import{_ as V,o as m,c as h,q as g,g as y,r as i,a as d,j as D,t as b,s as j,b as t,w as s,e as _,u as $,x as N,F as q,f as x,p as S,d as U}from"./index-2937f55a.js";const R={name:"InnerRouterView",props:{default:{type:Boolean,default:!1},visible:{default:!1},name:{type:String},title:{type:String}},data(){return{visible:!1}},computed:{currentViewName(){return this.$parent.currentViewName}},watch:{currentViewName(e){this.visible=e===this.name}},methods:{},created(){this.visible=this.$parent.currentViewName===this.name}},B={key:0,class:"inner-router-view"};function T(e,a,u,v,o,l){return o.visible?(m(),h("div",B,[g(e.$slots,"default")])):y("",!0)}const I=V(R,[["render",T]]);const E={name:"InnerRouterViewWindow",components:{InnerRouterView:I},data(){return{currentViewName:"",views:[],histories:[]}},computed:{currentView(){return this.views.find(e=>e.props.name===this.currentViewName).props}},methods:{push(e){this.histories.push(e),this.currentViewName=e,this.views=this.$slots.default()},back(){this.histories.pop(),this.currentViewName=this.histories[this.histories.length-1]},__getDefaultView(){let e=this.views.find(a=>a.props.default);return e==null&&(e=this.views[0].props.name),e}},created(){this.views=this.$slots.default(),this.currentViewName=this.__getDefaultView(),this.histories=[this.currentViewName]}},O={class:"inner-router-view-window"},P={class:"nav"},z={class:"title"},W={key:1},L={class:"routers"};function A(e,a,u,v,o,l){const n=i("el-button");return m(),h("div",O,[d("div",P,[d("div",z,[o.histories.length>1?(m(),D(n,{key:0,class:"button-icon",icon:"ArrowLeftBold",onClick:l.back},null,8,["onClick"])):y("",!0),l.currentView.title!=null&&l.currentView.title!==""?(m(),h("h4",W,b(l.currentView.title),1)):y("",!0)])]),d("div",L,[g(e.$slots,"default",{},void 0,!0)])])}const F=V(E,[["render",A],["__scopeId","data-v-daaa0815"]]);const H={name:"OperaDatabaseView",props:{project:{required:!0},database:{}},data(){return{form:this.database||{name:"",type:"mysql",host:"localhost",port:3306,schema:"",username:"root",password:""}}},methods:{save(){this.database==null&&this.project.databases.unshift(this.form),j({id:this.project.id,databases:this.project.databases}).then(()=>{this.$emit("success")}).catch(e=>{console.log("e",e)})}}},M={class:"opera-database-view"},Q={class:"opera"};function G(e,a,u,v,o,l){const n=i("el-input"),c=i("el-form-item"),f=i("el-option"),w=i("el-select"),k=i("el-form"),p=i("el-button");return m(),h("div",M,[t(k,null,{default:s(()=>[t(c,{label:"Name",required:""},{default:s(()=>[t(n,{modelValue:o.form.name,"onUpdate:modelValue":a[0]||(a[0]=r=>o.form.name=r)},null,8,["modelValue"])]),_:1}),t(c,{label:"Database Type",required:""},{default:s(()=>[t(w,{modelValue:o.form.type,"onUpdate:modelValue":a[1]||(a[1]=r=>o.form.type=r)},{default:s(()=>[t(f,{value:"mysql",label:"MySQL"}),t(f,{value:"oracle",label:"Oracle"})]),_:1},8,["modelValue"])]),_:1}),t(c,{label:"Host",required:""},{default:s(()=>[t(n,{modelValue:o.form.host,"onUpdate:modelValue":a[2]||(a[2]=r=>o.form.host=r)},null,8,["modelValue"])]),_:1}),t(c,{label:"Port",required:""},{default:s(()=>[t(n,{modelValue:o.form.port,"onUpdate:modelValue":a[3]||(a[3]=r=>o.form.port=r)},null,8,["modelValue"])]),_:1}),t(c,{label:"Schema",required:""},{default:s(()=>[t(n,{modelValue:o.form.schema,"onUpdate:modelValue":a[4]||(a[4]=r=>o.form.schema=r)},null,8,["modelValue"])]),_:1}),t(c,{label:"Username",required:""},{default:s(()=>[t(n,{modelValue:o.form.username,"onUpdate:modelValue":a[5]||(a[5]=r=>o.form.username=r)},null,8,["modelValue"])]),_:1}),t(c,{label:"Password",required:""},{default:s(()=>[t(n,{modelValue:o.form.password,"onUpdate:modelValue":a[6]||(a[6]=r=>o.form.password=r)},null,8,["modelValue"])]),_:1})]),_:1}),d("div",Q,[u.database==null?(m(),D(p,{key:0,type:"primary",size:"large",onClick:l.save},{default:s(()=>[_("Add Database")]),_:1},8,["onClick"])):(m(),D(p,{key:1,type:"primary",size:"large",onClick:l.save},{default:s(()=>[_("Confirm Update")]),_:1},8,["onClick"]))])])}const J=V(H,[["render",G],["__scopeId","data-v-84c7a766"]]);function K(e){return $.post("/db/mysql/connect/test",e)}const X={name:"DatabaseView",props:{database:{required:!0}},methods:{testConnect(){K({host:this.database.host,port:this.database.port,user:this.database.username,password:this.database.password,database:this.database.schema}).then(e=>{console.log("data",e)}).catch(e=>{console.log("e",e)})}}},Y={class:"toolbar"};function Z(e,a,u,v,o,l){const n=i("el-descriptions-item"),c=i("el-button"),f=i("el-descriptions");return m(),D(f,{title:u.database.name},{extra:s(()=>[d("ul",Y,[d("li",null,[t(c,{size:"small",onClick:l.testConnect},{default:s(()=>[_("Test Connection")]),_:1},8,["onClick"])]),d("li",null,[t(c,{size:"small",icon:"Edit",onClick:a[0]||(a[0]=w=>e.$emit("edit"))},{default:s(()=>[_("Edit")]),_:1})]),d("li",null,[t(c,{size:"small",icon:"Delete",onClick:a[1]||(a[1]=w=>e.$emit("delete"))},{default:s(()=>[_("Delete")]),_:1})])])]),default:s(()=>[t(n,{label:"Type"},{default:s(()=>[_(b(u.database.type),1)]),_:1}),t(n,{label:"Host"},{default:s(()=>[_(b(u.database.host),1)]),_:1}),t(n,{label:"Port"},{default:s(()=>[_(b(u.database.port),1)]),_:1}),t(n,{label:"Schema"},{default:s(()=>[_(b(u.database.schema),1)]),_:1}),t(n,{label:"Username"},{default:s(()=>[_(b(u.database.username),1)]),_:1}),t(n,{label:"Password"},{default:s(()=>[_(b(u.database.password),1)]),_:1})]),_:1},8,["title"])}const ee=V(X,[["render",Z],["__scopeId","data-v-ce35eb48"]]);const te={components:{DatabaseView:ee,OperaDatabaseView:J,InnerRouterViewWindow:F,InnerRouterView:I},data(){return{projectId:null,project:null,currentDatabase:null}},computed:{operaDbTitle(){return this.currentDatabase==null?"Create New Database":`Edit ${this.currentDatabase.name}`}},methods:{fetchProject(){N(this.projectId).then(e=>{this.project={...e,databases:e.databases||[]}}).catch(e=>{console.log("e",e)})},add(){this.currentDatabase=null,this.$refs.window.push("operaDatabase")},edit(e){this.currentDatabase=e,this.$refs.window.push("operaDatabase")},deleteDatabase(e){this.project.databases.splice(e,1),this.__save()},connect(e){},__save(){j({id:this.project.id,databases:this.project.databases}).then(()=>{this.$emit("success")}).catch(e=>{console.log("e",e)})}},created(){this.projectId=this.$route.query.project_id,this.fetchProject()}},ae=e=>(S("data-v-82d9cfb5"),e=e(),U(),e),se={class:"form"},oe={key:0,class:"wrap"},ne=ae(()=>d("section",{class:"tip"}," The database information will only be stored on your device. ",-1)),le={class:"database-list-wrap"},re={class:"toolbar"},ie={class:"database-list"};function de(e,a,u,v,o,l){const n=i("el-button"),c=i("DatabaseView"),f=i("InnerRouterView"),w=i("OperaDatabaseView"),k=i("InnerRouterViewWindow");return m(),h("div",se,[o.project!=null?(m(),h("div",oe,[d("h2",null,b(o.project.name)+" Databases",1),ne,t(k,{ref:"window"},{default:s(()=>[t(f,{name:"databaseList",default:""},{default:s(()=>[d("div",le,[d("ul",re,[d("li",null,[t(n,{type:"primary",onClick:l.add},{default:s(()=>[_("Add New Database")]),_:1},8,["onClick"])])]),d("ul",ie,[(m(!0),h(q,null,x(o.project.databases,(p,r)=>(m(),h("li",{key:p.name},[t(c,{database:p,onEdit:C=>l.edit(p),onDelete:C=>l.deleteDatabase(r),onConnect:C=>l.connect(p)},null,8,["database","onEdit","onDelete","onConnect"])]))),128))])])]),_:1}),t(f,{name:"operaDatabase",title:l.operaDbTitle},{default:s(()=>[t(w,{project:o.project,database:o.currentDatabase,onSuccess:a[0]||(a[0]=p=>e.$refs.window.back())},null,8,["project","database"])]),_:1},8,["title"])]),_:1},512)])):y("",!0)])}const ue=V(te,[["render",de],["__scopeId","data-v-82d9cfb5"]]);export{ue as default};
