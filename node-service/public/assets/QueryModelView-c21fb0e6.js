import{_ as V,r as b,o as u,g as C,w as p,b as r,c as f,f as w,F as T,a0 as L,i as x,a as s,t as _,j as M,x as K,K as B,A,I as Q,H as k,a5 as $,e as S,m as N,a6 as z,a7 as G,E as X,a8 as O,a9 as Y,aa as Z,B as ee,a4 as te,C as le,a3 as ne,p as ae,l as ie}from"./index-ba5c27dc.js";import{a as se,I as oe}from"./InnerRouterViewWindow-bf82daa9.js";import{b as E}from"./form.check-189b470c.js";const I={join:{color:"#eee",hoverColor:"#faa5aa",selectedColor:"#FC777D"},aggregate:{color:"#FFE957",hoverColor:"#faa5aa",selectedColor:"#FC777D"}},re={name:"RelationLine",props:{start:{required:!0},end:{required:!0},selected:{default:!1},lineType:{required:!0}},data(){return{lineConfig:{x:0,y:0,stroke:"#ccc",strokeWidth:4,lineJoin:"round",lineCap:"round"}}},computed:{position(){return[this.start,this.end]}},watch:{position(){this.init()},selected(){this.selected?this.highlight(!0,this.selected):this.highlight(!1,this.selected)}},methods:{handleSelect(){this.selected?this.$emit("unselect"):this.$emit("select")},highlight(e=!0,t=!1){const n=this.$refs.line.getNode();if(e)t?(n.setAttr("stroke",I[this.lineType].selectedColor),n.zIndex(101)):(n.setAttr("stroke",I[this.lineType].hoverColor),n.zIndex(100)),n.setAttr("strokeWidth",5);else{if(n.zIndex(1),t)return;n.setAttr("stroke",I[this.lineType].color),n.setAttr("strokeWidth",4)}},init(){this.lineConfig.stroke=I[this.lineType].color;const e=[];this.start.y!==this.end.y&&(this.end.x-this.start.x>0?this.end.x-this.start.x<50?(this.start.x-=200,e.push(this.start.x-50),e.push(this.start.y),e.push(this.start.x-50),e.push(this.end.y)):(e.push(this.start.x+(this.end.x-this.start.x)/2),e.push(this.start.y),e.push(this.start.x+(this.end.x-this.start.x)/2),e.push(this.end.y)):Math.abs(this.end.x-this.start.x)<200?(this.start.x-=200,e.push(this.start.x-50),e.push(this.start.y),e.push(this.start.x-50),e.push(this.end.y)):Math.abs(this.end.x-this.start.x)<450?(this.end.x+=200,e.push(this.start.x+50),e.push(this.start.y),e.push(this.start.x+50),e.push(this.end.y)):(this.start.x-=200,this.end.x+=200,e.push(this.start.x-Math.abs(this.end.x-this.start.x)/2),e.push(this.start.y),e.push(this.start.x-Math.abs(this.end.x-this.start.x)/2),e.push(this.end.y))),this.lineConfig.points=[this.start.x,this.start.y,...e,this.end.x,this.end.y]}},created(){this.init()}};function de(e,t,n,d,a,l){const o=b("v-line");return u(),C(o,{ref:"line",config:a.lineConfig,onMouseenter:t[0]||(t[0]=m=>l.highlight(!0,n.selected)),onMouseleave:t[1]||(t[1]=m=>l.highlight(!1,n.selected)),onClick:l.handleSelect},null,8,["config","onClick"])}const W=V(re,[["render",de],["__scopeId","data-v-6a26c54d"]]),ue={name:"Table",props:{x:{default:0},y:{default:0},fieldHeight:{default:30},table:{required:!0},relations:{required:!0},selected:{default:!1}},data(){const e=this;return{layerConfig:{x:e.x,y:e.y,draggable:!1}}},computed:{backgroundConfig(){return{width:200,height:(this.visibleFields.length+1)*this.fieldHeight,fill:"#fafafa"}},tableNameConfig(){return{text:this.table.name,x:10,y:8,fontSize:15,fill:"#fff"}},tableHeaderConfig(){return{width:200,height:this.fieldHeight,fill:this.table.type==="MAIN"?"#FC777D":"#666"}},relation(){return this.relations.find(e=>e.targetTable===this.table.name)},visibleFields(){return this.table.fields.filter(e=>e.visible===!0)}},watch:{selected(e){if(e){this.select();return}this.select(!1)}},methods:{selectTable(e){this.$emit("table:select",this.table.id)},previewTable(e){this.$emit("table:preview",this.table.id)},select(e=!0){const t=this.$refs.background.getNode();e?(t.setAttr("stroke",(this.table.type==="MAIN","#FC777D")),t.setAttr("strokeWidth",5)):t.setAttr("strokeWidth",0)},handleHeaderMouseover(e){this.getNode().draggable(!0),window.document.body.style.cursor="move"},handleHeaderMouseleave(e){this.getNode().draggable(!1),window.document.body.style.cursor="default"},getNode(){return this.$refs.table.getNode()},handleFieldMouseDown(e){this.getNode().draggable(!1),this.$emit("field:mousedown",{table:this.table,field:e})},handleFieldMouseUp(e){this.getNode().draggable(!0),this.$emit("field:mouseup",{table:this.table,field:e})}}};function ce(e,t,n,d,a,l){const o=b("v-rect"),m=b("v-text"),g=b("v-layer");return u(),C(g,{ref:"table",config:a.layerConfig},{default:p(()=>[r(o,{ref:"background",config:l.backgroundConfig},null,8,["config"]),r(o,{config:l.tableHeaderConfig,onMouseover:l.handleHeaderMouseover,onMouseleave:l.handleHeaderMouseleave,onClick:l.selectTable,onDblclick:l.previewTable},null,8,["config","onMouseover","onMouseleave","onClick","onDblclick"]),r(m,{config:l.tableNameConfig,onMouseover:l.handleHeaderMouseover,onMouseleave:l.handleHeaderMouseleave,onClick:l.selectTable,onDblclick:l.previewTable},null,8,["config","onMouseover","onMouseleave","onClick","onDblclick"]),(u(!0),f(T,null,w(l.visibleFields,(c,i)=>(u(),C(o,{key:c.name,config:{y:i*n.fieldHeight+l.tableHeaderConfig.height,width:200,height:n.fieldHeight,fill:"#fff"},onMousedown:v=>l.handleFieldMouseDown(c),onMouseup:v=>l.handleFieldMouseUp(c)},null,8,["config","onMousedown","onMouseup"]))),128)),(u(!0),f(T,null,w(l.visibleFields,(c,i)=>(u(),C(m,{key:c,config:{text:c.name,x:10,y:i*n.fieldHeight+l.tableHeaderConfig.height+10,fontSize:13,fill:"#333"},onMousedown:v=>l.handleFieldMouseDown(c),onMouseup:v=>l.handleFieldMouseUp(c)},null,8,["config","onMousedown","onMouseup"]))),128))]),_:1},8,["config"])}const P=V(ue,[["render",ce]]);const he={name:"QueryModelDesigner",components:{Table:P,RelationLine:W},props:{model:{},fieldHeight:{default:30}},data(){return{rendered:!0,configKonva:{width:1260,height:1e3,draggable:!0},relationLines:[],relationRuntime:{table:null,field:null,targetTable:null,targetField:null}}},computed:{tableLength(){return this.model.tables.length},reRenderFactors(){return[this.tableLength,this.model]}},watch:{reRenderFactors(){this.render()}},methods:{handleDelete(){if(this.model.selectedLineId!=null){this.__deleteLine();return}this.model.selectedTableId!=null&&this.__deleteTable()},globalClick(e){e.target.nodeType==="Stage"&&(this.model.selectedTableId=null,this.model.previewTableId=null,this.model.selectedLineId=null)},moveTable(){for(const e of this.model.tables){const t=this.$refs[e.id][0].getNode().getAbsolutePosition();e.x=t.x,e.y=t.y}this.computeRelations()},computeRelations(){this.relationLines=[];for(const e of this.model.joins){const t=this.model.tables.find(d=>d.id===e.table.id),n=this.model.tables.find(d=>d.id===e.targetTable.id);for(const d of e.ons){const a=this.__getFieldPosition(t,d.field),l=this.__getFieldPosition(n,d.targetField,!1);a==null||l==null||this.relationLines.push({id:L(),start:a,end:l,type:"join",table:e.table,field:d.field,targetTable:e.targetTable,targetField:d.targetField})}}for(const e of this.model.aggregates){const t=this.__getFieldPosition(e.table,e.field),n=this.__getFieldPosition(e.targetTable,e.targetField,!1);t==null||n==null||this.relationLines.push({id:L(),start:t,end:n,type:"aggregate",table:e.table,field:e.field,targetTable:e.targetTable,targetField:e.targetField})}},handleFieldMouseDown({table:e,field:t}){this.$refs.stage.getNode().draggable(!1),this.relationRuntime.table=e,this.relationRuntime.field=t},handleFieldMouseUp({table:e,field:t}){if(!(this.relationRuntime.table==null||(this.$refs.stage.getNode().draggable(!0),this.relationRuntime.targetTable=e,this.relationRuntime.targetField=t,this.relationRuntime.table.id===this.relationRuntime.targetTable.id))){if(this.model.lineType==="join"){this.__addJoinRelation(),this.$emit("change");return}this.model.lineType==="aggregate"&&(this.__addAggregate(),this.$emit("change"))}},handleTableSelect(e){this.model.selectedTableId=e,this.model.selectedLineId=null,this.model.previewTableId=null},handleLineSelect(e){this.model.selectedLineId=e.id,this.model.selectedTableId=null,this.model.previewTableId=null},handleTablePreview(e){this.model.previewTableId=e},handleDrop(e,t){const n=this.$refs.stage.getNode();n.setPointersPositions(e);const d=n.getPointerPosition(),a={width:200,height:(this.model.dragData.fields.length+1)*this.fieldHeight},l={...this.model.dragData,fields:this.model.dragData.fields.map(o=>({...o,alias:o.name,visible:!0,isVirtual:!1})),isVirtual:!1,type:this.model.tables.length===0?"MAIN":"SUB",x:d.x-a.width/2,y:d.y-a.height/2,id:L(),joins:[]};this.model.tables.push(l),this.$emit("change")},confirmCreateVirtualTable(){const e={width:200,height:this.fieldHeight},t={id:L(),name:this.model.name,alias:this.model.name,comment:this.model.comment,...e,type:"MAIN",isVirtual:!0,x:100,y:100,joins:[],aggregates:[]};t.fields=this.__getVirtualTableDefaultFields(t),this.model.tables.push(t),this.$emit("change")},render(){this.rendered=!1,this.$nextTick(()=>{this.rendered=!0,this.$nextTick(()=>{const t=this.$refs.stage.getNode().container();t.addEventListener("dragover",function(n){n.preventDefault()}),t.addEventListener("drop",n=>{n.preventDefault(),this.handleDrop(n,2)}),this.computeRelations()})})},__getVirtualTableDefaultFields(e){return JSON.parse(JSON.stringify([{name:"field1",alias:"field1",type:"int",length:0,decimal:0,required:!1,isPrimaryKey:!1,isAutoIncrement:!1,comment:"Virtual field 1",isVirtual:!0,visible:!0,table:e},{name:"field2",alias:"field2",type:"int",length:0,decimal:0,required:!1,isPrimaryKey:!1,isAutoIncrement:!1,comment:"Virtual field 2",isVirtual:!0,visible:!0,table:e},{name:"field3",alias:"field3",type:"int",length:0,decimal:0,required:!1,isPrimaryKey:!1,isAutoIncrement:!1,comment:"Virtual field 3",isVirtual:!0,visible:!0,table:e}]))},__deleteLine(){const e=this.relationLines.find(t=>t.id===this.model.selectedLineId);if(e.type==="join"){const t=this.model.joins.findIndex(a=>a.table.id===e.table.id&&a.targetTable.id===e.targetTable.id),n=this.model.joins[t],d=n.ons.findIndex(a=>a.field.name===e.field.name&&a.targetField.name===e.targetField.name);d!==-1&&n.ons.splice(d,1),n.ons.length===0&&this.model.joins.splice(t,1)}else{const t=this.model.aggregates.findIndex(n=>n.table.id===e.table.id&&n.targetTable.id===e.targetTable.id&&n.field.name===e.field.name&&n.targetField.name===e.targetField.name);this.model.aggregates.splice(t,1)}this.model.selectedLineId=null,this.$emit("change"),this.render()},__deleteTable(){const e=this.model.tables.findIndex(d=>d.id===this.model.selectedTableId),t=this.model.tables[e];let n=Promise.resolve();t.type==="MAIN"&&this.model.tables.length>1&&(n=this.deleteConfirm("Deleting the main table will delete all the schedules and associations. Are you sure to delete it?")),n.then(()=>{if(t.type==="MAIN"){this.model.tables=[],this.model.joins=[],this.model.aggregates=[],this.$emit("change");return}this.model.joins=this.model.joins.filter(d=>!(d.table.id===this.model.selectedTableId||d.targetTable.id===this.model.selectedTableId)),this.model.aggregates=this.model.aggregates.filter(d=>{if(d.table.id===this.model.selectedTableId||d.targetTable.id===this.model.selectedTableId)return!1}),this.model.tables.splice(e,1),this.$emit("change")}).catch(()=>{})},__addJoinRelation(){if(this.relationRuntime.table.id===this.relationRuntime.targetTable.id){this.$tip.warning("The join relationship cannot be created.");return}let e=this.model.joins.find(t=>t.table.id===this.relationRuntime.table.id&&t.targetTable.id===this.relationRuntime.targetTable.id);e==null&&(e={table:this.relationRuntime.table,targetTable:this.relationRuntime.targetTable,joinType:"INNER JOIN",relation:"ONE-TO-ONE",ons:[]},this.model.joins.push(e)),e.ons.push({field:this.relationRuntime.field,targetField:this.relationRuntime.targetField,relation:"AND"}),this.computeRelations()},__addAggregate(){if(this.relationRuntime.table.id===this.relationRuntime.targetTable.id){this.$tip.warning("The aggregate relationship cannot be created.");return}let e=this.model.aggregates.find(t=>t.table.id===this.relationRuntime.table.id&&t.targetTable.id===this.relationRuntime.targetTable.id&&(t.field.name===this.relationRuntime.field.name||t.targetField.name===this.relationRuntime.targetField.name));e==null&&(e={table:this.relationRuntime.table,targetTable:this.relationRuntime.targetTable,field:this.relationRuntime.field,targetField:this.relationRuntime.targetField,function:"COUNT"},this.model.aggregates.push(e)),this.computeRelations()},__getFieldPosition(e,t,n=!0){const a=this.$refs.stage.getNode().getAbsolutePosition();let l=e.fields.findIndex(c=>c.visible&&c.name===t.name);if(l===-1)return null;let o=l;for(let c=0;c<o;c++)e.fields[c].visible||l--;if(l===-1)return null;const m=e.x+(n?200:0)-a.x,g=e.y+this.fieldHeight+(l+1)*this.fieldHeight-15-a.y;return{x:m,y:g}}},mounted(){this.render()}},me={class:"wrap"};function ge(e,t,n,d,a,l){const o=b("Table"),m=b("RelationLine"),g=b("v-layer"),c=b("v-stage");return u(),f(T,null,[n.model.tables.length===0?(u(),f("div",{key:0,class:"empty-tip",onDragover:t[1]||(t[1]=x(()=>{},["prevent"])),onDrop:t[2]||(t[2]=i=>l.handleDrop(i,1))},[s("div",me,[s("p",null,_(e.$t("database.dragTip")),1),s("p",null,_(e.$t("common.or")),1),s("p",null,[s("em",{onClick:t[0]||(t[0]=(...i)=>l.confirmCreateVirtualTable&&l.confirmCreateVirtualTable(...i))},_(e.$t("database.createVirtualTableTip")),1)])])],32)):M("",!0),s("div",{class:"stage-wrap",tabindex:"-1",onKeyup:t[5]||(t[5]=K((...i)=>l.handleDelete&&l.handleDelete(...i),["delete"]))},[a.rendered?(u(),C(c,{key:0,ref:"stage",config:a.configKonva,onMouseup:t[4]||(t[4]=i=>e.$refs.stage.getNode().draggable(!0)),onClick:l.globalClick},{default:p(()=>[(u(!0),f(T,null,w(n.model.tables,i=>(u(),C(o,{ref_for:!0,ref:i.id,key:i.name,"field-height":n.fieldHeight,x:i.x,y:i.y,table:i,relations:n.model.joins,selected:n.model.selectedTableId===i.id,onDragmove:l.moveTable,"onField:mousedown":l.handleFieldMouseDown,"onField:mouseup":l.handleFieldMouseUp,"onTable:select":l.handleTableSelect,"onTable:preview":l.handleTablePreview},null,8,["field-height","x","y","table","relations","selected","onDragmove","onField:mousedown","onField:mouseup","onTable:select","onTable:preview"]))),128)),r(g,null,{default:p(()=>[(u(!0),f(T,null,w(a.relationLines,i=>(u(),C(m,{key:i.id,"line-type":i.type,start:i.start,end:i.end,selected:n.model.selectedLineId===i.id,onSelect:v=>l.handleLineSelect(i),onUnselect:t[3]||(t[3]=v=>n.model.selectedLineId=null)},null,8,["line-type","start","end","selected","onSelect"]))),128))]),_:1})]),_:1},8,["config","onClick"])):M("",!0)],32)],64)}const be=V(he,[["render",ge],["__scopeId","data-v-94c889e2"]]);const fe={name:"SQLLine",props:{type:{},indent:{default:0},visible:{default:!0}}},_e={class:"code"},pe={class:"opera"},ye={key:0},ve={key:1},Te={key:2};function Ce(e,t,n,d,a,l){const o=b("el-button");return u(),f("div",{class:k(["sql-line",{"sql-line__hide":!n.visible}]),style:$({"padding-left":n.indent+"px"})},[s("p",_e,[B(e.$slots,"default",{},void 0,!0)]),s("ul",pe,[n.type==="field"?(u(),f("li",ye,[A(r(o,{icon:"View",onClick:t[0]||(t[0]=m=>e.$emit("update:visible",!1))},null,512),[[Q,n.visible]]),A(r(o,{icon:"Hide",onClick:t[1]||(t[1]=m=>e.$emit("update:visible",!0))},null,512),[[Q,!n.visible]])])):M("",!0),n.type==="virtual-field"?(u(),f("li",ve,[r(o,{icon:"Delete",onClick:t[2]||(t[2]=m=>e.$emit("field:delete",!1))})])):M("",!0),n.type==="select"?(u(),f("li",Te,[r(o,{icon:"Plus",onClick:t[3]||(t[3]=m=>e.$emit("field:create"))})])):M("",!0)])],6)}const U=V(fe,[["render",Ce],["__scopeId","data-v-baeab383"]]);const Me={name:"DynamicWidthInput",props:{modelValue:{}},data(){return{value:this.modelValue}},watch:{modelValue:{immediate:!0,handler(){this.value=this.modelValue}}},methods:{handleInput(e){this.value=e.target.innerText,this.$emit("update:modelValue",e.target.innerText),this.$emit("change",e.target.innerText)},handleBlur(){this.$emit("update:blur-model-value",this.value),this.$emit("blur")}}};function Ve(e,t,n,d,a,l){return u(),f("div",{class:"dynamic-width-input",contenteditable:!0,onInput:t[0]||(t[0]=(...o)=>l.handleInput&&l.handleInput(...o)),onBlur:t[1]||(t[1]=(...o)=>l.handleBlur&&l.handleBlur(...o))},_(n.modelValue),33)}const R=V(Me,[["render",Ve],["__scopeId","data-v-208cca2b"]]);const we={name:"SQLLineKeywordSelect",props:{data:{type:Array,required:!0}}};function Se(e,t,n,d,a,l){const o=b("el-option"),m=b("el-select");return u(),C(m,null,{default:p(()=>[(u(!0),f(T,null,w(n.data,g=>(u(),C(o,{key:g,value:g,label:g},null,8,["value","label"]))),128))]),_:1})}const j=V(we,[["render",Se],["__scopeId","data-v-919f06f3"]]);const ke={name:"SQLPreview",data(){return{visible:!1,result:[]}},computed:{columns(){if(this.result.length===0)return[];const e=[];for(const t in this.result[0])e.push(t);return e},rows(){return this.result}},methods:{open(e){this.visible=!0,this.result=e},getColumnWidth(e){return e.length*15}}};function De(e,t,n,d,a,l){const o=b("el-table-column"),m=b("el-table"),g=b("el-dialog");return u(),C(g,{"custom-class":"sql-preview",title:"Query Result",modelValue:a.visible,"onUpdate:modelValue":t[0]||(t[0]=c=>a.visible=c),"append-to-body":""},{default:p(()=>[r(m,{data:a.result},{default:p(()=>[(u(!0),f(T,null,w(l.columns,c=>(u(),C(o,{key:c,prop:c,label:c,"min-width":l.getColumnWidth(c)},null,8,["prop","label","min-width"]))),128))]),_:1},8,["data"])]),_:1},8,["modelValue"])}const Fe=V(ke,[["render",De]]),Le={name:"SQLJoin",components:{DynamicWidthInput:R,SQLLine:U,SQLLineKeywordSelect:j},props:{table:{required:!0},joins:{required:!0},indentLevel:{default:1}},computed:{indent(){return`${(this.indentLevel-1)*20}px`},currentTableJoins(){return this.joins.filter(e=>e.table.id===this.table.id)}},methods:{handleChange(){this.$emit("field:change")}}},Ie={class:"hidden"},xe=s("em",null,"ON",-1),$e={class:"join-ons"},Ne=s("span",null,".",-1),Ue=s("span",null,"=",-1),Re=s("span",null,".",-1);function je(e,t,n,d,a,l){const o=b("SQLLineKeywordSelect"),m=b("DynamicWidthInput"),g=b("SQLLine");return u(),f("ul",{class:"joins",style:$({"padding-left":l.indent})},[(u(!0),f(T,null,w(l.currentTableJoins,c=>(u(),f("li",null,[r(g,null,{default:p(()=>[r(o,{modelValue:c.joinType,"onUpdate:modelValue":i=>c.joinType=i,data:["INNER JOIN","LEFT JOIN","RIGHT JOIN","OUTER JOIN"],class:"keyword",style:{width:"100px"},onChange:l.handleChange},null,8,["modelValue","onUpdate:modelValue","onChange"]),s("span",Ie,_(c.joinType),1),s("span",null,_(c.targetTable.name),1),r(m,{modelValue:c.targetTable.alias,"onUpdate:modelValue":i=>c.targetTable.alias=i,onChange:l.handleChange},null,8,["modelValue","onUpdate:modelValue","onChange"]),xe,r(o,{modelValue:c.relation,"onUpdate:modelValue":i=>c.relation=i,data:["ONE-TO-ONE","ONE-TO-MANY","MANY-TO-ONE"],class:"relation",style:{width:"115px"},onChange:l.handleChange},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:2},1024),s("ul",$e,[(u(!0),f(T,null,w(c.ons,(i,v)=>(u(),C(g,{indent:"20"},{default:p(()=>[v!==0?(u(),C(o,{key:0,modelValue:i.relation,"onUpdate:modelValue":h=>i.relation=h,data:["AND","OR"],style:{width:"40px"},onChange:l.handleChange},null,8,["modelValue","onUpdate:modelValue","onChange"])):M("",!0),r(m,{modelValue:c.targetTable.alias,"onUpdate:modelValue":h=>c.targetTable.alias=h,onChange:l.handleChange},null,8,["modelValue","onUpdate:modelValue","onChange"]),Ne,s("span",null,_(i.targetField.name),1),Ue,r(m,{modelValue:c.table.alias,"onUpdate:modelValue":h=>c.table.alias=h,onChange:l.handleChange},null,8,["modelValue","onUpdate:modelValue","onChange"]),Re,s("span",null,_(i.field.name),1)]),_:2},1024))),256))])]))),256))],4)}const qe=V(Le,[["render",je]]),Ae={name:"SQL",components:{SQLJoin:qe,DynamicWidthInput:R,SQLLine:U,SQLLineKeywordSelect:j},props:{table:{required:!0},joins:{required:!0},aggregates:{required:!0}},computed:{currentTableJoins(){return this.joins.filter(e=>e.table.id===this.table.id)},visibleFields(){let e=new Set;for(const t of this.table.fields)t.table=this.table,t.alias=t.name,e.add(t);for(const t of this.joins)if(t.table.id===this.table.id)for(const n of t.targetTable.fields)n.table=t.targetTable,n.alias=n.name,e.add(n);return[...e]}},methods:{handleChange(){this.$emit("field:change")},createVirtualField(){this.table.fields.push({name:"virtual1",alias:"virtual1",type:"int",comment:"Virtual field 1",isVirtual:!0,visible:!0}),this.handleChange()},getAggregate(e){const t=this.aggregates.find(n=>n.field.name===e.name);return t??null},fieldVisibleChange(){this.$emit("field:change")},deleteVirtualField(e){this.table.fields.splice(e,1),this.handleChange()},__getAggregateFunctionWidth(e){return{COUNT:63,SUM:42,AVG:40,MAX:42,MIN:38}[e]}}},Qe=s("em",null,"SELECT",-1),Ee=s("em",null,"SELECT",-1),Oe={class:"hidden"},We=s("span",null,"(",-1),Pe=s("span",null,".",-1),He=s("span",null,")",-1),Je=s("em",null,"FROM",-1),Ke=s("span",null,")",-1),Be=s("em",null,"AS",-1),ze=s("span",{class:"comment"},"#",-1),Ge=s("span",null,".",-1),Xe=s("em",null,"AS",-1),Ye=s("em",null,"AS",-1),Ze=s("span",{class:"comment"},"#",-1),et=s("em",null,"FROM",-1),tt=s("em",null,"AS",-1);function lt(e,t,n,d,a,l){const o=b("SQLLine"),m=b("SQLLineKeywordSelect"),g=b("DynamicWidthInput"),c=b("SQLJoin");return u(),f(T,null,[r(o,{type:"select","onField:create":l.createVirtualField},{default:p(()=>[Qe]),_:1},8,["onField:create"]),(u(!0),f(T,null,w(l.visibleFields,(i,v)=>(u(),f(T,null,[l.getAggregate(i)?(u(),f(T,{key:0},[r(o,{indent:"20",visible:i.visible},{default:p(()=>[S("(")]),_:2},1032,["visible"]),r(o,{indent:"40",visible:i.visible},{default:p(()=>[Ee]),_:2},1032,["visible"]),r(o,{indent:"60",visible:i.visible},{default:p(()=>[r(m,{modelValue:l.getAggregate(i).function,"onUpdate:modelValue":h=>l.getAggregate(i).function=h,data:["COUNT","SUM","AVG","MAX","MIN"],style:$(`width: ${l.__getAggregateFunctionWidth(l.getAggregate(i).function)}px;`),onChange:l.handleChange},null,8,["modelValue","onUpdate:modelValue","style","onChange"]),s("span",Oe,_(l.getAggregate(i).function),1),We,r(g,{modelValue:l.getAggregate(i).targetTable.alias,"onUpdate:modelValue":h=>l.getAggregate(i).targetTable.alias=h,onChange:l.handleChange},null,8,["modelValue","onUpdate:modelValue","onChange"]),Pe,s("span",null,_(l.getAggregate(i).targetField.name),1),He]),_:2},1032,["visible"]),r(o,{indent:"40",visible:i.visible},{default:p(()=>[Je,s("span",null,_(l.getAggregate(i).targetTable.name),1),r(g,{modelValue:l.getAggregate(i).targetTable.alias,"onUpdate:modelValue":h=>l.getAggregate(i).targetTable.alias=h,onChange:l.handleChange},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:2},1032,["visible"]),r(c,{"indent-level":3,joins:n.joins,table:l.getAggregate(i).targetTable},null,8,["joins","table"]),r(o,{indent:"20",type:i.isVirtual?"virtual-field":"field",visible:i.visible,"onUpdate:visible":[h=>i.visible=h,l.fieldVisibleChange],"onField:delete":h=>l.deleteVirtualField(v)},{default:p(()=>[Ke,Be,r(g,{modelValue:i.alias,"onUpdate:modelValue":h=>i.alias=h},null,8,["modelValue","onUpdate:modelValue"]),s("span",null,_(l.visibleFields.length===v+1?"":","),1),i.isVirtual?(u(),f(T,{key:0},[ze,r(g,{modelValue:i.type,"onUpdate:modelValue":h=>i.type=h,class:"comment",onChange:l.handleChange},null,8,["modelValue","onUpdate:modelValue","onChange"]),r(g,{modelValue:i.comment,"onUpdate:modelValue":h=>i.comment=h,class:"comment",onChange:l.handleChange},null,8,["modelValue","onUpdate:modelValue","onChange"])],64)):M("",!0)]),_:2},1032,["type","visible","onUpdate:visible","onField:delete"])],64)):(u(),C(o,{key:i.name,type:i.isVirtual?"virtual-field":"field",visible:i.visible,"onUpdate:visible":[h=>i.visible=h,l.fieldVisibleChange],indent:"20","onField:delete":h=>l.deleteVirtualField(v)},{default:p(()=>[r(g,{modelValue:i.table.alias,"onUpdate:modelValue":h=>i.table.alias=h,onChange:l.handleChange},null,8,["modelValue","onUpdate:modelValue","onChange"]),Ge,i.isVirtual?(u(),f(T,{key:1},[r(g,{"model-value":i.name,"blur-model-value":i.name,"onUpdate:blurModelValue":h=>i.name=h,onBlur:l.handleChange},null,8,["model-value","blur-model-value","onUpdate:blurModelValue","onBlur"]),Ye,r(g,{"model-value":i.alias,"blur-model-value":i.alias,"onUpdate:blurModelValue":h=>i.alias=h,onBlur:l.handleChange},null,8,["model-value","blur-model-value","onUpdate:blurModelValue","onBlur"]),s("span",null,_(l.visibleFields.length===v+1?"":","),1),Ze,r(g,{modelValue:i.type,"onUpdate:modelValue":h=>i.type=h,class:"comment",onChange:l.handleChange},null,8,["modelValue","onUpdate:modelValue","onChange"]),r(g,{modelValue:i.comment,"onUpdate:modelValue":h=>i.comment=h,class:"comment",onChange:l.handleChange},null,8,["modelValue","onUpdate:modelValue","onChange"])],64)):(u(),f(T,{key:0},[s("span",null,_(i.name),1),Xe,r(g,{modelValue:i.alias,"onUpdate:modelValue":h=>i.alias=h,onChange:l.handleChange},null,8,["modelValue","onUpdate:modelValue","onChange"]),s("span",null,_(l.visibleFields.length===v+1?"":","),1)],64))]),_:2},1032,["type","visible","onUpdate:visible","onField:delete"]))],64))),256)),n.table.isVirtual?M("",!0):(u(),C(o,{key:0},{default:p(()=>[et,s("span",null,_(n.table.name),1),tt,r(g,{modelValue:n.table.alias,"onUpdate:modelValue":t[0]||(t[0]=i=>n.table.alias=i),onChange:l.handleChange},null,8,["modelValue","onChange"])]),_:1})),r(c,{joins:n.joins,table:n.table},null,8,["joins","table"])],64)}const nt=V(Ae,[["render",lt]]);const at={name:"TableSetting",components:{SQL:nt,SQLPreview:Fe,SQLLineKeywordSelect:j,DynamicWidthInput:R,SQLLine:U},props:{table:{required:!0},joins:{type:Array},aggregates:{type:Array}},computed:{...N(["currentDatabase"]),visibleFields(){let e=new Set;for(const t of this.table.fields)t.table=this.table,t.alias=t.name,e.add(t);for(const t of this.joins)if(t.table.id===this.table.id)for(const n of t.targetTable.fields)n.table=t.targetTable,n.alias=n.name,e.add(n);return[...e]}},methods:{copy(){z({sql:this.__getSql()}).then(e=>navigator.clipboard.writeText(e)).then(()=>{this.$tip.success("Copy successfully.")}).catch(e=>{this.$tip.apiFailed(e)})},execute(){const e=this.__getSql();G({database:this.currentDatabase,sql:e}).then(t=>{this.$refs.sqlPreview.open(t)}).catch(t=>{this.$tip.apiFailed(t)})},handleChange(){this.$emit("field:change")},__getSql(){let e=[];e.push("SELECT");for(const t of this.visibleFields){if(!t.visible)continue;const n=this.getAggregate(t);n!=null?(e.push("(SELECT"),e.push(`${n.function}(${n.targetTable.alias}.${n.targetField.name})`),e.push(`FROM ${n.targetTable.name} AS ${n.targetTable.alias}`),e=e.concat(this.__getJoinSql(n.targetTable,this.joins)),e.push(`) AS ${n.field.name},`)):e.push(`${t.table.alias}.${t.name} AS ${t.alias},`)}return e[e.length-1]=e[e.length-1].substring(0,e[e.length-1].length-1),this.table.isVirtual||e.push(`FROM ${this.table.name} AS ${this.table.alias}`),e=e.concat(this.__getJoinSql(this.table,this.joins)),e.join(`
`)},__getJoinSql(e,t){const n=[],d=t.filter(a=>a.table.id===e.id);for(const a of d){n.push(`${a.joinType} ${a.targetTable.name} ${a.targetTable.alias}`);for(let l=0;l<a.ons.length;l++){const o=a.ons[l];let m=l===0?"ON ":`${o.relation} `;n.push(`${m}${a.targetTable.alias}.${o.targetField.name} = ${a.table.alias}.${o.field.name}`)}}return n},getAggregate(e){const t=this.aggregates.find(n=>n.field.name===e.name);return t??null}}},it={class:"toolbar"},st={key:0,class:"wrap"};function ot(e,t,n,d,a,l){const o=b("el-button"),m=b("SQL"),g=b("SQLPreview");return u(),f("div",{class:k(["table-setting",{visible:n.table!=null}])},[s("div",it,[r(o,{type:"primary",class:"button-copy","data-clipboard-text":"Hello World",onClick:l.copy},{default:p(()=>[S(_(e.$t("common.copy")),1)]),_:1},8,["onClick"]),r(o,{type:"primary",onClick:l.execute},{default:p(()=>[S(_(e.$t("common.execute")),1)]),_:1},8,["onClick"])]),n.table!=null?(u(),f("div",st,[r(m,{aggregates:n.aggregates,joins:n.joins,table:n.table,"onField:change":l.handleChange},null,8,["aggregates","joins","table","onField:change"])])):M("",!0),r(g,{ref:"sqlPreview"},null,512)],2)}const rt=V(at,[["render",ot],["__scopeId","data-v-9c04afa9"]]);const dt={name:"TableLibrary",components:{Empty:X,InnerRouterView:se,InnerRouterViewWindow:oe},props:{queryModels:{required:!0},tables:{},currentModel:{}},data(){return{newModel:{name:"",comment:""},editModel:{id:null,name:"",comment:""}}},computed:{...N(["currentDatabase"])},methods:{getRules(){return{name:[{required:!0,message:this.$t("form.isRequired",{value:this.$t("database.modelName")})},{validator:(e,t,n)=>E(e,t,n,this.$t("form.isIncorrect",{field:this.$t("database.modelName")}))}]}},checkTableName:E,handleDragStart(e){this.$emit("table:drag",e.target.getAttribute("name"))},createQueryModel(){this.$refs.routerViewWindow.push("create-model");for(const e in this.newModel)this.newModel[e]="";this.$nextTick(()=>{this.$refs.createForm.clearValidate()})},updateModel(e){for(const t in this.editModel)this.editModel[t]=e[t];this.$refs.routerViewWindow.push("update-model"),this.$nextTick(()=>{this.$refs.createForm.clearValidate()})},confirmUpdate(){this.$refs.editForm.validate(e=>{e&&O({database:this.currentDatabase,model:this.editModel}).then(()=>{Object.assign(this.currentModel,this.editModel),this.$refs.routerViewWindow.back()}).catch(t=>{this.$tip.apiFailed(t)})})},confirmCreate(){this.$refs.createForm.validate(e=>{if(!e)return;const t={...this.newModel,lineType:"join",tables:[],joins:[],aggregates:[]};Y({database:this.currentDatabase,model:t}).then(n=>{t.id=n,this.queryModels.unshift(t),this.selectModel(t),this.$refs.routerViewWindow.back()}).catch(n=>{this.$tip.apiFailed(n)})})},deleteModel(e){this.deleteConfirm(this.$t("database.deleteModelTip",{modelName:e.name})).then(()=>{Z({database:this.currentDatabase,model:e.id}).then(()=>{const t=this.queryModels.findIndex(n=>n.id===e.id);if(t!==-1){const n=this.queryModels[t];this.queryModels.splice(t,1),this.$emit("deleted",n)}this.$tip.success(this.$t("common.deleteSuccessfully"))}).catch(t=>{this.$tip.apiFailed(t)})}).catch(()=>{})},selectModel(e){this.$emit("update:currentModel",e)}}},ut={class:"table-library"},ct={class:"block"},ht={class:"header",slot:"title"},mt={key:0,class:"model-list"},gt=["onClick"],bt=["onClick"],ft=["onClick"],_t={class:"create-model-form"},pt={class:"opera"},yt={class:"create-model-form"},vt={class:"opera"},Tt={class:"block table-list-wrap"},Ct={class:"header"},Mt={class:"table-list"},Vt=["name"];function wt(e,t,n,d,a,l){const o=b("el-button"),m=b("Edit"),g=b("el-icon"),c=b("Delete"),i=b("Empty"),v=b("InnerRouterView"),h=b("el-input"),D=b("el-form-item"),q=b("el-form"),J=b("InnerRouterViewWindow");return u(),f("div",ut,[s("div",ct,[r(J,{ref:"routerViewWindow",default:"query-models"},{default:p(()=>[r(v,{name:"query-models"},{default:p(()=>[s("div",ht,[s("h4",null,_(e.$t("database.queryModels")),1),r(o,{type:"primary",icon:"Plus",class:"button-icon",onClick:l.createQueryModel},null,8,["onClick"])]),n.queryModels.length>0?(u(),f("ul",mt,[(u(!0),f(T,null,w(n.queryModels,y=>(u(),f("li",{key:y.name,class:k({selected:n.currentModel!=null&&n.currentModel.id===y.id}),onClick:F=>l.selectModel(y)},[s("label",null,_(y.name),1),s("p",null,_(y.comment),1),s("div",null,[s("span",{onClick:x(F=>l.updateModel(y),["stop"])},[r(g,null,{default:p(()=>[r(m)]),_:1})],8,bt),s("span",{onClick:x(F=>l.deleteModel(y),["stop"])},[r(g,null,{default:p(()=>[r(c)]),_:1})],8,ft)])],10,gt))),128))])):(u(),C(i,{key:1}))]),_:1}),r(v,{name:"create-model",title:e.$t("database.createNewModel")},{default:p(()=>[s("div",_t,[r(q,{ref:"createForm",model:a.newModel,rules:l.getRules()},{default:p(()=>[r(D,{label:e.$t("common.name"),prop:"name",required:""},{default:p(()=>[r(h,{modelValue:a.newModel.name,"onUpdate:modelValue":t[0]||(t[0]=y=>a.newModel.name=y)},null,8,["modelValue"])]),_:1},8,["label"]),r(D,{label:e.$t("common.remark"),prop:"comment"},{default:p(()=>[r(h,{modelValue:a.newModel.comment,"onUpdate:modelValue":t[1]||(t[1]=y=>a.newModel.comment=y),type:"textarea",rows:2},null,8,["modelValue"])]),_:1},8,["label"])]),_:1},8,["model","rules"]),s("div",pt,[r(o,{onClick:t[2]||(t[2]=y=>e.$refs.routerViewWindow.back())},{default:p(()=>[S(_(e.$t("common.cancel")),1)]),_:1}),r(o,{type:"primary",onClick:l.confirmCreate},{default:p(()=>[S(_(e.$t("common.confirmAdd")),1)]),_:1},8,["onClick"])])])]),_:1},8,["title"]),r(v,{name:"update-model",title:e.$t("database.updateModelTitle")},{default:p(()=>[s("div",yt,[r(q,{ref:"editForm",model:a.editModel,rules:l.getRules()},{default:p(()=>[r(D,{label:e.$t("common.name"),prop:"name",required:""},{default:p(()=>[r(h,{modelValue:a.editModel.name,"onUpdate:modelValue":t[3]||(t[3]=y=>a.editModel.name=y)},null,8,["modelValue"])]),_:1},8,["label"]),r(D,{label:e.$t("common.remark"),prop:"comment"},{default:p(()=>[r(h,{modelValue:a.editModel.comment,"onUpdate:modelValue":t[4]||(t[4]=y=>a.editModel.comment=y),type:"textarea",rows:2},null,8,["modelValue"])]),_:1},8,["label"])]),_:1},8,["model","rules"]),s("div",vt,[r(o,{onClick:t[5]||(t[5]=y=>e.$refs.routerViewWindow.back())},{default:p(()=>[S(_(e.$t("common.cancel")),1)]),_:1}),r(o,{type:"primary",onClick:l.confirmUpdate},{default:p(()=>[S(_(e.$t("common.confirmUpdate")),1)]),_:1},8,["onClick"])])])]),_:1},8,["title"])]),_:1},512)]),s("div",Tt,[s("div",Ct,[s("h4",null,_(e.$t("database.tables")),1)]),s("ul",Mt,[(u(!0),f(T,null,w(n.tables,y=>(u(),f("li",{key:y.name,name:y.name,draggable:"true",onDragstart:t[6]||(t[6]=(...F)=>l.handleDragStart&&l.handleDragStart(...F))},[s("label",null,_(y.name),1),s("p",null,_(y.comment),1)],40,Vt))),128))])])])}const St=V(dt,[["render",wt],["__scopeId","data-v-4a90dae2"]]);const kt={name:"QueryModelView",components:{OperaDataSourceWindow:ee,DataSourceSelect:te,TableLibrary:St,QueryModelDesigner:be,TableSetting:rt,RelationLine:W,Table:P},data(){return{fieldHeight:30,queryModels:[],databases:[],tables:[],lineType:"join",currentDataSource:null,connectError:null,currentModel:null}},computed:{...N(["currentProject","currentDatabase"]),currentTable(){return this.currentModel==null||this.currentModel.previewTableId==null?null:this.currentModel.tables.find(e=>e.id===this.currentModel.previewTableId)},joins(){return this.currentTable==null?[]:this.currentModel.joins},aggregates(){return this.currentTable==null||this.currentTable.type!=="MAIN"?[]:this.currentModel.aggregates}},watch:{currentDatabase(){this.fetchDatabases()}},methods:{handleModelDeleted(e){this.currentModel===e&&this.queryModels.length>0&&(this.currentModel=this.queryModels[0]),this.queryModels.length===0&&(this.currentModel=null)},saveModel(){const e=this.__getModelSettings(this.currentModel);O({database:this.currentDatabase,model:e}).then(()=>{}).catch(t=>{this.$tip.apiFailed(t)})},handleSettingChange(){this.saveModel(),this.$refs.designer.render()},handleDragStart(e){this.currentModel.dragData=this.tables.find(t=>t.name===e)},fetchDatabases(){this.currentModel=null,this.$nextTick(()=>{le().then(e=>{this.databases=e,this.fetchTables()}).catch(e=>{this.$tip.apiFailed(e)})})},fetchTables(){this.currentDataSource=this.databases.find(e=>e.id===this.currentDatabase),this.currentDataSource!=null&&ne({host:this.currentDataSource.host,port:this.currentDataSource.port,user:this.currentDataSource.username,password:this.currentDataSource.password,database:this.currentDataSource.schema}).then(e=>{this.connectError=null,this.tables=e.map(t=>({...t,alias:t.name,fields:t.fields.map(n=>({...n,isVirtual:!1}))})),this.fetchModels()}).catch(e=>{this.connectError=e.message})},fetchModels(){const t=this.databases.find(n=>n.id===this.currentDatabase).models;this.queryModels=t.map(n=>(n.tables=n.tables.map(d=>{const a=this.tables.find(o=>o.name.toLowerCase()===d.name.toLowerCase());if(a==null&&!d.isVirtual)return null;let l=d.fields;return a!=null&&(l=l.map(o=>{const m=a.fields.find(g=>g.name===o.name);return this.__modelField2field(o,m)}),l=l.filter(o=>o!=null)),{...d,fields:l}}),n.tables=n.tables.filter(d=>d!=null),n.joins.map(d=>this.__modelJoin2join(n,d)),n.joins=n.joins.filter(d=>d!=null),n.aggregates.map(d=>this.__modelAggregate2Aggregate(n,d)),n.aggregates=n.aggregates.filter(d=>d!=null),n)),this.queryModels.length>0&&(this.currentModel=this.queryModels[0])},__getModelSettings(e){const t=e.tables.map(a=>({id:a.id,name:a.name,alias:a.alias,comment:a.comment,isVirtual:a.isVirtual,type:a.type,fields:a.fields.map(l=>{const o={};for(const m in l)m==="table"||m.startsWith("__")||(o[m]=l[m]);return o}),x:a.x,y:a.y})),n=e.joins.map(a=>({...a,table:a.table.id,targetTable:a.targetTable.id,ons:a.ons.map(l=>({field:l.field.name,targetField:l.targetField.name,relation:l.relation}))})),d=e.aggregates.map(a=>({table:a.table.id,targetTable:a.targetTable.id,field:a.field.name,targetField:a.targetField.name,function:a.function}));return{id:e.id,name:e.name,comment:e.comment,tables:t,joins:n,aggregates:d}},__modelField2field(e,t){return t!=null&&e==null?{...t,visible:!1,alias:t.name,isVirtual:!1}:t==null&&!e.isVirtual?null:{...e,alias:e.alias,isVirtual:e.isVirtual,type:e.isVirtual?e.type:t.type,comment:e.isVirtual?e.comment:t.comment,visible:e.visible==null?!0:e.visible}},__modelJoin2join(e,t){const n=e.tables.find(l=>l.id===t.table),d=e.tables.find(l=>l.id===t.targetTable);if(n==null||d==null)return null;t.table=n,t.targetTable=d;const a=[];for(const l of t.ons){const o=n.fields.find(g=>g.name.toLowerCase()===l.field.toLowerCase()),m=d.fields.find(g=>g.name.toLowerCase()===l.targetField.toLowerCase());o==null||m==null||a.push({field:o,targetField:m,relation:l.relation})}return a.length===0?null:(t.ons=a,t)},__modelAggregate2Aggregate(e,t){const n=e.tables.find(o=>o.id===t.table),d=e.tables.find(o=>o.id===t.targetTable);if(n==null||d==null)return null;t.table=n,t.targetTable=d;const a=n.fields.find(o=>o.name.toLowerCase()===t.field.toLowerCase()),l=d.fields.find(o=>o.name.toLowerCase()===t.targetField.toLowerCase());return a==null||l==null?null:(t.field=a,t.targetField=l,t)}},created(){this.fetchDatabases()}},H=e=>(ae("data-v-4a924037"),e=e(),ie(),e),Dt={class:"database-query-models"},Ft={key:0,class:"no-datasource-tip"},Lt={class:"tip-wrap"},It={key:1,class:"connect-error-tip"},xt={class:"tip-wrap"},$t={class:"designer-wrap"},Nt={key:0,class:"toolbar"},Ut={class:"line-types"},Rt=H(()=>s("em",{class:"join-line"},null,-1)),jt=H(()=>s("em",{class:"aggregate-line"},null,-1)),qt={key:2,class:"no-model-tip"},At={class:"tip-wrap"};function Qt(e,t,n,d,a,l){const o=b("DataSourceSelect"),m=b("el-button"),g=b("TableLibrary"),c=b("QueryModelDesigner"),i=b("TableSetting"),v=b("OperaDataSourceWindow");return u(),f("div",Dt,[e.currentDatabase==null||e.currentDatabase===""?(u(),f("div",Ft,[s("div",Lt,[s("h4",null,_(e.$t("database.selectDataSourceTip")),1),r(o,{"model-value":e.currentDatabase,"with-block":!0},null,8,["model-value"])])])):a.connectError!=null?(u(),f("div",It,[s("div",xt,[s("h4",null,_(e.$t("database.dataSourceConnectFailedTip")),1),s("p",null,_(a.connectError),1),r(m,{onClick:t[0]||(t[0]=h=>this.$refs.operaDataSourceWindow.open(this.currentDataSource))},{default:p(()=>[S(_(e.$t("database.editDataSourceInfoTip")),1)]),_:1})])])):(u(),f(T,{key:2},[r(g,{"query-models":a.queryModels,tables:a.tables,"onTable:drag":l.handleDragStart,"current-model":a.currentModel,"onUpdate:currentModel":t[1]||(t[1]=h=>a.currentModel=h),onDeleted:l.handleModelDeleted},null,8,["query-models","tables","onTable:drag","current-model","onDeleted"]),s("div",$t,[a.currentModel!=null?(u(),f("div",Nt,[s("ul",Ut,[s("li",{class:k({selected:a.currentModel.lineType==="join"}),onClick:t[2]||(t[2]=h=>a.currentModel.lineType="join")},[Rt,s("label",null,_(e.$t("database.joinLine")),1)],2),s("li",{class:k({selected:a.currentModel.lineType==="aggregate"}),onClick:t[3]||(t[3]=h=>a.currentModel.lineType="aggregate")},[jt,s("label",null,_(e.$t("database.aggregateLine")),1)],2)])])):M("",!0),a.currentModel!=null?(u(),C(c,{key:1,ref:"designer",model:a.currentModel,"field-height":30,onChange:l.saveModel},null,8,["model","onChange"])):M("",!0),r(i,{table:l.currentTable,joins:l.joins,aggregates:l.aggregates,"onField:change":l.handleSettingChange},null,8,["table","joins","aggregates","onField:change"]),a.queryModels.length===0?(u(),f("div",qt,[s("div",At,[s("h4",null,_(e.$t("database.queryModelEmptyTipTitle")),1),s("p",null,_(e.$t("database.queryModelEmptyTip")),1)])])):M("",!0)])],64)),r(v,{ref:"operaDataSourceWindow",onSuccess:l.fetchDatabases},null,8,["onSuccess"])])}const Pt=V(kt,[["render",Qt],["__scopeId","data-v-4a924037"]]);export{Pt as Q};
