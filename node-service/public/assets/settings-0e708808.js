import{_ as N,r as s,o as d,g,w as a,b as l,c as V,F as q,j as F,W as Z,G as $,z as L,a as r,H as A,t as x,e as C,A as D,p as E,l as W,X as ee,N as G,Y as ie,Z as M,f as P,i as U,U as oe,$ as K,M as te,T as se,m as re,n as ue,a0 as ce,a1 as de,I as R}from"./index-e3ddf85e.js";import{C as O}from"./CompilerSelect-35a94851.js";import{c as pe,d as me,i as le,e as z,t as he,g as Y,h as _e,j as fe}from"./service-c0b33db7.js";import{E as ne}from"./Empty-b8c033c5.js";import{p as be,O as ve,V as J,S as ge}from"./ServiceCodeErrorWindow-590560ae.js";import{a as Ve}from"./form.check-189b470c.js";import{a as ye,b as Ce}from"./service.space-3e6b6b02.js";const Se={name:"InputTypeSelect",props:{withGroup:{default:!1}}};function ke(e,t,i,_,n,o){const c=s("el-option"),p=s("el-select");return d(),g(p,{class:"input-type-select"},{default:a(()=>[l(c,{value:"input",label:"Input"}),l(c,{value:"number_input",label:"Number Input"}),l(c,{value:"textarea",label:"Textarea"}),l(c,{value:"select",label:"Select"}),l(c,{value:"checkbox",label:"Checkbox"}),l(c,{value:"radio",label:"Radio"}),i.withGroup?F("",!0):(d(),V(q,{key:0},[l(c,{value:"datasource",label:"Data Source"}),l(c,{value:"table",label:"Table"}),l(c,{value:"query_model",label:"Query Model"})],64))]),_:1})}const Q=N(Se,[["render",ke],["__scopeId","data-v-1888cfe4"]]);const Ie={name:"SettingFiles",components:{SortableButton:Z,CompilerSelect:O,InputTypeSelect:Q},props:{space:{required:!0},service:{required:!0}},data(){return{currentNode:null,files:[]}},methods:{fetchFiles(){pe(this.space,this.service).then(e=>{this.files=e,$(this.files)}).catch(e=>{this.$tip.apiFailed(e)})},saveFileSetting(){this.saveTimeout!=null&&clearTimeout(this.saveTimeout),this.saveTimeout=setTimeout(()=>{me({space:this.space,service:this.service,type:this.currentNode.type,path:this.currentNode.path,relativePath:this.currentNode.relativePath,compiler:this.currentNode.compiler,enableExpress:this.currentNode.enableExpress,variables:this.currentNode.variables.filter(e=>e.name.trim().length>0)}).then(()=>{}).catch(e=>{this.$tip.apiFailed(e)})},300)},createVariable(){this.currentNode.variables.push({name:"",value:"",compiler:"static",remark:""})},deleteVariable(e){this.currentNode.variables.splice(e,1)},handleNodeClick(e){this.currentNode=e},isFlagFile(e){return e.compiler!=null&&e.compiler!==""||e.enableExpress!=null&&e.enableExpress!==""||e.variables.length>0},handleSorted(e){this.currentNode.variables=[],this.$nextTick(()=>{this.currentNode.variables=e,this.saveFileSetting()})}},created(){this.fetchFiles()}},ae=e=>(E("data-v-2db634e0"),e=e(),W(),e),we={class:"tree"},Te={class:"files-wrap"},Fe={class:"search-wrap"},xe={class:"node-label"},Ne={class:"file-setting"},Ae=ae(()=>r("h4",null,"File Setting",-1)),De={class:"content-wrap"},Ue=ae(()=>r("label",null,"Variables",-1)),qe={class:"opera"};function Be(e,t,i,_,n,o){const c=s("el-input"),p=s("Document"),f=s("el-icon"),y=s("Folder"),I=s("el-tree"),m=s("CompilerSelect"),w=s("el-form-item"),S=s("el-button"),v=s("SortableButton"),b=s("el-table-column"),h=s("el-table"),k=s("el-form"),B=L("sortable");return d(),V("div",we,[r("div",Te,[r("div",Fe,[l(c,{placeholder:"Filter keyword"})]),l(I,{data:n.files,"empty-text":"No Files",onNodeClick:o.handleNodeClick},{default:a(({node:u,data:T})=>[r("span",xe,[T.type==="FILE"?(d(),g(f,{key:0},{default:a(()=>[l(p)]),_:1})):T.type==="DIRECTORY"?(d(),g(f,{key:1},{default:a(()=>[l(y)]),_:1})):F("",!0),r("span",{class:A(["filename",{"flag-file":o.isFlagFile(T)}])},x(T.label),3)])]),_:1},8,["data","onNodeClick"])]),r("div",Ne,[Ae,r("div",De,[n.currentNode!=null?(d(),g(k,{key:0},{default:a(()=>[l(w,{label:"Compiler"},{default:a(()=>[l(m,{modelValue:n.currentNode.compiler,"onUpdate:modelValue":t[0]||(t[0]=u=>n.currentNode.compiler=u),"with-follow-service":!0,onChange:o.saveFileSetting},null,8,["modelValue","onChange"])]),_:1}),l(w,{label:"Enable Express"},{default:a(()=>[l(c,{modelValue:n.currentNode.enableExpress,"onUpdate:modelValue":t[1]||(t[1]=u=>n.currentNode.enableExpress=u),type:"textarea",rows:8,onInput:o.saveFileSetting},null,8,["modelValue","onInput"])]),_:1}),l(w,{label:"Variables",class:"item-variables"},{label:a(()=>[r("div",null,[Ue,r("div",qe,[l(S,{icon:"Top",class:"button-icon"}),l(S,{icon:"Bottom",class:"button-icon"}),l(S,{onClick:o.createVariable},{default:a(()=>[C("Add")]),_:1},8,["onClick"])])])]),default:a(()=>[D((d(),g(h,{data:n.currentNode.variables},{default:a(()=>[l(b,{width:"25px"},{default:a(()=>[l(v)]),_:1}),l(b,{label:"*Name","min-width":"120px"},{default:a(({row:u})=>[l(c,{modelValue:u.name,"onUpdate:modelValue":T=>u.name=T,onInput:o.saveFileSetting},null,8,["modelValue","onUpdate:modelValue","onInput"])]),_:1}),l(b,{label:"*Value","min-width":"200px"},{default:a(({row:u})=>[l(c,{modelValue:u.value,"onUpdate:modelValue":T=>u.value=T,type:"textarea",rows:1,onChange:o.saveFileSetting},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),l(b,{label:"*Compiler","min-width":"120px"},{default:a(({row:u})=>[l(m,{modelValue:u.compiler,"onUpdate:modelValue":T=>u.compiler=T,onChange:o.saveFileSetting},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),l(b,{label:"Remark","min-width":"140px"},{default:a(({row:u})=>[l(c,{modelValue:u.remark,"onUpdate:modelValue":T=>u.remark=T,type:"textarea",rows:1,onInput:o.saveFileSetting},null,8,["modelValue","onUpdate:modelValue","onInput"])]),_:1}),n.currentNode.variables.length>0?(d(),g(b,{key:0,"min-width":"60px",fixed:"right"},{default:a(({row:u,index:T})=>[l(S,{icon:"Delete",class:"button-icon",onClick:X=>o.deleteVariable(T)},null,8,["onClick"])]),_:1})):F("",!0)]),_:1},8,["data"])),[[B,{data:n.currentNode.variables,onChange:o.handleSorted},"config"]])]),_:1})]),_:1})):F("",!0)])])])}const Ee=N(Ie,[["render",Be],["__scopeId","data-v-2db634e0"]]);const We={name:"InitializeView",components:{DatabaseTypeSelect:ee,CompilerSelect:O,DirectorySelect:G},props:{spaceName:{required:!0},serviceName:{required:!0}},data(){return{form:{space:this.spaceName,name:this.serviceName,version:"1.0.0",compiler:"static",supportedDatabases:[],codespace:""}}},methods:{initialize(){le(this.form).then(()=>{this.$emit("initialized",this.form)}).catch(e=>{this.$tip.apiFailed(e)})},fetchConfig(e){z({codespace:e}).then(t=>{t!=null&&(this.form.version=t.version||this.form.version,this.form.compiler=t.compiler||this.form.compiler,this.form.supportedDatabases=t.supportedDatabases||this.form.supportedDatabases)}).catch(t=>{this.$tip.apiFailed(t)})}}},Oe=e=>(E("data-v-546a00f9"),e=e(),W(),e),Re={class:"initialize-wrap"},Pe=Oe(()=>r("div",{class:"tip"},[r("h3",null,"Initialize Service"),r("p",null,"You must first specify or create a local directory and initialize the service. Then you can code the service in the specified local directory.")],-1)),ze={class:"directory-select-wrap"},Le={class:"opera-bottom"};function Ge(e,t,i,_,n,o){const c=s("DirectorySelect"),p=s("el-button");return d(),V("div",Re,[Pe,r("div",ze,[l(c,{modelValue:n.form.codespace,"onUpdate:modelValue":t[0]||(t[0]=f=>n.form.codespace=f),title:"Select Service Directory",onChange:o.fetchConfig},null,8,["modelValue","onChange"])]),r("div",Le,[l(p,{type:"primary",size:"large",onClick:o.initialize},{default:a(()=>[C("Initialize Service")]),_:1},8,["onClick"])])])}const Qe=N(We,[["render",Ge],["__scopeId","data-v-546a00f9"]]);const Me={name:"BuildCommandTypeSelect"};function Ye(e,t,i,_,n,o){const c=s("el-option"),p=s("el-select");return d(),g(p,{class:"build-command-type-select"},{default:a(()=>[l(c,{value:"Node",label:"Node"}),l(c,{value:"MySQL",label:"MySQL"})]),_:1})}const Je=N(Me,[["render",Ye],["__scopeId","data-v-d0af9b64"]]);const je={name:"ServiceFileSelectWindow",props:{title:{default:"Select Service File"},serviceConfig:{required:!0}},data(){return{visible:!1,paths:[],files:[],selectedFilepath:null}},methods:{open(){this.visible=!0,this.paths=[this.__getProjectName()],this.__fetchFiles(),this.selectedFilepath=null},confirmSelect(){this.visible=!1;let e=`${this.paths.slice(1).join("/")}/${this.selectedFilepath}`;e.startsWith("/")||(e="/"+e),this.$emit("change",e)},cancelSelect(){this.visible=!1},changePath(e){if(e===this.paths.length-1)return;const t=this.paths.slice(0,e+1);this.__fetchFiles(t,()=>{this.paths.splice(e+1),this.selectedFilepath=null})},openOrSelectFile(e){if(e.type==="DIRECTORY"){const t=JSON.parse(JSON.stringify(this.paths));t.push(e.path),this.__fetchFiles(t,()=>{this.paths.push(e.path),this.selectedFilepath=null});return}this.selectedFilepath=e.path},__fetchFiles(e,t){ie(this.__getAbsolutePath(e)).then(i=>{this.files=i,$(this.files),t&&t()}).catch(i=>{this.$tip.apiFailed(i)})},__getProjectName(){return M.split(this.serviceConfig.codespace).pop()},__getAbsolutePath(e){e==null&&(e=JSON.parse(JSON.stringify(this.paths))),e.shift();let t=M.join([this.serviceConfig.codespace,...e]);return this.serviceConfig.translator.settings.length>0&&(t=M.join([this.serviceConfig.codespace,this.serviceConfig.translator.output,...e])),t}}},He=["id"],Xe={class:"paths"},Ke=["onClick"],Ze={class:"files"},$e=["onClick"],et={class:"opera"};function tt(e,t,i,_,n,o){const c=s("el-button"),p=s("Folder"),f=s("Document"),y=s("el-icon"),I=s("el-dialog");return d(),g(I,{modelValue:n.visible,"onUpdate:modelValue":t[0]||(t[0]=m=>n.visible=m),"show-close":!1,"custom-class":"service-file-select-window","append-to-body":""},{header:a(({close:m,titleId:w,titleClass:S})=>[r("h4",{id:w,class:A(S)},x(i.title),11,He),l(c,{class:"button-icon",icon:"Refresh",onClick:o.__fetchFiles},null,8,["onClick"])]),default:a(()=>[r("ul",Xe,[(d(!0),V(q,null,P(n.paths,(m,w)=>(d(),V("li",{key:m,onClick:S=>o.changePath(w)},x(m),9,Ke))),128))]),r("div",Ze,[r("ul",null,[(d(!0),V(q,null,P(n.files,m=>(d(),V("li",{key:m.path,class:A({"is-file":m.type==="FILE",selected:n.selectedFilepath===m.path}),onClick:w=>o.openOrSelectFile(m)},[l(y,null,{default:a(()=>[m.type==="DIRECTORY"?(d(),g(p,{key:0})):(d(),g(f,{key:1}))]),_:2},1024),r("p",null,x(m.path),1)],10,$e))),128))])]),r("div",et,[l(c,{size:"large",onClick:o.cancelSelect},{default:a(()=>[C("Cancel")]),_:1},8,["onClick"]),l(c,{type:"primary",size:"large",disabled:n.selectedFilepath==null,onClick:o.confirmSelect},{default:a(()=>[C("Confirm Select")]),_:1},8,["disabled","onClick"])])]),_:1},8,["modelValue"])}const lt=N(je,[["render",tt]]);const nt={name:"BuildList",components:{ServiceFileSelectWindow:lt,DirectorySelect:G,Empty:ne,BuildCommandTypeSelect:Je},props:{builds:{required:!0,type:Array},withUnbuild:{default:!1},serviceConfig:{required:!0}},data(){return{actives:[],varIndex:1,selectFileData:{currentBuild:null}}},watch:{builds:{immediate:!0,handler(){this.__handleBuildList("builds")}},unbuilds:{immediate:!0,handler(){this.__handleBuildList("unbuilds")}}},methods:{handleFileChange(e){this.selectFileData.currentBuild.__filepath=e,this.handleSave()},create(){const e=""+Math.random();this.builds.push({id:e,name:this.__generateBuildName(),type:"Node",contentType:"string",content:"",__readonly:!1,__filepath:""}),this.actives.push(e)},handleChange(e){for(const t of this.builds){const i=e.find(_=>_===t.id)!=null;t.__readonly=!i}},handleSave(){this.$emit("save")},deleteBuild(e){this.builds.splice(e,1),this.handleSave()},openSelectFileWindow(e){this.selectFileData.currentBuild=e,this.$refs.serviceFileSelectWindow.open()},__generateBuildName(){let e;for(;;)if(e=`${this.withUnbuild?"un":""}build${this.varIndex}`,this.varIndex++,this.builds.findIndex(t=>t.name===e)===-1)return e},__handleBuildList(e){this[e]!=null&&this[e].forEach(t=>{t.id=""+Math.random(),t.contentType==="file"&&(t.__filepath=t.content,t.content=""),t.__readonly=!0})}}},at=e=>(E("data-v-1c66eddf"),e=e(),W(),e),it={class:"service-build-list"},ot={class:"toolbar"},st=at(()=>r("p",null,"tips: The following builds are performed after the service is installed",-1)),rt={class:"title-wrap"},ut={key:0,class:"view"},ct={class:"name"},dt={class:"type"},pt={key:1,class:"edit"},mt={class:"opera"},ht=["onClick"],_t={key:0,class:"holder"},ft={key:1};function bt(e,t,i,_,n,o){const c=s("el-button"),p=s("el-input"),f=s("el-form-item"),y=s("BuildCommandTypeSelect"),I=s("el-form"),m=s("el-tab-pane"),w=s("el-tabs"),S=s("el-collapse-item"),v=s("el-collapse"),b=s("Empty"),h=s("ServiceFileSelectWindow");return d(),V("div",it,[r("div",ot,[st,l(c,{type:"primary",onClick:o.create},{default:a(()=>[C("Create")]),_:1},8,["onClick"])]),i.builds.length>0?(d(),g(v,{key:0,modelValue:n.actives,"onUpdate:modelValue":t[2]||(t[2]=k=>n.actives=k),onChange:o.handleChange},{default:a(()=>[(d(!0),V(q,null,P(i.builds,(k,B)=>(d(),g(S,{key:k.id,name:k.id},{title:a(()=>[r("div",rt,[k.__readonly?(d(),V("div",ut,[r("p",ct,x(k.name),1),r("p",dt,x(k.type),1)])):(d(),V("div",pt,[l(I,{model:k},{default:a(()=>[l(f,{label:"Name",required:""},{default:a(()=>[l(p,{class:"name",modelValue:k.name,"onUpdate:modelValue":u=>k.name=u,onClick:t[0]||(t[0]=U(()=>{},["stop"])),onKeypress:t[1]||(t[1]=U(()=>{},["stop"])),onInput:o.handleSave},null,8,["modelValue","onUpdate:modelValue","onInput"])]),_:2},1024),l(f,{label:"Type",required:""},{default:a(()=>[l(y,{class:"type",modelValue:k.type,"onUpdate:modelValue":u=>k.type=u,onChange:o.handleSave},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:2},1024)]),_:2},1032,["model"])])),r("div",mt,[l(c,{icon:"Delete",onClick:U(u=>o.deleteBuild(B),["stop"])},{default:a(()=>[C("Delete")]),_:2},1032,["onClick"])])])]),default:a(()=>[l(w,{modelValue:k.contentType,"onUpdate:modelValue":u=>k.contentType=u},{default:a(()=>[l(m,{name:"string",label:"Input"},{default:a(()=>[l(p,{modelValue:k.content,"onUpdate:modelValue":u=>k.content=u,type:"textarea",placeholder:"Build command",rows:5,onInput:o.handleSave},null,8,["modelValue","onUpdate:modelValue","onInput"])]),_:2},1024),l(m,{name:"file",label:"File"},{default:a(()=>[r("div",{class:"select-holder",onClick:u=>o.openSelectFileWindow(k)},[k.__filepath==null||k.__filepath===""?(d(),V("p",_t,"Click to select file.")):(d(),V("p",ft,x(k.__filepath),1))],8,ht)]),_:2},1024)]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1032,["name"]))),128))]),_:1},8,["modelValue","onChange"])):(d(),g(b,{key:1})),l(h,{ref:"serviceFileSelectWindow","service-config":i.serviceConfig,onChange:o.handleFileChange},null,8,["service-config","onChange"])])}const vt=N(nt,[["render",bt],["__scopeId","data-v-1c66eddf"]]);const gt={name:"TranslatorTypeSelect"};function Vt(e,t,i,_,n,o){const c=s("el-option"),p=s("el-select");return d(),g(p,{class:"translator-type-select"},{default:a(()=>[l(c,{value:"pattern",label:"Pattern"}),l(c,{value:"code",label:"Code"})]),_:1})}const yt=N(gt,[["render",Vt],["__scopeId","data-v-c3f8ce1c"]]);const Ct={name:"TranslatorList",components:{TranslatorTypeSelect:yt,Empty:ne},props:{space:{required:!0},service:{required:!0},translator:{required:!0}},data(){return{actives:[],varIndex:1}},computed:{translators(){return this.translator.settings}},watch:{translators:{immediate:!0,handler(){this.translators.forEach(e=>{e.id=""+Math.random(),e.__readonly=!0})}}},methods:{add(){const e=""+Math.random();this.translator.settings.push({id:e,name:this.__generateTranslatorName(),type:"pattern",path:".*",source:"",target:"",code:"  return {filepath: filepath, content: content};",__readonly:!1}),this.actives.push(e)},deleteTranslator(e){this.translator.settings.splice(e,1),this.handleSave()},handleChange(e){for(const t of this.translators){const i=e.find(_=>_===t.id)!=null;t.__readonly=!i}},handleSave(){this.$emit("save")},translate(){he({space:this.space,service:this.service}).then(()=>{}).catch(e=>{this.$tip.apiFailed(e)})},__generateTranslatorName(){let e;for(;;)if(e=`translator${this.varIndex}`,this.varIndex++,this.translators.findIndex(t=>t.name===e)===-1)return e}}},j=e=>(E("data-v-900b00b1"),e=e(),W(),e),St={class:"translator-setting"},kt={class:"toolbar"},It=j(()=>r("p",null,"tips: The translator can be configured to quickly translate source code into service code",-1)),wt={class:"opera"},Tt={class:"title-wrap"},Ft={key:0,class:"view"},xt={class:"name"},Nt={class:"path"},At={class:"type"},Dt={key:1,class:"edit"},Ut={class:"opera"},qt=j(()=>r("p",{class:"code"},[r("em",{class:"keyword"},"function"),C(),r("em",null,"translate"),C(" ("),r("em",null,"filepath"),C(", "),r("em",null,"content"),C(", "),r("em",null,"fileSetting"),C(") {")],-1)),Bt=j(()=>r("p",null,"}",-1));function Et(e,t,i,_,n,o){const c=s("el-button"),p=s("el-input"),f=s("el-form-item"),y=s("TranslatorTypeSelect"),I=s("el-form"),m=s("el-collapse-item"),w=s("el-collapse"),S=s("Empty");return d(),V("div",St,[r("div",kt,[It,r("div",wt,[l(c,{type:"primary",onClick:o.add},{default:a(()=>[C("Add")]),_:1},8,["onClick"]),l(c,{type:"primary",onClick:o.translate},{default:a(()=>[C("Translate")]),_:1},8,["onClick"])])]),o.translators.length>0?(d(),g(w,{key:0,modelValue:n.actives,"onUpdate:modelValue":t[4]||(t[4]=v=>n.actives=v),onChange:o.handleChange},{default:a(()=>[(d(!0),V(q,null,P(o.translators,(v,b)=>(d(),g(m,{key:v.id,name:v.id},{title:a(()=>[r("div",Tt,[v.__readonly?(d(),V("div",Ft,[r("p",xt,x(v.name),1),r("p",Nt,x(v.path),1),r("p",At,x(v.type),1)])):(d(),V("div",Dt,[l(I,{model:v},{default:a(()=>[l(f,{label:"Name",required:""},{default:a(()=>[l(p,{class:"name",modelValue:v.name,"onUpdate:modelValue":h=>v.name=h,onClick:t[0]||(t[0]=U(()=>{},["stop"])),onKeypress:t[1]||(t[1]=U(()=>{},["stop"])),onInput:o.handleSave},null,8,["modelValue","onUpdate:modelValue","onInput"])]),_:2},1024),l(f,{label:"Path",required:""},{default:a(()=>[l(p,{class:"path",modelValue:v.path,"onUpdate:modelValue":h=>v.path=h,onClick:t[2]||(t[2]=U(()=>{},["stop"])),onKeypress:t[3]||(t[3]=U(()=>{},["stop"])),onInput:o.handleSave},null,8,["modelValue","onUpdate:modelValue","onInput"])]),_:2},1024),l(f,{label:"Type",required:""},{default:a(()=>[l(y,{class:"type",modelValue:v.type,"onUpdate:modelValue":h=>v.type=h,onChange:o.handleSave},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:2},1024)]),_:2},1032,["model"])])),r("div",Ut,[l(c,{icon:"Delete",onClick:U(h=>o.deleteTranslator(b),["stop"])},{default:a(()=>[C("Delete")]),_:2},1032,["onClick"])])])]),default:a(()=>[v.type==="pattern"?(d(),g(I,{key:0},{default:a(()=>[l(f,{label:"Source",required:""},{default:a(()=>[l(p,{modelValue:v.source,"onUpdate:modelValue":h=>v.source=h,type:"textarea",rows:1,onInput:o.handleSave},null,8,["modelValue","onUpdate:modelValue","onInput"])]),_:2},1024),l(f,{label:"Target",required:""},{default:a(()=>[l(p,{modelValue:v.target,"onUpdate:modelValue":h=>v.target=h,type:"textarea",rows:1,onInput:o.handleSave},null,8,["modelValue","onUpdate:modelValue","onInput"])]),_:2},1024)]),_:2},1024)):v.type==="code"?(d(),V(q,{key:1},[qt,l(p,{modelValue:v.code,"onUpdate:modelValue":h=>v.code=h,type:"textarea",rows:5,onInput:o.handleSave},null,8,["modelValue","onUpdate:modelValue","onInput"]),Bt],64)):F("",!0)]),_:2},1032,["name"]))),128))]),_:1},8,["modelValue","onChange"])):(d(),g(S,{key:1}))])}const Wt=N(Ct,[["render",Et],["__scopeId","data-v-900b00b1"]]),Ot="data:image/png;base64,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";const Rt={name:"BasicSetting",components:{TranslatorList:Wt,BuildList:vt,DirectorySelect:G,DatabaseTypeSelect:ee,CompilerSelect:O},props:{space:{required:!0},service:{required:!0},serviceType:{required:!0},serviceConfig:{}},data(){return{newCodespace:{changing:!1,value:""},originForm:null,form:{version:"",private:!1,receivable:!1,compiler:"",introduce:"",repository:"",supportedDatabases:[],tableFieldDefinitions:[],builds:[],unbuilds:[],prices:[{type:"free",value:0}],translator:{output:"",settings:[]},codespace:""}}},methods:{initData(){for(const e in this.form)this.form[e]=this.serviceConfig[e]||this.form[e];this.originForm=JSON.parse(JSON.stringify(this.form))},initialize(){this.form.codespace=this.newCodespace.value,le({space:this.space,name:this.service,...this.form}).then(()=>{this.newCodespace.changing=!1,this.$emit("initialized",this.form)}).catch(e=>{this.$tip.apiFailed(e)})},changePriceType(e){e==="free"&&(this.form.prices[0].value=0),this.saveConfig()},changeCodespace(){this.newCodespace.changing=!0,this.newCodespace.value=this.form.codespace},fetchConfig(e){z({codespace:e}).then(t=>{t!=null&&(this.form.version=t.version||this.form.version,this.form.introduce=t.introduce||this.form.introduce,this.form.compiler=t.compiler||this.form.compiler,this.form.prices=t.prices||this.form.prices,this.form.supportedDatabases=t.supportedDatabases||this.form.supportedDatabases,this.form.builds=t.builds||this.form.builds,this.form.unbuilds=t.unbuilds||this.form.unbuilds,this.form.translator=t.translator||this.form.translator)}).catch(t=>{this.$tip.apiFailed(t)})},saveConfig(){this.newCodespace.changing||Y({space:this.space,service:this.service,...this.form,translator:{...this.form.translator,settings:this.form.translator.settings.filter(e=>e.type==="code"&&e.code.trim().length>0||e.type==="pattern"&&e.source.trim()!==""&&e.target.trim()!=="").map(e=>({name:e.name,path:e.path.trim().length===0?".*":e.path,type:e.type,source:e.type==="pattern"?e.source:"",target:e.type==="pattern"?e.target:"",code:e.type==="code"?e.code:""}))},builds:this.form.builds.map(e=>({name:e.name,type:e.type,content:e.contentType==="file"?e.__filepath:e.content,contentType:e.contentType})),unbuilds:this.form.unbuilds.map(e=>({name:e.name,type:e.type,content:e.contentType==="file"?e.__filepath:e.content,contentType:e.contentType}))}).then(()=>{this.originForm=JSON.parse(JSON.stringify(this.form))}).catch(e=>{this.$tip.apiFailed(e)})}},created(){this.initData()}},Pt=e=>(E("data-v-1235cbfd"),e=e(),W(),e),zt={class:"basic-setting"},Lt={class:"wrap"},Gt=Pt(()=>r("span",null,[r("img",{src:Ot})],-1)),Qt={key:0,class:"codespace-wrap"},Mt={key:0,class:"opera-wrap"};function Yt(e,t,i,_,n,o){const c=s("el-input"),p=s("el-form-item"),f=s("CompilerSelect"),y=s("DatabaseTypeSelect"),I=s("el-radio-button"),m=s("el-radio-group"),w=s("el-input-number"),S=s("el-checkbox"),v=s("TranslatorList"),b=s("BuildList"),h=s("el-button"),k=s("DirectorySelect"),B=s("el-form");return d(),V("div",zt,[r("div",Lt,[l(B,{model:n.form},{default:a(()=>[l(p,{label:"Version",prop:"version",required:""},{default:a(()=>[l(c,{modelValue:n.form.version,"onUpdate:modelValue":t[0]||(t[0]=u=>n.form.version=u),onInput:o.saveConfig},null,8,["modelValue","onInput"])]),_:1}),l(p,{label:"Compiler",prop:"compiler",required:""},{default:a(()=>[l(f,{modelValue:n.form.compiler,"onUpdate:modelValue":t[1]||(t[1]=u=>n.form.compiler=u),onChange:o.saveConfig},null,8,["modelValue","onChange"])]),_:1}),l(p,{label:"Supported Databases",prop:"supportedDatabases"},{default:a(()=>[l(y,{modelValue:n.form.supportedDatabases,"onUpdate:modelValue":t[2]||(t[2]=u=>n.form.supportedDatabases=u),onChange:o.saveConfig},null,8,["modelValue","onChange"])]),_:1}),l(p,{label:"Repository",prop:"repository"},{default:a(()=>[l(c,{modelValue:n.form.repository,"onUpdate:modelValue":t[3]||(t[3]=u=>n.form.repository=u),onInput:o.saveConfig},null,8,["modelValue","onInput"])]),_:1}),l(p,{label:"Introduce",prop:"introduce",required:""},{default:a(()=>[l(c,{type:"textarea",rows:5,modelValue:n.form.introduce,"onUpdate:modelValue":t[4]||(t[4]=u=>n.form.introduce=u),onInput:o.saveConfig},null,8,["modelValue","onInput"])]),_:1}),l(p,{label:"Charge",prop:"prices[0].type",required:""},{default:a(()=>[l(m,{modelValue:n.form.prices[0].type,"onUpdate:modelValue":t[5]||(t[5]=u=>n.form.prices[0].type=u),onChange:o.changePriceType},{default:a(()=>[(d(!0),V(q,null,P(e.$const.getServiceLeaseTypes(e.$t),u=>(d(),g(I,{key:u.code,label:u.code},{default:a(()=>[C(x(u.label),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue","onChange"])]),_:1}),n.form.prices[0].type!=="free"?(d(),g(p,{key:0,label:"Price",prop:"prices[0].value",class:"item-price",required:""},{default:a(()=>[Gt,l(w,{controls:!1,modelValue:n.form.prices[0].value,"onUpdate:modelValue":t[6]||(t[6]=u=>n.form.prices[0].value=u),onInput:o.saveConfig},null,8,["modelValue","onInput"])]),_:1})):F("",!0),l(p,{label:"Other settings",class:"item-other-settings"},{default:a(()=>[r("div",null,[l(S,{modelValue:n.form.private,"onUpdate:modelValue":t[7]||(t[7]=u=>n.form.private=u),label:"Is a private service",onChange:o.saveConfig},null,8,["modelValue","onChange"])])]),_:1}),l(p,{label:"Translator",prop:"translator"},{default:a(()=>[l(v,{space:i.space,service:i.service,translator:n.form.translator,onSave:o.saveConfig},null,8,["space","service","translator","onSave"])]),_:1}),l(p,{label:"Install Builds",prop:"builds"},{default:a(()=>[l(b,{builds:n.form.builds,"service-config":i.serviceConfig,onSave:o.saveConfig},null,8,["builds","service-config","onSave"])]),_:1}),l(p,{label:"Uninstall Builds",prop:"unbuilds"},{default:a(()=>[l(b,{builds:n.form.unbuilds,"with-unbuild":!0,"service-config":i.serviceConfig,onSave:o.saveConfig},null,8,["builds","service-config","onSave"])]),_:1}),l(p,{label:"Code Space",prop:"codespace"},{default:a(()=>[n.newCodespace.changing?(d(),g(k,{key:1,title:"Select new codespace",modelValue:n.newCodespace.value,"onUpdate:modelValue":t[8]||(t[8]=u=>n.newCodespace.value=u),onChange:o.fetchConfig},null,8,["modelValue","onChange"])):(d(),V("div",Qt,[r("p",null,x(n.form.codespace),1),l(h,{type:"primary",onClick:o.changeCodespace},{default:a(()=>[C("Change")]),_:1},8,["onClick"])]))]),_:1})]),_:1},8,["model"]),n.newCodespace.changing?(d(),V("div",Mt,[l(h,{size:"large",onClick:t[9]||(t[9]=u=>n.newCodespace.changing=!1)},{default:a(()=>[C("Cancel")]),_:1}),l(h,{size:"large",type:"primary",onClick:o.initialize},{default:a(()=>[C("Reinitialize")]),_:1},8,["onClick"])])):F("",!0)])])}const Jt=N(Rt,[["render",Yt],["__scopeId","data-v-1235cbfd"]]),jt={name:"PublishWindow",data(){return{visible:!1,isWorking:!1,space:null,service:null,form:{version:"",publishDescription:""}}},methods:{open(e,t){this.space=e,this.service=t,this.visible=!0,this.fetchConfig()},getRules(){return{version:[{required:!0,message:this.$t("form.isRequired",{value:this.$t("service.versionNumber")})},{validator:Ve,message:this.$t("form.isIncorrect",{field:this.$t("service.versionNumber")})}],publishDescription:[{required:!0,message:this.$t("form.isRequired",{value:this.$t("service.versionDescription")})}]}},fetchConfig(){z({space:this.space,service:this.service}).then(e=>{this.form.version=e.version}).catch(e=>{this.$tip.apiFailed(e)})},saveConfig(){this.$refs.form.validate().then(()=>{Y({space:this.space,service:this.service,version:this.form.version}).catch(e=>{this.$tip.apiFailed(e)})}).catch(()=>{})},publish(){this.isWorking||(this.isWorking=!0,be({space:this.space,service:this.service,publishDescription:this.form.publishDescription}).then(()=>{this.visible=!1}).catch(e=>{this.$tip.apiFailed(e)}).finally(()=>{this.isWorking=!1}))}}},Ht={class:"dialog-footer"};function Xt(e,t,i,_,n,o){const c=s("el-input"),p=s("el-form-item"),f=s("el-form"),y=s("el-button"),I=s("el-dialog");return d(),g(I,{modelValue:n.visible,"onUpdate:modelValue":t[3]||(t[3]=m=>n.visible=m),class:"publish-window",title:"Publish version",width:"500px",draggable:"","close-on-press-escape":!1,"close-on-click-modal":!1},{footer:a(()=>[r("span",Ht,[l(y,{onClick:t[2]||(t[2]=m=>n.visible=!1)},{default:a(()=>[C("Cancel")]),_:1}),l(y,{type:"primary",disabled:n.isWorking,onClick:o.publish},{default:a(()=>[C(" Confirm ")]),_:1},8,["disabled","onClick"])])]),default:a(()=>[l(f,{ref:"form",model:n.form,rules:o.getRules()},{default:a(()=>[l(p,{label:e.$t("service.versionNumber"),prop:"version",required:""},{default:a(()=>[l(c,{modelValue:n.form.version,"onUpdate:modelValue":t[0]||(t[0]=m=>n.form.version=m),onInput:o.saveConfig},{prefix:a(()=>[C("v")]),_:1},8,["modelValue","onInput"])]),_:1},8,["label"]),l(p,{label:e.$t("service.versionDescription"),prop:"publishDescription",required:""},{default:a(()=>[l(c,{type:"textarea",rows:5,modelValue:n.form.publishDescription,"onUpdate:modelValue":t[1]||(t[1]=m=>n.form.publishDescription=m)},null,8,["modelValue"])]),_:1},8,["label"])]),_:1},8,["model","rules"])]),_:1},8,["modelValue"])}const Kt=N(jt,[["render",Xt]]);const Zt={name:"OptionSettingWindow",components:{OptionValueInput:ve},data(){return{visible:!1,option:null}},methods:{open(e){this.option=e,this.visible=!0},add(){this.option.settings.push({label:"",name:"",inputType:"input",required:!0,defaultValue:""})},deleteSetting(e){this.option.settings.splice(e,1),this.emitChange()},emitChange(){this.$emit("change")}}},$t={class:"toolbar"};function el(e,t,i,_,n,o){const c=s("el-button"),p=s("el-input"),f=s("el-table-column"),y=s("el-option"),I=s("el-select"),m=s("el-switch"),w=s("OptionValueInput"),S=s("el-table"),v=s("el-dialog");return d(),g(v,{modelValue:n.visible,"onUpdate:modelValue":t[0]||(t[0]=b=>n.visible=b),title:"Option Settings","append-to-body":"","custom-class":"option-setting-window"},{default:a(()=>[r("div",$t,[l(c,{icon:"Plus",type:"primary",onClick:o.add},{default:a(()=>[C("Add")]),_:1},8,["onClick"])]),l(S,{data:n.option.settings},{default:a(()=>[l(f,{prop:"label",label:"Label"},{default:a(({row:b})=>[l(p,{modelValue:b.label,"onUpdate:modelValue":h=>b.label=h,onInput:o.emitChange},null,8,["modelValue","onUpdate:modelValue","onInput"])]),_:1}),l(f,{prop:"name",label:"Name"},{default:a(({row:b})=>[l(p,{modelValue:b.name,"onUpdate:modelValue":h=>b.name=h,onInput:o.emitChange},null,8,["modelValue","onUpdate:modelValue","onInput"])]),_:1}),l(f,{prop:"inputType",label:"Input Type"},{default:a(({row:b})=>[l(I,{modelValue:b.inputType,"onUpdate:modelValue":h=>b.inputType=h,onChange:o.emitChange},{default:a(()=>[l(y,{value:"input",label:"Input"}),l(y,{value:"number_input",label:"Number Input"}),l(y,{value:"textarea",label:"Textarea"})]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),l(f,{prop:"required",label:"Input Type"},{default:a(({row:b})=>[l(m,{modelValue:b.required,"onUpdate:modelValue":h=>b.required=h},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),l(f,{prop:"defaultValue",label:"Default Value"},{default:a(({row:b})=>[l(w,{"option-setting":b,modelValue:b.defaultValue,"onUpdate:modelValue":h=>b.defaultValue=h,onInput:o.emitChange},null,8,["option-setting","modelValue","onUpdate:modelValue","onInput"])]),_:1}),l(f,{width:"60px"},{default:a(({row:b,$index:h})=>[l(c,{icon:"Delete",onClick:k=>o.deleteSetting(h)},null,8,["onClick"])]),_:1})]),_:1},8,["data"])]),_:1},8,["modelValue"])}const tl=N(Zt,[["render",el]]),ll={name:"VariableSettingForm",components:{OptionSettingWindow:tl,SortableButton:Z,VariableInput:J,CompilerSelect:O,InputTypeSelect:Q},props:{variable:{required:!0},rootVariable:{required:!0},variableGroup:{default:!1}},computed:{withGroup(){return this.variableGroup!=null}},watch:{"variable.defaultValue":function(){this.handleFieldVariableValues(),this.handleChange()},"variable.name":function(){this.handleFieldVariableValues(),this.handleChange()}},methods:{handleChange(){this.$emit("change")},handleDefaultValueChange(){this.handleFieldVariableValues(),this.$emit("change")},handleFieldVariableValues(){if(this.rootVariable!==this.variable&&(this.rootVariable.inputType==="query_model"||this.rootVariable.inputType==="table"))for(const e of this.rootVariable.children)for(const t of e.defaultValue){t[this.variable.name]=this.variable.defaultValue;for(const i in t){if(i==="origin")continue;e.children.find(n=>n.name===i)==null&&!t.origin.hasOwnProperty(i)&&delete t[i]}}},createOption(){this.variable.options.push({value:"",label:"",remark:"",settings:[]})},deleteOption(e){this.variable.options.splice(e,1)},handleInputTypeChange(){let e=this.variable.defaultValue;if(e!=null&&e.value!=null&&(e=e.value),e instanceof Array&&(e=e[0]),typeof e=="number"&&(e=e+""),this.variable.inputType==="number_input"){let t=Number(parseInt(e));isNaN(t)&&(t=0),this.variable.defaultValue=t}else if(this.variable.inputType==="select"){const t=this.variable.options.find(i=>i.value===e);this.variable.defaultValue={value:t==null?null:e,settings:t==null?[]:t.settings}}else this.variable.inputType==="checkbox"?this.variable.defaultValue=[]:this.variable.inputType==="radio"?this.variable.defaultValue="":this.variable.inputType==="datasource"||this.variable.inputType==="table"||this.variable.inputType==="query_model"?this.variable.defaultValue=null:this.variable.defaultValue=e;this.handleChange()},handleOptionSorted(e){this.variable.options=[],this.$nextTick(()=>{this.variable.options=e,this.handleChange()})}}},nl=r("label",null,"Options",-1),al={class:"opera"};function il(e,t,i,_,n,o){const c=s("el-input"),p=s("el-form-item"),f=s("InputTypeSelect"),y=s("el-button"),I=s("SortableButton"),m=s("el-table-column"),w=s("el-table"),S=s("OptionSettingWindow"),v=s("VariableInput"),b=s("el-switch"),h=s("CompilerSelect"),k=s("el-form"),B=L("sortable");return d(),g(k,{model:i.variable},{default:a(()=>[l(p,{label:"Label",required:""},{default:a(()=>[l(c,{modelValue:i.variable.label,"onUpdate:modelValue":t[0]||(t[0]=u=>i.variable.label=u),onInput:o.handleChange},null,8,["modelValue","onInput"])]),_:1}),l(p,{label:"Name",required:""},{default:a(()=>[l(c,{modelValue:i.variable.name,"onUpdate:modelValue":t[1]||(t[1]=u=>i.variable.name=u),onInput:o.handleChange},null,8,["modelValue","onInput"])]),_:1}),l(p,{label:"Input Type",required:""},{default:a(()=>[l(f,{modelValue:i.variable.inputType,"onUpdate:modelValue":t[2]||(t[2]=u=>i.variable.inputType=u),"with-group":o.withGroup,onChange:o.handleInputTypeChange},null,8,["modelValue","with-group","onChange"])]),_:1}),i.variable.inputType==="select"||i.variable.inputType==="checkbox"||i.variable.inputType==="radio"?(d(),g(p,{key:0,label:"Options",class:"item-options",required:""},{label:a(()=>[r("div",null,[nl,r("div",al,[l(y,{type:"primary",onClick:o.createOption},{default:a(()=>[C("Add")]),_:1},8,["onClick"])])])]),default:a(()=>[D((d(),g(w,{data:i.variable.options},{default:a(()=>[l(m,{width:"25px"},{default:a(()=>[l(I)]),_:1}),l(m,{label:"*Label","min-width":"200px"},{default:a(({row:u})=>[l(c,{modelValue:u.label,"onUpdate:modelValue":T=>u.label=T,type:"textarea",rows:1,onInput:o.handleChange},null,8,["modelValue","onUpdate:modelValue","onInput"])]),_:1}),l(m,{label:"*Value","min-width":"120px"},{default:a(({row:u})=>[l(c,{modelValue:u.value,"onUpdate:modelValue":T=>u.value=T,onInput:o.handleChange},null,8,["modelValue","onUpdate:modelValue","onInput"])]),_:1}),l(m,{label:"Remark","min-width":"150px"},{default:a(({row:u})=>[l(c,{modelValue:u.remark,"onUpdate:modelValue":T=>u.remark=T,type:"textarea",rows:1,onInput:o.handleChange},null,8,["modelValue","onUpdate:modelValue","onInput"])]),_:1}),i.variable.options.length>0?(d(),g(m,{key:0,"min-width":i.variable.inputType==="select"?"120px":"60px",fixed:"right"},{default:a(({row:u,$index:T})=>[i.variable.inputType==="select"?(d(),g(y,{key:0,icon:"Setting",class:"button-icon",onClick:X=>e.$refs.optionSettingWindow.open(u)},null,8,["onClick"])):F("",!0),l(y,{icon:"Delete",class:"button-icon",onClick:X=>o.deleteOption(T)},null,8,["onClick"])]),_:1},8,["min-width"])):F("",!0)]),_:1},8,["data"])),[[B,{data:i.variable.options,onChange:o.handleOptionSorted},"config"]]),l(S,{ref:"optionSettingWindow",onChange:o.handleChange},null,8,["onChange"])]),_:1})):F("",!0),l(p,{label:"Default Value"},{default:a(()=>[l(v,{variable:i.variable,"value-key":"defaultValue",onChange:o.handleDefaultValueChange},null,8,["variable","onChange"])]),_:1}),l(p,{label:"Required"},{default:a(()=>[l(b,{modelValue:i.variable.required,"onUpdate:modelValue":t[3]||(t[3]=u=>i.variable.required=u),onChange:o.handleChange},null,8,["modelValue","onChange"])]),_:1}),l(p,{label:"Hidden"},{default:a(()=>[l(b,{modelValue:i.variable.hidden,"onUpdate:modelValue":t[4]||(t[4]=u=>i.variable.hidden=u),onChange:o.handleChange},null,8,["modelValue","onChange"])]),_:1}),i.variable.inputType!=="number_input"&&i.variable.inputType!=="table"&&i.variable.inputType!=="query_model"&&i.variable.inputType!=="datasource"&&i.rootVariable.inputType!=="query_model"&&i.rootVariable.inputType!=="table"?(d(),g(p,{key:1,label:"Compiler"},{default:a(()=>[l(h,{modelValue:i.variable.compiler,"onUpdate:modelValue":t[5]||(t[5]=u=>i.variable.compiler=u),onChange:o.handleChange},null,8,["modelValue","onChange"])]),_:1})):F("",!0),l(p,{label:"Remark"},{default:a(()=>[l(c,{modelValue:i.variable.remark,"onUpdate:modelValue":t[6]||(t[6]=u=>i.variable.remark=u),type:"textarea",rows:3,onInput:o.handleChange},null,8,["modelValue","onInput"])]),_:1})]),_:1},8,["model"])}const ol=N(ll,[["render",il]]),sl={name:"VariableGroupSettingForm",components:{VariableInput:J,CompilerSelect:O,InputTypeSelect:Q},props:{variable:{required:!0}},methods:{changeScope(){if(this.variable.type==="group")for(const e of this.variable.children)e.scope=this.variable.scope;this.handleChange()},handleChange(){this.$emit("change")}}};function rl(e,t,i,_,n,o){const c=s("el-input"),p=s("el-form-item"),f=s("el-form");return d(),g(f,{model:i.variable},{default:a(()=>[l(p,{label:"Label",required:""},{default:a(()=>[l(c,{modelValue:i.variable.label,"onUpdate:modelValue":t[0]||(t[0]=y=>i.variable.label=y),onInput:o.handleChange},null,8,["modelValue","onInput"])]),_:1}),l(p,{label:"Name",required:""},{default:a(()=>[l(c,{modelValue:i.variable.name,"onUpdate:modelValue":t[1]||(t[1]=y=>i.variable.name=y),onInput:o.handleChange},null,8,["modelValue","onInput"])]),_:1})]),_:1},8,["model"])}const ul=N(sl,[["render",rl]]);const cl={name:"Variables",components:{VariableGroupSettingForm:ul,VariableSettingForm:ol,VariableInput:J,I18nInput:oe,InputTypeSelect:Q,CompilerSelect:O},props:{space:{required:!0},service:{required:!0}},data(){return{isWorking:{save:!1},timeout:{save:null},varIndex:1,groupIndex:1,currentVariable:null,currentGroup:null,currentRootVariable:null,variables:[],dragData:{target:null}}},methods:{selectVariable(e,t){this.currentVariable=null,this.$nextTick(()=>{this.currentVariable=e,this.currentGroup=null,this.currentRootVariable=null,t.level>2?(this.currentRootVariable=t.parent.parent.data,this.currentGroup=t.parent.data):t.level>1?(this.currentRootVariable=t.parent.data,t.parent.data.type==="group"&&(this.currentGroup=t.parent.data)):this.currentRootVariable=t.data})},createChild(e){if(e.type==="group"){this.createVariable(e);return}if(e.inputType==="query_model"){this.createGroup(e,"query_model_field");return}e.inputType==="table"&&this.createGroup(e,"table_field")},createVariable(e){const t=this.__generateVariableName(e==null?this.variables:e.children),i={id:K(),type:"variable",name:t,label:t,inputType:"input",required:!1,hidden:!1,defaultValue:"",compiler:"static",remark:"",options:[]};e!=null?e.children.push(i):this.variables.push(i),this.saveVariables()},createGroup(e){const t=this.__generateGroupName(),i={id:K(),type:"group",name:t,label:t,children:[]};e==null?this.variables.push(i):(e.children==null&&(e.children=[]),e.children.push(i)),this.currentVariable=i,this.saveVariables()},saveVariables(){this.timeout.save!=null&&clearTimeout(this.timeout.save),this.timeout.save=setTimeout(()=>{_e({space:this.space,service:this.service,variables:this.getVariables()}).then(()=>{}).catch(e=>{this.$tip.apiFailed(e)}).finally(()=>{this.timeout.save=null})},1e3)},fetchVariables(){z({space:this.space,service:this.service}).then(e=>{this.variables=e.variables.map(t=>this.__getInitVariable(t))}).catch(e=>{this.$tip.apiFailed(e)})},getVariables(){return this.variables.filter(t=>t.name.trim().length>0&&t.label.trim().length>0).map(t=>this.__getSaveVariable(t))},deleteVariable(){const e=this.currentVariable.type==="variable"?"variable":"variable group";this.deleteConfirm(`Do you want to delete the ${e} named 「${this.currentVariable.name}」?`).then(()=>{if(this.currentRootVariable!==this.currentVariable&&(this.currentRootVariable.inputType==="query_model"||this.currentRootVariable.inputType==="table")){const i=this.currentGroup.children.findIndex(_=>_.id===this.currentVariable.id);if(i===-1)return;this.currentGroup.children.splice(i,1);for(const _ of this.currentRootVariable.children)for(const n of _.defaultValue)for(const o in n){if(o==="origin")continue;_.children.find(p=>p.name===o)==null&&!n.origin.hasOwnProperty(o)&&delete n[o]}this.currentVariable=null,this.saveVariables();return}if(this.currentGroup!=null){const i=this.currentGroup.children.findIndex(_=>_.id===this.currentVariable.id);if(i===-1)return;this.currentGroup.children.splice(i,1),this.currentVariable=null,this.saveVariables();return}const t=this.variables.findIndex(i=>i.id===this.currentVariable.id);t!==-1&&(this.variables.splice(t,1),this.currentVariable=null,this.saveVariables())}).catch(()=>{})},handleDragStart(e){this.dragData.target=e.data},handleDrop(){this.saveVariables()},allowDrag(){return!0},allowDrop(e,t,i){return e.data.type==="variable"?!(t.data.type==="variable"&&i==="inner"):e.data.type==="group"?t.data.type!=="variable":!1},__getValidOptions(e){return e.filter(t=>t.value.trim().length>0&&t.label.trim().length>0)},__getInitVariable(e){const t=JSON.parse(JSON.stringify(e));return t.type==="group"?(t.children=t.children==null?[]:t.children.map(i=>(i.options=i.options==null?[]:i.options,this.__getInitVariable(i))),t):(t.options=t.options==null?[]:t.options,t.options.forEach(i=>{i.settings=i.settings==null?[]:i.settings}),t.inputType==="select"&&(JSON.stringify(t.defaultValue.settings)==="{}"||t.options.forEach(i=>{i.settings=i.settings.map(_=>({..._,value:t.defaultValue.settings[_.name]}))})),t)},__getSaveVariable(e){const t=JSON.parse(JSON.stringify(e));return t.type==="group"?(t.children=t.children.map(i=>this.__getSaveVariable(i)),t):t.inputType==="number_input"?(t.defaultValue=parseInt(t.defaultValue),t):t.inputType==="query_model"||t.inputType==="table"?(t.children!=null&&t.children.length>0&&(t.children=t.children.map(i=>(i.children=i.children.map(_=>this.__getSaveVariable(_)),i))),delete t.options,t):t.inputType==="select"?(t.options=this.__getValidOptions(t.options),t.options.forEach(i=>{i.settings=i.settings.filter(_=>_.name.trim()!==""&&_.label.trim()!=="")}),t.options.forEach(i=>{i.settings.forEach(_=>{delete _.value})}),t):t.inputType==="radio"||t.inputType==="checkbox"?(t.options=this.__getValidOptions(t.options),t.options.forEach(i=>{delete i.settings}),t):(delete t.options,t)},__generateVariableName(e){let t;for(;;)if(t=`var${this.varIndex}`,this.varIndex++,e.findIndex(i=>i.type==="variable"&&i.name===t)===-1)return t},__generateGroupName(){let e;for(;;)if(e=`group${this.groupIndex}`,this.groupIndex++,this.variables.findIndex(t=>t.type==="group"&&t.name===e)===-1)return e}},created(){this.fetchVariables()}},H=e=>(E("data-v-fa6248cd"),e=e(),W(),e),dl={class:"tree"},pl={class:"variables-wrap"},ml={class:"tools"},hl={class:"title"},_l={key:0,class:"opera"},fl={class:"variable-setting"},bl={class:"title"},vl=H(()=>r("h4",null,"Variable Setting",-1)),gl={class:"content-wrap"},Vl={key:1,class:"variable-holder"},yl=H(()=>r("h4",null,"Variable & Variable Group Settings",-1)),Cl=H(()=>r("p",null,"You can open Settings by clicking on variables or groups of variables on the left.",-1)),Sl=[yl,Cl];function kl(e,t,i,_,n,o){const c=s("el-button"),p=s("el-tree"),f=s("VariableSettingForm"),y=s("VariableGroupSettingForm");return d(),V("div",dl,[r("div",pl,[r("div",ml,[l(c,{icon:"Plus",type:"primary",onClick:t[0]||(t[0]=I=>o.createVariable())},{default:a(()=>[C("Add Variable")]),_:1}),l(c,{icon:"Plus",type:"primary",onClick:t[1]||(t[1]=I=>o.createGroup(null,"service"))},{default:a(()=>[C("Add Group")]),_:1})]),l(p,{ref:"tree",class:"variables","expand-on-click-node":!1,"default-expand-all":!0,data:n.variables,"node-key":"name",onNodeClick:o.selectVariable,draggable:"","allow-drop":o.allowDrop,"allow-drag":o.allowDrag,"empty-text":"No Variables",onNodeDragStart:o.handleDragStart,onNodeDrop:o.handleDrop},{default:a(({node:I,data:m})=>[r("div",hl,[r("span",null,x(m.label),1),m.type==="group"||m.inputType==="query_model"||m.inputType==="table"?(d(),V("div",_l,[l(c,{class:"button-icon",icon:"Plus",size:"small",onClick:U(w=>o.createChild(m),["stop"])},null,8,["onClick"])])):F("",!0)])]),_:1},8,["data","onNodeClick","allow-drop","allow-drag","onNodeDragStart","onNodeDrop"])]),r("div",fl,[r("div",bl,[vl,n.currentVariable!=null?(d(),g(c,{key:0,type:"danger",text:"",onClick:o.deleteVariable},{default:a(()=>[C("Delete")]),_:1},8,["onClick"])):F("",!0)]),r("div",gl,[n.currentVariable!=null?(d(),V(q,{key:0},[n.currentVariable.type==="variable"?(d(),g(f,{key:0,variable:n.currentVariable,"variable-group":n.currentGroup,"root-variable":n.currentRootVariable,onChange:o.saveVariables},null,8,["variable","variable-group","root-variable","onChange"])):F("",!0),n.currentVariable.type==="group"?(d(),g(y,{key:1,variable:n.currentVariable,onChange:o.saveVariables},null,8,["variable","onChange"])):F("",!0)],64)):(d(),V("div",Vl,Sl))])])])}const Il=N(cl,[["render",kl],["__scopeId","data-v-fa6248cd"]]);const wl={name:"SpaceSettings",components:{MarkdownEditor:te,HelpButton:se},props:{space:{required:!0}},data(){return{loading:!1,isWorking:!1,form:{id:null,name:"",withPrivate:!1,subServiceReceivable:!1,homepage:"",introduce:"",description:""},rules:{introduce:[{required:!0,message:"Please input space introduce"}],description:[{required:!0,message:"Please input space description"}]}}},methods:{fetchSpace(){this.loading||(this.loading=!0,ye(this.space).then(e=>{for(const t in this.form)this.form[t]=e[t]}).catch(e=>{this.$tip.apiFailed(e)}).finally(()=>{this.loading=!1}))},save(){this.$refs.form.validate().then(()=>{this.isWorking||(this.isWorking=!0,Ce(this.form).then(()=>{this.$tip.success(this.$t("common.saveSuccessfully"))}).catch(e=>{this.$tip.apiFailed(e)}).finally(()=>{this.isWorking=!1}))}).catch(()=>{})}},created(){this.fetchSpace()}},Tl={class:"space-settings"},Fl={class:"form-wrap"},xl={class:"opera"};function Nl(e,t,i,_,n,o){const c=s("el-form-item"),p=s("el-input"),f=s("el-checkbox"),y=s("el-form"),I=s("MarkdownEditor"),m=s("el-button"),w=L("loading");return d(),V("div",Tl,[D((d(),V("div",Fl,[l(y,{ref:"form",model:n.form,rules:n.rules},{default:a(()=>[l(c,{label:"Space Name",prop:"name"},{default:a(()=>[r("h3",null,x(n.form.name),1)]),_:1}),l(c,{label:"Homepage",prop:"homepage"},{default:a(()=>[l(p,{modelValue:n.form.homepage,"onUpdate:modelValue":t[0]||(t[0]=S=>n.form.homepage=S)},null,8,["modelValue"])]),_:1}),l(c,{label:"Introduce",prop:"introduce",required:""},{default:a(()=>[l(p,{modelValue:n.form.introduce,"onUpdate:modelValue":t[1]||(t[1]=S=>n.form.introduce=S),type:"textarea",rows:3,maxlength:"200"},null,8,["modelValue"])]),_:1}),l(c,{label:"Other settings",class:"item-other-settings"},{default:a(()=>[r("div",null,[l(f,{modelValue:n.form.withPrivate,"onUpdate:modelValue":t[2]||(t[2]=S=>n.form.withPrivate=S),label:"Is a private space"},null,8,["modelValue"])]),r("div",null,[l(f,{modelValue:n.form.subServiceReceivable,"onUpdate:modelValue":t[3]||(t[3]=S=>n.form.subServiceReceivable=S),label:"Receive sub services."},null,8,["modelValue"])])]),_:1})]),_:1},8,["model","rules"]),l(y,{ref:"descForm",class:"description-form",model:n.form},{default:a(()=>[l(c,{label:"Description / Space Readme",prop:"description",required:""},{default:a(()=>[l(I,{modelValue:n.form.description,"onUpdate:modelValue":t[4]||(t[4]=S=>n.form.description=S),placeholder:"space description"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])])),[[w,n.loading]]),r("div",xl,[l(m,{type:"primary",size:"large",disabled:n.isWorking,onClick:o.save},{default:a(()=>[C("Save")]),_:1},8,["disabled","onClick"])])])}const Al=N(wl,[["render",Nl],["__scopeId","data-v-c3c3f15b"]]);const Dl={components:{ServiceCodeErrorWindow:ge,SpaceSettings:Al,MarkdownEditor:te,Variables:Il,PublishWindow:Kt,BasicSetting:Jt,InitializeView:Qe,DirectorySelect:G,SettingFiles:Ee},data(){return{isWorking:{compile:!1,cleanCompile:!1},route:{space:"",service:""},loading:!0,currentTab:"basic",service:null,serviceConfig:null}},computed:{...re(["currentProject","currentDatabase","installData"]),initialized(){return this.serviceConfig!=null&&this.serviceConfig.version!=null}},methods:{...ue(["setInstallData"]),saveConfig(){Y({...this.route,readme:this.service.description}).then(()=>{}).catch(e=>{this.$tip.apiFailed(e)})},fetchProfile(){this.loading=!0,fe({spaceName:this.route.space,serviceName:this.route.service}).then(e=>{this.service=e}).then(()=>z({space:this.route.space,service:this.route.service})).then(e=>{e!=null&&(this.serviceConfig=e,this.service.description=e.readme)}).catch(e=>{this.$tip.apiFailed(e)}).finally(()=>{this.loading=!1})},compile(){this.isWorking.compile||(this.isWorking.compile=!0,ce({...this.route,projectId:this.currentProject,database:this.currentDatabase,variables:this.$refs.variables.getVariables()}).then(e=>{this.setInstallData(e),this.$tip.success("Compile successfully.")}).catch(e=>{if(e.code===6e3){this.$refs.serviceCodeErrorWindow.open(e.errorData);return}this.$tip.apiFailed(e)}).finally(()=>{this.isWorking.compile=!1}))},cleanCompile(){this.isWorking.cleanCompile||(this.isWorking.cleanCompile=!0,de({...this.route,projectId:this.currentProject,database:this.currentDatabase,variables:this.$refs.variables.getVariables()}).then(e=>{this.$tip.success("Clean Compile successfully."),this.setInstallData(e)}).catch(e=>{if(e.code===6e3){this.$refs.serviceCodeErrorWindow.open(e.errorData);return}this.$tip.apiFailed(e)}).finally(()=>{this.isWorking.cleanCompile=!1}))}},created(){this.route.space=this.$route.query.space,this.route.service=this.$route.query.service,this.fetchProfile()}},Ul={class:"wrap"},ql={class:"header-wrap"},Bl={class:"header"},El={key:0,class:"opera"},Wl={key:0,class:"text-info-1 service-path"},Ol={class:"main"},Rl={class:"tabs"},Pl={class:"tab-content"};function zl(e,t,i,_,n,o){const c=s("el-button"),p=s("SpaceSettings"),f=s("BasicSetting"),y=s("MarkdownEditor"),I=s("Variables"),m=s("SettingFiles"),w=s("InitializeView"),S=s("PublishWindow"),v=s("ServiceCodeErrorWindow"),b=L("loading");return n.service!=null?D((d(),V("div",{key:0,class:A(["page",{"page-un-initialize":!o.initialized}])},[r("div",Ul,[r("div",ql,[r("div",Bl,[r("h2",null,x(n.service.space.name)+"·"+x(n.service.name),1),o.initialized?(d(),V("div",El,[l(c,{type:"primary",disabled:e.currentProject==null||n.isWorking.compile,onClick:o.compile},{default:a(()=>[C("Compile")]),_:1},8,["disabled","onClick"]),l(c,{type:"primary",disabled:e.currentProject==null||n.isWorking.cleanCompile,onClick:o.cleanCompile},{default:a(()=>[C("Clean Compile")]),_:1},8,["disabled","onClick"]),l(c,{type:"important",onClick:t[0]||(t[0]=h=>e.$refs.publishWindow.open(n.route.space,n.route.service))},{default:a(()=>[C("Publish")]),_:1})])):F("",!0)]),o.initialized?(d(),V("p",Wl,"At "+x(n.service.local.codespace),1)):F("",!0)]),r("div",Ol,[o.initialized?(d(),V(q,{key:0},[r("ul",Rl,[r("li",{class:A({selected:n.currentTab==="space"}),onClick:t[1]||(t[1]=h=>n.currentTab="space")},"Space",2),r("li",{class:A({selected:n.currentTab==="basic"}),onClick:t[2]||(t[2]=h=>n.currentTab="basic")},"Service",2),r("li",{class:A({selected:n.currentTab==="readme"}),onClick:t[3]||(t[3]=h=>n.currentTab="readme")},"Readme",2),r("li",{class:A({selected:n.currentTab==="variables"}),onClick:t[4]||(t[4]=h=>n.currentTab="variables")},"Variables",2),r("li",{class:A({selected:n.currentTab==="files"}),onClick:t[5]||(t[5]=h=>n.currentTab="files")},"Files",2)]),r("div",Pl,[D(l(p,{space:n.route.space},null,8,["space"]),[[R,n.currentTab==="space"]]),D(l(f,{space:n.route.space,service:n.route.service,"service-type":n.service.type,"service-config":n.serviceConfig},null,8,["space","service","service-type","service-config"]),[[R,n.currentTab==="basic"]]),n.service.description!=null?D((d(),g(y,{key:0,modelValue:n.service.description,"onUpdate:modelValue":[t[6]||(t[6]=h=>n.service.description=h),o.saveConfig]},null,8,["modelValue","onUpdate:modelValue"])),[[R,n.currentTab==="readme"]]):F("",!0),D(l(I,{ref:"variables",space:n.route.space,service:n.route.service},null,8,["space","service"]),[[R,n.currentTab==="variables"]]),D(l(m,{space:n.route.space,service:n.route.service},null,8,["space","service"]),[[R,n.currentTab==="files"]])])],64)):(d(),g(w,{key:1,"space-name":n.service.space.name,"service-name":n.service.name,onInitialized:o.fetchProfile},null,8,["space-name","service-name","onInitialized"]))])]),l(S,{ref:"publishWindow"},null,512),l(v,{ref:"serviceCodeErrorWindow"},null,512)],2)),[[b,n.loading]]):F("",!0)}const Hl=N(Dl,[["render",zl],["__scopeId","data-v-6fd05575"]]);export{Hl as default};
