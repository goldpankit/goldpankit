import{_ as I,r as c,o as a,c as d,a as i,F as V,f as E,b as o,w as u,p as M,l as A,x as q,E as K,M as O,m as G,n as H,J,z as R,A as k,t as l,e as p,g as _,j as y,H as j,I as b}from"./index-c7362d92.js";import{S as Q}from"./ServiceInstaller-e6cea803.js";import{P as X}from"./Pagination-6be846bc.js";import{B as Y}from"./BeanAmount-186c6d76.js";import{S as Z,P as x}from"./PluginList-e7c14579.js";import{f as $}from"./service.version-814c0d5c.js";import{f as ee}from"./plugin-7e165779.js";import{S as se}from"./ServiceTitle-03245d50.js";import"./ServiceCodeErrorWindow-bff9e5f4.js";import"./QueryModelView-889c43d8.js";import"./InnerRouterViewWindow-2c28559f.js";import"./form.check-189b470c.js";import"./FormItemTip-825deeec.js";import"./ServiceStatus-80b32ad0.js";const ie={name:"IssueListView",components:{Pagination:X},data(){return{pagination:{pageIndex:1,capacity:10,total:100}}}},P=s=>(M("data-v-f510f853"),s=s(),A(),s),ne={class:"issue-wrap"},le=P(()=>i("div",{class:"toolbar"},[i("ul",null,[i("li",null,"All"),i("li",null,"Enabled"),i("li",null,"Completed"),i("li",null,"Refused")]),i("ul",{class:"issue-types"},[i("li",{class:"bug"},"BUG"),i("li",{class:"optimize"},"Optimize")])],-1)),te={class:"issues"},re=P(()=>i("h3",null,"登录失败时验证码没有刷新",-1)),oe={class:"text-info-1"},ce=P(()=>i("span",null,"刘大逵",-1)),ae=P(()=>i("li",{class:"text-info-1"},[i("span",null,"Completed")],-1)),ue=P(()=>i("li",{class:"text-info-1"},[i("span",null,"3小时前")],-1));function pe(s,n,h,w,e,r){const f=c("UserFilled"),v=c("el-icon"),m=c("router-link"),g=c("Pagination");return a(),d("div",ne,[le,i("ul",te,[(a(),d(V,null,E(10,S=>i("li",{key:S},[o(m,{to:"#",target:"_blank"},{default:u(()=>[re,i("ul",null,[i("li",oe,[o(v,null,{default:u(()=>[o(f)]),_:1}),ce]),ae,ue])]),_:1})])),64))]),o(g,{pagination:e.pagination},null,8,["pagination"])])}const de=I(ie,[["render",pe],["__scopeId","data-v-f510f853"]]);const he={name:"SearchInput",props:{modelValue:{required:!0},placeholder:{}},methods:{search(){this.$emit("search")},handleInput(s){this.$emit("update:modelValue",s.target.value)}}},ve={class:"search-input"},me=["value","placeholder"];function ge(s,n,h,w,e,r){const f=c("Search"),v=c("el-icon");return a(),d("div",ve,[i("input",{value:h.modelValue,placeholder:h.placeholder,onKeypress:n[0]||(n[0]=q((...m)=>r.search&&r.search(...m),["enter"])),onInput:n[1]||(n[1]=(...m)=>r.handleInput&&r.handleInput(...m))},null,40,me),o(v,null,{default:u(()=>[o(f)]),_:1})])}const _e=I(he,[["render",ge],["__scopeId","data-v-898d8650"]]);const fe={components:{ServiceStructureView:Z,SearchInput:_e,ServiceTitle:se,PluginList:x,BeanAmount:Y,IssueListView:de,Empty:K,MarkdownEditor:O,ServiceInstaller:Q},data(){return{loading:{page:!0,plugins:!0},isWorking:{install:!1,uninstall:!1},space:null,keyword:"",latestService:null,service:null,selectedPlugin:null,plugins:[],selectedPluginDimension:"readme",project:null}},computed:{...G(["currentProject","currentProjectDetail"]),installed(){return this.selectedPlugin==null?!1:this.installedPlugins[this.selectedPlugin.name]!=null},majorVersion(){return this.service==null?"...":`${this.service.version.substring(0,this.service.version.indexOf("."))}`},installedPlugins(){return this.project.plugins||this.project.services},installedService(){return this.project.service||this.project.main},upgradeDescription(){return this.latestService==null?"":this.$t("service.upgradeTip",{currentVersion:this.service.version,newVersion:this.latestService.version,publishDescription:this.latestService.publishDescription})}},watch:{currentProject(){this.latestService=null,this.selectedPlugin=null,this.fetchProject()}},methods:{...H(["setCurrentProject"]),upgrade(){window.open(`/space/${this.space}/${this.service.name}/install?major=${this.majorVersion}`)},install(){this.selectedPluginDimension="install",this.$refs.installer.install()},uninstall(){this.selectedPluginDimension="install",this.$refs.installer.uninstall()},withInstalled(s){return this.installedPlugins[s.name]!=null},fetchProject(){if(this.loading.page=!0,this.currentProject==null||this.currentProject===""){this.project=null,this.space=null,this.loading.page=!1;return}this.refreshProject(!0)},fetchLatestVersion(){this.latestService==null&&$({space:this.space,service:this.service.name,majorVersion:this.majorVersion}).then(s=>{this.latestService=s}).catch(s=>{if(s.code===4002){this.alert("当前项目使用的服务可能已被更名或删除，您可以前往服务详情了解更多内容。",null,{showCancelButton:!0,confirmButtonText:"查看服务详情"}).then(()=>{window.open(`/space/${this.space}/${this.service.name}`)});return}this.$tip.apiFailed(s)})},refreshProject(s=!1){this.loading.page=!0,J(this.currentProject).then(n=>{if(this.project=n,this.space=this.project.space,this.space==null){this.service=null,this.loading.page=!1;return}if(this.installedService==null){this.loading.page=!1;return}let h=null;for(const w in this.installedService){h=w;break}this.service={name:h,...this.installedService[h]},this.fetchLatestVersion(),s&&this.searchPlugins()}).catch(n=>{this.$tip.apiFailed(n)}).finally(()=>{this.loading.page=!1})},searchPlugins(){this.loading.plugins=!0,ee({space:this.space,service:this.service.name,majorVersion:this.majorVersion,keyword:this.keyword}).then(s=>{this.plugins=s}).catch(s=>{s.code!==4001&&this.$tip.apiFailed(s)}).finally(()=>{this.loading.plugins=!1})},selectPlugin(s){this.plugins.length>0&&(this.selectedPlugin=s)},hasNewVersion(s){const n=this.installedPlugins[s.name];return n==null?!1:n.version!==s.lastVersion}},created(){const s=this.$route.query.project_id;s!=null&&s!==""&&(this.setCurrentProject(s),this.$router.replace({name:"Workbench"})),this.fetchProject()}},ke={class:"page"},Pe={key:0,class:"wrap"},we={class:"header"},Se={class:"title"},ye={class:"project-code-space"},je={class:"service-info"},be={class:"service-title-wrap"},Ve={class:"info"},Ie={class:"content-wrap"},Ce={class:"service-wrap"},De={class:"search-input-wrap"},Te={class:"setting-wrap"},We={class:"main"},Le={class:"service-dimensions"},Ue={class:"dimension-content"},Fe={class:"opera"},Be={class:"opera-tip"},ze={key:1,class:"setting-holder"},Ne={key:1,class:"incorrect-wrap"},Ee={class:"content"},Me={key:2,class:"incorrect-wrap"},Ae={class:"content"};function qe(s,n,h,w,e,r){const f=c("Folder"),v=c("el-icon"),m=c("ServiceTitle"),g=c("el-button"),S=c("el-popover"),T=c("SearchInput"),W=c("Upload"),L=c("Check"),U=c("PluginList"),F=c("MarkdownEditor"),B=c("ServiceInstaller"),z=c("ServiceStructureView"),N=c("InfoFilled"),C=c("router-link"),D=R("loading");return k((a(),d("div",ke,[!e.loading.page&&e.project!=null&&e.service!=null?(a(),d("div",Pe,[i("div",null,[i("div",we,[i("div",Se,[i("h2",null,l(e.project.name),1),i("p",ye,[o(v,null,{default:u(()=>[o(f)]),_:1}),p(l(s.currentProjectDetail.codespace),1)]),i("div",je,[i("div",be,[o(m,{space:e.space,service:e.service.name,"service-label":e.service.label,"with-new-page":!0},null,8,["space","service","service-label"]),p(" · v"+l(e.service.version),1)]),e.latestService!=null&&e.latestService.version!==e.service.version?(a(),_(S,{key:0,title:s.$t("service.upgradeTitle"),width:255,trigger:"hover","popper-class":"upgrade-popover"},{default:u(()=>[i("pre",null,l(r.upgradeDescription),1)]),reference:u(()=>[o(g,{size:"small",type:"primary",icon:"Upload",onClick:r.upgrade},{default:u(()=>[p(l(s.$t("service.upgrade")),1)]),_:1},8,["onClick"])]),_:1},8,["title"])):y("",!0)])]),i("div",Ve,[i("em",null,"v"+l(r.majorVersion),1),i("p",null,l(s.$t("common.currentVersion")),1)])]),i("div",Ie,[i("div",Ce,[i("div",De,[o(T,{placeholder:s.$t("common.search"),modelValue:e.keyword,"onUpdate:modelValue":n[0]||(n[0]=t=>e.keyword=t),onSearch:r.searchPlugins},null,8,["placeholder","modelValue","onSearch"])]),k((a(),_(U,{plugins:e.plugins,"custom-class":t=>({selected:e.selectedPlugin!=null&&e.selectedPlugin.name===t.name}),installed:t=>r.withInstalled(t),onClick:n[1]||(n[1]=t=>r.selectPlugin(t))},{title:u(({plugin:t})=>[p(l(t.label||t.name)+" ",1),r.hasNewVersion(t)?(a(),_(v,{key:0},{default:u(()=>[o(W)]),_:1})):r.withInstalled(t)?(a(),_(v,{key:1,class:"installed-icon"},{default:u(()=>[o(L)]),_:1})):y("",!0)]),_:1},8,["plugins","custom-class","installed"])),[[D,e.loading.plugins]])]),i("div",Te,[e.selectedPlugin!=null?(a(),d(V,{key:0},[i("h3",null,l(e.selectedPlugin.label||e.selectedPlugin.name),1),i("div",We,[i("ul",Le,[i("li",{class:j({selected:e.selectedPluginDimension==="readme"}),onClick:n[2]||(n[2]=t=>e.selectedPluginDimension="readme")},l(s.$t("common.readme")),3),i("li",{class:j({selected:e.selectedPluginDimension==="install"}),onClick:n[3]||(n[3]=t=>e.selectedPluginDimension="install")},l(s.$t("plugin.install")),3),i("li",{class:j({selected:e.selectedPluginDimension==="structure"}),onClick:n[4]||(n[4]=t=>e.selectedPluginDimension="structure")},l(s.$t("service.structure")),3)]),i("div",Ue,[k(i("div",null,[o(F,{modelValue:e.selectedPlugin.description,"onUpdate:modelValue":n[5]||(n[5]=t=>e.selectedPlugin.description=t),readonly:"","without-padding":!0},null,8,["modelValue"])],512),[[b,e.selectedPluginDimension==="readme"]]),k(o(B,{ref:"installer",installing:e.isWorking.install,"onUpdate:installing":n[6]||(n[6]=t=>e.isWorking.install=t),uninstalling:e.isWorking.uninstall,"onUpdate:uninstalling":n[7]||(n[7]=t=>e.isWorking.uninstall=t),space:e.space,service:e.service.name,plugin:e.selectedPlugin.name,"service-price":e.selectedPlugin.price.price,"service-lease":e.selectedPlugin.latestLease,version:e.selectedPlugin.lastVersion,"with-project":!1,"project-config":e.project,onInstalled:n[8]||(n[8]=t=>r.refreshProject()),onUninstalled:n[9]||(n[9]=t=>r.refreshProject())},null,8,["installing","uninstalling","space","service","plugin","service-price","service-lease","version","project-config"]),[[b,e.selectedPluginDimension==="install"]]),k(o(z,{space:e.space,service:e.service.name,plugin:e.selectedPlugin.name,version:e.selectedPlugin.lastVersion},null,8,["space","service","plugin","version"]),[[b,e.selectedPluginDimension==="structure"]])])]),i("div",Fe,[r.installed?(a(),d(V,{key:0},[r.hasNewVersion(e.selectedPlugin)?(a(),_(g,{key:0,type:"primary",size:"large",icon:"Upload",disabled:e.isWorking.install,onClick:r.install},{default:u(()=>[p(l(s.$t("service.upgrade")),1)]),_:1},8,["disabled","onClick"])):(a(),_(g,{key:1,type:"primary",size:"large",disabled:e.isWorking.install,onClick:r.install},{default:u(()=>[p(l(e.isWorking.install?s.$t("service.installing"):s.$t("service.reinstall")),1)]),_:1},8,["disabled","onClick"])),o(g,{size:"large",disabled:e.isWorking.uninstall,onClick:r.uninstall},{default:u(()=>[p(l(e.isWorking.uninstall?s.$t("service.uninstalling"):s.$t("service.uninstall")),1)]),_:1},8,["disabled","onClick"])],64)):(a(),_(g,{key:1,type:"primary",size:"large",disabled:e.isWorking.install,onClick:r.install},{default:u(()=>[p(l(e.isWorking.install?s.$t("service.installing"):s.$t("service.install")),1)]),_:1},8,["disabled","onClick"]))]),i("div",Be,[o(v,null,{default:u(()=>[o(N)]),_:1}),i("p",null,l(s.$t("service.installTip")),1)])],64)):(a(),d("div",ze,[i("h4",null,l(s.$t("workbench.subServiceSettings")),1),i("p",null,l(s.$t("workbench.subServiceSettingsTip")),1)]))])])])])):e.project==null?(a(),d("div",Ne,[i("div",Ee,[i("p",null,[p(l(s.$t("workbench.noProjectTip1")),1),o(C,{to:{name:"Index"}},{default:u(()=>[p(l(s.$t("common.homepage")),1)]),_:1}),p(l(s.$t("workbench.noProjectTip2")),1)])])])):e.service==null?(a(),d("div",Me,[i("div",Ae,[i("p",null,[p(l(s.$t("workbench.noServiceInstalledTip1")),1),o(C,{to:{name:"PublicServices"}},{default:u(()=>[p(l(s.$t("service.publicServices")),1)]),_:1}),p(l(s.$t("workbench.noServiceInstalledTip2")),1)])])])):y("",!0)])),[[D,e.loading.page]])}const is=I(fe,[["render",qe],["__scopeId","data-v-b45225ca"]]);export{is as default};
