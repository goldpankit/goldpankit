import{P as B,S as A}from"./PluginList-f7603291.js";import{_ as j,r as a,o as n,c as o,F as y,f as D,b as l,a as i,t,M as I,z as F,A as v,j as h,H as m,I as f,w as g,e as b,p as q,l as z}from"./index-38693b26.js";import{B as w}from"./BeanAmount-a65fb43c.js";import{f as E,a as U}from"./service-7c141bb7.js";import{a as O}from"./service.space-4e310a85.js";import{S as k}from"./ServiceTitle-ac0c6034.js";import{S as x}from"./ServiceStatus-0b8b2ee9.js";import"./service.version-b38dea85.js";const H={name:"VerticalServiceList",components:{ServiceTitle:k,BeanAmount:w},props:{space:{require:!0},services:{type:Array,required:!0}}},R={class:"service-list"},G={class:"price-wrap"},J={class:"text-info-1 text-mini"};function K(s,r,p,T,e,S){const _=a("ServiceTitle"),d=a("BeanAmount");return n(),o("ul",R,[(n(!0),o(y,null,D(p.services,u=>(n(),o("li",{key:u.name},[l(_,{space:p.space,service:u.name,"with-paths":!1},null,8,["space","service"]),i("p",null,t(u.introduce),1),i("div",G,[i("p",J,t(s.getDateOffsetText(u.lastPublish)),1),l(d,{price:u.price.price,type:u.price.leaseType},null,8,["price","type"])])]))),128))])}const Q=j(H,[["render",K],["__scopeId","data-v-15862673"]]);const W={components:{ServiceStatus:x,ServiceTitle:k,VerticalServiceList:Q,BeanAmount:w,MarkdownEditor:I,PluginList:B,ServiceStructureView:A},data(){return{loading:!0,route:{space:null,service:null},currentTab:"readme",currentMajorVersion:"",currentVersion:"",majorVersions:[],space:null,service:null,majorVersionDetail:null,relationServices:[]}},methods:{initData(){this.loading=!0,this.fetchSpace(),this.fetchServices(),this.fetchDetail()},changeMajorVersion(s){this.currentMajorVersion!==s&&(this.currentMajorVersion=s,this.fetchDetail(s))},fetchSpace(){O(this.route.space).then(s=>{this.space=s}).catch(s=>{this.$tip.apiFailed(s)})},fetchServices(){E({space:this.route.space,withSpaceInfo:!1,withPublisher:!1}).then(s=>{this.relationServices=s.filter(r=>this.route.service!==r.name)}).catch(s=>{this.$tip.apiFailed(s)})},fetchDetail(s){U({...this.route,majorVersion:s}).then(r=>{if(r==null){this.alert("该服务还未发布或已被删除").then(()=>{this.$router.push({name:"PublicServices"})});return}this.service=r,this.majorVersions=r.majorVersions,this.currentMajorVersion=s||this.majorVersions[0],this.majorVersionDetail=r.defaultMajorVersion,this.currentVersion=this.majorVersionDetail.version,this.majorVersionDetail.description==null&&this.majorVersionDetail.description.trim()===""&&(this.majorVersionDetail.description="No Descriptions")}).catch(r=>{if(r.code===5110||r.code===4002){this.alert(r.message).then(()=>{this.$router.push({name:"PublicServices"})});return}this.$tip.apiFailed(r)}).finally(()=>{this.loading=!1})}},beforeRouteUpdate(s,r,p){this.route.space=s.params.spaceName,this.route.service=s.params.serviceName,this.initData(),p()},created(){this.route.space=this.$route.params.spaceName,this.route.service=this.$route.params.serviceName,this.initData()}},X=s=>(q("data-v-798e8b95"),s=s(),z(),s),Y={class:"page"},Z={key:0,class:"wrap"},$={class:"header"},ee={class:"tech-stack-wrap"},se={key:0,class:"major-versions"},ie=["onClick"],re={class:"content-wrap"},te={class:"dimension-wrap"},ne={class:"dimensions"},oe={key:0,class:"detail"},ce={class:"info"},le={class:"user-profile"},ae={class:"user-info"},ue=["src"],pe={class:"introduce"},ve={class:"install"},he=X(()=>i("i",{class:"iconfont icon-code"},null,-1)),me={class:"info-list"},_e={key:0},de={key:1},fe={key:0,class:"relation-services-wrap"};function Se(s,r,p,T,e,S){const _=a("ServiceTitle"),d=a("ServiceStatus"),u=a("BeanAmount"),N=a("MarkdownEditor"),P=a("PluginList"),M=a("ServiceStructureView"),V=a("el-button"),C=a("VerticalServiceList"),L=F("loading");return v((n(),o("div",Y,[e.space!=null&&e.service!=null?(n(),o("div",Z,[i("div",$,[l(_,{space:e.space.name,service:e.service.name,"service-label":e.service.label},null,8,["space","service","service-label"]),i("div",ee,[l(d,{"with-private":e.service.withPrivate},null,8,["with-private"]),i("p",null,t(e.majorVersionDetail.subServices.length)+" "+t(s.$t("service.plugins")),1),l(u,{price:e.service.price.price,type:e.service.price.leaseType},null,8,["price","type"])]),e.majorVersions.length>1?(n(),o("ul",se,[(n(!0),o(y,null,D(e.majorVersions,c=>(n(),o("li",{key:c,class:m({selected:c===e.currentMajorVersion}),onClick:Ve=>S.changeMajorVersion(c)},"v"+t(c),11,ie))),128))])):h("",!0)]),i("div",re,[i("div",te,[i("ul",ne,[i("li",{class:m({selected:e.currentTab==="readme"}),onClick:r[0]||(r[0]=c=>e.currentTab="readme")},t(s.$t("common.readme")),3),i("li",{class:m({selected:e.currentTab==="extends"}),onClick:r[1]||(r[1]=c=>e.currentTab="extends")},t(s.$t("service.subServices")),3),i("li",{class:m({selected:e.currentTab==="structure"}),onClick:r[2]||(r[2]=c=>e.currentTab="structure")},t(s.$t("service.structure")),3)]),e.majorVersionDetail!=null?(n(),o("div",oe,[v(l(N,{modelValue:e.majorVersionDetail.description,"onUpdate:modelValue":r[3]||(r[3]=c=>e.majorVersionDetail.description=c),readonly:!0,"without-padding":!0},null,8,["modelValue"]),[[f,e.currentTab==="readme"]]),v(l(P,{plugins:e.majorVersionDetail.subServices},null,8,["plugins"]),[[f,e.currentTab==="extends"]]),v(l(M,{space:e.route.space,service:e.route.service,version:e.currentVersion},null,8,["space","service","version"]),[[f,e.currentTab==="structure"]])])):h("",!0)]),i("div",ce,[i("div",le,[i("div",ae,[i("img",{src:s.getAccessUri(e.service.user.avatar,"/images/avatar/default.png")},null,8,ue),i("h4",null,t(e.service.user.username),1)]),i("p",pe,t(e.service.user.introduce===""||e.service.user.introduce==null?"No introduce":e.service.user.introduce),1)]),i("div",ve,[l(V,{type:"important",size:"large",onClick:r[4]||(r[4]=c=>s.$router.push({name:"ServiceInstaller",params:{spaceName:e.space.name,serviceName:e.service.name},query:{major:e.currentMajorVersion}}))},{default:g(()=>[he,b(t(s.$t("service.install")),1)]),_:1}),l(V,{size:"large",onClick:r[5]||(r[5]=c=>s.$router.push({name:"CreatePlugin",query:{space:e.space.name,service:e.service.name}}))},{default:g(()=>[b(t(s.$t("plugin.create2")),1)]),_:1})]),i("ul",me,[i("li",null,[i("label",null,t(s.$t("service.subServices")),1),i("p",null,t(e.majorVersionDetail.subServices.length),1)]),i("li",null,[i("label",null,t(s.$t("service.lastPublish")),1),e.service.lastPublish!=null?(n(),o("p",_e,t(s.getDateOffsetText(e.service.lastPublish)),1)):(n(),o("p",de,"None"))])]),e.relationServices.length>0?(n(),o("div",fe,[i("h4",null,t(s.$t("service.relationList")),1),l(C,{services:e.relationServices},null,8,["services"])])):h("",!0)])])])):h("",!0)])),[[L,e.loading]])}const Ne=j(W,[["render",Se],["__scopeId","data-v-798e8b95"]]);export{Ne as default};
