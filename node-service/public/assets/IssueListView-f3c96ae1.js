import{B as W}from"./BeanAmount-9cac4711.js";import{E as T}from"./Empty-77749bbf.js";import{_ as C,r as u,o as i,c as r,F as m,f as S,H as q,i as B,a as t,K as E,t as a,j as f,g as v,e as w,L,P as D,N as F,m as A,n as N,h as M,O,Q as R,b as _,w as p,p as U,l as z}from"./index-9924447b.js";import{S as x,F as G,M as H,V as J,I as K,a as Q,b as X,c as Y,g as Z}from"./ServiceCodeErrorWindow-38aee87b.js";import{P as ee}from"./Pagination-b41c3364.js";const te={name:"SubServiceList",components:{Empty:T,BeanAmount:W},props:{services:{type:Array,required:!0},customClass:{type:Function,default(){return()=>{}}},installed:{type:Function,default(){return()=>{}}}}},se={key:0,class:"sub-service-list"},ne=["onClick"],ie={class:"latest-version"},le={key:0},re={class:"user-profile"},ae=["src"],oe={class:"price-wrap"},ce={class:"text-info-1 text-mini"},ue={key:0};function de(e,s,n,c,o,h){const g=u("BeanAmount"),y=u("Empty");return n.services.length>0?(i(),r("ul",se,[(i(!0),r(m,null,S(n.services,l=>(i(),r("li",{key:l.id,class:q({...n.customClass(l),"service-installed":n.installed(l)===!0}),onClick:B($=>e.$emit("click",l),["stop"])},[t("h5",null,[E(e.$slots,"title",{service:l},()=>[w(a(l.name),1)],!0)]),t("p",ie,[t("span",null,a(e.$t("service.latestVersion"))+": v"+a(l.lastVersion),1),n.installed(l)===!0?(i(),r("span",le,a(e.$t("service.installed")),1)):f("",!0)]),t("p",null,a(l.introduce),1),t("div",re,[t("img",{src:e.getAccessUri(l.user.avatar,"/images/avatar/default.png")},null,8,ae),t("span",null,a(l.user.username),1)]),t("div",oe,[t("p",ce,a(e.$t("service.lastPublish"))+": "+a(e.getDateOffsetText(l.lastPublishTime)),1),l.latestLease!=null?(i(),r("em",ue,a(e.getRemainingDay(l.latestLease.leaseEndTime))+" "+a(e.$t("common.days")),1)):(i(),v(g,{key:1,price:l.price.price,type:l.price.leaseType},null,8,["price","type"]))])],10,ne))),128))])):(i(),v(y,{key:1,description:e.$t("service.noSubServices")},null,8,["description"]))}const Oe=C(te,[["render",de],["__scopeId","data-v-7a480bed"]]);const _e={name:"ServiceInstaller",components:{ServiceCodeErrorWindow:x,MergeWindow:L,ProjectSelect:D,DirectorySelect:F,FieldSetting:G,MySqlFieldSelect:H,VariableInput:J,InstallRadio:K,InstallInput:Q,InstallCheckbox:X},props:{installing:{},uninstalling:{},space:{required:!0},service:{required:!0},serviceType:{required:!0},servicePrice:{required:!0},serviceLease:{required:!1},version:{required:!0},withProject:{default:!0},projectConfig:{},withBreadcrumbs:{default:!1},withInstallButton:{default:!1}},data(){return{isWorking:{install:!1,uninstall:!1},variables:[]}},computed:{...A(["currentProject","currentDatabase"]),serviceVariables(){return this.variables},unique(){return[this.space,this.service,this.version]}},watch:{unique(){this.fetchVersion()},"isWorking.install":function(){this.$emit("update:installing",this.isWorking.install)},"isWorking.uninstall":function(){this.$emit("update:uninstalling",this.isWorking.uninstall)}},methods:{...N(["setCurrentProject","setInstallData"]),...M(["refreshBalance"]),fetchVersion(){Y({space:this.space,service:this.service,version:this.version}).then(e=>{this.variables=JSON.parse(e.variables).map(s=>this.__initVariableValue(s))}).catch(e=>{this.$tip.apiFailed(e)})},install(){if(this.serviceLease!=null){this.__install();return}if(this.servicePrice<50){this.__install();return}this.installConfirm(this.servicePrice).then(()=>{this.__install()}).catch(()=>{})},__install(){this.isWorking.install||(this.isWorking.install=!0,O({projectId:this.currentProject,database:this.currentDatabase,space:this.space,service:this.service,serviceType:this.serviceType,version:this.version,variables:this.__getInstallVariables(this.variables)}).then(e=>{this.$tip.success(this.$t("service.installSuccessfully")),this.setInstallData(e),this.refreshBalance(),this.$emit("installed")}).catch(e=>{if(e.code===6e3){this.$refs.serviceCodeErrorWindow.open(e.errorData);return}this.$tip.apiFailed(e)}).finally(()=>{this.isWorking.install=!1}))},uninstall(){if(this.serviceLease!=null){this.__uninstall();return}if(this.servicePrice<50){this.__uninstall();return}this.uninstallConfirm().then(()=>{this.__uninstall()}).catch(()=>{})},__uninstall(){this.isWorking.uninstall||(this.isWorking.uninstall=!0,R({projectId:this.currentProject,database:this.currentDatabase,space:this.space,service:this.service,serviceType:this.serviceType,version:this.version,variables:this.__getInstallVariables(this.variables)}).then(e=>{this.$tip.success(this.$t("service.uninstallSuccessfully")),this.setInstallData(e),this.$emit("uninstalled")}).catch(e=>{if(e.code===6e3){this.$refs.serviceCodeErrorWindow.open(e.errorData);return}this.$tip.apiFailed(e)}).finally(()=>{this.isWorking.uninstall=!1}))},__getInstallVariables(e){return e.map(s=>{if(s.inputType==="select"){const n=s.options.find(o=>o.value===s.value.value);if(n==null)return s;const c={};for(const o of n.settings)c[o.name]=o.value;s.value.settings=c}return s})},__initVariableValue(e,s){if(s==null&&this.projectConfig!=null){const n=this.projectConfig.services[this.service];if(n!=null){const c=n.variables.findLast(o=>o.name===e.name);c!=null&&(s=c.value)}if(s==null){let c=null;for(const h in this.projectConfig.main){c=h;break}const o=this.projectConfig.main[c].variables[e.name];s=o,o!=null&&o.constructor!==e.defaultValue.constructor&&(s=null)}}if(s!=null){if(e.inputType==="table"||e.inputType==="query_model"){for(const n in s.settings){const c=e.children.find(o=>o.name===n);c!=null&&(c.value=s.settings[n])}return e.value=s.value,console.log(e.name,e.value,s),e}return e.type==="group"?(e.children.forEach(n=>this.__initVariableValue(n,s[n.name])),e):(e.value=s,e)}if(s=e.defaultValue,s=s??Z(e.inputType),e.inputType==="table"||e.inputType==="query_model"){for(const n of e.children)n.value=n.defaultValue;return e.value=s,e}return e.type==="group"?(e.children.forEach(n=>{n.value=n.defaultValue}),e):(e.value=s,e)}},created(){this.fetchVersion()}},pe={class:"service-installer"},he={key:0,class:"nav"},fe={class:"title"},me={class:"content-wrap"},ge={class:"install-tip"},ye={class:"form-wrap"},ve={key:1,class:"label-wrap"},ke={key:1,class:"group-vars"},$e={class:"text-info-1 text-mini"},Ve={key:0},we={key:1,class:"parameters-holder"},Se={key:2,class:"install"};function be(e,s,n,c,o,h){const g=u("el-button"),y=u("ProjectSelect"),l=u("el-form-item"),$=u("ArrowRight"),b=u("el-icon"),I=u("VariableInput"),P=u("el-form"),j=u("ServiceCodeErrorWindow");return i(),r("div",pe,[n.withBreadcrumbs?(i(),r("div",he,[t("div",fe,[_(g,{class:"button-icon",icon:"ArrowLeftBold",onClick:s[0]||(s[0]=d=>e.$emit("back"))}),t("h4",null,a(n.service)+a(n.version==null?"":" · "+n.version.toUpperCase())+" · "+a(e.$t("service.install2")),1)])])):f("",!0),t("div",me,[n.withProject||h.serviceVariables.length>0?(i(),r(m,{key:0},[t("p",ge,a(e.$t("service.withParametersTip")),1),t("div",ye,[_(P,null,{default:p(()=>[n.withProject?(i(),v(l,{key:0,label:e.$t("project.project"),required:""},{default:p(()=>[_(y,{"model-value":e.currentProject,"with-block":!0,"with-prefix":!1,onChange:e.setCurrentProject},null,8,["model-value","onChange"])]),_:1},8,["label"])):f("",!0),(i(!0),r(m,null,S(h.serviceVariables,d=>(i(),r(m,null,[d.hidden?f("",!0):(i(),v(l,{key:d.name,label:d.label,required:d.required},{label:p(()=>[d.type==="variable"?(i(),r(m,{key:0},[w(a(d.label),1)],64)):(i(),r("div",ve,[t("span",null,a(d.label),1),_(b,null,{default:p(()=>[_($)]),_:1})]))]),default:p(()=>[d.type==="variable"?(i(),v(I,{key:0,variable:d},null,8,["variable"])):d.type==="group"?(i(),r("ul",ke,[(i(!0),r(m,null,S(d.children,V=>(i(),r("li",{key:`${d.name}_${V.name}`},[t("label",$e,[V.required?(i(),r("em",Ve,"*")):f("",!0),w(a(V.label),1)]),_(I,{variable:V},null,8,["variable"])]))),128))])):f("",!0)]),_:2},1032,["label","required"]))],64))),256))]),_:1})])],64)):(i(),r("div",we,[t("p",null,a(e.$t("service.withoutParametersTip")),1)])),n.withInstallButton?(i(),r("div",Se,[_(g,{type:"important",onClick:h.install,disabled:o.isWorking.install},{default:p(()=>[w(a(o.isWorking.install?e.$t("service.installing"):e.$t("service.install")),1)]),_:1},8,["onClick","disabled"])])):f("",!0)]),_(j,{ref:"serviceCodeErrorWindow"},null,512)])}const Re=C(_e,[["render",be],["__scopeId","data-v-25beed6a"]]);const Ce={name:"IssueListView",components:{Pagination:ee},data(){return{pagination:{pageIndex:1,capacity:10,total:100}}}},k=e=>(U("data-v-f510f853"),e=e(),z(),e),Ie={class:"issue-wrap"},Pe=k(()=>t("div",{class:"toolbar"},[t("ul",null,[t("li",null,"All"),t("li",null,"Enabled"),t("li",null,"Completed"),t("li",null,"Refused")]),t("ul",{class:"issue-types"},[t("li",{class:"bug"},"BUG"),t("li",{class:"optimize"},"Optimize")])],-1)),je={class:"issues"},We=k(()=>t("h3",null,"登录失败时验证码没有刷新",-1)),Te={class:"text-info-1"},qe=k(()=>t("span",null,"刘大逵",-1)),Be=k(()=>t("li",{class:"text-info-1"},[t("span",null,"Completed")],-1)),Ee=k(()=>t("li",{class:"text-info-1"},[t("span",null,"3小时前")],-1));function Le(e,s,n,c,o,h){const g=u("UserFilled"),y=u("el-icon"),l=u("router-link"),$=u("Pagination");return i(),r("div",Ie,[Pe,t("ul",je,[(i(),r(m,null,S(10,b=>t("li",{key:b},[_(l,{to:"#",target:"_blank"},{default:p(()=>[We,t("ul",null,[t("li",Te,[_(y,null,{default:p(()=>[_(g)]),_:1}),qe]),Be,Ee])]),_:1})])),64))]),_($,{pagination:o.pagination},null,8,["pagination"])])}const Ue=C(Ce,[["render",Le],["__scopeId","data-v-f510f853"]]);export{Ue as I,Oe as S,Re as a};
