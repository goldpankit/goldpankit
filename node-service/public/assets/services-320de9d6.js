import{P}from"./Pagination-9905b134.js";import{_ as $,E as w,m as N,r as c,z as I,o as n,c as o,a,t as s,A,F as D,f as B,g as r,b as m,j as v,w as g,e as f,p as E,l as T}from"./index-c1ed4b13.js";import{d as z,f as F}from"./user.service-6f4f3b93.js";import{b as M}from"./service-ff4ad1ca.js";import{B as L}from"./BeanAmount-a786337c.js";import{S as V}from"./ServiceTitle-eb07b032.js";import{S as O}from"./ServiceStatus-884858b6.js";const q={components:{ServiceStatus:O,ServiceTitle:V,BeanAmount:L,Empty:w,Pagination:P},data(){return{loading:!1,pagination:{page:1,capacity:5,total:0},services:[]}},computed:{...N(["userInfo"])},methods:{openDetail(e){e.type!=="COMMON"&&this.$router.push({name:"ServiceDetail",params:{spaceName:e.space.name,serviceName:e.name}})},openSettings(e){if(e.type==="MAIN"){this.$router.push({name:"ServiceSettings",query:{space:e.space.name,service:e.name}});return}this.$router.push({name:"PluginSettings",query:{space:e.space.name,service:e.mainService.name,plugin:e.name}})},deleteService(e){this.deleteConfirm(this.$t("service.confirmDeleteTip")).then(()=>{z({space:e.space.name,service:e.name}).then(()=>{this.services.length===1&&(this.pagination.page-=1),this.fetchPage(),this.$tip.success(this.$t("common.deleteSuccessfully"))}).catch(i=>{this.$tip.apiFailed(i)})}).catch(()=>{})},handleCurrentChange(e){this.pagination.page=e,this.fetchPage()},handleSizeChange(e){this.pagination.capacity=e,this.fetchPage()},fetchPage(){this.loading||(this.loading=!0,this.pagination.page<1&&(this.pagination.page=1),F({...this.pagination,model:{}}).then(e=>{this.services=e.records,this.pagination.total=e.total,this.fetchLocalServices()}).catch(e=>{this.$tip.apiFailed(e)}).finally(()=>{this.loading=!1}))},fetchLocalServices(){M().then(e=>{this.services.forEach(i=>{i.codespace=null;const p=e.find(u=>u.space===i.space.name&&u.name===i.name);p!=null&&(i.repository=p.repository,i.codespace=p.codespace)})}).catch(e=>{this.$tip.apiFailed(e)})}},created(){this.fetchPage()}},j=e=>(E("data-v-83b724ff"),e=e(),T(),e),U={class:"page"},G={class:"wrap"},H={class:"header"},J={class:"service-list-wrap"},K={key:0,class:"service-list"},Q={class:"introduce"},R={class:"info"},W={class:"info"},X={class:"footer-info"},Y={key:0,class:"user-profile"},Z=["src"],x=j(()=>a("span",null,"|",-1)),ee={class:"text-info-1 text-mini"},te={key:2,class:"opera"};function ae(e,i,p,u,h,l){const _=c("ServiceTitle"),y=c("ServiceStatus"),d=c("el-button"),C=c("Empty"),b=c("Pagination"),k=I("loading");return n(),o("div",U,[a("div",G,[a("div",H,[a("h2",null,s(e.$t("user.leasedAndPrivateServices")),1)]),A((n(),o("div",J,[h.services.length>0?(n(),o("ul",K,[(n(!0),o(D,null,B(h.services,t=>(n(),o("li",{key:t.id},[t.type==="MAIN"?(n(),r(_,{key:0,space:t.space.name,service:t.name,"service-label":t.label,"with-type":!0},null,8,["space","service","service-label"])):(n(),r(_,{key:1,space:t.space.name,service:t.mainService.name,"service-label":t.mainService.label,plugin:t.name,"plugin-label":t.label,"with-type":!0},null,8,["space","service","service-label","plugin","plugin-label"])),a("p",Q,s(t.introduce),1),a("div",R,[a("label",null,s(e.$t("service.codespace"))+":",1),a("p",null,s(t.codespace),1)]),a("div",W,[a("label",null,s(e.$t("service.repository"))+":",1),a("p",null,s(t.repository),1)]),a("div",X,[t.user!=null?(n(),o("div",Y,[a("img",{src:e.getAccessUri(t.user.avatar,"/images/avatar/default.png")},null,8,Z),a("span",null,s(t.user.username),1)])):v("",!0),m(y,{"with-private":t.withPrivate},null,8,["with-private"]),x,a("p",ee,s(t.lastPublish==null?e.$t("service.unPublish"):e.getDateOffsetText(t.lastPublish)),1)]),t.user!=null&&e.userInfo.id===t.user.id?(n(),o("ul",te,[a("li",null,[t.type==="MAIN"?(n(),r(d,{key:0,onClick:S=>l.openSettings(t)},{default:g(()=>[f(s(e.$t("service.serviceSettings")),1)]),_:2},1032,["onClick"])):(n(),r(d,{key:1,onClick:S=>l.openSettings(t)},{default:g(()=>[f(s(e.$t("plugin.settings")),1)]),_:2},1032,["onClick"]))]),a("li",null,[m(d,{text:"",type:"danger",onClick:S=>l.deleteService(t)},{default:g(()=>[f(s(e.$t("common.delete")),1)]),_:2},1032,["onClick"])])])):v("",!0)]))),128))])):(n(),r(C,{key:1,description:e.$t("service.noServices")},null,8,["description"])),m(b,{pagination:h.pagination,onCurrentChange:l.handleCurrentChange,onSizeChange:l.handleSizeChange},null,8,["pagination","onCurrentChange","onSizeChange"])])),[[k,h.loading]])])])}const pe=$(q,[["render",ae],["__scopeId","data-v-83b724ff"]]);export{pe as default};
