import{_ as k,n as C,q as y,u as $,v as x,r as m,o as U,c as I,a as c,t as g,b as u,w as p,j as b,x as B,e as w}from"./index-7c4f5eaa.js";/*! js-cookie v3.0.5 | MIT */function h(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var a in n)t[a]=n[a]}return t}var D={read:function(t){return t[0]==='"'&&(t=t.slice(1,-1)),t.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent)},write:function(t){return encodeURIComponent(t).replace(/%(2[346BF]|3[AC-F]|40|5[BDE]|60|7[BCD])/g,decodeURIComponent)}};function v(t,e){function n(r,s,o){if(!(typeof document>"u")){o=h({},e,o),typeof o.expires=="number"&&(o.expires=new Date(Date.now()+o.expires*864e5)),o.expires&&(o.expires=o.expires.toUTCString()),r=encodeURIComponent(r).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape);var i="";for(var l in o)o[l]&&(i+="; "+l,o[l]!==!0&&(i+="="+o[l].split(";")[0]));return document.cookie=r+"="+t.write(s,r)+i}}function a(r){if(!(typeof document>"u"||arguments.length&&!r)){for(var s=document.cookie?document.cookie.split("; "):[],o={},i=0;i<s.length;i++){var l=s[i].split("="),_=l.slice(1).join("=");try{var f=decodeURIComponent(l[0]);if(o[f]=t.read(_,f),r===f)break}catch{}}return r?o[r]:o}}return Object.create({set:n,get:a,remove:function(r,s){n(r,"",h({},s,{expires:-1}))},withAttributes:function(r){return v(this.converter,h({},this.attributes,r))},withConverter:function(r){return v(h({},this.converter,r),this.attributes)}},{attributes:{value:Object.freeze(e)},converter:{value:Object.freeze(t)}})}var R=v(D,{path:"/"});const V={data(){return{form:{username:"",password:""},loginData:{isWorking:!1}}},methods:{...C(["setUserInfo"]),getRules(){return{username:[{required:!0,message:this.$t("form.isRequired",{value:this.$t("user.username")})}],password:[{required:!0,message:this.$t("form.isRequired",{value:this.$t("user.password")})}]}},login(t=!1){this.$refs.form.validate().then(()=>{this.loginData.isWorking||(this.loginData.isWorking=!0,y({...this.form,username:this.form.username.trim(),force:t}).then(e=>(R.set("x-kit-token",e),$(e))).then(()=>x()).then(e=>{this.setUserInfo(e);const n=this.$route.query.redirect_uri;if(n!=null&&n!=="")this.$router.push(n);else{const a=this.$router.options.history.state.back;a==null||a==="/signup"?this.$router.push({name:"Desktop"}):this.$router.back()}}).catch(e=>{if(e.code===6201){this.alert("当前账号已登录，继续登录后其它设备将自动离线，确认要继续登录吗？如果您对当前登录状态存在疑问，建议您登录后尽快修改密码！","重要提示",{showCancelButton:!0,cancelButtonText:"暂不登录",confirmButtonText:"继续登录"}).then(()=>{this.login(!0)});return}this.$tip.apiFailed(e)}).finally(()=>{this.loginData.isWorking=!1}))}).catch(()=>{})}}},q={class:"signup"},j={class:"wrap"},W={class:"login-box"},z={class:"create-account"};function A(t,e,n,a,r,s){const o=m("el-input"),i=m("el-form-item"),l=m("el-form"),_=m("el-button"),f=m("router-link");return U(),I("div",q,[c("div",j,[c("h2",null,g(t.$t("common.signIn")),1),u(l,{ref:"form",model:r.form,rules:s.getRules(),onSubmit:e[3]||(e[3]=b(()=>{},["stop"]))},{default:p(()=>[u(i,{label:t.$t("user.username"),prop:"username",required:""},{default:p(()=>[u(o,{modelValue:r.form.username,"onUpdate:modelValue":e[0]||(e[0]=d=>r.form.username=d),type:"text",size:"large"},null,8,["modelValue"])]),_:1},8,["label"]),u(i,{class:"password-item",label:t.$t("user.password"),prop:"password",required:""},{label:p(()=>[c("label",null,g(t.$t("user.password")),1)]),default:p(()=>[u(o,{modelValue:r.form.password,"onUpdate:modelValue":e[1]||(e[1]=d=>r.form.password=d),"show-password":"",type:"password",size:"large",onKeypress:e[2]||(e[2]=B(d=>s.login(),["enter","native"]))},null,8,["modelValue"])]),_:1},8,["label"])]),_:1},8,["model","rules"]),c("div",W,[c("div",null,[u(_,{type:"important",disabled:r.loginData.isWorking,onClick:e[4]||(e[4]=d=>s.login())},{default:p(()=>[w(g(t.$t("common.signIn")),1)]),_:1},8,["disabled"])])])]),c("div",z,[u(f,{to:{name:"SignUp"}},{default:p(()=>[w(g(t.$t("user.createAccount")),1)]),_:1})])])}const S=k(V,[["render",A],["__scopeId","data-v-f70dd615"]]);export{S as default};
