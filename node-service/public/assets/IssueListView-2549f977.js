import{B}from"./BeanAmount-278922ff.js";import{E as x}from"./Empty-89b3c193.js";import{_ as w,r,o as n,c as l,F as f,f as I,G as W,j as q,a as t,J as A,t as h,g as v,e as V,P as F,K as D,m as N,l as E,i as M,L as R,M as U,b as _,k as y,w as p,p as P,h as j}from"./index-8997febf.js";import{F as G,M as O,V as z,I as J,a as K,b as H,f as Q,g as X}from"./service.version-d5d1ea47.js";import{P as Y}from"./Pagination-ed9a0c44.js";const Z={name:"SubServiceList",components:{Empty:x,BeanAmount:B},props:{services:{type:Array,required:!0},customClass:{type:Function,default(){return()=>{}}}}},ee={key:0,class:"sub-service-list"},te=["onClick"],se={class:"price-wrap"},ie={class:"text-info-1 text-mini"},ne={key:0};function le(e,s,i,u,o,d){const m=r("BeanAmount"),g=r("Empty");return i.services.length>0?(n(),l("ul",ee,[(n(!0),l(f,null,I(i.services,a=>(n(),l("li",{key:a.id,class:W(i.customClass(a)),onClick:q(b=>e.$emit("click",a),["stop"])},[t("h5",null,[A(e.$slots,"title",{service:a},()=>[V(h(a.name),1)],!0)]),t("p",null,h(a.lastVersion),1),t("p",null,h(a.introduce),1),t("div",se,[t("p",ie,"Last publish: "+h(e.getDateOffsetText(a.lastPublishTime)),1),a.latestLease!=null?(n(),l("em",ne,h(e.getRemainingDay(a.latestLease.leaseEndTime))+" days ",1)):(n(),v(m,{key:1,price:a.price.price,type:a.price.leaseType},null,8,["price","type"]))])],10,te))),128))])):(n(),v(g,{key:1,description:"No Sub Services"}))}const Ae=w(Z,[["render",le],["__scopeId","data-v-232fe4f6"]]);const ae={name:"ServiceInstaller",components:{ProjectSelect:F,DirectorySelect:D,FieldSetting:G,MySqlFieldSelect:O,VariableInput:z,InstallRadio:J,InstallInput:K,InstallCheckbox:H},props:{installing:{},uninstalling:{},space:{required:!0},service:{required:!0},serviceType:{required:!0},servicePrice:{required:!0},serviceLease:{required:!1},version:{required:!0},withProject:{default:!0},projectConfig:{},withBreadcrumbs:{default:!1},withInstallButton:{default:!1}},data(){return{isWorking:{install:!1,uninstall:!1},variables:[]}},computed:{...N(["currentProject","currentDatabase"]),serviceVariables(){return this.variables},unique(){return[this.space,this.service,this.version]}},watch:{unique(){this.fetchVersion()},"isWorking.install":function(){this.$emit("update:installing",this.isWorking.install)},"isWorking.uninstall":function(){this.$emit("update:uninstalling",this.isWorking.uninstall)}},methods:{...E(["setCurrentProject","setInstallData"]),...M(["refreshBalance"]),fetchVersion(){Q({space:this.space,service:this.service,version:this.version}).then(e=>{this.variables=JSON.parse(e.variables).map(s=>this.__initVariableValue(s))}).catch(e=>{this.$tip.apiFailed(e)})},install(){if(this.serviceLease!=null){this.__install();return}if(this.servicePrice<50){this.__install();return}this.$model.installConfirm(this.servicePrice).then(()=>{this.__install()}).catch(()=>{})},__install(){this.isWorking.install||(this.isWorking.install=!0,R({projectId:this.currentProject,database:this.currentDatabase,space:this.space,service:this.service,serviceType:this.serviceType,version:this.version,variables:this.__getInstallVariables(this.variables)}).then(e=>{this.$tip.success("Install Successfully"),this.setInstallData(e),this.refreshBalance(),this.$emit("installed")}).catch(e=>{this.$tip.apiFailed(e),this.$emit("error",e)}).finally(()=>{this.isWorking.install=!1}))},uninstall(){if(this.serviceLease!=null){this.__uninstall();return}if(this.servicePrice<50){this.__uninstall();return}this.$model.uninstallConfirm().then(()=>{this.__uninstall()}).catch(()=>{})},__uninstall(){this.isWorking.uninstall||(this.isWorking.uninstall=!0,U({projectId:this.currentProject,database:this.currentDatabase,space:this.space,service:this.service,serviceType:this.serviceType,version:this.version,variables:this.__getInstallVariables(this.variables)}).then(e=>{this.$tip.success("Uninstall Successfully"),this.setInstallData(e),this.$emit("uninstalled")}).catch(e=>{this.$tip.apiFailed(e),this.$emit("error",e)}).finally(()=>{this.isWorking.uninstall=!1}))},__getInstallVariables(e){return e.map(s=>{if(s.inputType==="select"){const i=s.options.find(o=>o.value===s.value.value);if(i==null)return s;const u={};for(const o of i.settings)u[o.name]=o.value;s.value.settings=u}return s})},__initVariableValue(e,s){if(s==null&&this.projectConfig!=null){const i=this.projectConfig.services[this.service];if(i!=null&&(s=i.variables[e.name]),s==null){let u=null;for(const d in this.projectConfig.main){u=d;break}const o=this.projectConfig.main[u].variables[e.name];s=o,o!=null&&o.constructor!==e.defaultValue.constructor&&(s=null)}}if(s!=null){if(e.inputType==="table"||e.inputType==="query_model"){for(const i in s.settings){const u=e.children.find(o=>o.name===i);u!=null&&(u.value=s.settings[i])}return e.value=s.value,e}if(e.type==="group")return e.children.forEach(i=>this.__initVariableValue(i,s[i.name])),e}return s=s??e.defaultValue,s=s??X(e.inputType),e.value=s,e}},created(){this.fetchVersion()}},L=e=>(P("data-v-21cef5d7"),e=e(),j(),e),oe={class:"service-installer"},re={key:0,class:"nav"},ce={class:"title"},ue={class:"content-wrap"},_e=L(()=>t("p",{class:"install-tip"}," tips: Install the service by filling out the form below and clicking the Install button at the bottom. ",-1)),he={class:"form-wrap"},pe={key:1,class:"label-wrap"},de={key:1,class:"group-vars"},fe={class:"text-info-1 text-mini"},me={key:1,class:"parameters-holder"},ge=L(()=>t("p",null,"This service does not have any parameters, click the INSTALL button at the bottom to install.",-1)),ye=[ge],ve={key:2,class:"install"};function ke(e,s,i,u,o,d){const m=r("el-button"),g=r("ProjectSelect"),a=r("el-form-item"),b=r("ArrowRight"),$=r("el-icon"),C=r("VariableInput"),T=r("el-form");return n(),l("div",oe,[i.withBreadcrumbs?(n(),l("div",re,[t("div",ce,[_(m,{class:"button-icon",icon:"ArrowLeftBold",onClick:s[0]||(s[0]=c=>e.$emit("back"))}),t("h4",null,h(i.service)+h(i.version==null?"":" · "+i.version.toUpperCase())+" · Install",1)])])):y("",!0),t("div",ue,[i.withProject||d.serviceVariables.length>0?(n(),l(f,{key:0},[_e,t("div",he,[_(T,null,{default:p(()=>[i.withProject?(n(),v(a,{key:0,label:"Project",required:""},{default:p(()=>[_(g,{"model-value":e.currentProject,"with-block":!0,"with-prefix":!1,onChange:e.setCurrentProject},null,8,["model-value","onChange"])]),_:1})):y("",!0),(n(!0),l(f,null,I(d.serviceVariables,c=>(n(),l(f,null,[c.hidden?y("",!0):(n(),v(a,{key:c.name,label:c.label},{label:p(()=>[c.type==="variable"?(n(),l(f,{key:0},[V(h(c.label),1)],64)):(n(),l("div",pe,[t("span",null,h(c.label),1),_($,null,{default:p(()=>[_(b)]),_:1})]))]),default:p(()=>[c.type==="variable"?(n(),v(C,{key:0,variable:c},null,8,["variable"])):c.type==="group"?(n(),l("ul",de,[(n(!0),l(f,null,I(c.children,S=>(n(),l("li",{key:`${c.name}_${S.name}`},[t("label",fe,h(S.label),1),_(C,{variable:S},null,8,["variable"])]))),128))])):y("",!0)]),_:2},1032,["label"]))],64))),256))]),_:1})])],64)):(n(),l("div",me,ye)),i.withInstallButton?(n(),l("div",ve,[_(m,{type:"important",onClick:d.install,disabled:o.isWorking.install},{default:p(()=>[V(h(o.isWorking.install?"INSTALLING...":"INSTALL"),1)]),_:1},8,["onClick","disabled"])])):y("",!0)])])}const Fe=w(ae,[["render",ke],["__scopeId","data-v-21cef5d7"]]);const be={name:"IssueListView",components:{Pagination:Y},data(){return{pagination:{pageIndex:1,capacity:10,total:100}}}},k=e=>(P("data-v-f510f853"),e=e(),j(),e),Ie={class:"issue-wrap"},$e=k(()=>t("div",{class:"toolbar"},[t("ul",null,[t("li",null,"All"),t("li",null,"Enabled"),t("li",null,"Completed"),t("li",null,"Refused")]),t("ul",{class:"issue-types"},[t("li",{class:"bug"},"BUG"),t("li",{class:"optimize"},"Optimize")])],-1)),Se={class:"issues"},Ve=k(()=>t("h3",null,"登录失败时验证码没有刷新",-1)),we={class:"text-info-1"},Ce=k(()=>t("span",null,"刘大逵",-1)),Pe=k(()=>t("li",{class:"text-info-1"},[t("span",null,"Completed")],-1)),je=k(()=>t("li",{class:"text-info-1"},[t("span",null,"3小时前")],-1));function Le(e,s,i,u,o,d){const m=r("UserFilled"),g=r("el-icon"),a=r("router-link"),b=r("Pagination");return n(),l("div",Ie,[$e,t("ul",Se,[(n(),l(f,null,I(10,$=>t("li",{key:$},[_(a,{to:"#",target:"_blank"},{default:p(()=>[Ve,t("ul",null,[t("li",we,[_(g,null,{default:p(()=>[_(m)]),_:1}),Ce]),Pe,je])]),_:1})])),64))]),_(b,{pagination:o.pagination},null,8,["pagination"])])}const De=w(be,[["render",Le],["__scopeId","data-v-f510f853"]]);export{De as I,Ae as S,Fe as a};
