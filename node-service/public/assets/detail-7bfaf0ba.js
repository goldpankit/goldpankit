import{_ as D,E as j,r as l,o as c,c as v,F as g,f as L,a as t,t as r,g as d,H as F,w as V,b as _,j as y,M as C,m as N,I as S,A as M,J as w,e as I}from"./index-24c18995.js";import{f as B,s as q}from"./service-38c03d19.js";import{S as R,I as A,a as z}from"./IssueListView-babd34e8.js";import{f as O}from"./service.space-3d368801.js";import{S as U}from"./ServiceList-a9b194af.js";import"./BeanAmount-1a4bad73.js";import"./ServiceCodeErrorWindow-1293b713.js";import"./Pagination-2652aa37.js";const W={name:"ServiceListView",components:{Empty:j},props:{services:{required:!0},emptyDescription:{default:"No Services"}}},Y={key:0,class:"service-list"},H={class:"service-info"},J={class:"text-mini text-info-1"};function $(s,i,n,o,e,p){const u=l("Empty");return n.services.length>0?(c(),v("ul",Y,[(c(!0),v(g,null,L(n.services,m=>(c(),v("li",{key:m.name},[t("div",H,[t("h3",null,r(m.name),1),t("p",null,r(m.introduce),1),t("p",J,"Last publish: "+r(m.lastPublishTime),1)])]))),128))])):(c(),d(u,{key:1,description:n.emptyDescription},null,8,["description"]))}const E=D(W,[["render",$],["__scopeId","data-v-fdbc436c"]]);const G={name:"ServiceStructureView",props:{nodes:{required:!0}},data(){return{}},computed:{data(){const s=this.nodes.filter(n=>n.type==="DIRECTORY").sort((n,o)=>o.path.split("/").length-n.path.split("/").length),i=this.nodes.filter(n=>n.type==="FILE");for(const n of s){let o=null;for(let e=i.length-1;e>=0;e--){if(!i[e].path.startsWith(n.path))continue;n.children==null&&(n.children=[]);let p=new Date(i[e].publishTime).getTime();(o==null||p>o)&&(n.description=i[e].description,o=p),n.publishTime=i[e].publishTime,i[e].path=i[e].path.split("/").pop(),n.children.push(i[e]),i.splice(e,1)}}s.reverse();for(let n=s.length-1;n>=0;n--){const o=s[n];let e=!1;for(let p=n-1;p>=0;p--){const u=s[p];if(!o.path.startsWith(u.path))continue;u.children==null&&(u.children=[]);let m=new Date(o.publishTime).getTime(),b=new Date(u.publishTime).getTime();m>b&&(u.description=o.description,u.publishTime=o.publishTime),o.path=o.path.split("/").pop(),u.children.push(o),e=!0;break}e&&s.splice(n,1)}return s.push.apply(s,i),F(s),s}}},K={class:"node-label"},Q={class:"filename"},X={class:"text-info-1 text-mini description"},Z={class:"text-info-1 text-mini publish-time"};function x(s,i,n,o,e,p){const u=l("Document"),m=l("el-icon"),b=l("Folder"),k=l("el-tree");return c(),d(k,{class:"service-structure-tree",data:p.data},{default:V(({node:a,data:f})=>[t("span",K,[f.type==="FILE"?(c(),d(m,{key:0},{default:V(()=>[_(u)]),_:1})):f.type==="DIRECTORY"?(c(),d(m,{key:1},{default:V(()=>[_(b)]),_:1})):y("",!0),t("span",Q,r(f.path),1),t("span",X,r(f.description),1),t("span",Z,r(s.getDateOffsetText(f.publishTime)),1)])]),_:1},8,["data"])}const ee=D(G,[["render",x],["__scopeId","data-v-20da06ab"]]);const se={name:"MainServiceDetail",components:{SubServiceList:R,MarkdownEditor:C,ServiceStructureView:ee,ServiceListView:E},props:{space:{required:!0},service:{required:!0}},data(){return{currentMajorVersion:"",currentVersion:"",currentDim:"readme",majorVersions:[],majorVersionDetail:null}},computed:{...N(["currentProject"])},methods:{changeMajorVersion(s){this.currentMajorVersion=s,this.fetchDetail(s)},fetchDetail(s){B({space:this.space,service:this.service,majorVersion:s}).then(i=>{this.majorVersions=i.majorVersions,this.currentMajorVersion=s||this.majorVersions[0],this.majorVersionDetail=i.defaultMajorVersion,this.currentVersion=this.majorVersionDetail.version,this.majorVersionDetail.description==null&&this.majorVersionDetail.description.trim()===""&&(this.majorVersionDetail.description="No Descriptions")}).catch(i=>{this.$tip.apiFailed(i)})}},created(){this.fetchDetail()}},ie={key:0,class:"service-detail"},te={class:"nav"},re={class:"title"},ne=["onClick"],ce={class:"install"},oe={class:"content-wrap"},le={class:"service-dimensions"};function ue(s,i,n,o,e,p){const u=l("el-button"),m=l("MarkdownEditor"),b=l("SubServiceList"),k=l("ServiceStructureView");return e.majorVersionDetail!=null?(c(),v("div",ie,[t("div",te,[t("div",re,[_(u,{class:"button-icon",icon:"ArrowLeftBold",onClick:i[0]||(i[0]=a=>s.$emit("back"))}),t("h4",null,r(n.service),1)]),t("ul",null,[(c(!0),v(g,null,L(e.majorVersions,a=>(c(),v("li",{key:a,class:S({selected:a===e.currentMajorVersion}),onClick:f=>p.changeMajorVersion(a)},"v"+r(a),11,ne))),128))])]),t("div",ce,[_(u,{type:"important",onClick:i[1]||(i[1]=a=>s.$emit("install",e.currentVersion))},{default:V(()=>[t("h5",null,r(s.$t("service.install")),1)]),_:1})]),t("div",oe,[t("ul",le,[t("li",{class:S({selected:e.currentDim==="readme"}),onClick:i[2]||(i[2]=a=>e.currentDim="readme")},r(s.$t("common.readme")),3),t("li",{class:S({selected:e.currentDim==="subServices"}),onClick:i[3]||(i[3]=a=>e.currentDim="subServices")},r(s.$t("service.subServices")),3),t("li",{class:S({selected:e.currentDim==="structure"}),onClick:i[4]||(i[4]=a=>e.currentDim="structure")},r(s.$t("service.structure")),3)]),M(_(m,{modelValue:e.majorVersionDetail.description,"onUpdate:modelValue":i[5]||(i[5]=a=>e.majorVersionDetail.description=a),readonly:!0},null,8,["modelValue"]),[[w,e.currentDim==="readme"]]),M(_(b,{services:e.majorVersionDetail.subServices},null,8,["services"]),[[w,e.currentDim==="subServices"]]),M(_(k,{nodes:e.majorVersionDetail.structure},null,8,["nodes"]),[[w,e.currentDim==="structure"]])])])):y("",!0)}const ae=D(se,[["render",ue],["__scopeId","data-v-4f8dde72"]]);const pe={components:{ServiceList:U,IssueListView:A,ServiceListView:E,Empty:j,MarkdownEditor:C,ServiceInstaller:z,MainServiceDetail:ae},data(){return{spaceName:null,currentTab:"readme",currentMainService:null,currentMainServiceVersion:null,space:null,mainServices:[]}},computed:{...N(["userInfo"])},methods:{fetchSpace(){O(this.spaceName).then(s=>{this.space=s,this.space.description==null&&(this.space.description=""),this.fetchServiceList()}).catch(s=>{this.$tip.apiFailed(s)})},fetchServiceList(){q({space:this.spaceName,serviceType:"MAIN"}).then(s=>{this.mainServices=s;const i=this.$route.query.service;i!=null&&i!==""&&(this.currentMainService=this.mainServices.find(n=>n.name===i),this.currentMainService!=null&&(this.currentTab="services"))}).catch(s=>{this.$tip.apiFailed(s)})},handleServiceInstall(s){this.currentMainServiceVersion=s}},created(){this.spaceName=this.$route.params.name,this.fetchSpace()}},me={key:0,class:"page"},ve={class:"wrap"},de={class:"tech-stack-wrap"},he={class:"tech-stack"},_e={class:"content-wrap"},fe={class:"dimension-wrap"},Se={class:"dimensions"},be={class:"detail"},ye={key:0,class:"readme"},Ve={class:"info"},ke={class:"user-profile"},De={class:"user-info"},Me=["src"],we={class:"introduce"},ge={class:"install"},Te=["href"],Ie={key:1},je={key:0},Le={key:1};function Ce(s,i,n,o,e,p){const u=l("MarkdownEditor"),m=l("ServiceList"),b=l("Empty"),k=l("MainServiceDetail"),a=l("ServiceInstaller"),f=l("ServiceListView"),P=l("IssueListView"),T=l("el-button");return e.space!=null?(c(),v("div",me,[t("div",ve,[t("h2",null,r(e.space.name),1),t("div",de,[t("em",null,r(e.space.withPrivate?s.$t("common.private"):s.$t("common.public")),1),t("p",he,r(e.space.serviceCount)+" "+r(s.$t("service.services")),1)]),t("div",_e,[t("div",fe,[t("ul",Se,[t("li",{class:S({selected:e.currentTab==="readme"}),onClick:i[0]||(i[0]=h=>e.currentTab="readme")},r(s.$t("common.readme")),3),t("li",{class:S({selected:e.currentTab==="services"}),onClick:i[1]||(i[1]=h=>e.currentTab="services")},r(s.$t("service.services2")),3),t("li",{class:S(["disabled",{selected:e.currentTab==="prices"}])},r(s.$t("common.prices")),3),t("li",{class:S(["disabled",{selected:e.currentTab==="issues"}])},r(s.$t("common.issues")),3)]),t("div",be,[e.currentTab==="readme"?(c(),v("div",ye,[_(u,{readonly:"","without-padding":!0,modelValue:e.space.description,"onUpdate:modelValue":i[2]||(i[2]=h=>e.space.description=h)},null,8,["modelValue"])])):e.currentTab==="services"?(c(),v(g,{key:1},[e.currentMainService==null&&e.mainServices.length>0?(c(),d(m,{key:0,services:e.mainServices,onSelect:i[3]||(i[3]=h=>e.currentMainService=h)},null,8,["services"])):e.currentMainService==null&&e.mainServices.length===0?(c(),d(b,{key:1,description:s.$t("service.noServices")},null,8,["description"])):y("",!0),e.currentMainService!=null&&e.currentMainServiceVersion==null?(c(),d(k,{key:2,space:e.space.name,service:e.currentMainService.name,onInstall:p.handleServiceInstall,onBack:i[4]||(i[4]=h=>e.currentMainService=null)},null,8,["space","service","onInstall"])):e.currentMainServiceVersion!=null?(c(),d(a,{key:3,space:e.space.name,service:e.currentMainService.name,"service-type":e.currentMainService.type,"service-price":e.currentMainService.price.price,"service-lease":e.currentMainService.latestLease,version:e.currentMainServiceVersion,"with-breadcrumbs":!0,"with-install-button":!0,onBack:i[5]||(i[5]=h=>e.currentMainServiceVersion=null),onInstalled:i[6]||(i[6]=h=>s.$router.push({name:"Workbench"}))},null,8,["space","service","service-type","service-price","service-lease","version"])):y("",!0)],64)):e.currentTab==="prices"?(c(),d(f,{key:2,services:[],"empty-description":"No Price Services"})):e.currentTab==="issues"?(c(),d(P,{key:3})):y("",!0)])]),t("div",Ve,[t("div",ke,[t("div",De,[t("img",{src:s.getAccessUri(e.space.user.avatar,"/images/avatar/default.png")},null,8,Me),t("h4",null,r(e.space.user.username),1)]),t("p",we,r(e.space.user.introduce===""||e.space.user.introduce==null?"No introduce":e.space.user.introduce),1)]),t("div",ge,[e.space.subServiceReceivable||s.userInfo!=null&&s.userInfo.id===e.space.userId?(c(),d(T,{key:0,type:"primary",size:"large",onClick:i[7]||(i[7]=h=>s.$router.push({name:"CreateService",query:{space:e.spaceName}}))},{default:V(()=>[I(r(s.$t("service.createNewService")),1)]),_:1})):y("",!0),_(T,{type:"primary",size:"large",disabled:""},{default:V(()=>[I(r(s.$t("issue.createNewIssue")),1)]),_:1})]),t("ul",null,[t("li",null,[t("label",null,r(s.$t("space.homePage")),1),e.space.homepage!=null&&e.space.homepage!==""?(c(),v("a",{key:0,href:e.space.homepage,target:"_blank"},r(e.space.homepage),9,Te)):(c(),v("p",Ie,r(s.$t("common.none")),1))]),t("li",null,[t("label",null,r(s.$t("service.services2")),1),t("p",null,r(e.space.serviceCount),1)]),t("li",null,[t("label",null,r(s.$t("service.lastPublish")),1),e.space.lastPublish!=null?(c(),v("p",je,r(e.space.lastPublish),1)):(c(),v("p",Le,"None"))])])])])])])):y("",!0)}const ze=D(pe,[["render",Ce],["__scopeId","data-v-2f374de1"]]);export{ze as default};
