import{P as S}from"./Pagination-cf5ae055.js";import{E as y}from"./Empty-6ec2728f.js";import{d as C,f as P}from"./user.service-32970845.js";import{b as $}from"./service-c7b6a2af.js";import{_ as k,m as b,r as h,o as i,c as o,a as t,t as s,F as E,f as F,g as z,b as d,w as g,e as m,j as B}from"./index-edfb6a04.js";const L={components:{Empty:y,Pagination:S},data(){return{loading:!1,pagination:{page:1,capacity:10,total:100},services:[]}},computed:{...b(["userInfo"])},methods:{openSettings(e){this.$router.push({name:"ServiceSettings",query:{space:e.space.name,service:e.name}})},deleteService(e){this.deleteConfirm(this.$t("service.confirmDeleteTip")).then(()=>{C({space:e.space.name,service:e.name}).then(()=>{this.services.length===1&&(this.pagination.page-=1,this.fetchPage()),this.$tip.success(this.$t("common.deleteSuccessfully"))}).catch(n=>{this.$tip.apiFailed(n)})}).catch(()=>{})},handleCurrentChange(e){console.log("page",e),this.pagination.page=e,this.fetchPage()},handleSizeChange(e){this.pagination.capacity=e,this.fetchPage()},fetchPage(){this.loading||(this.loading=!0,this.pagination.page<1&&(this.pagination.page=1),P({...this.pagination,model:{}}).then(e=>{this.services=e.records,this.pagination.total=e.total,this.fetchLocalServices()}).catch(e=>{this.$tip.apiFailed(e)}).finally(()=>{this.loading=!1}))},fetchLocalServices(){$().then(e=>{this.services.forEach(n=>{n.codespace=null;const c=e.find(p=>p.space===n.space.name&&p.name===n.name);c!=null&&(n.repository=c.repository,n.codespace=c.codespace)})}).catch(e=>{this.$tip.apiFailed(e)})}},created(){this.fetchPage()}},N={class:"page"},T={class:"wrap"},V={class:"header"},w={key:0,class:"service-list"},D={class:"introduce"},I={class:"footer-info"},j={class:"user-profile"},q=["src"],A={class:"text-info-1 text-mini"},O={key:0,class:"opera"};function U(e,n,c,p,l,r){const u=h("el-button"),f=h("Empty"),_=h("Pagination");return i(),o("div",N,[t("div",T,[t("div",V,[t("h2",null,s(e.$t("service.PrivateServicesTitle")),1)]),!l.loading&&l.services.length>0?(i(),o("ul",w,[(i(!0),o(E,null,F(l.services,a=>(i(),o("li",{key:a.id},[t("h3",null,"@"+s(a.space.name)+"/"+s(a.name),1),t("p",D,s(a.introduce),1),t("p",null,s(e.$t("service.codespace"))+": "+s(a.codespace),1),t("p",null,s(e.$t("service.repository"))+": "+s(a.repository),1),t("div",I,[t("div",j,[t("img",{src:e.getAccessUri(a.user.avatar,"/images/avatar/default.png")},null,8,q),t("span",null,s(a.user.username),1)]),t("p",A,s(e.$t("service.lastPublish"))+": "+s(a.lastPublish==null?e.$t("service.unPublish"):e.getDateOffsetText(a.lastPublish)),1)]),e.userInfo.id===a.user.id?(i(),o("ul",O,[t("li",null,[d(u,{text:"",onClick:v=>r.openSettings(a)},{default:g(()=>[m(s(e.$t("service.serviceSettings")),1)]),_:2},1032,["onClick"])]),t("li",null,[d(u,{text:"",type:"danger",onClick:v=>r.deleteService(a)},{default:g(()=>[m(s(e.$t("common.delete")),1)]),_:2},1032,["onClick"])])])):B("",!0)]))),128))])):(i(),z(f,{key:1,description:e.$t("service.noServices")},null,8,["description"])),d(_,{pagination:l.pagination,onCurrentChange:r.handleCurrentChange,onSizeChange:r.handleSizeChange},null,8,["pagination","onCurrentChange","onSizeChange"])])])}const M=k(L,[["render",U],["__scopeId","data-v-aac446e5"]]);export{M as default};
