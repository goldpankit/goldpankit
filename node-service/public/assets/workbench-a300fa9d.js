import{_ as N,E as U,M as z,m as B,n as F,J as T,r as u,z as E,A as S,o as l,c as m,a as s,t as n,e as c,F as k,j as f,g as p,w as v,b as a,H as g,I as b}from"./index-ba5c27dc.js";import{S as q,I as A,a as H}from"./IssueListView-fdf5b1a3.js";import{a as J}from"./service-90ba5a29.js";import{B as O}from"./BeanAmount-c61b22f0.js";import{f as G}from"./ServiceCodeErrorWindow-2baa5003.js";import"./Pagination-e9bb10d0.js";import"./QueryModelView-c21fb0e6.js";import"./InnerRouterViewWindow-bf82daa9.js";import"./form.check-189b470c.js";const K={components:{SubServiceList:q,BeanAmount:O,IssueListView:A,Empty:U,MarkdownEditor:z,ServiceInstaller:H},data(){return{loading:!0,isWorking:{install:!1,uninstall:!1},space:null,latestMainService:null,mainService:null,currentService:null,subServices:[],currentServiceDimension:"readme",project:null}},watch:{currentProject(){this.latestMainService=null,this.fetchProject(!0)}},computed:{...B(["currentProject"]),installed(){return this.currentService==null?!1:this.project.services[this.currentService.name]!=null},majorVersion(){return this.mainService==null?"...":`${this.mainService.version.substring(0,this.mainService.version.indexOf("."))}`}},methods:{...F(["setCurrentProject"]),install(){this.currentServiceDimension="install",this.$refs.installer.install()},uninstall(){this.currentServiceDimension="install",this.$refs.installer.uninstall()},withInstalled(i){return this.project.services[i.name]!=null},fetchProject(i=!1){if(this.loading=!0,this.currentProject==null||this.currentProject===""){this.project=null,this.space=null,this.loading=!1;return}this.refreshProject(i)},fetchMainService(){this.latestMainService==null&&G({space:this.space,service:this.mainService.name}).then(i=>{this.latestMainService=i}).catch(i=>{this.$tip.apiFailed(i)})},refreshProject(i=!1){T(this.currentProject).then(r=>{if(this.project=r,this.space=this.project.space,this.project.main==null){this.loading=!1;return}let d=null;for(const j in this.project.main){d=j;break}this.mainService={name:d,...this.project.main[d]},this.fetchMainService(),i&&this.searchSubServices()}).catch(r=>{this.$tip.apiFailed(r)}).finally(()=>{this.loading=!1})},searchSubServices(){J({space:this.space,service:this.mainService.name,majorVersion:this.majorVersion}).then(i=>{this.subServices=i,this.subServices.length>0&&this.selectService(this.subServices[0])}).catch(i=>{this.$tip.apiFailed(i)})},selectService(i){this.subServices.length>0&&(this.currentService=i)},hasNewVersion(i){const r=this.project.services[i.name];return r==null?!1:r.version!==i.lastVersion}},created(){const i=this.$route.query.project_id;i!=null&&i!==""&&(this.setCurrentProject(i),this.$router.replace({name:"Workbench"})),this.fetchProject(!0)}},Q={class:"page"},R={key:0,class:"wrap"},X={class:"header"},Y={class:"title"},Z={class:"service-info"},x={class:"info"},$={class:"content-wrap"},ee={class:"service-wrap"},ie={class:"search-box"},se={class:"setting-wrap"},ne={class:"main"},re={class:"service-dimensions"},te={class:"dimension-content"},le={class:"issue-wrap"},ce={class:"opera"},oe={class:"opera-tip"},ae={key:1,class:"setting-holder"},ue={key:1,class:"incorrect-wrap"},ve={class:"content"},me={key:2,class:"incorrect-wrap"},pe={class:"content"};function he(i,r,d,j,e,o){const h=u("el-button"),y=u("el-input"),V=u("Upload"),_=u("el-icon"),C=u("Check"),I=u("SubServiceList"),P=u("MarkdownEditor"),D=u("ServiceInstaller"),M=u("IssueListView"),W=u("InfoFilled"),w=u("router-link"),L=E("loading");return S((l(),m("div",Q,[!e.loading&&e.project!=null&&e.mainService!=null?(l(),m("div",R,[s("div",null,[s("div",X,[s("div",Y,[s("h2",null,n(e.project.name),1),s("div",Z,[s("p",null,[c(n(e.space)+" · "+n(e.mainService.name)+" · v"+n(e.mainService.version)+" ",1),e.latestMainService!=null?(l(),m(k,{key:0},[c(" · "+n(i.$t("service.latestVersion"))+": v"+n(e.latestMainService.version),1)],64)):f("",!0)]),e.latestMainService!=null&&e.latestMainService.version!==e.mainService.version?(l(),p(h,{key:0,type:"primary",icon:"Upload",onClick:r[0]||(r[0]=t=>i.$router.push({name:"SpaceDetail",params:{name:e.space},query:{service:this.mainService.name}}))},{default:v(()=>[c(n(i.$t("service.upgrade")),1)]),_:1})):f("",!0)])]),s("div",x,[s("em",null,"v"+n(o.majorVersion),1),s("p",null,n(i.$t("common.currentVersion")),1)])]),s("div",$,[s("div",ee,[s("div",ie,[a(y,{size:"large",placeholder:i.$t("common.search")},null,8,["placeholder"])]),a(I,{services:e.subServices,"custom-class":t=>({selected:e.currentService!=null&&e.currentService.name===t.name}),installed:t=>o.withInstalled(t),onClick:r[1]||(r[1]=t=>o.selectService(t))},{title:v(({service:t})=>[c(n(t.name)+" ",1),o.hasNewVersion(t)?(l(),p(_,{key:0},{default:v(()=>[a(V)]),_:1})):o.withInstalled(t)?(l(),p(_,{key:1,class:"installed-icon"},{default:v(()=>[a(C)]),_:1})):f("",!0)]),_:1},8,["services","custom-class","installed"])]),s("div",se,[e.currentService!=null?(l(),m(k,{key:0},[s("h3",null,n(e.currentService.name),1),s("div",ne,[s("ul",re,[s("li",{class:g({selected:e.currentServiceDimension==="readme"}),onClick:r[2]||(r[2]=t=>e.currentServiceDimension="readme")},n(i.$t("common.readme")),3),s("li",{class:g({selected:e.currentServiceDimension==="install"}),onClick:r[3]||(r[3]=t=>e.currentServiceDimension="install")},n(i.$t("service.install2")),3),s("li",{class:g(["disabled",{selected:e.currentServiceDimension==="issues"}])},n(i.$t("common.issues")),3)]),s("div",te,[S(s("div",null,[a(P,{modelValue:e.currentService.description,"onUpdate:modelValue":r[4]||(r[4]=t=>e.currentService.description=t),readonly:"","without-padding":!0},null,8,["modelValue"])],512),[[b,e.currentServiceDimension==="readme"]]),S(a(D,{ref:"installer",installing:e.isWorking.install,"onUpdate:installing":r[5]||(r[5]=t=>e.isWorking.install=t),uninstalling:e.isWorking.uninstall,"onUpdate:uninstalling":r[6]||(r[6]=t=>e.isWorking.uninstall=t),space:e.space,service:e.currentService.name,"service-type":e.currentService.type,"service-price":e.currentService.price.price,"service-lease":e.currentService.latestLease,version:e.currentService.lastVersion,"with-project":!1,"project-config":e.project,onInstalled:r[7]||(r[7]=t=>o.refreshProject()),onUninstalled:r[8]||(r[8]=t=>o.refreshProject())},null,8,["installing","uninstalling","space","service","service-type","service-price","service-lease","version","project-config"]),[[b,e.currentServiceDimension==="install"]]),s("div",le,[S(a(M,null,null,512),[[b,e.currentServiceDimension==="issues"]])])])]),s("div",ce,[o.installed?(l(),m(k,{key:0},[o.hasNewVersion(e.currentService)?(l(),p(h,{key:0,type:"primary",size:"large",icon:"Upload",disabled:e.isWorking.install,onClick:o.install},{default:v(()=>[c(n(i.$t("service.upgrade")),1)]),_:1},8,["disabled","onClick"])):(l(),p(h,{key:1,type:"primary",size:"large",disabled:e.isWorking.install,onClick:o.install},{default:v(()=>[c(n(e.isWorking.install?i.$t("service.installing"):i.$t("service.reinstall")),1)]),_:1},8,["disabled","onClick"])),a(h,{size:"large",disabled:e.isWorking.uninstall,onClick:o.uninstall},{default:v(()=>[c(n(e.isWorking.uninstall?i.$t("service.uninstalling"):i.$t("service.uninstall")),1)]),_:1},8,["disabled","onClick"])],64)):(l(),p(h,{key:1,type:"primary",size:"large",disabled:e.isWorking.install,onClick:o.install},{default:v(()=>[c(n(e.isWorking.install?i.$t("service.installing"):i.$t("service.install")),1)]),_:1},8,["disabled","onClick"]))]),s("div",oe,[a(_,null,{default:v(()=>[a(W)]),_:1}),s("p",null,n(i.$t("service.installTip")),1)])],64)):(l(),m("div",ae,[s("h4",null,n(i.$t("workbench.subServiceSettings")),1),s("p",null,n(i.$t("workbench.subServiceSettingsTip")),1)]))])])])])):e.project==null?(l(),m("div",ue,[s("div",ve,[s("p",null,[c(n(i.$t("workbench.noProjectTip1")),1),a(w,{to:{name:"Index"}},{default:v(()=>[c(n(i.$t("common.homepage")),1)]),_:1}),c(n(i.$t("workbench.noProjectTip2")),1)])])])):e.mainService==null?(l(),m("div",me,[s("div",pe,[s("p",null,[c(n(i.$t("workbench.noServiceInstalledTip1")),1),a(w,{to:{name:"PublicSpaces"}},{default:v(()=>[c(n(i.$t("common.publicSpace")),1)]),_:1}),c(n(i.$t("workbench.noServiceInstalledTip2")),1)])])])):f("",!0)])),[[L,e.loading]])}const ye=N(K,[["render",he],["__scopeId","data-v-11c85f8a"]]);export{ye as default};
