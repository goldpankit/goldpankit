import{P as S}from"./Pagination-08a0cc6e.js";import{E as y}from"./Empty-ae53a821.js";import{d as C,f as b}from"./user.service-796eaae1.js";import{b as P}from"./service-c2359415.js";import{_ as k,m as $,r as h,o as i,c as o,a as t,F as E,f as I,g as F,b as d,t as s,w as g,e as m,j as L,p as N,l as w}from"./index-0500b79f.js";const z={components:{Empty:y,Pagination:S},data(){return{loading:!1,pagination:{page:1,capacity:10,total:100},services:[]}},computed:{...$(["userInfo"])},methods:{openSettings(e){this.$router.push({name:"ServiceSettings",query:{space:e.space.name,service:e.name}})},deleteService(e){this.deleteConfirm(this.$t("service.confirmDeleteTip")).then(()=>{C({space:e.space.name,service:e.name}).then(()=>{this.services.length===1&&(this.pagination.page-=1,this.fetchPage()),this.$tip.success(this.$t("common.deleteSuccessfully"))}).catch(n=>{this.$tip.apiFailed(n)})}).catch(()=>{})},handleCurrentChange(e){console.log("page",e),this.pagination.page=e,this.fetchPage()},handleSizeChange(e){this.pagination.capacity=e,this.fetchPage()},fetchPage(){this.loading||(this.loading=!0,this.pagination.page<1&&(this.pagination.page=1),b({...this.pagination,model:{}}).then(e=>{this.services=e.records,this.pagination.total=e.total,this.fetchLocalServices()}).catch(e=>{this.$tip.apiFailed(e)}).finally(()=>{this.loading=!1}))},fetchLocalServices(){P().then(e=>{this.services.forEach(n=>{n.codespace=null;const c=e.find(p=>p.space===n.space.name&&p.name===n.name);c!=null&&(n.repository=c.repository,n.codespace=c.codespace)})}).catch(e=>{this.$tip.apiFailed(e)})}},created(){this.fetchPage()}},B=e=>(N("data-v-ed6b466b"),e=e(),w(),e),V={class:"page"},D={class:"wrap"},T=B(()=>t("div",{class:"header"},[t("h2",null,"Leased and private services")],-1)),x={key:0,class:"service-list"},j={class:"introduce"},q={class:"footer-info"},A={class:"user-profile"},O=["src"],U={class:"text-info-1 text-mini"},G={key:0,class:"opera"};function H(e,n,c,p,l,r){const u=h("el-button"),f=h("Empty"),_=h("Pagination");return i(),o("div",V,[t("div",D,[T,!l.loading&&l.services.length>0?(i(),o("ul",x,[(i(!0),o(E,null,I(l.services,a=>(i(),o("li",{key:a.id},[t("h3",null,"@"+s(a.space.name)+"/"+s(a.name),1),t("p",j,s(a.introduce),1),t("p",null,s(e.$t("service.codespace"))+": "+s(a.codespace),1),t("p",null,s(e.$t("service.repository"))+": "+s(a.repository),1),t("div",q,[t("div",A,[t("img",{src:e.getAccessUri(a.user.avatar,"/images/avatar/default.png")},null,8,O),t("span",null,s(a.user.username),1)]),t("p",U,s(e.$t("service.lastPublish"))+": "+s(a.lastPublish==null?e.$t("service.unPublish"):e.getDateOffsetText(a.lastPublish)),1)]),e.userInfo.id===a.user.id?(i(),o("ul",G,[t("li",null,[d(u,{text:"",onClick:v=>r.openSettings(a)},{default:g(()=>[m(s(e.$t("service.serviceSettings")),1)]),_:2},1032,["onClick"])]),t("li",null,[d(u,{text:"",type:"danger",onClick:v=>r.deleteService(a)},{default:g(()=>[m(s(e.$t("common.delete")),1)]),_:2},1032,["onClick"])])])):L("",!0)]))),128))])):(i(),F(f,{key:1,description:"No Services"})),d(_,{pagination:l.pagination,onCurrentChange:r.handleCurrentChange,onSizeChange:r.handleSizeChange},null,8,["pagination","onCurrentChange","onSizeChange"])])])}const W=k(z,[["render",H],["__scopeId","data-v-ed6b466b"]]);export{W as default};
