import{_ as T,r as s,o as c,u as b,w as n,d as l,c as g,F as B,f as w,X as K,H as Z,q as G,b as r,I as U,t as A,g as v,v as E,p as W,h as z,D as $,L as Q,Y as ae,x as R,E as ee,e as N,V as ne,m as ie,J as L}from"./index-f2a25bd4.js";import{C as O}from"./CompilerSelect-5a2534ce.js";import{b as oe,d as se,i as te,e as P,t as re,g as Y,h as ce,j as ue}from"./service-7069bde1.js";import{p as de,V as J,c as pe,d as he}from"./service.version-50db337e.js";import{M as _e}from"./MarkdownEditor-a38a5933.js";const me={name:"InputTypeSelect",props:{withGroup:{default:!1}}};function fe(e,t,o,y,a,i){const u=s("el-option"),h=s("el-select");return c(),b(h,{class:"input-type-select"},{default:n(()=>[l(u,{value:"input",label:"Input"}),l(u,{value:"textarea",label:"Textarea"}),l(u,{value:"checkbox",label:"Checkbox"}),l(u,{value:"radio",label:"Radio"}),o.withGroup?w("",!0):(c(),g(B,{key:0},[l(u,{value:"database",label:"Database"}),l(u,{value:"table",label:"Table"}),l(u,{value:"query_model",label:"Query Model"})],64))]),_:1})}const M=T(me,[["render",fe],["__scopeId","data-v-128cdeb5"]]);const ve={name:"SettingFiles",components:{SortableButton:K,CompilerSelect:O,InputTypeSelect:M},props:{space:{required:!0},service:{required:!0}},data(){return{currentNode:null,files:[]}},methods:{fetchFiles(){oe(this.space,this.service).then(e=>{this.files=e,Z(this.files)}).catch(e=>{this.$tip.apiFailed(e)})},saveFileSetting(){console.log("save"),this.saveTimeout!=null&&clearTimeout(this.saveTimeout),this.saveTimeout=setTimeout(()=>{se({space:this.space,service:this.service,type:this.currentNode.type,path:this.currentNode.path,relativePath:this.currentNode.relativePath,compiler:this.currentNode.compiler,enableExpress:this.currentNode.enableExpress,variables:this.currentNode.variables.filter(e=>e.name.trim().length>0)}).then(()=>{console.log("保存成功")}).catch(e=>{this.$tip.apiFailed(e)})},300)},createVariable(){this.currentNode.variables.push({name:"",value:"",compiler:"static",remark:""})},deleteVariable(e){this.currentNode.variables.splice(e,1)},handleNodeClick(e){this.currentNode=e},isFlagFile(e){return e.compiler!=null&&e.compiler!==""||e.enableExpress!=null&&e.enableExpress!==""||e.variables.length>0},handleSorted(e){this.currentNode.variables=[],this.$nextTick(()=>{this.currentNode.variables=e,this.saveFileSetting()})}},created(){this.fetchFiles()}},le=e=>(W("data-v-13b6e026"),e=e(),z(),e),be={class:"tree"},ge={class:"files-wrap"},ye={class:"search-wrap"},Ce={class:"node-label"},Ve={class:"file-setting"},Se=le(()=>r("h4",null,"File Setting",-1)),ke={class:"content-wrap"},Ie=le(()=>r("label",null,"Variables",-1)),we={class:"opera"};function Fe(e,t,o,y,a,i){const u=s("el-input"),h=s("Document"),m=s("el-icon"),C=s("Folder"),S=s("el-tree"),p=s("CompilerSelect"),F=s("el-form-item"),I=s("el-button"),f=s("SortableButton"),x=s("el-table-column"),k=s("el-table"),V=s("el-form"),q=G("sortable");return c(),g("div",be,[r("div",ge,[r("div",ye,[l(u,{placeholder:"Filter keyword"})]),l(S,{data:a.files,"empty-text":"No Files",onNodeClick:i.handleNodeClick},{default:n(({node:d,data:_})=>[r("span",Ce,[_.type==="FILE"?(c(),b(m,{key:0},{default:n(()=>[l(h)]),_:1})):_.type==="DIRECTORY"?(c(),b(m,{key:1},{default:n(()=>[l(C)]),_:1})):w("",!0),r("span",{class:U(["filename",{"flag-file":i.isFlagFile(_)}])},A(_.label),3)])]),_:1},8,["data","onNodeClick"])]),r("div",Ve,[Se,r("div",ke,[a.currentNode!=null?(c(),b(V,{key:0},{default:n(()=>[l(F,{label:"Compiler"},{default:n(()=>[l(p,{modelValue:a.currentNode.compiler,"onUpdate:modelValue":t[0]||(t[0]=d=>a.currentNode.compiler=d),"with-follow-service":!0,onChange:i.saveFileSetting},null,8,["modelValue","onChange"])]),_:1}),l(F,{label:"Enable Express"},{default:n(()=>[l(u,{modelValue:a.currentNode.enableExpress,"onUpdate:modelValue":t[1]||(t[1]=d=>a.currentNode.enableExpress=d),type:"textarea",rows:8,onInput:i.saveFileSetting},null,8,["modelValue","onInput"])]),_:1}),l(F,{label:"Variables",class:"item-variables"},{label:n(()=>[r("div",null,[Ie,r("div",we,[l(I,{icon:"Top",class:"button-icon"}),l(I,{icon:"Bottom",class:"button-icon"}),l(I,{onClick:i.createVariable},{default:n(()=>[v("Add")]),_:1},8,["onClick"])])])]),default:n(()=>[E((c(),b(k,{data:a.currentNode.variables},{default:n(()=>[l(x,{width:"25px"},{default:n(()=>[l(f)]),_:1}),l(x,{label:"*Name","min-width":"120px"},{default:n(({row:d})=>[l(u,{modelValue:d.name,"onUpdate:modelValue":_=>d.name=_,onInput:i.saveFileSetting},null,8,["modelValue","onUpdate:modelValue","onInput"])]),_:1}),l(x,{label:"*Value","min-width":"200px"},{default:n(({row:d})=>[l(u,{modelValue:d.value,"onUpdate:modelValue":_=>d.value=_,type:"textarea",rows:1,onChange:i.saveFileSetting},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),l(x,{label:"*Compiler","min-width":"120px"},{default:n(({row:d})=>[l(p,{modelValue:d.compiler,"onUpdate:modelValue":_=>d.compiler=_,onChange:i.saveFileSetting},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),l(x,{label:"Remark","min-width":"140px"},{default:n(({row:d})=>[l(u,{modelValue:d.remark,"onUpdate:modelValue":_=>d.remark=_,type:"textarea",rows:1,onInput:i.saveFileSetting},null,8,["modelValue","onUpdate:modelValue","onInput"])]),_:1}),a.currentNode.variables.length>0?(c(),b(x,{key:0,"min-width":"60px",fixed:"right"},{default:n(({row:d,index:_})=>[l(I,{icon:"Delete",class:"button-icon",onClick:D=>i.deleteVariable(_)},null,8,["onClick"])]),_:1})):w("",!0)]),_:1},8,["data"])),[[q,{data:a.currentNode.variables,onChange:i.handleSorted},"config"]])]),_:1})]),_:1})):w("",!0)])])])}const xe=T(ve,[["render",Fe],["__scopeId","data-v-13b6e026"]]);const Ae={name:"InitializeView",components:{DatabaseTypeSelect:$,CompilerSelect:O,DirectorySelect:Q},props:{spaceName:{required:!0},serviceName:{required:!0}},data(){return{form:{space:this.spaceName,name:this.serviceName,version:"1.0.0",compiler:"static",supportedDatabases:[],codespace:""}}},methods:{initialize(){te(this.form).then(()=>{this.$emit("initialized",this.form)}).catch(e=>{this.$tip.apiFailed(e)})},fetchConfig(e){P({codespace:e}).then(t=>{t!=null&&(this.form.version=t.version||this.form.version,this.form.compiler=t.compiler||this.form.compiler,this.form.supportedDatabases=t.supportedDatabases||this.form.supportedDatabases)}).catch(t=>{this.$tip.apiFailed(t)})}}},Te=e=>(W("data-v-fb01340d"),e=e(),z(),e),Ne={class:"initialize-wrap"},De=Te(()=>r("div",{class:"tip"},[r("h3",null,"Initialize Service"),r("p",null,"You must first specify or create a local directory and initialize the service. Then you can code the service in the specified local directory.")],-1)),Ue={class:"directory-select-wrap"},Be={class:"opera-bottom"};function qe(e,t,o,y,a,i){const u=s("DirectorySelect"),h=s("el-button");return c(),g("div",Ne,[De,r("div",Ue,[l(u,{modelValue:a.form.codespace,"onUpdate:modelValue":t[0]||(t[0]=m=>a.form.codespace=m),title:"Select Service Directory",onChange:i.fetchConfig},null,8,["modelValue","onChange"])]),r("div",Be,[l(h,{type:"primary",size:"large",onClick:i.initialize},{default:n(()=>[v("Initialize Service")]),_:1},8,["onClick"])])])}const Ee=T(Ae,[["render",qe],["__scopeId","data-v-fb01340d"]]);const Pe={name:"BuildCommandTypeSelect"};function We(e,t,o,y,a,i){const u=s("el-option"),h=s("el-select");return c(),b(h,{class:"build-command-type-select"},{default:n(()=>[l(u,{value:"Node",label:"Node"}),l(u,{value:"MySQL",label:"MySQL"})]),_:1})}const ze=T(Pe,[["render",We],["__scopeId","data-v-3b21c3bd"]]);const Oe={name:"ServiceFileSelectWindow",props:{title:{default:"Select Service File"},serviceConfig:{required:!0}},data(){return{visible:!1,paths:[],files:[],selectedFilepath:null}},methods:{open(){this.visible=!0,this.paths=[this.__getProjectName()],this.__fetchFiles(),this.selectedFilepath=null},confirmSelect(){this.visible=!1;let e=`${this.paths.slice(1).join("/")}/${this.selectedFilepath}`;e.startsWith("/")||(e="/"+e),this.$emit("change",e)},cancelSelect(){this.visible=!1},changePath(e){e!==this.paths.length-1&&(this.paths=this.paths.splice(0,e+1),this.__fetchFiles(),this.selectedFilepath=null)},openOrSelectFile(e){if(e.type==="DIRECTORY"){this.paths.push(e.path),this.__fetchFiles(),this.selectedFilepath=null;return}this.selectedFilepath=e.path},__fetchFiles(){ae(this.__getAbsolutePath()).then(e=>{this.files=e,Z(this.files)}).catch(e=>{this.$tip.apiFailed(e)})},__getProjectName(){return this.serviceConfig.codespace.split("/").pop()},__getAbsolutePath(){let e=`${this.serviceConfig.codespace}/${this.paths.slice(1).join("/")}`;return this.serviceConfig.translator.settings.length>0&&(e=`${this.serviceConfig.codespace}/${this.serviceConfig.translator.output}/${this.paths.slice(1).join("/")}`),e.endsWith("/")?e.substring(0,e.length-1):e}}},Le=["id"],Re={class:"paths"},Qe=["onClick"],Me={class:"files"},Ge=["onClick"],Ye={class:"opera"};function Je(e,t,o,y,a,i){const u=s("el-button"),h=s("Folder"),m=s("Document"),C=s("el-icon"),S=s("el-dialog");return c(),b(S,{modelValue:a.visible,"onUpdate:modelValue":t[0]||(t[0]=p=>a.visible=p),"show-close":!1,"custom-class":"service-file-select-window","append-to-body":""},{header:n(({close:p,titleId:F,titleClass:I})=>[r("h4",{id:F,class:U(I)},A(o.title),11,Le),l(u,{class:"button-icon",icon:"Refresh",onClick:i.__fetchFiles},null,8,["onClick"])]),default:n(()=>[r("ul",Re,[(c(!0),g(B,null,R(a.paths,(p,F)=>(c(),g("li",{key:p,onClick:I=>i.changePath(F)},A(p),9,Qe))),128))]),r("div",Me,[r("ul",null,[(c(!0),g(B,null,R(a.files,p=>(c(),g("li",{key:p.path,class:U({"is-file":p.type==="file",selected:a.selectedFilepath===p.path}),onClick:F=>i.openOrSelectFile(p)},[l(C,null,{default:n(()=>[p.type==="DIRECTORY"?(c(),b(h,{key:0})):(c(),b(m,{key:1}))]),_:2},1024),r("p",null,A(p.path),1)],10,Ge))),128))])]),r("div",Ye,[l(u,{size:"large",onClick:i.cancelSelect},{default:n(()=>[v("Cancel")]),_:1},8,["onClick"]),l(u,{type:"primary",size:"large",disabled:a.selectedFilepath==null,onClick:i.confirmSelect},{default:n(()=>[v("Confirm Select")]),_:1},8,["disabled","onClick"])])]),_:1},8,["modelValue"])}const je=T(Oe,[["render",Je]]);const He={name:"BuildList",components:{ServiceFileSelectWindow:je,DirectorySelect:Q,Empty:ee,BuildCommandTypeSelect:ze},props:{builds:{required:!0,type:Array},withUnbuild:{default:!1},serviceConfig:{required:!0}},data(){return{actives:[],varIndex:1,selectFileData:{currentBuild:null}}},watch:{builds:{immediate:!0,handler(){this.__handleBuildList("builds")}},unbuilds:{immediate:!0,handler(){this.__handleBuildList("unbuilds")}}},methods:{handleFileChange(e){this.selectFileData.currentBuild.__filepath=e,this.handleSave()},create(){const e=""+Math.random();this.builds.push({id:e,name:this.__generateBuildName(),type:"Node",contentType:"string",content:"",__readonly:!1,__filepath:""}),this.actives.push(e)},handleChange(e){for(const t of this.builds){const o=e.find(y=>y===t.id)!=null;t.__readonly=!o}},handleSave(){this.$emit("save")},deleteBuild(e){this.builds.splice(e,1),this.handleSave()},openSelectFileWindow(e){this.selectFileData.currentBuild=e,this.$refs.serviceFileSelectWindow.open()},__generateBuildName(){let e;for(;;)if(e=`${this.withUnbuild?"un":""}build${this.varIndex}`,this.varIndex++,this.builds.findIndex(t=>t.name===e)===-1)return e},__handleBuildList(e){this[e]!=null&&this[e].forEach(t=>{t.id=""+Math.random(),t.contentType==="file"&&(t.__filepath=t.content,t.content=""),t.__readonly=!0})}}},Xe=e=>(W("data-v-b0938ed8"),e=e(),z(),e),Ke={class:"service-build-list"},Ze={class:"toolbar"},$e=Xe(()=>r("p",null,"tips: The following builds are performed after the service is installed",-1)),et={class:"title-wrap"},tt={key:0,class:"view"},lt={class:"name"},at={class:"type"},nt={key:1,class:"edit"},it={class:"opera"},ot=["onClick"],st={key:0,class:"holder"},rt={key:1};function ct(e,t,o,y,a,i){const u=s("el-button"),h=s("el-input"),m=s("el-form-item"),C=s("BuildCommandTypeSelect"),S=s("el-form"),p=s("el-tab-pane"),F=s("el-tabs"),I=s("el-collapse-item"),f=s("el-collapse"),x=s("Empty"),k=s("ServiceFileSelectWindow");return c(),g("div",Ke,[r("div",Ze,[$e,l(u,{type:"primary",onClick:i.create},{default:n(()=>[v("Create")]),_:1},8,["onClick"])]),o.builds.length>0?(c(),b(f,{key:0,modelValue:a.actives,"onUpdate:modelValue":t[2]||(t[2]=V=>a.actives=V),onChange:i.handleChange},{default:n(()=>[(c(!0),g(B,null,R(o.builds,(V,q)=>(c(),b(I,{key:V.id,name:V.id},{title:n(()=>[r("div",et,[V.__readonly?(c(),g("div",tt,[r("p",lt,A(V.name),1),r("p",at,A(V.type),1)])):(c(),g("div",nt,[l(S,{model:V},{default:n(()=>[l(m,{label:"Name",required:""},{default:n(()=>[l(h,{class:"name",modelValue:V.name,"onUpdate:modelValue":d=>V.name=d,onClick:t[0]||(t[0]=N(()=>{},["stop"])),onKeypress:t[1]||(t[1]=N(()=>{},["stop"])),onInput:i.handleSave},null,8,["modelValue","onUpdate:modelValue","onInput"])]),_:2},1024),l(m,{label:"Type",required:""},{default:n(()=>[l(C,{class:"type",modelValue:V.type,"onUpdate:modelValue":d=>V.type=d,onChange:i.handleSave},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:2},1024)]),_:2},1032,["model"])])),r("div",it,[l(u,{icon:"Delete",onClick:N(d=>i.deleteBuild(q),["stop"])},{default:n(()=>[v("Delete")]),_:2},1032,["onClick"])])])]),default:n(()=>[l(F,{modelValue:V.contentType,"onUpdate:modelValue":d=>V.contentType=d},{default:n(()=>[l(p,{name:"string",label:"Input"},{default:n(()=>[l(h,{modelValue:V.content,"onUpdate:modelValue":d=>V.content=d,type:"textarea",placeholder:"Build command",rows:5,onInput:i.handleSave},null,8,["modelValue","onUpdate:modelValue","onInput"])]),_:2},1024),l(p,{name:"file",label:"File"},{default:n(()=>[r("div",{class:"select-holder",onClick:d=>i.openSelectFileWindow(V)},[V.__filepath==null||V.__filepath===""?(c(),g("p",st,"Click to select file.")):(c(),g("p",rt,A(V.__filepath),1))],8,ot)]),_:2},1024)]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1032,["name"]))),128))]),_:1},8,["modelValue","onChange"])):(c(),b(x,{key:1})),l(k,{ref:"serviceFileSelectWindow","service-config":o.serviceConfig,onChange:i.handleFileChange},null,8,["service-config","onChange"])])}const ut=T(He,[["render",ct],["__scopeId","data-v-b0938ed8"]]);const dt={name:"TranslatorTypeSelect"};function pt(e,t,o,y,a,i){const u=s("el-option"),h=s("el-select");return c(),b(h,{class:"translator-type-select"},{default:n(()=>[l(u,{value:"pattern",label:"Pattern"}),l(u,{value:"code",label:"Code"})]),_:1})}const ht=T(dt,[["render",pt],["__scopeId","data-v-2e8f2ab5"]]);const _t={name:"TranslatorList",components:{TranslatorTypeSelect:ht,Empty:ee},props:{space:{required:!0},service:{required:!0},translator:{required:!0}},data(){return{actives:[],varIndex:1}},computed:{translators(){return this.translator.settings}},watch:{translators:{immediate:!0,handler(){this.translators.forEach(e=>{e.id=""+Math.random(),e.__readonly=!0})}}},methods:{add(){const e=""+Math.random();this.translator.settings.push({id:e,name:this.__generateTranslatorName(),type:"pattern",path:".*",source:"",target:"",code:"  return {filepath: filepath, content: content};",__readonly:!1}),this.actives.push(e)},deleteTranslator(e){this.translator.settings.splice(e,1),this.handleSave()},handleChange(e){for(const t of this.translators){const o=e.find(y=>y===t.id)!=null;t.__readonly=!o}},handleSave(){this.$emit("save")},translate(){re({space:this.space,service:this.service}).then(()=>{console.log("翻译完成")}).catch(e=>{this.$tip.apiFailed(e)})},__generateTranslatorName(){let e;for(;;)if(e=`translator${this.varIndex}`,this.varIndex++,this.translators.findIndex(t=>t.name===e)===-1)return e}},created(){console.log("translator",this.translator)}},j=e=>(W("data-v-95f4f6fc"),e=e(),z(),e),mt={class:"translator-setting"},ft={class:"toolbar"},vt=j(()=>r("p",null,"tips: The translator can be configured to quickly translate source code into service code",-1)),bt={class:"opera"},gt={class:"title-wrap"},yt={key:0,class:"view"},Ct={class:"name"},Vt={class:"path"},St={class:"type"},kt={key:1,class:"edit"},It={class:"opera"},wt=j(()=>r("p",{class:"code"},[r("em",{class:"keyword"},"function"),v(),r("em",null,"translate"),v(" ("),r("em",null,"filepath"),v(", "),r("em",null,"content"),v(", "),r("em",null,"fileSetting"),v(") {")],-1)),Ft=j(()=>r("p",null,"}",-1));function xt(e,t,o,y,a,i){const u=s("el-button"),h=s("el-input"),m=s("el-form-item"),C=s("TranslatorTypeSelect"),S=s("el-form"),p=s("el-collapse-item"),F=s("el-collapse"),I=s("Empty");return c(),g("div",mt,[r("div",ft,[vt,r("div",bt,[l(u,{type:"primary",onClick:i.add},{default:n(()=>[v("Add")]),_:1},8,["onClick"]),l(u,{type:"primary",onClick:i.translate},{default:n(()=>[v("Translate")]),_:1},8,["onClick"])])]),i.translators.length>0?(c(),b(F,{key:0,modelValue:a.actives,"onUpdate:modelValue":t[4]||(t[4]=f=>a.actives=f),onChange:i.handleChange},{default:n(()=>[(c(!0),g(B,null,R(i.translators,(f,x)=>(c(),b(p,{key:f.id,name:f.id},{title:n(()=>[r("div",gt,[f.__readonly?(c(),g("div",yt,[r("p",Ct,A(f.name),1),r("p",Vt,A(f.path),1),r("p",St,A(f.type),1)])):(c(),g("div",kt,[l(S,{model:f},{default:n(()=>[l(m,{label:"Name",required:""},{default:n(()=>[l(h,{class:"name",modelValue:f.name,"onUpdate:modelValue":k=>f.name=k,onClick:t[0]||(t[0]=N(()=>{},["stop"])),onKeypress:t[1]||(t[1]=N(()=>{},["stop"])),onInput:i.handleSave},null,8,["modelValue","onUpdate:modelValue","onInput"])]),_:2},1024),l(m,{label:"Path",required:""},{default:n(()=>[l(h,{class:"path",modelValue:f.path,"onUpdate:modelValue":k=>f.path=k,onClick:t[2]||(t[2]=N(()=>{},["stop"])),onKeypress:t[3]||(t[3]=N(()=>{},["stop"])),onInput:i.handleSave},null,8,["modelValue","onUpdate:modelValue","onInput"])]),_:2},1024),l(m,{label:"Type",required:""},{default:n(()=>[l(C,{class:"type",modelValue:f.type,"onUpdate:modelValue":k=>f.type=k,onChange:i.handleSave},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:2},1024)]),_:2},1032,["model"])])),r("div",It,[l(u,{icon:"Delete",onClick:N(k=>i.deleteTranslator(x),["stop"])},{default:n(()=>[v("Delete")]),_:2},1032,["onClick"])])])]),default:n(()=>[f.type==="pattern"?(c(),b(S,{key:0},{default:n(()=>[l(m,{label:"Source",required:""},{default:n(()=>[l(h,{modelValue:f.source,"onUpdate:modelValue":k=>f.source=k,type:"textarea",rows:1,onInput:i.handleSave},null,8,["modelValue","onUpdate:modelValue","onInput"])]),_:2},1024),l(m,{label:"Target",required:""},{default:n(()=>[l(h,{modelValue:f.target,"onUpdate:modelValue":k=>f.target=k,type:"textarea",rows:1,onInput:i.handleSave},null,8,["modelValue","onUpdate:modelValue","onInput"])]),_:2},1024)]),_:2},1024)):f.type==="code"?(c(),g(B,{key:1},[wt,l(h,{modelValue:f.code,"onUpdate:modelValue":k=>f.code=k,type:"textarea",rows:5,onInput:i.handleSave},null,8,["modelValue","onUpdate:modelValue","onInput"]),Ft],64)):w("",!0)]),_:2},1032,["name"]))),128))]),_:1},8,["modelValue","onChange"])):(c(),b(I,{key:1}))])}const At=T(_t,[["render",xt],["__scopeId","data-v-95f4f6fc"]]),Tt="data:image/png;base64,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";const Nt={name:"BasicSetting",components:{TranslatorList:At,BuildList:ut,DirectorySelect:Q,DatabaseTypeSelect:$,CompilerSelect:O},props:{space:{required:!0},service:{required:!0},serviceType:{required:!0},serviceConfig:{}},data(){return{newCodespace:{changing:!1,value:""},originForm:null,form:{version:"",private:!1,receivable:!1,compiler:"",introduce:"",supportedDatabases:[],tableFieldDefinitions:[],builds:[],unbuilds:[],prices:[{type:"free",value:0}],translator:{output:"",settings:[]},codespace:""}}},methods:{initData(){for(const e in this.form)this.form[e]=this.serviceConfig[e]||this.form[e];this.originForm=JSON.parse(JSON.stringify(this.form))},initialize(){te(this.form).then(()=>{this.newCodespace.changing=!1,this.$emit("initialized",this.form)}).catch(e=>{this.$tip.apiFailed(e)})},changePriceType(e){e==="free"&&(this.form.prices[0].value=0),this.saveConfig()},changeCodespace(){this.newCodespace.changing=!0,this.newCodespace.value=this.form.codespace},fetchConfig(e){P({codespace:e}).then(t=>{t!=null&&(this.form.version=t.version||this.form.version,this.form.introduce=t.introduce||this.form.introduce,this.form.compiler=t.compiler||this.form.compiler,this.form.prices=t.prices||this.form.prices,this.form.supportedDatabases=t.supportedDatabases||this.form.supportedDatabases,this.form.builds=t.builds||this.form.builds,this.form.unbuilds=t.unbuilds||this.form.unbuilds,this.form.translator=t.translator||this.form.translator)}).catch(t=>{this.$tip.apiFailed(t)})},saveConfig(){this.newCodespace.changing||Y({space:this.space,service:this.service,...this.form,translator:{...this.form.translator,settings:this.form.translator.settings.filter(e=>e.type==="code"&&e.code.trim().length>0||e.type==="pattern"&&e.source.trim()!==""&&e.target.trim()!=="").map(e=>({name:e.name,path:e.path.trim().length===0?".*":e.path,type:e.type,source:e.type==="pattern"?e.source:"",target:e.type==="pattern"?e.target:"",code:e.type==="code"?e.code:""}))},builds:this.form.builds.map(e=>({name:e.name,type:e.type,content:e.contentType==="file"?e.__filepath:e.content,contentType:e.contentType})),unbuilds:this.form.unbuilds.map(e=>({name:e.name,type:e.type,content:e.contentType==="file"?e.__filepath:e.content,contentType:e.contentType}))}).then(()=>{this.originForm=JSON.parse(JSON.stringify(this.form))}).catch(e=>{this.$tip.apiFailed(e)})}},created(){this.initData()}},H=e=>(W("data-v-4cf71911"),e=e(),z(),e),Dt={class:"basic-setting"},Ut={class:"wrap"},Bt=H(()=>r("span",null,[r("img",{src:Tt})],-1)),qt=H(()=>r("p",null,"Is a private service.",-1)),Et={key:0},Pt=H(()=>r("p",null,"Receive sub services added by others.",-1)),Wt={key:0,class:"codespace-wrap"},zt={key:0,class:"opera-wrap"};function Ot(e,t,o,y,a,i){const u=s("el-input"),h=s("el-form-item"),m=s("CompilerSelect"),C=s("DatabaseTypeSelect"),S=s("el-radio-button"),p=s("el-radio-group"),F=s("el-input-number"),I=s("el-checkbox"),f=s("TranslatorList"),x=s("BuildList"),k=s("el-button"),V=s("DirectorySelect"),q=s("el-form");return c(),g("div",Dt,[r("div",Ut,[l(q,{model:a.form},{default:n(()=>[l(h,{label:"Version",prop:"version",required:""},{default:n(()=>[l(u,{modelValue:a.form.version,"onUpdate:modelValue":t[0]||(t[0]=d=>a.form.version=d),onInput:i.saveConfig},null,8,["modelValue","onInput"])]),_:1}),l(h,{label:"Compiler",prop:"compiler",required:""},{default:n(()=>[l(m,{modelValue:a.form.compiler,"onUpdate:modelValue":t[1]||(t[1]=d=>a.form.compiler=d),onChange:i.saveConfig},null,8,["modelValue","onChange"])]),_:1}),l(h,{label:"Supported Databases",prop:"supportedDatabases"},{default:n(()=>[l(C,{modelValue:a.form.supportedDatabases,"onUpdate:modelValue":t[2]||(t[2]=d=>a.form.supportedDatabases=d),onChange:i.saveConfig},null,8,["modelValue","onChange"])]),_:1}),l(h,{label:"Introduce",prop:"introduce",required:""},{default:n(()=>[l(u,{type:"textarea",rows:5,modelValue:a.form.introduce,"onUpdate:modelValue":t[3]||(t[3]=d=>a.form.introduce=d),onInput:i.saveConfig},null,8,["modelValue","onInput"])]),_:1}),l(h,{label:"Charge",prop:"prices[0].type",required:""},{default:n(()=>[l(p,{modelValue:a.form.prices[0].type,"onUpdate:modelValue":t[4]||(t[4]=d=>a.form.prices[0].type=d),onChange:i.changePriceType},{default:n(()=>[l(S,{label:"free"},{default:n(()=>[v("Free")]),_:1}),l(S,{label:"times"},{default:n(()=>[v("Charge per ride")]),_:1}),l(S,{label:"monthly"},{default:n(()=>[v("Monthly charge")]),_:1}),l(S,{label:"quarterly"},{default:n(()=>[v("Quarterly charge")]),_:1}),l(S,{label:"annual"},{default:n(()=>[v("Annual charge")]),_:1})]),_:1},8,["modelValue","onChange"])]),_:1}),a.form.prices[0].type!=="free"?(c(),b(h,{key:0,label:"Price",prop:"prices[0].value",class:"item-price",required:""},{default:n(()=>[Bt,l(F,{controls:!1,modelValue:a.form.prices[0].value,"onUpdate:modelValue":t[5]||(t[5]=d=>a.form.prices[0].value=d),onInput:i.saveConfig},null,8,["modelValue","onInput"])]),_:1})):w("",!0),l(h,{label:"Other settings",class:"item-other-settings"},{default:n(()=>[r("div",null,[l(I,{modelValue:a.form.private,"onUpdate:modelValue":t[6]||(t[6]=d=>a.form.private=d),onChange:i.saveConfig},null,8,["modelValue","onChange"]),qt]),o.serviceType==="MAIN"?(c(),g("div",Et,[l(I,{modelValue:a.form.receivable,"onUpdate:modelValue":t[7]||(t[7]=d=>a.form.receivable=d),onChange:i.saveConfig},null,8,["modelValue","onChange"]),Pt])):w("",!0)]),_:1}),l(h,{label:"Translator",prop:"translator"},{default:n(()=>[l(f,{space:o.space,service:o.service,translator:a.form.translator,onSave:i.saveConfig},null,8,["space","service","translator","onSave"])]),_:1}),l(h,{label:"Install Builds",prop:"builds"},{default:n(()=>[l(x,{builds:a.form.builds,"service-config":o.serviceConfig,onSave:i.saveConfig},null,8,["builds","service-config","onSave"])]),_:1}),l(h,{label:"Uninstall Builds",prop:"unbuilds"},{default:n(()=>[l(x,{builds:a.form.unbuilds,"with-unbuild":!0,"service-config":o.serviceConfig,onSave:i.saveConfig},null,8,["builds","service-config","onSave"])]),_:1}),l(h,{label:"Code Space",prop:"codespace"},{default:n(()=>[a.newCodespace.changing?(c(),b(V,{key:1,title:"Select new codespace",modelValue:a.newCodespace.value,"onUpdate:modelValue":t[8]||(t[8]=d=>a.newCodespace.value=d),onChange:i.fetchConfig},null,8,["modelValue","onChange"])):(c(),g("div",Wt,[r("p",null,A(a.form.codespace),1),l(k,{type:"primary",onClick:i.changeCodespace},{default:n(()=>[v("Change")]),_:1},8,["onClick"])]))]),_:1})]),_:1},8,["model"]),a.newCodespace.changing?(c(),g("div",zt,[l(k,{size:"large",onClick:t[9]||(t[9]=d=>a.newCodespace.changing=!1)},{default:n(()=>[v("Cancel")]),_:1}),l(k,{size:"large",type:"primary",onClick:i.initialize},{default:n(()=>[v("Reinitialize")]),_:1},8,["onClick"])])):w("",!0)])])}const Lt=T(Nt,[["render",Ot],["__scopeId","data-v-4cf71911"]]),Rt={name:"PublishWindow",data(){return{visible:!1,isWorking:!1,space:null,service:null,form:{version:"",publishDescription:""}}},methods:{open(e,t){this.space=e,this.service=t,this.visible=!0,this.fetchConfig()},fetchConfig(){P({space:this.space,service:this.service}).then(e=>{this.form.version=e.version}).catch(e=>{this.$tip.apiFailed(e)})},saveConfig(){Y({space:this.space,service:this.service,version:this.form.version}).catch(e=>{this.$tip.apiFailed(e)})},publish(){this.isWorking||(this.isWorking=!0,de({space:this.space,service:this.service,publishDescription:this.form.publishDescription}).then(()=>{this.visible=!1}).catch(e=>{this.$tip.apiFailed(e)}).finally(()=>{this.isWorking=!1}))}}},Qt={class:"dialog-footer"};function Mt(e,t,o,y,a,i){const u=s("el-input"),h=s("el-form-item"),m=s("el-form"),C=s("el-button"),S=s("el-dialog");return c(),b(S,{modelValue:a.visible,"onUpdate:modelValue":t[3]||(t[3]=p=>a.visible=p),class:"publish-window",title:"Publish version",width:"500px",draggable:"","close-on-press-escape":!1,"close-on-click-modal":!1},{footer:n(()=>[r("span",Qt,[l(C,{onClick:t[2]||(t[2]=p=>a.visible=!1)},{default:n(()=>[v("Cancel")]),_:1}),l(C,{type:"primary",onClick:i.publish},{default:n(()=>[v(" Confirm ")]),_:1},8,["onClick"])])]),default:n(()=>[l(m,{model:a.form},{default:n(()=>[l(h,{label:"Version",required:""},{default:n(()=>[l(u,{modelValue:a.form.version,"onUpdate:modelValue":t[0]||(t[0]=p=>a.form.version=p),onInput:i.saveConfig},null,8,["modelValue","onInput"])]),_:1}),l(h,{label:"Description",required:""},{default:n(()=>[l(u,{type:"textarea",rows:5,modelValue:a.form.publishDescription,"onUpdate:modelValue":t[1]||(t[1]=p=>a.form.publishDescription=p)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])}const Gt=T(Rt,[["render",Mt]]),Yt={name:"VariableSettingForm",components:{SortableButton:K,VariableInput:J,CompilerSelect:O,InputTypeSelect:M},props:{variable:{required:!0},variables:{required:!0},withGroup:{default:!1}},methods:{handleChange(){this.$emit("change")},createOption(){this.variable.options.push({value:"",label:"",remark:""})},deleteOption(e){this.variable.options.splice(e,1)},handleInputTypeChange(){this.variable.inputType==="checkbox"?this.variable.defaultValue=[this.variable.defaultValue]:this.variable.defaultValue=this.variable.defaultValue instanceof Array?this.variable.defaultValue[0]:this.variable.defaultValue,console.log("this.variable.defaultValue",this.variable.defaultValue),this.handleChange()},handleOptionSorted(e){this.variable.options=[],this.$nextTick(()=>{this.variable.options=e,this.handleChange()})}}},Jt=r("label",null,"Options",-1),jt={class:"opera"};function Ht(e,t,o,y,a,i){const u=s("el-radio"),h=s("el-radio-group"),m=s("el-form-item"),C=s("el-input"),S=s("InputTypeSelect"),p=s("el-button"),F=s("SortableButton"),I=s("el-table-column"),f=s("el-table"),x=s("VariableInput"),k=s("el-switch"),V=s("CompilerSelect"),q=s("el-form"),d=G("sortable");return c(),b(q,{model:o.variable},{default:n(()=>[o.withGroup?w("",!0):(c(),b(m,{key:0,label:"Scope",required:""},{default:n(()=>[l(h,{modelValue:o.variable.scope,"onUpdate:modelValue":t[0]||(t[0]=_=>o.variable.scope=_),onChange:i.handleChange},{default:n(()=>[l(u,{label:"service",border:""},{default:n(()=>[v("Service")]),_:1}),l(u,{label:"table_field",border:""},{default:n(()=>[v("Table Field")]),_:1})]),_:1},8,["modelValue","onChange"])]),_:1})),l(m,{label:"Label",required:""},{default:n(()=>[l(C,{modelValue:o.variable.label,"onUpdate:modelValue":t[1]||(t[1]=_=>o.variable.label=_),onInput:i.handleChange},null,8,["modelValue","onInput"])]),_:1}),l(m,{label:"Name",required:""},{default:n(()=>[l(C,{modelValue:o.variable.name,"onUpdate:modelValue":t[2]||(t[2]=_=>o.variable.name=_),onInput:i.handleChange},null,8,["modelValue","onInput"])]),_:1}),l(m,{label:"Input Type",required:""},{default:n(()=>[l(S,{modelValue:o.variable.inputType,"onUpdate:modelValue":t[3]||(t[3]=_=>o.variable.inputType=_),"with-group":o.withGroup,onChange:i.handleInputTypeChange},null,8,["modelValue","with-group","onChange"])]),_:1}),o.variable.inputType==="checkbox"||o.variable.inputType==="radio"?(c(),b(m,{key:1,label:"Options",class:"item-options",required:""},{label:n(()=>[r("div",null,[Jt,r("div",jt,[l(p,{icon:"Top",class:"button-icon"}),l(p,{icon:"Bottom",class:"button-icon"}),l(p,{type:"primary",onClick:i.createOption},{default:n(()=>[v("Add")]),_:1},8,["onClick"])])])]),default:n(()=>[E((c(),b(f,{data:o.variable.options},{default:n(()=>[l(I,{width:"25px"},{default:n(()=>[l(F)]),_:1}),l(I,{label:"*Label","min-width":"200px"},{default:n(({row:_})=>[l(C,{modelValue:_.label,"onUpdate:modelValue":D=>_.label=D,type:"textarea",rows:1,onInput:i.handleChange},null,8,["modelValue","onUpdate:modelValue","onInput"])]),_:1}),l(I,{label:"*Value","min-width":"120px"},{default:n(({row:_})=>[l(C,{modelValue:_.value,"onUpdate:modelValue":D=>_.value=D,onInput:i.handleChange},null,8,["modelValue","onUpdate:modelValue","onInput"])]),_:1}),l(I,{label:"Remark","min-width":"150px"},{default:n(({row:_})=>[l(C,{modelValue:_.remark,"onUpdate:modelValue":D=>_.remark=D,type:"textarea",rows:1,onInput:i.handleChange},null,8,["modelValue","onUpdate:modelValue","onInput"])]),_:1}),o.variable.options.length>0?(c(),b(I,{key:0,"min-width":"60px",fixed:"right"},{default:n(({row:_,index:D})=>[l(p,{icon:"Delete",class:"button-icon",onClick:wl=>i.deleteOption(D)},null,8,["onClick"])]),_:1})):w("",!0)]),_:1},8,["data"])),[[d,{data:o.variable.options,onChange:i.handleOptionSorted},"config"]])]),_:1})):w("",!0),l(m,{label:"Default Value"},{default:n(()=>[l(x,{variable:o.variable,variables:o.variables,"value-key":"defaultValue",onChange:i.handleChange},null,8,["variable","variables","onChange"])]),_:1}),l(m,{label:"Required"},{default:n(()=>[l(k,{modelValue:o.variable.required,"onUpdate:modelValue":t[4]||(t[4]=_=>o.variable.required=_),onChange:i.handleChange},null,8,["modelValue","onChange"])]),_:1}),o.variable.inputType!=="table"&&o.variable.scope==="service"?(c(),b(m,{key:2,label:"Hidden"},{default:n(()=>[l(k,{modelValue:o.variable.hidden,"onUpdate:modelValue":t[5]||(t[5]=_=>o.variable.hidden=_),onChange:i.handleChange},null,8,["modelValue","onChange"])]),_:1})):w("",!0),o.variable.inputType!=="table"&&o.variable.scope==="service"?(c(),b(m,{key:3,label:"Compiler"},{default:n(()=>[l(V,{modelValue:o.variable.compiler,"onUpdate:modelValue":t[6]||(t[6]=_=>o.variable.compiler=_),onChange:i.handleChange},null,8,["modelValue","onChange"])]),_:1})):w("",!0),l(m,{label:"Remark"},{default:n(()=>[l(C,{modelValue:o.variable.remark,"onUpdate:modelValue":t[7]||(t[7]=_=>o.variable.remark=_),type:"textarea",rows:3,onInput:i.handleChange},null,8,["modelValue","onInput"])]),_:1})]),_:1},8,["model"])}const Xt=T(Yt,[["render",Ht]]),Kt={name:"VariableGroupSettingForm",components:{VariableInput:J,CompilerSelect:O,InputTypeSelect:M},props:{variable:{required:!0}},methods:{changeScope(){if(this.variable.type==="group")for(const e of this.variable.children)e.scope=this.variable.scope;this.handleChange()},handleChange(){this.$emit("change")}}};function Zt(e,t,o,y,a,i){const u=s("el-radio"),h=s("el-radio-group"),m=s("el-form-item"),C=s("el-input"),S=s("el-form");return c(),b(S,{model:o.variable},{default:n(()=>[l(m,{label:"Scope",required:""},{default:n(()=>[l(h,{modelValue:o.variable.scope,"onUpdate:modelValue":t[0]||(t[0]=p=>o.variable.scope=p),onChange:i.changeScope},{default:n(()=>[l(u,{label:"service",border:""},{default:n(()=>[v("Service")]),_:1}),l(u,{label:"table_field",border:""},{default:n(()=>[v("Table Field")]),_:1})]),_:1},8,["modelValue","onChange"])]),_:1}),l(m,{label:"Label",required:""},{default:n(()=>[l(C,{modelValue:o.variable.label,"onUpdate:modelValue":t[1]||(t[1]=p=>o.variable.label=p),onInput:i.handleChange},null,8,["modelValue","onInput"])]),_:1}),l(m,{label:"Name",required:""},{default:n(()=>[l(C,{modelValue:o.variable.name,"onUpdate:modelValue":t[2]||(t[2]=p=>o.variable.name=p),onInput:i.handleChange},null,8,["modelValue","onInput"])]),_:1})]),_:1},8,["model"])}const $t=T(Kt,[["render",Zt]]);const el={name:"Variables",components:{VariableGroupSettingForm:$t,VariableSettingForm:Xt,VariableInput:J,I18nInput:ne,InputTypeSelect:M,CompilerSelect:O},props:{space:{required:!0},service:{required:!0}},data(){return{varIndex:1,groupIndex:1,currentVariable:null,currentGroup:null,variables:[],dragData:{target:null}}},methods:{selectVariable(e,t){this.currentVariable=null,this.$nextTick(()=>{this.currentVariable=e,this.currentGroup=null,t.level>1&&(this.currentGroup=t.parent.data)})},createVariable(e){const t=this.__generateVariableName(e==null?this.variables:e.children),o={type:"variable",scope:e==null?"service":e.scope,name:t,label:t,inputType:"input",required:!1,hidden:!1,defaultValue:"",compiler:"static",remark:"",options:[]};if(e!=null)e.children.push(o);else if(this.variables.length===0)this.variables.push(o);else{const y=this.variables.findLastIndex(a=>a.type==="variable");y===-1?this.variables.unshift(o):this.variables.splice(y+1,0,o)}this.currentVariable=o,this.saveVariables()},createGroup(){const e=this.__generateGroupName(),t={type:"group",scope:"service",name:e,label:e,children:[]};this.variables.push(t),this.currentVariable=t,this.saveVariables()},saveVariables(){const e=this.variables.filter(t=>t.name.trim().length>0&&t.label.trim().length>0);ce({space:this.space,service:this.service,variables:e.map(t=>{if(t.type==="group"){const o=JSON.parse(JSON.stringify(t));return o.children=o.children.map(y=>this.__getSaveVariable(y)),t}return this.__getSaveVariable(t)})}).then(t=>{console.log("data",t)}).catch(t=>{this.$tip.apiFailed(t)})},fetchVariables(){P({space:this.space,service:this.service}).then(e=>{this.variables=e.variables.map(t=>{const o=JSON.parse(JSON.stringify(t));return o.type==="group"?(o.children=o.children==null?[]:o.children.map(y=>(y.options=y.options==null?[]:y.options,y)),o):(o.options=o.options==null?[]:o.options,o)}),this.variables=this.variables.sort((t,o)=>t.type==="variable"&&o.type==="group"?-1:1)}).catch(e=>{this.$tip.apiFailed(e)})},deleteVariable(){const e=this.currentVariable.type==="variable"?"variable":"variable group";this.$model.deleteConfirm(`Do you want to delete the ${e} named 「${this.currentVariable.name}」?`).then(()=>{if(this.currentGroup!=null){const o=this.currentGroup.children.findIndex(y=>y.name===this.currentVariable.name);if(o===-1)return;this.currentGroup.children.splice(o,1),this.currentVariable=null,this.saveVariables();return}const t=this.variables.findIndex(o=>o.name===this.currentVariable.name);t!==-1&&(this.variables.splice(t,1),this.currentVariable=null,this.saveVariables())}).catch(()=>{})},handleDragStart(e){this.dragData.target=e.data},handleDrop(){this.saveVariables()},allowDrag(){return!0},allowDrop(e,t,o){return e.data.type==="variable"?!(t.data.type==="variable"&&o==="inner"):e.data.type==="group"?(console.log("dropType",o),t.data.type!=="variable"):!1},__getSaveVariable(e){const t=JSON.parse(JSON.stringify(e));return t.inputType==="input"?delete t.options:t.options=t.options.filter(o=>o.value.trim().length>0&&o.label.trim().length>0),t},__generateVariableName(e){let t;for(;;)if(t=`var${this.varIndex}`,this.varIndex++,e.findIndex(o=>o.type==="variable"&&o.name===t)===-1)return t},__generateGroupName(){let e;for(;;)if(e=`group${this.groupIndex}`,this.groupIndex++,this.variables.findIndex(t=>t.type==="group"&&t.name===e)===-1)return e}},created(){this.fetchVariables()}},X=e=>(W("data-v-e6f6ce42"),e=e(),z(),e),tl={class:"tree"},ll={class:"variables-wrap"},al={class:"tools"},nl={class:"title"},il={key:0,class:"opera"},ol={class:"variable-setting"},sl={class:"title"},rl=X(()=>r("h4",null,"Variable Setting",-1)),cl={class:"content-wrap"},ul={key:1,class:"variable-holder"},dl=X(()=>r("h4",null,"Variable & Variable Group Settings",-1)),pl=X(()=>r("p",null,"You can open Settings by clicking on variables or groups of variables on the left.",-1)),hl=[dl,pl];function _l(e,t,o,y,a,i){const u=s("el-button"),h=s("el-tree"),m=s("VariableSettingForm"),C=s("VariableGroupSettingForm");return c(),g("div",tl,[r("div",ll,[r("div",al,[l(u,{icon:"Plus",type:"primary",onClick:t[0]||(t[0]=S=>i.createVariable())},{default:n(()=>[v("Add Variable")]),_:1}),l(u,{icon:"Plus",type:"primary",onClick:i.createGroup},{default:n(()=>[v("Add Group")]),_:1},8,["onClick"])]),l(h,{class:"variables","expand-on-click-node":!1,"default-expand-all":!0,data:a.variables,onNodeClick:i.selectVariable,draggable:"","allow-drop":i.allowDrop,"allow-drag":i.allowDrag,"empty-text":"No Variables",onNodeDragStart:i.handleDragStart,onNodeDrop:i.handleDrop},{default:n(({node:S,data:p})=>[r("div",nl,[r("span",null,A(p.label),1),p.type==="group"?(c(),g("div",il,[l(u,{class:"button-icon",icon:"Plus",size:"small",onClick:N(F=>i.createVariable(p),["stop"])},null,8,["onClick"])])):w("",!0)])]),_:1},8,["data","onNodeClick","allow-drop","allow-drag","onNodeDragStart","onNodeDrop"])]),r("div",ol,[r("div",sl,[rl,a.currentVariable!=null?(c(),b(u,{key:0,type:"danger",text:"",onClick:i.deleteVariable},{default:n(()=>[v("Delete")]),_:1},8,["onClick"])):w("",!0)]),r("div",cl,[a.currentVariable!=null?(c(),g(B,{key:0},[a.currentVariable.type==="variable"?(c(),b(m,{key:0,variable:a.currentVariable,variables:a.variables,"with-group":a.currentGroup!=null,onChange:i.saveVariables},null,8,["variable","variables","with-group","onChange"])):w("",!0),a.currentVariable.type==="group"?(c(),b(C,{key:1,variable:a.currentVariable,onChange:i.saveVariables},null,8,["variable","onChange"])):w("",!0)],64)):(c(),g("div",ul,hl))])])])}const ml=T(el,[["render",_l],["__scopeId","data-v-e6f6ce42"]]);const fl={components:{MarkdownEditor:_e,Variables:ml,PublishWindow:Gt,BasicSetting:Lt,InitializeView:Ee,DirectorySelect:Q,SettingFiles:xe},data(){return{isWorking:{compile:!1,cleanCompile:!1},route:{space:"",service:""},loading:!0,currentTab:"basic",service:null,serviceConfig:null}},computed:{...ie(["currentProject","currentDatabase"]),initialized(){return this.serviceConfig!=null&&this.serviceConfig.version!=null}},methods:{saveConfig(){Y({...this.route,readme:this.service.description}).then(()=>{console.log("保存成功")}).catch(e=>{this.$tip.apiFailed(e)})},fetchProfile(){this.loading=!0,ue({spaceName:this.route.space,serviceName:this.route.service}).then(e=>{this.service=e,this.service.local&&this.service.local.codespace&&this.fetchConfig(this.service.local.codespace)}).then(()=>P({space:this.route.space,service:this.route.service})).then(e=>{e!=null&&(this.service.description=e.readme)}).catch(e=>{this.$tip.apiFailed(e)}).finally(()=>{this.loading=!1})},fetchConfig(e){P({codespace:e}).then(t=>{this.serviceConfig=t}).catch(t=>{this.$tip.apiFailed(t)})},compile(){if(this.isWorking.compile)return;this.isWorking.compile=!0;const e=this.$refs.variables.variables;pe({...this.route,projectId:this.currentProject,database:this.currentDatabase,variables:e}).then(()=>{console.log("编译成功")}).catch(t=>{this.$tip.apiFailed(t)}).finally(()=>{this.isWorking.compile=!1})},cleanCompile(){if(this.isWorking.cleanCompile)return;this.isWorking.cleanCompile=!0;const e=this.$refs.variables.variables;he({...this.route,projectId:this.currentProject,database:this.currentDatabase,variables:e}).then(()=>{console.log("清空成功")}).catch(t=>{this.$tip.apiFailed(t)}).finally(()=>{this.isWorking.cleanCompile=!1})}},created(){this.route.space=this.$route.query.space,this.route.service=this.$route.query.service,this.fetchProfile()}},vl={class:"wrap"},bl={class:"header-wrap"},gl={class:"header"},yl={key:0,class:"opera"},Cl={key:0,class:"text-info-1 service-path"},Vl={class:"main"},Sl={class:"tabs"},kl={class:"tab-content"};function Il(e,t,o,y,a,i){const u=s("el-button"),h=s("BasicSetting"),m=s("MarkdownEditor"),C=s("Variables"),S=s("SettingFiles"),p=s("InitializeView"),F=s("PublishWindow"),I=G("loading");return a.service!=null?E((c(),g("div",{key:0,class:U(["page",{"page-un-initialize":!i.initialized}])},[r("div",vl,[r("div",bl,[r("div",gl,[r("h2",null,A(a.service.space.name)+"·"+A(a.service.name),1),i.initialized?(c(),g("div",yl,[l(u,{type:"primary",disabled:e.currentProject==null||a.isWorking.compile,onClick:i.compile},{default:n(()=>[v("Compile")]),_:1},8,["disabled","onClick"]),l(u,{type:"primary",disabled:e.currentProject==null||a.isWorking.cleanCompile,onClick:i.cleanCompile},{default:n(()=>[v("Clean Compile")]),_:1},8,["disabled","onClick"]),l(u,{type:"important",onClick:t[0]||(t[0]=f=>e.$refs.publishWindow.open(a.route.space,a.route.service))},{default:n(()=>[v("Publish")]),_:1})])):w("",!0)]),i.initialized?(c(),g("p",Cl,"At "+A(a.service.local.codespace),1)):w("",!0)]),r("div",Vl,[i.initialized?(c(),g(B,{key:0},[r("ul",Sl,[r("li",{class:U({selected:a.currentTab==="basic"}),onClick:t[1]||(t[1]=f=>a.currentTab="basic")},"Basic",2),r("li",{class:U({selected:a.currentTab==="readme"}),onClick:t[2]||(t[2]=f=>a.currentTab="readme")},"Readme",2),r("li",{class:U({selected:a.currentTab==="variables"}),onClick:t[3]||(t[3]=f=>a.currentTab="variables")},"Variables",2),r("li",{class:U({selected:a.currentTab==="files"}),onClick:t[4]||(t[4]=f=>a.currentTab="files")},"Files",2)]),r("div",kl,[E(l(h,{space:a.route.space,service:a.route.service,"service-type":a.service.type,"service-config":a.serviceConfig},null,8,["space","service","service-type","service-config"]),[[L,a.currentTab==="basic"]]),a.service.description!=null?E((c(),b(m,{key:0,modelValue:a.service.description,"onUpdate:modelValue":[t[5]||(t[5]=f=>a.service.description=f),i.saveConfig]},null,8,["modelValue","onUpdate:modelValue"])),[[L,a.currentTab==="readme"]]):w("",!0),E(l(C,{ref:"variables",space:a.route.space,service:a.route.service},null,8,["space","service"]),[[L,a.currentTab==="variables"]]),E(l(S,{space:a.route.space,service:a.route.service},null,8,["space","service"]),[[L,a.currentTab==="files"]])])],64)):(c(),b(p,{key:1,"space-name":a.service.space.name,"service-name":a.service.name,onInitialized:i.fetchProfile},null,8,["space-name","service-name","onInitialized"]))])]),l(F,{ref:"publishWindow"},null,512)],2)),[[I,a.loading]]):w("",!0)}const Dl=T(fl,[["render",Il],["__scopeId","data-v-620b6b83"]]);export{Dl as default};
