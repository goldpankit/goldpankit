import{_ as I,r as a,o as c,c as d,a as i,F as S,f as M,b as o,w as u,p as q,k as A,y as K,E as O,M as G,m as J,q as R,K as H,A as Q,B as k,t as l,e as p,g,i as P,I as b,J as V}from"./index-10e8cffd.js";import{S as X}from"./ServiceInstaller-242285ec.js";import{P as Y}from"./Pagination-8282e6ee.js";import{B as Z}from"./BeanAmount-b7d4fa2a.js";import{S as x,P as $}from"./PluginList-b5c467e7.js";import{f as ee}from"./service.version-1ac302a5.js";import{f as se}from"./plugin-0f8a09e9.js";import{S as ie}from"./ServiceTitle-c589949d.js";import"./ServiceCodeErrorWindow-92223bed.js";import"./QueryModelView-1fd7c538.js";import"./InnerRouterViewWindow-76cb5791.js";import"./wechat-ae447c56.js";import"./ServiceStatus-38311c4f.js";const ne={name:"IssueListView",components:{Pagination:Y},data(){return{pagination:{pageIndex:1,capacity:10,total:100}}}},w=s=>(q("data-v-f510f853"),s=s(),A(),s),le={class:"issue-wrap"},te=w(()=>i("div",{class:"toolbar"},[i("ul",null,[i("li",null,"All"),i("li",null,"Enabled"),i("li",null,"Completed"),i("li",null,"Refused")]),i("ul",{class:"issue-types"},[i("li",{class:"bug"},"BUG"),i("li",{class:"optimize"},"Optimize")])],-1)),re={class:"issues"},oe=w(()=>i("h3",null,"登录失败时验证码没有刷新",-1)),ce={class:"text-info-1"},ae=w(()=>i("span",null,"刘大逵",-1)),ue=w(()=>i("li",{class:"text-info-1"},[i("span",null,"Completed")],-1)),pe=w(()=>i("li",{class:"text-info-1"},[i("span",null,"3小时前")],-1));function de(s,n,h,y,e,r){const f=a("UserFilled"),m=a("el-icon"),_=a("router-link"),v=a("Pagination");return c(),d("div",le,[te,i("ul",re,[(c(),d(S,null,M(10,j=>i("li",{key:j},[o(_,{to:"#",target:"_blank"},{default:u(()=>[oe,i("ul",null,[i("li",ce,[o(m,null,{default:u(()=>[o(f)]),_:1}),ae]),ue,pe])]),_:1})])),64))]),o(v,{pagination:e.pagination},null,8,["pagination"])])}const he=I(ne,[["render",de],["__scopeId","data-v-f510f853"]]);const me={name:"SearchInput",props:{modelValue:{required:!0},placeholder:{}},methods:{search(){this.$emit("search")},handleInput(s){this.$emit("update:modelValue",s.target.value)}}},ve={class:"search-input"},ge=["value","placeholder"];function _e(s,n,h,y,e,r){const f=a("Search"),m=a("el-icon");return c(),d("div",ve,[i("input",{value:h.modelValue,placeholder:h.placeholder,onKeypress:n[0]||(n[0]=K((..._)=>r.search&&r.search(..._),["enter"])),onInput:n[1]||(n[1]=(..._)=>r.handleInput&&r.handleInput(..._))},null,40,ge),o(m,null,{default:u(()=>[o(f)]),_:1})])}const fe=I(me,[["render",_e],["__scopeId","data-v-898d8650"]]);const ke={components:{ServiceStructureView:x,SearchInput:fe,ServiceTitle:ie,PluginList:$,BeanAmount:Z,IssueListView:he,Empty:O,MarkdownEditor:G,ServiceInstaller:X},data(){return{loading:{page:!0,plugins:!0},isWorking:{install:!1,uninstall:!1},space:null,keyword:"",latestService:null,service:null,selectedPlugin:null,plugins:[],selectedPluginDimension:"readme",project:null}},computed:{...J(["userInfo","currentProject","currentProjectDetail"]),installed(){return this.selectedPlugin==null?!1:this.installedPlugins[this.selectedPlugin.name]!=null},majorVersion(){return this.service==null?"...":`${this.service.version.substring(0,this.service.version.indexOf("."))}`},installedPlugins(){return this.project.plugins||this.project.services},installedService(){return this.project.service||this.project.main},upgradeDescription(){return this.latestService==null?"":this.$t("service.upgradeTip",{currentVersion:this.service.version,newVersion:this.latestService.version,publishDescription:this.latestService.publishDescription})}},watch:{currentProject(){this.latestService=null,this.selectedPlugin=null,this.fetchProject()}},methods:{...R(["setCurrentProject"]),upgrade(){window.open(`/space/${this.space}/${this.service.name}/install?major=${this.majorVersion}`)},install(){this.selectedPluginDimension="install",this.$refs.installer.install()},uninstall(){this.selectedPluginDimension="install",this.$refs.installer.uninstall()},withInstalled(s){return this.installedPlugins[s.name]!=null},fetchProject(){if(this.loading.page=!0,this.currentProject==null||this.currentProject===""){this.project=null,this.space=null,this.loading.page=!1;return}this.refreshProject(!0)},fetchLatestVersion(){this.latestService==null&&ee({space:this.space,service:this.service.name,majorVersion:this.majorVersion}).then(s=>{this.latestService=s}).catch(s=>{if(s.code===4002){this.alert("当前项目使用的服务可能已被更名或删除，您可以前往服务详情了解更多内容。",null,{showCancelButton:!0,confirmButtonText:"查看服务详情"}).then(()=>{window.open(`/space/${this.space}/${this.service.name}`)});return}this.$tip.apiFailed(s)})},refreshProject(s=!1){this.loading.page=!0,H(this.currentProject).then(n=>{if(this.project=n,this.space=this.project.space,this.space==null){this.service=null,this.loading.page=!1;return}if(this.installedService==null){this.loading.page=!1;return}let h=null;for(const y in this.installedService){h=y;break}this.service={name:h,...this.installedService[h]},this.fetchLatestVersion(),s&&this.searchPlugins()}).catch(n=>{this.$tip.apiFailed(n)}).finally(()=>{this.loading.page=!1})},searchPlugins(){this.loading.plugins=!0,se({space:this.space,service:this.service.name,majorVersion:this.majorVersion,keyword:this.keyword}).then(s=>{this.plugins=s}).catch(s=>{s.code!==4001&&this.$tip.apiFailed(s)}).finally(()=>{this.loading.plugins=!1})},selectPlugin(s){this.plugins.length>0&&(this.selectedPlugin=s)},hasNewVersion(s){const n=this.installedPlugins[s.name];return n==null?!1:n.version!==s.lastVersion}},created(){const s=this.$route.query.project_id;s!=null&&s!==""&&(this.setCurrentProject(s),this.$router.replace({name:"Workbench"})),this.fetchProject()}},Pe={class:"page"},we={key:0,class:"wrap"},ye={class:"header"},Se={class:"title"},je={class:"project-code-space"},be={class:"service-info"},Ve={class:"service-title-wrap"},Ie={class:"info"},Ce={class:"content-wrap"},De={class:"service-wrap"},Te={class:"search-input-wrap"},We={class:"setting-wrap"},Le={class:"main"},Ue={class:"service-dimensions"},Be={class:"dimension-content"},Fe={key:0,class:"opera"},ze={key:1,class:"opera-tip"},Ne={key:1,class:"setting-holder"},Ee={key:1,class:"incorrect-wrap"},Me={class:"content"},qe={key:2,class:"incorrect-wrap"},Ae={class:"content"};function Ke(s,n,h,y,e,r){const f=a("Folder"),m=a("el-icon"),_=a("ServiceTitle"),v=a("el-button"),j=a("el-popover"),T=a("SearchInput"),W=a("Upload"),L=a("Check"),U=a("PluginList"),B=a("MarkdownEditor"),F=a("ServiceInstaller"),z=a("ServiceStructureView"),N=a("el-scrollbar"),E=a("InfoFilled"),C=a("router-link"),D=Q("loading");return k((c(),d("div",Pe,[!e.loading.page&&e.project!=null&&e.service!=null?(c(),d("div",we,[i("div",null,[i("div",ye,[i("div",Se,[i("h2",null,l(e.project.name),1),i("p",je,[o(m,null,{default:u(()=>[o(f)]),_:1}),p(l(s.currentProjectDetail.codespace),1)]),i("div",be,[i("div",Ve,[o(_,{space:e.space,service:e.service.name,"service-label":e.service.label,"with-new-page":!0},null,8,["space","service","service-label"]),p(" · v"+l(e.service.version),1)]),e.latestService!=null&&e.latestService.version!==e.service.version?(c(),g(j,{key:0,title:s.$t("service.upgradeTitle"),width:255,trigger:"hover","popper-class":"upgrade-popover"},{default:u(()=>[i("pre",null,l(r.upgradeDescription),1)]),reference:u(()=>[o(v,{size:"small",type:"primary",icon:"Upload",onClick:r.upgrade},{default:u(()=>[p(l(s.$t("service.upgrade")),1)]),_:1},8,["onClick"])]),_:1},8,["title"])):P("",!0)])]),i("div",Ie,[i("em",null,"v"+l(r.majorVersion),1),i("p",null,l(s.$t("common.currentVersion")),1)])]),i("div",Ce,[i("div",De,[i("div",Te,[o(T,{placeholder:s.$t("common.search"),modelValue:e.keyword,"onUpdate:modelValue":n[0]||(n[0]=t=>e.keyword=t),onSearch:r.searchPlugins},null,8,["placeholder","modelValue","onSearch"])]),k((c(),g(U,{plugins:e.plugins,"custom-class":t=>({selected:e.selectedPlugin!=null&&e.selectedPlugin.name===t.name}),installed:t=>r.withInstalled(t),onSelect:n[1]||(n[1]=t=>r.selectPlugin(t))},{title:u(({plugin:t})=>[p(l(t.label||t.name)+" ",1),r.hasNewVersion(t)?(c(),g(m,{key:0},{default:u(()=>[o(W)]),_:1})):r.withInstalled(t)?(c(),g(m,{key:1,class:"installed-icon"},{default:u(()=>[o(L)]),_:1})):P("",!0)]),_:1},8,["plugins","custom-class","installed"])),[[D,e.loading.plugins]])]),i("div",We,[e.selectedPlugin!=null?(c(),d(S,{key:0},[i("h3",null,l(e.selectedPlugin.label||e.selectedPlugin.name),1),i("div",Le,[o(N,null,{default:u(()=>[i("ul",Ue,[i("li",{class:b({selected:e.selectedPluginDimension==="readme"}),onClick:n[2]||(n[2]=t=>e.selectedPluginDimension="readme")},l(s.$t("common.readme")),3),i("li",{class:b({selected:e.selectedPluginDimension==="install"}),onClick:n[3]||(n[3]=t=>e.selectedPluginDimension="install")},l(s.$t("plugin.install")),3),i("li",{class:b({selected:e.selectedPluginDimension==="structure"}),onClick:n[4]||(n[4]=t=>e.selectedPluginDimension="structure")},l(s.$t("service.structure")),3)]),i("div",Be,[k(i("div",null,[o(B,{modelValue:e.selectedPlugin.description,"onUpdate:modelValue":n[5]||(n[5]=t=>e.selectedPlugin.description=t),readonly:"","without-padding":!0},null,8,["modelValue"])],512),[[V,e.selectedPluginDimension==="readme"]]),k(o(F,{ref:"installer",installing:e.isWorking.install,"onUpdate:installing":n[6]||(n[6]=t=>e.isWorking.install=t),uninstalling:e.isWorking.uninstall,"onUpdate:uninstalling":n[7]||(n[7]=t=>e.isWorking.uninstall=t),space:e.space,service:e.service.name,plugin:e.selectedPlugin.name,"service-price":e.selectedPlugin.price.price,"service-lease":e.selectedPlugin.latestLease,version:e.selectedPlugin.lastVersion,"with-project":!1,"project-config":e.project,onInstalled:n[8]||(n[8]=t=>r.refreshProject()),onUninstalled:n[9]||(n[9]=t=>r.refreshProject())},null,8,["installing","uninstalling","space","service","plugin","service-price","service-lease","version","project-config"]),[[V,e.selectedPluginDimension==="install"]]),k(o(z,{space:e.space,service:e.service.name,plugin:e.selectedPlugin.name,version:e.selectedPlugin.lastVersion},null,8,["space","service","plugin","version"]),[[V,e.selectedPluginDimension==="structure"]])])]),_:1})]),e.selectedPluginDimension==="install"?(c(),d("div",Fe,[s.userInfo==null?(c(),g(v,{key:0,type:"primary",size:"large",onClick:n[10]||(n[10]=t=>s.$router.push({name:"SignIn"}))},{default:u(()=>[p("登录后可安装插件")]),_:1})):(c(),d(S,{key:1},[r.installed?(c(),d(S,{key:0},[r.hasNewVersion(e.selectedPlugin)?(c(),g(v,{key:0,type:"primary",size:"large",icon:"Upload",disabled:e.isWorking.install,onClick:r.install},{default:u(()=>[p(l(s.$t("service.upgrade")),1)]),_:1},8,["disabled","onClick"])):(c(),g(v,{key:1,type:"primary",size:"large",disabled:e.isWorking.install,onClick:r.install},{default:u(()=>[p(l(e.isWorking.install?s.$t("service.installing"):s.$t("service.reinstall")),1)]),_:1},8,["disabled","onClick"])),o(v,{size:"large",disabled:e.isWorking.uninstall,onClick:r.uninstall},{default:u(()=>[p(l(e.isWorking.uninstall?s.$t("service.uninstalling"):s.$t("service.uninstall")),1)]),_:1},8,["disabled","onClick"])],64)):(c(),g(v,{key:1,type:"primary",size:"large",disabled:e.isWorking.install,onClick:r.install},{default:u(()=>[p(l(e.isWorking.install?s.$t("service.installing"):s.$t("service.install")),1)]),_:1},8,["disabled","onClick"]))],64))])):P("",!0),e.selectedPluginDimension==="install"?(c(),d("div",ze,[o(m,null,{default:u(()=>[o(E)]),_:1}),i("p",null,l(s.$t("service.installTip")),1)])):P("",!0)],64)):(c(),d("div",Ne,[i("h4",null,l(s.$t("workbench.subServiceSettings")),1),i("p",null,l(s.$t("workbench.subServiceSettingsTip")),1)]))])])])])):e.project==null?(c(),d("div",Ee,[i("div",Me,[i("p",null,[p(l(s.$t("workbench.noProjectTip1")),1),o(C,{to:{name:"Index"}},{default:u(()=>[p(l(s.$t("common.homepage")),1)]),_:1}),p(l(s.$t("workbench.noProjectTip2")),1)])])])):e.service==null?(c(),d("div",qe,[i("div",Ae,[i("p",null,[p(l(s.$t("workbench.noServiceInstalledTip1")),1),o(C,{to:{name:"PublicServices"}},{default:u(()=>[p(l(s.$t("service.publicServices")),1)]),_:1}),p(l(s.$t("workbench.noServiceInstalledTip2")),1)])])])):P("",!0)])),[[D,e.loading.page]])}const is=I(ke,[["render",Ke],["__scopeId","data-v-4331fdca"]]);export{is as default};
