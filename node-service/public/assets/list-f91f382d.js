import{I as q,a as S}from"./InnerRouterViewWindow-7b44fd09.js";import{_ as D,D as U,z as x,A as T,B as N,r,o as u,c as _,d as t,w as o,u as V,b as d,t as f,f as C,g as m,p as k,h as R,E as P,C as B,G as F,F as z,x as O}from"./index-509f7063.js";import{P as $}from"./Pagination-ba4bc926.js";const j={name:"OperaDatabaseView",components:{DatabaseTypeSelect:U},props:{database:{}},data(){return{form:this.database||{name:"",type:"mysql",host:"localhost",port:3306,schema:"",username:"root",password:""},connectResult:{connecting:!1,message:null,withError:!1}}},computed:{url(){return`jdbc:mysql://${this.form.host}:${this.form.port}`}},methods:{create(){x(this.form).then(()=>{this.$emit("success")}).catch(e=>{this.$tip.apiFailed(e)})},update(){T(this.form).then(()=>{this.$emit("success")}).catch(e=>{this.$tip.apiFailed(e)})},testConnect(){this.connectResult.connecting||(this.connectResult.connecting=!0,this.connectResult.withError=!1,N({host:this.form.host,port:this.form.port,user:this.form.username,password:this.form.password,database:this.form.schema}).then(()=>{this.connectResult.withError=!1,this.connectResult.message="Succeeded"}).catch(e=>{this.connectResult.withError=!0,this.connectResult.message=e.message}).finally(()=>{this.connectResult.connecting=!1}))}}},L=e=>(k("data-v-589a4a8e"),e=e(),R(),e),A={class:"opera-database-view"},W=L(()=>d("label",null,"URL",-1)),H={key:0},M={key:1,class:"success"},G={key:2,class:"error"},Q={class:"opera"};function J(e,a,p,g,s,c){const l=r("el-input"),i=r("el-form-item"),w=r("DatabaseTypeSelect"),b=r("el-form"),y=r("el-button");return u(),_("div",A,[t(b,null,{default:o(()=>[t(i,{label:"Name",required:""},{default:o(()=>[t(l,{modelValue:s.form.name,"onUpdate:modelValue":a[0]||(a[0]=n=>s.form.name=n)},null,8,["modelValue"])]),_:1}),t(i,{label:"Database Type",required:""},{default:o(()=>[t(w,{modelValue:s.form.type,"onUpdate:modelValue":a[1]||(a[1]=n=>s.form.type=n),multiple:!1},null,8,["modelValue"])]),_:1}),t(i,{label:"Host",required:""},{default:o(()=>[t(l,{modelValue:s.form.host,"onUpdate:modelValue":a[2]||(a[2]=n=>s.form.host=n)},null,8,["modelValue"])]),_:1}),t(i,{label:"Port",required:""},{default:o(()=>[t(l,{modelValue:s.form.port,"onUpdate:modelValue":a[3]||(a[3]=n=>s.form.port=n)},null,8,["modelValue"])]),_:1}),t(i,{label:"Schema",required:""},{default:o(()=>[t(l,{modelValue:s.form.schema,"onUpdate:modelValue":a[4]||(a[4]=n=>s.form.schema=n)},null,8,["modelValue"])]),_:1}),t(i,{label:"Username",required:""},{default:o(()=>[t(l,{modelValue:s.form.username,"onUpdate:modelValue":a[5]||(a[5]=n=>s.form.username=n)},null,8,["modelValue"])]),_:1}),t(i,{label:"Password",required:""},{default:o(()=>[t(l,{type:"password",modelValue:s.form.password,"onUpdate:modelValue":a[6]||(a[6]=n=>s.form.password=n),"show-password":""},null,8,["modelValue"])]),_:1}),s.form.type==="mysql"?(u(),V(i,{key:0,label:"URL",class:"item-url",required:""},{label:o(()=>[d("div",null,[W,d("a",{href:"javascript:;",onClick:a[7]||(a[7]=(...n)=>c.testConnect&&c.testConnect(...n))},"Test Connection")])]),default:o(()=>[t(l,{"model-value":c.url,readonly:"",disabled:""},null,8,["model-value"]),s.connectResult.connecting?(u(),_("p",H,"连接中")):!s.connectResult.withError&&s.connectResult.message!=null?(u(),_("p",M,f(s.connectResult.message),1)):s.connectResult.message!=null?(u(),_("p",G,f(s.connectResult.message),1)):C("",!0)]),_:1})):C("",!0)]),_:1}),d("div",Q,[p.database==null?(u(),V(y,{key:0,type:"primary",size:"large",onClick:c.create},{default:o(()=>[m("Add Database")]),_:1},8,["onClick"])):(u(),V(y,{key:1,type:"primary",size:"large",onClick:c.update},{default:o(()=>[m("Confirm Update")]),_:1},8,["onClick"]))])])}const K=D(j,[["render",J],["__scopeId","data-v-589a4a8e"]]);const X={name:"DatabaseView",props:{database:{required:!0}},methods:{}},Y={class:"toolbar"};function Z(e,a,p,g,s,c){const l=r("el-descriptions-item"),i=r("el-button"),w=r("el-descriptions");return u(),V(w,{title:p.database.name},{extra:o(()=>[d("ul",Y,[d("li",null,[t(i,{size:"small",onClick:a[0]||(a[0]=b=>e.$router.push({name:"DatabaseModels",params:{database:p.database.name}}))},{default:o(()=>[m("Query Models")]),_:1})]),d("li",null,[t(i,{size:"small",icon:"Edit",onClick:a[1]||(a[1]=b=>e.$emit("edit"))},{default:o(()=>[m("Edit")]),_:1})]),d("li",null,[t(i,{size:"small",type:"danger",text:"",onClick:a[2]||(a[2]=b=>e.$emit("delete"))},{default:o(()=>[m("Delete")]),_:1})])])]),default:o(()=>[t(l,{label:"Type"},{default:o(()=>[m(f(p.database.type),1)]),_:1}),t(l,{label:"Host"},{default:o(()=>[m(f(p.database.host),1)]),_:1}),t(l,{label:"Port"},{default:o(()=>[m(f(p.database.port),1)]),_:1}),t(l,{label:"Schema"},{default:o(()=>[m(f(p.database.schema),1)]),_:1}),t(l,{label:"Username"},{default:o(()=>[m(f(p.database.username),1)]),_:1}),t(l,{label:"Password"},{default:o(()=>[m("******")]),_:1})]),_:1},8,["title"])}const ee=D(X,[["render",Z],["__scopeId","data-v-b9a37fe1"]]);const te={components:{Pagination:$,Empty:P,DatabaseView:ee,OperaDatabaseView:K,InnerRouterViewWindow:q,InnerRouterView:S},data(){return{databases:[],currentDatabase:null,pagination:{pageIndex:1,capacity:10,total:0}}},computed:{operaDbTitle(){return this.currentDatabase==null?"Create New Database":`Edit ${this.currentDatabase.name}`}},methods:{search(){B(this.pagination).then(e=>{this.databases=e.records}).catch(e=>{this.$tip.apiFailed(e)})},add(){this.currentDatabase=null,this.$refs.window.push("operaDatabase")},edit(e){this.currentDatabase=e,this.$refs.window.push("operaDatabase")},deleteDatabase(e){this.$model.deleteConfirm("Do you want to delete the database?").then(()=>{F(e).then(()=>{this.search()}).catch(a=>{this.$tip.apiFailed(a)})}).catch(()=>{})},connect(e){},__save(){saveConfig({id:this.project.id,databases:this.project.databases}).then(()=>{this.$emit("success")}).catch(e=>{this.$tip.apiFailed(e)})}},created(){this.search()}},I=e=>(k("data-v-9c38df1e"),e=e(),R(),e),ae={class:"form"},se={class:"wrap"},oe=I(()=>d("h2",null,"Databases",-1)),ne=I(()=>d("section",{class:"tip"}," The database information will only be stored on your device. ",-1)),le={class:"database-list-wrap"},re={class:"toolbar"},ie={key:0,class:"database-list"};function de(e,a,p,g,s,c){const l=r("el-button"),i=r("DatabaseView"),w=r("Empty"),b=r("Pagination"),y=r("InnerRouterView"),n=r("OperaDatabaseView"),E=r("InnerRouterViewWindow");return u(),_("div",ae,[d("div",se,[oe,ne,t(E,{ref:"window"},{default:o(()=>[t(y,{name:"databaseList",default:""},{default:o(()=>[d("div",le,[d("ul",re,[d("li",null,[t(l,{type:"primary",onClick:c.add},{default:o(()=>[m("Add New Database")]),_:1},8,["onClick"])])]),s.databases.length>0?(u(),_("ul",ie,[(u(!0),_(z,null,O(s.databases,h=>(u(),_("li",{key:h.name},[t(i,{database:h,onEdit:v=>c.edit(h),onDelete:v=>c.deleteDatabase(h.id),onConnect:v=>c.connect(h)},null,8,["database","onEdit","onDelete","onConnect"])]))),128))])):(u(),V(w,{key:1,description:"No Databases"})),t(b,{pagination:s.pagination},null,8,["pagination"])])]),_:1}),t(y,{name:"operaDatabase",title:c.operaDbTitle},{default:o(()=>[t(n,{database:s.currentDatabase,onSuccess:a[0]||(a[0]=h=>(e.$refs.window.back(),c.search()))},null,8,["database"])]),_:1},8,["title"])]),_:1},512)])])}const pe=D(te,[["render",de],["__scopeId","data-v-9c38df1e"]]);export{pe as default};
