import{_ as S,K as k,r as u,z as w,A as F,o as c,g as f,w as v,a,b as y,j as T,t as o,E as $,c as h,F as D,f as V,H as P,i as C,L as E,e as b}from"./index-42b6b834.js";import{a as L}from"./service.version-e08215bb.js";import{B}from"./BeanAmount-bd829d76.js";import{S as x}from"./ServiceStatus-9fee83d5.js";const A={name:"ServiceStructureView",props:{space:{required:!0},service:{required:!0},plugin:{required:!1},version:{required:!0}},data(){return{loading:!1,nodes:[]}},computed:{data(){const e=this.nodes.filter(t=>t.type==="DIRECTORY").sort((t,n)=>n.path.split("/").length-t.path.split("/").length),r=this.nodes.filter(t=>t.type==="FILE");for(const t of e){let n=null;for(let i=r.length-1;i>=0;i--){if(!r[i].path.startsWith(t.path))continue;t.children==null&&(t.children=[]);let p=new Date(r[i].publishTime).getTime();(n==null||p>n)&&(t.description=r[i].description,n=p),t.publishTime=r[i].publishTime,r[i].path=r[i].path.split("/").pop(),t.children.push(r[i]),r.splice(i,1)}}e.reverse();for(let t=e.length-1;t>=0;t--){const n=e[t];let i=!1;for(let p=t-1;p>=0;p--){const l=e[p];if(!n.path.startsWith(l.path))continue;l.children==null&&(l.children=[]);let d=new Date(n.publishTime).getTime(),_=new Date(l.publishTime).getTime();d>_&&(l.description=n.description,l.publishTime=n.publishTime),n.path=n.path.split("/").pop(),l.children.push(n),i=!0;break}i&&e.splice(t,1)}return e.push.apply(e,r),k(e),e},factor(){return[this.space,this.service,this.plugin,this.version]}},watch:{factor(){this.fetchVersionFiles()}},methods:{fetchVersionFiles(){this.loading=!0,L({space:this.space,service:this.service,plugin:this.plugin,version:this.version}).then(e=>{this.nodes=e}).catch(e=>{this.$tip.apiFailed(e)}).finally(()=>{this.loading=!1})}},created(){this.fetchVersionFiles()}},I={class:"node-label"},q={class:"filename"},R={class:"text-info-1 text-mini description"},N={class:"text-info-1 text-mini publish-time"};function O(e,r,t,n,i,p){const l=u("Document"),d=u("el-icon"),_=u("Folder"),s=u("el-tree"),g=w("loading");return F((c(),f(s,{class:"service-structure-tree",data:p.data},{default:v(({node:Z,data:m})=>[a("span",I,[m.type==="FILE"?(c(),f(d,{key:0},{default:v(()=>[y(l)]),_:1})):m.type==="DIRECTORY"?(c(),f(d,{key:1},{default:v(()=>[y(_)]),_:1})):T("",!0),a("span",q,o(m.path),1),a("span",R,o(m.description),1),a("span",N,o(e.getDateOffsetText(m.publishTime)),1)])]),_:1},8,["data"])),[[g,i.loading]])}const ne=S(A,[["render",O],["__scopeId","data-v-d9815c52"]]);const j={name:"PluginList",components:{ServiceStatus:x,Empty:$,BeanAmount:B},props:{plugins:{type:Array,required:!0},customClass:{type:Function,default(){return()=>{}}},installed:{type:Function,default(){return()=>{}}}}},z={key:0,class:"plugin-list"},W=["onClick"],Y={class:"latest-version"},H={key:0},K={class:"introduce"},M={key:0,class:"user-profile"},U=["src"],G={class:"price-wrap"},J={class:"text-info-1 text-mini"},Q={key:0};function X(e,r,t,n,i,p){const l=u("ServiceStatus"),d=u("BeanAmount"),_=u("Empty");return t.plugins.length>0?(c(),h("ul",z,[(c(!0),h(D,null,V(t.plugins,s=>(c(),h("li",{key:s.id,class:P({...t.customClass(s),"plugin-installed":t.installed(s)===!0}),onClick:C(g=>e.$emit("click",s),["stop"])},[a("h5",null,[E(e.$slots,"title",{plugin:s},()=>[b(o(s.label||s.name),1)],!0)]),a("p",Y,[a("span",null,o(e.$t("service.latestVersion"))+": v"+o(s.lastVersion),1),t.installed(s)===!0?(c(),h("span",H,o(e.$t("service.installed")),1)):T("",!0)]),a("p",K,o(s.introduce),1),s.user!=null?(c(),h("div",M,[a("img",{src:e.getAccessUri(s.user.avatar,"/images/avatar/default.png")},null,8,U),a("span",null,o(s.user.username),1)])):T("",!0),a("div",G,[a("p",J,[y(l,{"with-private":s.withPrivate},null,8,["with-private"]),b(" | "+o(e.getDateOffsetText(s.lastPublishTime)),1)]),s.latestLease!=null?(c(),h("em",Q,o(e.getRemainingDay(s.latestLease.leaseEndTime))+" "+o(e.$t("common.days")),1)):(c(),f(d,{key:1,price:s.price.price,type:s.price.leaseType},null,8,["price","type"]))])],10,W))),128))])):(c(),f(_,{key:1,description:e.$t("service.noSubServices")},null,8,["description"]))}const re=S(j,[["render",X],["__scopeId","data-v-d67480fe"]]);export{re as P,ne as S};
