import{_ as P,m as N,n as B,J as L,r as o,o as l,c as v,a as n,t,b as c,w as u,F as k,H as h,A as f,I as _,g as S,j as b,e as p,p as U,l as z}from"./index-57c80a9e.js";import{S as E,I as M,a as F}from"./IssueListView-39ae3600.js";import{a as A}from"./service-0fddfd61.js";import{M as q}from"./MarkdownEditor-3a103099.js";import{E as H}from"./Empty-d455360c.js";import{B as J}from"./BeanAmount-2463967c.js";import"./service.version-9d601ca9.js";import"./Pagination-0a060214.js";const T={components:{SubServiceList:E,BeanAmount:J,IssueListView:M,Empty:H,MarkdownEditor:q,ServiceInstaller:F},data(){return{isWorking:{install:!1,uninstall:!1},space:null,mainService:null,currentService:null,version:"v1",subServices:[],currentServiceDimension:"readme",project:null}},watch:{currentProject(){this.fetchProject(!0)}},computed:{...N(["currentProject"]),installed(){return this.currentService==null?!1:this.project.services[this.currentService.name]!=null}},methods:{...B(["setCurrentProject"]),fetchProject(s=!1){L(this.currentProject).then(i=>{this.project=i,this.space=this.project.space;let m=null;for(const g in this.project.main){m=g;break}this.mainService={name:m,...this.project.main[m]},s&&this.searchSubServices()}).catch(i=>{this.$tip.apiFailed(i)})},searchSubServices(){A({space:this.space,service:this.mainService.name,majorVersion:this.mainService.version.split(".")[0]}).then(s=>{this.subServices=s,this.subServices.length>0&&this.selectService(this.subServices[0])}).catch(s=>{this.$tip.apiFailed(s)})},selectService(s){this.currentService=s},hasNewVersion(s){const i=this.project.services[s.name];return i==null?!1:i.version!==s.lastVersion}},created(){const s=this.$route.query.project_id;s!=null&&s!==""&&(this.setCurrentProject(s),this.$router.replace({name:"Workbench"})),this.fetchProject(!0)}},j=s=>(U("data-v-b1301a26"),s=s(),z(),s),Y={class:"page"},G={key:0,class:"wrap"},K={class:"header"},O={class:"title"},Q={class:"service-info"},R={class:"info"},X={class:"content-wrap"},Z={class:"service-wrap"},x={class:"search-box"},$={class:"setting-wrap"},ee={class:"main"},se={class:"service-dimensions"},ie={class:"dimension-content"},ne={class:"issue-wrap"},re={class:"opera"},te={key:1,class:"setting-holder"},le=j(()=>n("h4",null,"Sub Service Settings",-1)),oe=j(()=>n("p",null,"You can open Settings by clicking on sub services on the left.",-1)),ce=[le,oe];function ae(s,i,m,g,e,a){const y=o("el-input"),w=o("Upload"),V=o("el-icon"),C=o("SubServiceList"),I=o("MarkdownEditor"),W=o("ServiceInstaller"),D=o("IssueListView"),d=o("el-button");return l(),v("div",Y,[e.space!=null?(l(),v("div",G,[n("div",null,[n("div",K,[n("div",O,[n("h2",null,t(e.project.name),1),n("p",Q,t(e.space)+" · "+t(e.mainService.name)+" · v"+t(e.mainService.version),1)]),n("div",R,[n("em",null,t(e.version),1),n("p",null,t(s.$t("common.currentVersion")),1)])]),n("div",X,[n("div",Z,[n("div",x,[c(y,{size:"large",placeholder:s.$t("common.search")},null,8,["placeholder"])]),c(C,{services:e.subServices,"custom-class":r=>({selected:e.currentService!=null&&e.currentService.name===r.name}),onClick:i[0]||(i[0]=r=>a.selectService(r))},{title:u(({service:r})=>[p(t(r.name)+" ",1),a.hasNewVersion(r)?(l(),S(V,{key:0},{default:u(()=>[c(w)]),_:1})):b("",!0)]),_:1},8,["services","custom-class"])]),n("div",$,[e.currentService!=null?(l(),v(k,{key:0},[n("h3",null,t(e.currentService.name),1),n("div",ee,[n("ul",se,[n("li",{class:h({selected:e.currentServiceDimension==="readme"}),onClick:i[1]||(i[1]=r=>e.currentServiceDimension="readme")},t(s.$t("common.readme")),3),n("li",{class:h({selected:e.currentServiceDimension==="install"}),onClick:i[2]||(i[2]=r=>e.currentServiceDimension="install")},t(s.$t("service.install2")),3),n("li",{class:h({selected:e.currentServiceDimension==="issues"}),onClick:i[3]||(i[3]=r=>e.currentServiceDimension="issues")},t(s.$t("common.issues")),3)]),n("div",ie,[f(n("div",null,[c(I,{modelValue:e.currentService.description,"onUpdate:modelValue":i[4]||(i[4]=r=>e.currentService.description=r),readonly:"","without-padding":!0},null,8,["modelValue"])],512),[[_,e.currentServiceDimension==="readme"]]),f(c(W,{ref:"installer",installing:e.isWorking.install,"onUpdate:installing":i[5]||(i[5]=r=>e.isWorking.install=r),uninstalling:e.isWorking.uninstall,"onUpdate:uninstalling":i[6]||(i[6]=r=>e.isWorking.uninstall=r),space:e.space,service:e.currentService.name,"service-type":e.currentService.type,"service-price":e.currentService.price.price,"service-lease":e.currentService.latestLease,version:e.currentService.lastVersion,"with-project":!1,"project-config":e.project,onInstalled:i[7]||(i[7]=r=>a.fetchProject()),onUninstalled:i[8]||(i[8]=r=>a.fetchProject())},null,8,["installing","uninstalling","space","service","service-type","service-price","service-lease","version","project-config"]),[[_,e.currentServiceDimension==="install"]]),n("div",ne,[f(c(D,null,null,512),[[_,e.currentServiceDimension==="issues"]])])])]),n("div",re,[a.installed?(l(),v(k,{key:0},[a.hasNewVersion(e.currentService)?(l(),S(d,{key:0,type:"primary",size:"large",icon:"Upload",disabled:e.isWorking.install,onClick:i[9]||(i[9]=r=>s.$refs.installer.install())},{default:u(()=>[p(t(s.$t("service.upgrade")),1)]),_:1},8,["disabled"])):(l(),S(d,{key:1,type:"primary",size:"large",disabled:e.isWorking.install,onClick:i[10]||(i[10]=r=>s.$refs.installer.install())},{default:u(()=>[p(t(e.isWorking.install?s.$t("service.installing"):s.$t("service.reinstall")),1)]),_:1},8,["disabled"])),c(d,{size:"large",disabled:e.isWorking.uninstall,onClick:i[11]||(i[11]=r=>s.$refs.installer.uninstall())},{default:u(()=>[p(t(e.isWorking.uninstall?s.$t("service.uninstalling"):s.$t("service.uninstall")),1)]),_:1},8,["disabled"])],64)):(l(),S(d,{key:1,type:"primary",size:"large",disabled:e.isWorking.install,onClick:i[12]||(i[12]=r=>s.$refs.installer.install())},{default:u(()=>[p(t(e.isWorking.install?s.$t("service.installing"):s.$t("service.install")),1)]),_:1},8,["disabled"]))])],64)):(l(),v("div",te,ce))])])])])):b("",!0)])}const _e=P(T,[["render",ae],["__scopeId","data-v-b1301a26"]]);export{_e as default};
