import{B as j}from"./BeanAmount-0cebc2c4.js";import{E as T}from"./Empty-6ec2728f.js";import{_ as w,r as _,o as n,c as a,F as f,f as b,H as q,i as B,a as t,K as L,t as o,g as v,e as I,P as W,L as F,m as D,n as A,h as E,M as N,N as M,b as p,j as g,w as d,p as R,l as U}from"./index-edfb6a04.js";import{F as O,M as x,V as z,I as G,a as H,b as J,f as K,g as Q}from"./service.version-354904a4.js";import{P as X}from"./Pagination-cf5ae055.js";const Y={name:"SubServiceList",components:{Empty:T,BeanAmount:j},props:{services:{type:Array,required:!0},customClass:{type:Function,default(){return()=>{}}}}},Z={key:0,class:"sub-service-list"},ee=["onClick"],te={class:"latest-version"},se={class:"user-profile"},ie=["src"],ne={class:"price-wrap"},le={class:"text-info-1 text-mini"},ae={key:0};function re(e,s,i,c,r,h){const m=_("BeanAmount"),y=_("Empty");return i.services.length>0?(n(),a("ul",Z,[(n(!0),a(f,null,b(i.services,l=>(n(),a("li",{key:l.id,class:q(i.customClass(l)),onClick:B($=>e.$emit("click",l),["stop"])},[t("h5",null,[L(e.$slots,"title",{service:l},()=>[I(o(l.name),1)],!0)]),t("p",te,o(e.$t("service.latestVersion"))+": v"+o(l.lastVersion),1),t("p",null,o(l.introduce),1),t("div",se,[t("img",{src:e.getAccessUri(l.user.avatar,"/images/avatar/default.png")},null,8,ie),t("span",null,o(l.user.username),1)]),t("div",ne,[t("p",le,o(e.$t("service.lastPublish"))+": "+o(e.getDateOffsetText(l.lastPublishTime)),1),l.latestLease!=null?(n(),a("em",ae,o(e.getRemainingDay(l.latestLease.leaseEndTime))+" "+o(e.$t("common.days")),1)):(n(),v(m,{key:1,price:l.price.price,type:l.price.leaseType},null,8,["price","type"]))])],10,ee))),128))])):(n(),v(y,{key:1,description:e.$t("service.noSubServices")},null,8,["description"]))}const Ae=w(Y,[["render",re],["__scopeId","data-v-50a6eacc"]]);const oe={name:"ServiceInstaller",components:{ProjectSelect:W,DirectorySelect:F,FieldSetting:O,MySqlFieldSelect:x,VariableInput:z,InstallRadio:G,InstallInput:H,InstallCheckbox:J},props:{installing:{},uninstalling:{},space:{required:!0},service:{required:!0},serviceType:{required:!0},servicePrice:{required:!0},serviceLease:{required:!1},version:{required:!0},withProject:{default:!0},projectConfig:{},withBreadcrumbs:{default:!1},withInstallButton:{default:!1}},data(){return{isWorking:{install:!1,uninstall:!1},variables:[]}},computed:{...D(["currentProject","currentDatabase"]),serviceVariables(){return this.variables},unique(){return[this.space,this.service,this.version]}},watch:{unique(){this.fetchVersion()},"isWorking.install":function(){this.$emit("update:installing",this.isWorking.install)},"isWorking.uninstall":function(){this.$emit("update:uninstalling",this.isWorking.uninstall)}},methods:{...A(["setCurrentProject","setInstallData"]),...E(["refreshBalance"]),fetchVersion(){K({space:this.space,service:this.service,version:this.version}).then(e=>{this.variables=JSON.parse(e.variables).map(s=>this.__initVariableValue(s)),console.log("this.variables",this.variables)}).catch(e=>{this.$tip.apiFailed(e)})},install(){if(this.serviceLease!=null){this.__install();return}if(this.servicePrice<50){this.__install();return}this.installConfirm(this.servicePrice).then(()=>{this.__install()}).catch(()=>{})},__install(){this.isWorking.install||(this.isWorking.install=!0,N({projectId:this.currentProject,database:this.currentDatabase,space:this.space,service:this.service,serviceType:this.serviceType,version:this.version,variables:this.__getInstallVariables(this.variables)}).then(e=>{this.$tip.success(this.$t("service.installSuccessfully")),this.setInstallData(e),this.refreshBalance(),this.$emit("installed")}).catch(e=>{this.$tip.apiFailed(e),this.$emit("error",e)}).finally(()=>{this.isWorking.install=!1}))},uninstall(){if(this.serviceLease!=null){this.__uninstall();return}if(this.servicePrice<50){this.__uninstall();return}this.uninstallConfirm().then(()=>{this.__uninstall()}).catch(()=>{})},__uninstall(){this.isWorking.uninstall||(this.isWorking.uninstall=!0,M({projectId:this.currentProject,database:this.currentDatabase,space:this.space,service:this.service,serviceType:this.serviceType,version:this.version,variables:this.__getInstallVariables(this.variables)}).then(e=>{this.$tip.success(this.$t("service.uninstallSuccessfully")),this.setInstallData(e),this.$emit("uninstalled")}).catch(e=>{this.$tip.apiFailed(e),this.$emit("error",e)}).finally(()=>{this.isWorking.uninstall=!1}))},__getInstallVariables(e){return e.map(s=>{if(s.inputType==="select"){const i=s.options.find(r=>r.value===s.value.value);if(i==null)return s;const c={};for(const r of i.settings)c[r.name]=r.value;s.value.settings=c}return s})},__initVariableValue(e,s){if(s==null&&this.projectConfig!=null){const i=this.projectConfig.services[this.service];if(i!=null){const c=i.variables.findLast(r=>r.name===e.name);c!=null&&(s=c.value)}if(s==null){let c=null;for(const h in this.projectConfig.main){c=h;break}const r=this.projectConfig.main[c].variables[e.name];s=r,r!=null&&r.constructor!==e.defaultValue.constructor&&(s=null)}}if(s!=null){if(e.inputType==="table"||e.inputType==="query_model"){for(const i in s.settings){const c=e.children.find(r=>r.name===i);c!=null&&(c.value=s.settings[i])}return e.value=s.value,console.log(e.name,e.value,s),e}return e.type==="group"?(e.children.forEach(i=>this.__initVariableValue(i,s[i.name])),e):(e.value=s,e)}if(s=e.defaultValue,s=s??Q(e.inputType),e.inputType==="table"||e.inputType==="query_model"){for(const i of e.children)i.value=i.defaultValue;return e.value=s,e}return e.type==="group"?(e.children.forEach(i=>{i.value=i.defaultValue}),e):(e.value=s,e)}},created(){this.fetchVersion()}},ce={class:"service-installer"},ue={key:0,class:"nav"},_e={class:"title"},pe={class:"content-wrap"},de={class:"install-tip"},he={class:"form-wrap"},fe={key:1,class:"label-wrap"},me={key:1,class:"group-vars"},ge={class:"text-info-1 text-mini"},ye={key:0},ve={key:1,class:"parameters-holder"},ke={key:2,class:"install"};function $e(e,s,i,c,r,h){const m=_("el-button"),y=_("ProjectSelect"),l=_("el-form-item"),$=_("ArrowRight"),S=_("el-icon"),C=_("VariableInput"),P=_("el-form");return n(),a("div",ce,[i.withBreadcrumbs?(n(),a("div",ue,[t("div",_e,[p(m,{class:"button-icon",icon:"ArrowLeftBold",onClick:s[0]||(s[0]=u=>e.$emit("back"))}),t("h4",null,o(i.service)+o(i.version==null?"":" · "+i.version.toUpperCase())+" · "+o(e.$t("service.install2")),1)])])):g("",!0),t("div",pe,[i.withProject||h.serviceVariables.length>0?(n(),a(f,{key:0},[t("p",de,o(e.$t("service.withParametersTip")),1),t("div",he,[p(P,null,{default:d(()=>[i.withProject?(n(),v(l,{key:0,label:e.$t("project.project"),required:""},{default:d(()=>[p(y,{"model-value":e.currentProject,"with-block":!0,"with-prefix":!1,onChange:e.setCurrentProject},null,8,["model-value","onChange"])]),_:1},8,["label"])):g("",!0),(n(!0),a(f,null,b(h.serviceVariables,u=>(n(),a(f,null,[u.hidden?g("",!0):(n(),v(l,{key:u.name,label:u.label,required:u.required},{label:d(()=>[u.type==="variable"?(n(),a(f,{key:0},[I(o(u.label),1)],64)):(n(),a("div",fe,[t("span",null,o(u.label),1),p(S,null,{default:d(()=>[p($)]),_:1})]))]),default:d(()=>[u.type==="variable"?(n(),v(C,{key:0,variable:u},null,8,["variable"])):u.type==="group"?(n(),a("ul",me,[(n(!0),a(f,null,b(u.children,V=>(n(),a("li",{key:`${u.name}_${V.name}`},[t("label",ge,[V.required?(n(),a("em",ye,"*")):g("",!0),I(o(V.label),1)]),p(C,{variable:V},null,8,["variable"])]))),128))])):g("",!0)]),_:2},1032,["label","required"]))],64))),256))]),_:1})])],64)):(n(),a("div",ve,[t("p",null,o(e.$t("service.withoutParametersTip")),1)])),i.withInstallButton?(n(),a("div",ke,[p(m,{type:"important",onClick:h.install,disabled:r.isWorking.install},{default:d(()=>[I(o(r.isWorking.install?e.$t("service.installing"):e.$t("service.install")),1)]),_:1},8,["onClick","disabled"])])):g("",!0)])])}const Ee=w(oe,[["render",$e],["__scopeId","data-v-91df260d"]]);const Ve={name:"IssueListView",components:{Pagination:X},data(){return{pagination:{pageIndex:1,capacity:10,total:100}}}},k=e=>(R("data-v-f510f853"),e=e(),U(),e),Ie={class:"issue-wrap"},be=k(()=>t("div",{class:"toolbar"},[t("ul",null,[t("li",null,"All"),t("li",null,"Enabled"),t("li",null,"Completed"),t("li",null,"Refused")]),t("ul",{class:"issue-types"},[t("li",{class:"bug"},"BUG"),t("li",{class:"optimize"},"Optimize")])],-1)),Se={class:"issues"},we=k(()=>t("h3",null,"登录失败时验证码没有刷新",-1)),Ce={class:"text-info-1"},Pe=k(()=>t("span",null,"刘大逵",-1)),je=k(()=>t("li",{class:"text-info-1"},[t("span",null,"Completed")],-1)),Te=k(()=>t("li",{class:"text-info-1"},[t("span",null,"3小时前")],-1));function qe(e,s,i,c,r,h){const m=_("UserFilled"),y=_("el-icon"),l=_("router-link"),$=_("Pagination");return n(),a("div",Ie,[be,t("ul",Se,[(n(),a(f,null,b(10,S=>t("li",{key:S},[p(l,{to:"#",target:"_blank"},{default:d(()=>[we,t("ul",null,[t("li",Ce,[p(y,null,{default:d(()=>[p(m)]),_:1}),Pe]),je,Te])]),_:1})])),64))]),p($,{pagination:r.pagination},null,8,["pagination"])])}const Ne=w(Ve,[["render",qe],["__scopeId","data-v-f510f853"]]);export{Ne as I,Ae as S,Ee as a};
