import{_ as F,r as o,o as u,g as V,w as n,b as l,c as v,F as D,j as R,X as H,H as K,a as r,I as $,t as p,Y as X,O as W,e as k,Z as ie,$ as P,f as E,E as Z,i as A,p as L,l as Q,z as x,A as z,V as ne,a0 as Y,M as ee,U as se,m as oe,n as re,a1 as ce,a2 as ue,J as j}from"./index-d23d572e.js";import{C as B}from"./CompilerSelect-2c9da15f.js";import{c as de,d as pe,i as te,e as M,t as me,g as G,h as he,j as fe}from"./service-af1aeefe.js";import{p as be,O as _e,V as J,S as ve}from"./ServiceCodeErrorWindow-642fe6fc.js";import{a as ge}from"./form.check-189b470c.js";import{a as ye,b as Ve}from"./service.space-69d75299.js";const Ce={name:"InputTypeSelect",props:{withGroup:{default:!1}}};function ke(e,t,i,b,a,s){const c=o("el-option"),d=o("el-select");return u(),V(d,{class:"input-type-select"},{default:n(()=>[l(c,{value:"input",label:"Input"}),l(c,{value:"number_input",label:"Number Input"}),l(c,{value:"textarea",label:"Textarea"}),l(c,{value:"select",label:"Select"}),l(c,{value:"checkbox",label:"Checkbox"}),l(c,{value:"radio",label:"Radio"}),i.withGroup?R("",!0):(u(),v(D,{key:0},[l(c,{value:"datasource",label:"Data Source"}),l(c,{value:"table",label:"Table"}),l(c,{value:"query_model",label:"Query Model"})],64))]),_:1})}const O=F(Ce,[["render",ke],["__scopeId","data-v-48c58dfb"]]);const Se={name:"SettingFiles",components:{SortableButton:H,CompilerSelect:B,InputTypeSelect:O},props:{space:{required:!0},service:{required:!0}},data(){return{currentNode:null,files:[]}},methods:{fetchFiles(){de(this.space,this.service).then(e=>{this.files=e,K(this.files)}).catch(e=>{this.$tip.apiFailed(e)})},saveFileSetting(){this.saveTimeout!=null&&clearTimeout(this.saveTimeout),this.saveTimeout=setTimeout(()=>{pe({space:this.space,service:this.service,type:this.currentNode.type,path:this.currentNode.path,relativePath:this.currentNode.relativePath,compiler:this.currentNode.compiler,enableExpress:this.currentNode.enableExpress,variables:this.currentNode.variables.filter(e=>e.name.trim().length>0)}).then(()=>{}).catch(e=>{this.$tip.apiFailed(e)})},300)},createVariable(){this.currentNode.variables.push({name:"",value:"",compiler:"static",remark:""})},deleteVariable(e){this.currentNode.variables.splice(e,1)},handleNodeClick(e){this.currentNode=e},isFlagFile(e){return e.compiler!=null&&e.compiler!==""||e.enableExpress!=null&&e.enableExpress!==""||e.variables.length>0},handleSorted(e){this.currentNode.variables=[],this.$nextTick(()=>{this.currentNode.variables=e,this.saveFileSetting()})}},created(){this.fetchFiles()}},Te={class:"tree"},Ie={class:"files-wrap"},we={class:"search-wrap"},Re={class:"node-label"},Fe={class:"file-setting"},Ne={class:"content-wrap"},$e={key:1,class:"setting-holder"},De={class:"holder-wrap"};function Ae(e,t,i,b,a,s){const c=o("el-input"),d=o("Document"),f=o("el-icon"),C=o("Folder"),I=o("el-tree"),h=o("CompilerSelect"),w=o("el-form-item"),T=o("el-form");return u(),v("div",Te,[r("div",Ie,[r("div",we,[l(c,{placeholder:e.$t("service.settings.file.filterKeyword")},null,8,["placeholder"])]),l(I,{data:a.files,"highlight-current":!0,"empty-text":e.$t("service.settings.file.noFiles"),onNodeClick:s.handleNodeClick},{default:n(({node:_,data:g})=>[r("span",Re,[g.type==="FILE"?(u(),V(f,{key:0},{default:n(()=>[l(d)]),_:1})):g.type==="DIRECTORY"?(u(),V(f,{key:1},{default:n(()=>[l(C)]),_:1})):R("",!0),r("span",{class:$(["filename",{"flag-file":s.isFlagFile(g)}])},p(g.label),3)])]),_:1},8,["data","empty-text","onNodeClick"])]),r("div",Fe,[r("h4",null,p(e.$t("service.settings.file.fileSetting")),1),r("div",Ne,[a.currentNode!=null?(u(),V(T,{key:0},{default:n(()=>[l(w,{label:e.$t("service.settings.file.compiler")},{default:n(()=>[l(h,{modelValue:a.currentNode.compiler,"onUpdate:modelValue":t[0]||(t[0]=_=>a.currentNode.compiler=_),"with-follow-service":!0,onChange:s.saveFileSetting},null,8,["modelValue","onChange"])]),_:1},8,["label"]),l(w,{label:e.$t("service.settings.file.enableExpress")},{default:n(()=>[l(c,{modelValue:a.currentNode.enableExpress,"onUpdate:modelValue":t[1]||(t[1]=_=>a.currentNode.enableExpress=_),type:"textarea",rows:8,placeholder:e.$t("service.settings.file.enableExpressHolder"),onInput:s.saveFileSetting},null,8,["modelValue","placeholder","onInput"])]),_:1},8,["label"])]),_:1})):(u(),v("div",$e,[r("div",De,[r("h5",null,p(e.$t("service.settings.file.fileSetting")),1),r("p",null,p(e.$t("service.settings.file.fileSettingHolder")),1)])]))])])])}const ze=F(Se,[["render",Ae],["__scopeId","data-v-ffd79f15"]]);const Ue={name:"InitializeView",components:{DatabaseTypeSelect:X,CompilerSelect:B,DirectorySelect:W},props:{spaceName:{required:!0},serviceName:{required:!0}},data(){return{form:{space:this.spaceName,name:this.serviceName,version:"1.0.0",compiler:"static",supportedDatabases:[],codespace:""}}},methods:{initialize(){te(this.form).then(()=>{this.$emit("initialized",this.form)}).catch(e=>{this.$tip.apiFailed(e)})},fetchConfig(e){M({codespace:e}).then(t=>{t!=null&&(this.form.version=t.version||this.form.version,this.form.compiler=t.compiler||this.form.compiler,this.form.supportedDatabases=t.supportedDatabases||this.form.supportedDatabases)}).catch(t=>{this.$tip.apiFailed(t)})}}},qe={class:"initialize-wrap"},Be={class:"tip"},je={class:"directory-select-wrap"},Ee={class:"opera-bottom"};function Me(e,t,i,b,a,s){const c=o("DirectorySelect"),d=o("el-button");return u(),v("div",qe,[r("div",Be,[r("h3",null,p(e.$t("service.settings.initialize.initializeService")),1),r("p",null,p(e.$t("service.settings.initialize.initializeServiceTip")),1)]),r("div",je,[l(c,{modelValue:a.form.codespace,"onUpdate:modelValue":t[0]||(t[0]=f=>a.form.codespace=f),title:e.$t("service.settings.initialize.selectServiceCodespace"),onChange:s.fetchConfig},null,8,["modelValue","title","onChange"])]),r("div",Ee,[l(d,{type:"primary",size:"large",onClick:s.initialize},{default:n(()=>[k(p(e.$t("service.settings.initialize.initializeService")),1)]),_:1},8,["onClick"])])])}const We=F(Ue,[["render",Me],["__scopeId","data-v-922eead1"]]);const Oe={name:"BuildCommandTypeSelect"};function Pe(e,t,i,b,a,s){const c=o("el-option"),d=o("el-select");return u(),V(d,{class:"build-command-type-select"},{default:n(()=>[l(c,{value:"Node",label:"Node"}),l(c,{value:"MySQL",label:"MySQL"})]),_:1})}const Le=F(Oe,[["render",Pe],["__scopeId","data-v-3b21c3bd"]]);const Qe={name:"ServiceFileSelectWindow",props:{title:{default:"Select Service File"},serviceConfig:{required:!0}},data(){return{visible:!1,paths:[],files:[],selectedFilepath:null}},methods:{open(){this.visible=!0,this.paths=[this.__getProjectName()],this.__fetchFiles(),this.selectedFilepath=null},confirmSelect(){this.visible=!1;let e=`${this.paths.slice(1).join("/")}/${this.selectedFilepath}`;e.startsWith("/")||(e="/"+e),this.$emit("change",e)},cancelSelect(){this.visible=!1},changePath(e){if(e===this.paths.length-1)return;const t=this.paths.slice(0,e+1);this.__fetchFiles(t,()=>{this.paths.splice(e+1),this.selectedFilepath=null})},openOrSelectFile(e){if(e.type==="DIRECTORY"){const t=JSON.parse(JSON.stringify(this.paths));t.push(e.path),this.__fetchFiles(t,()=>{this.paths.push(e.path),this.selectedFilepath=null});return}this.selectedFilepath=e.path},__fetchFiles(e,t){ie(this.__getAbsolutePath(e)).then(i=>{this.files=i,K(this.files),t&&t()}).catch(i=>{this.$tip.apiFailed(i)})},__getProjectName(){return P.split(this.serviceConfig.codespace).pop()},__getAbsolutePath(e){e==null&&(e=JSON.parse(JSON.stringify(this.paths))),e.shift();let t=P.join([this.serviceConfig.codespace,...e]);return this.serviceConfig.translator.settings.length>0&&(t=P.join([this.serviceConfig.codespace,this.serviceConfig.translator.output,...e])),t}}},xe=["id"],Ge={class:"paths"},Je=["onClick"],Ye={class:"files"},He=["onClick"],Ke={class:"opera"};function Xe(e,t,i,b,a,s){const c=o("el-button"),d=o("Folder"),f=o("Document"),C=o("el-icon"),I=o("el-dialog");return u(),V(I,{modelValue:a.visible,"onUpdate:modelValue":t[0]||(t[0]=h=>a.visible=h),"show-close":!1,"custom-class":"service-file-select-window","append-to-body":""},{header:n(({close:h,titleId:w,titleClass:T})=>[r("h4",{id:w,class:$(T)},p(i.title),11,xe),l(c,{class:"button-icon",icon:"Refresh",onClick:s.__fetchFiles},null,8,["onClick"])]),default:n(()=>[r("ul",Ge,[(u(!0),v(D,null,E(a.paths,(h,w)=>(u(),v("li",{key:h,onClick:T=>s.changePath(w)},p(h),9,Je))),128))]),r("div",Ye,[r("ul",null,[(u(!0),v(D,null,E(a.files,h=>(u(),v("li",{key:h.path,class:$({"is-file":h.type==="FILE",selected:a.selectedFilepath===h.path}),onClick:w=>s.openOrSelectFile(h)},[l(C,null,{default:n(()=>[h.type==="DIRECTORY"?(u(),V(d,{key:0})):(u(),V(f,{key:1}))]),_:2},1024),r("p",null,p(h.path),1)],10,He))),128))])]),r("div",Ke,[l(c,{size:"large",onClick:s.cancelSelect},{default:n(()=>[k("Cancel")]),_:1},8,["onClick"]),l(c,{type:"primary",size:"large",disabled:a.selectedFilepath==null,onClick:s.confirmSelect},{default:n(()=>[k("Confirm Select")]),_:1},8,["disabled","onClick"])])]),_:1},8,["modelValue"])}const Ze=F(Qe,[["render",Xe]]);const et={name:"BuildList",components:{ServiceFileSelectWindow:Ze,DirectorySelect:W,Empty:Z,BuildCommandTypeSelect:Le},props:{builds:{required:!0,type:Array},withUnbuild:{default:!1},serviceConfig:{required:!0}},data(){return{actives:[],varIndex:1,selectFileData:{currentBuild:null}}},watch:{builds:{immediate:!0,handler(){this.__handleBuildList("builds")}},unbuilds:{immediate:!0,handler(){this.__handleBuildList("unbuilds")}}},methods:{handleFileChange(e){this.selectFileData.currentBuild.__filepath=e,this.handleSave()},create(){const e=""+Math.random();this.builds.push({id:e,name:this.__generateBuildName(),type:"Node",contentType:"string",content:"",__readonly:!1,__filepath:""}),this.actives.push(e)},handleChange(e){for(const t of this.builds){const i=e.find(b=>b===t.id)!=null;t.__readonly=!i}},handleSave(){this.$emit("save")},deleteBuild(e){this.builds.splice(e,1),this.handleSave()},openSelectFileWindow(e){this.selectFileData.currentBuild=e,this.$refs.serviceFileSelectWindow.open()},__generateBuildName(){let e;for(;;)if(e=`${this.withUnbuild?"un":""}build${this.varIndex}`,this.varIndex++,this.builds.findIndex(t=>t.name===e)===-1)return e},__handleBuildList(e){this[e]!=null&&this[e].forEach(t=>{t.id=""+Math.random(),t.contentType==="file"&&(t.__filepath=t.content,t.content=""),t.__readonly=!0})}}},tt={class:"service-build-list"},lt={class:"toolbar"},at={key:0},it={key:1},nt={class:"title-wrap"},st={key:0,class:"view"},ot={class:"name"},rt={class:"type"},ct={key:1,class:"edit"},ut={class:"opera"},dt=["onClick"],pt={key:0,class:"holder"},mt={key:1};function ht(e,t,i,b,a,s){const c=o("el-button"),d=o("el-input"),f=o("el-form-item"),C=o("BuildCommandTypeSelect"),I=o("el-form"),h=o("el-tab-pane"),w=o("el-tabs"),T=o("el-collapse-item"),_=o("el-collapse"),g=o("Empty"),y=o("ServiceFileSelectWindow");return u(),v("div",tt,[r("div",lt,[i.withUnbuild?(u(),v("p",at,p(e.$t("service.settings.build.unBuildTip")),1)):(u(),v("p",it,p(e.$t("service.settings.build.buildTip")),1)),l(c,{type:"primary",onClick:s.create},{default:n(()=>[k(p(e.$t("common.create")),1)]),_:1},8,["onClick"])]),i.builds.length>0?(u(),V(_,{key:0,modelValue:a.actives,"onUpdate:modelValue":t[2]||(t[2]=S=>a.actives=S),onChange:s.handleChange},{default:n(()=>[(u(!0),v(D,null,E(i.builds,(S,N)=>(u(),V(T,{key:S.id,name:S.id},{title:n(()=>[r("div",nt,[S.__readonly?(u(),v("div",st,[r("p",ot,p(S.name),1),r("p",rt,p(S.type),1)])):(u(),v("div",ct,[l(I,{model:S},{default:n(()=>[l(f,{label:e.$t("common.name"),required:""},{default:n(()=>[l(d,{class:"name",modelValue:S.name,"onUpdate:modelValue":m=>S.name=m,onClick:t[0]||(t[0]=A(()=>{},["stop"])),onKeypress:t[1]||(t[1]=A(()=>{},["stop"])),onInput:s.handleSave},null,8,["modelValue","onUpdate:modelValue","onInput"])]),_:2},1032,["label"]),l(f,{label:e.$t("common.type"),required:""},{default:n(()=>[l(C,{class:"type",modelValue:S.type,"onUpdate:modelValue":m=>S.type=m,onChange:s.handleSave},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:2},1032,["label"])]),_:2},1032,["model"])])),r("div",ut,[l(c,{icon:"Delete",onClick:A(m=>s.deleteBuild(N),["stop"])},{default:n(()=>[k(p(e.$t("common.delete")),1)]),_:2},1032,["onClick"])])])]),default:n(()=>[l(w,{modelValue:S.contentType,"onUpdate:modelValue":m=>S.contentType=m},{default:n(()=>[l(h,{name:"string",label:e.$t("service.settings.build.input")},{default:n(()=>[l(d,{modelValue:S.content,"onUpdate:modelValue":m=>S.content=m,type:"textarea",placeholder:e.$t("service.settings.build.buildCommand"),rows:5,onInput:s.handleSave},null,8,["modelValue","onUpdate:modelValue","placeholder","onInput"])]),_:2},1032,["label"]),l(h,{name:"file",label:e.$t("service.settings.build.file")},{default:n(()=>[r("div",{class:"select-holder",onClick:m=>s.openSelectFileWindow(S)},[S.__filepath==null||S.__filepath===""?(u(),v("p",pt,p(e.$t("common.clickToSelectFile")),1)):(u(),v("p",mt,p(S.__filepath),1))],8,dt)]),_:2},1032,["label"])]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1032,["name"]))),128))]),_:1},8,["modelValue","onChange"])):(u(),V(g,{key:1})),l(y,{ref:"serviceFileSelectWindow","service-config":i.serviceConfig,onChange:s.handleFileChange},null,8,["service-config","onChange"])])}const ft=F(et,[["render",ht],["__scopeId","data-v-9f0c30c7"]]);const bt={name:"TranslatorTypeSelect"};function _t(e,t,i,b,a,s){const c=o("el-option"),d=o("el-select");return u(),V(d,{class:"translator-type-select"},{default:n(()=>[l(c,{value:"pattern",label:e.$t("service.settings.translator.pattern")},null,8,["label"]),l(c,{value:"code",label:e.$t("service.settings.translator.code")},null,8,["label"])]),_:1})}const vt=F(bt,[["render",_t],["__scopeId","data-v-f6d00470"]]);const gt={name:"TranslatorList",components:{TranslatorTypeSelect:vt,Empty:Z},props:{space:{required:!0},service:{required:!0},translator:{required:!0}},data(){return{actives:[],varIndex:1}},computed:{translators(){return this.translator.settings}},watch:{translators:{immediate:!0,handler(){this.translators.forEach(e=>{e.id=""+Math.random(),e.__readonly=!0})}}},methods:{add(){const e=""+Math.random();this.translator.settings.push({id:e,name:this.__generateTranslatorName(),type:"pattern",path:".*",source:"",target:"",code:"  return {filepath: filepath, content: content};",__readonly:!1}),this.actives.push(e)},deleteTranslator(e){this.translator.settings.splice(e,1),this.handleSave()},handleChange(e){for(const t of this.translators){const i=e.find(b=>b===t.id)!=null;t.__readonly=!i}},handleSave(){this.$emit("save")},translate(){me({space:this.space,service:this.service}).then(()=>{}).catch(e=>{this.$tip.apiFailed(e)})},__generateTranslatorName(){let e;for(;;)if(e=`translator${this.varIndex}`,this.varIndex++,this.translators.findIndex(t=>t.name===e)===-1)return e}}},le=e=>(L("data-v-5e8b20a7"),e=e(),Q(),e),yt={class:"translator-setting"},Vt={class:"toolbar"},Ct={class:"opera"},kt={class:"title-wrap"},St={key:0,class:"view"},Tt={class:"name"},It={class:"path"},wt={class:"type"},Rt={key:1,class:"edit"},Ft={class:"opera"},Nt=le(()=>r("p",{class:"code"},[r("em",{class:"keyword"},"function"),k(),r("em",null,"translate"),k(" ("),r("em",null,"filepath"),k(", "),r("em",null,"content"),k(", "),r("em",null,"fileSetting"),k(") {")],-1)),$t=le(()=>r("p",null,"}",-1));function Dt(e,t,i,b,a,s){const c=o("el-button"),d=o("el-input"),f=o("el-form-item"),C=o("TranslatorTypeSelect"),I=o("el-form"),h=o("el-collapse-item"),w=o("el-collapse"),T=o("Empty");return u(),v("div",yt,[r("div",Vt,[r("p",null,p(e.$t("service.settings.translator.translatorTip")),1),r("div",Ct,[l(c,{type:"primary",onClick:s.add},{default:n(()=>[k(p(e.$t("common.add")),1)]),_:1},8,["onClick"]),l(c,{type:"primary",onClick:s.translate},{default:n(()=>[k(p(e.$t("service.settings.translator.translate")),1)]),_:1},8,["onClick"])])]),s.translators.length>0?(u(),V(w,{key:0,modelValue:a.actives,"onUpdate:modelValue":t[4]||(t[4]=_=>a.actives=_),onChange:s.handleChange},{default:n(()=>[(u(!0),v(D,null,E(s.translators,(_,g)=>(u(),V(h,{key:_.id,name:_.id},{title:n(()=>[r("div",kt,[_.__readonly?(u(),v("div",St,[r("p",Tt,p(_.name),1),r("p",It,p(_.path),1),r("p",wt,p(_.type),1)])):(u(),v("div",Rt,[l(I,{model:_},{default:n(()=>[l(f,{label:e.$t("common.name"),required:""},{default:n(()=>[l(d,{class:"name",modelValue:_.name,"onUpdate:modelValue":y=>_.name=y,onClick:t[0]||(t[0]=A(()=>{},["stop"])),onKeypress:t[1]||(t[1]=A(()=>{},["stop"])),onInput:s.handleSave},null,8,["modelValue","onUpdate:modelValue","onInput"])]),_:2},1032,["label"]),l(f,{label:e.$t("service.settings.translator.path"),required:""},{default:n(()=>[l(d,{class:"path",modelValue:_.path,"onUpdate:modelValue":y=>_.path=y,onClick:t[2]||(t[2]=A(()=>{},["stop"])),onKeypress:t[3]||(t[3]=A(()=>{},["stop"])),onInput:s.handleSave},null,8,["modelValue","onUpdate:modelValue","onInput"])]),_:2},1032,["label"]),l(f,{label:e.$t("service.settings.translator.type"),required:""},{default:n(()=>[l(C,{class:"type",modelValue:_.type,"onUpdate:modelValue":y=>_.type=y,onChange:s.handleSave},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:2},1032,["label"])]),_:2},1032,["model"])])),r("div",Ft,[l(c,{icon:"Delete",onClick:A(y=>s.deleteTranslator(g),["stop"])},{default:n(()=>[k("Delete")]),_:2},1032,["onClick"])])])]),default:n(()=>[_.type==="pattern"?(u(),V(I,{key:0},{default:n(()=>[l(f,{label:"Source",required:""},{default:n(()=>[l(d,{modelValue:_.source,"onUpdate:modelValue":y=>_.source=y,type:"textarea",rows:1,onInput:s.handleSave},null,8,["modelValue","onUpdate:modelValue","onInput"])]),_:2},1024),l(f,{label:"Target",required:""},{default:n(()=>[l(d,{modelValue:_.target,"onUpdate:modelValue":y=>_.target=y,type:"textarea",rows:1,onInput:s.handleSave},null,8,["modelValue","onUpdate:modelValue","onInput"])]),_:2},1024)]),_:2},1024)):_.type==="code"?(u(),v(D,{key:1},[Nt,l(d,{modelValue:_.code,"onUpdate:modelValue":y=>_.code=y,type:"textarea",rows:5,onInput:s.handleSave},null,8,["modelValue","onUpdate:modelValue","onInput"]),$t],64)):R("",!0)]),_:2},1032,["name"]))),128))]),_:1},8,["modelValue","onChange"])):(u(),V(T,{key:1}))])}const At=F(gt,[["render",Dt],["__scopeId","data-v-5e8b20a7"]]),zt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAAAXNSR0IArs4c6QAAB0JJREFUeF7tm2tsFFUUx88utFJaSq1bWRCktEsfi1jwBTEmQoS0Pggl4iORFv1AmgghCCoSE6AEQ9BgAJWkwocCfvARU0wlloChTdQoStoG05ctbnm5WCQttGUpsGvOlLPcTmd2zp2d2ULofKHMzN6553fP+Z9z751xwF1+OO5y+2EYwLAH3OUELA+B1wsemoNMgxCcE4LQ08TXAY4a+ntfVcPG24W7ZQCKC7xo1AauYSEIVSOUoYYRNYCigtyjDnAoo45HUuL1utyM3q5pWb2+lDHX82Z6L3XWNiSn4LWfjyd3dVyM8/nOJixVgSp1grO6vOrPai5Aq+6LCoBovPu+q743FvvTczJ6eH1zQPWGHVPaVTBKY+0RpgBgnAcheBQtRcO3vtuWzrNa+65Pv5hY8/uJ5LBeAEDMQJgCUFzgDaEpj0+/VLNiyRmx44MsbDqZCI1to6Hp5GjIyegNX180v2PQvRt2TtkreERMIEgDILEzMh4NrzjsAvxX7yic1w9BhFHbmFy35xs3dPeMnHHzd7aCkAJAxqPQfba+hTo4yL6Kw2lw4Eiacj7HE4Cp2UHI8jrBcS0AzX/FK+crD44O/w5BqD1CFRa2QZAFoLj+vCcv+ooW+nXjfular2LcmncCkDl9lK4H/PBVb0QQsYDABlBcMK0cILQ0Li7k37O50a1nFY3+gud74dlXbo1yJJEUQai9Yf93bt+RX1IJtuWewAeQ760FB8zgjv6ufXJ5IRIE1IXt5RNt0QQ+gJvKrxWvZCoK3payybAwvwvyXxsrRwAA2k4EYNtH/SGzrqQdxJrCLggsAGKZaycANFz0BDWEo8dS95Z/61aqSCc451pRObIAiBWf3QDQuB2br0FzS5ziAQhBPERh3FfVwOp/JFdkNSALAFPfyvX66s+JjZ2bAtDUOmpQKOBvCQJOqPZXNc7ltKd3DwsAVX5KXtcYFbFxSoFle3rgRrx+EWTUadIDvect35RVd7NYiiozsAG4xva1XuiK92DH925t0O0/iiCKoVENYASgpRFg+5b+u7SeJ4piNHpgCIAmPghgtqfL8/3xNODogN1hYFUoWA4AO0ZeIFMMaXkEZYRIwCnkzHqBIQDsGGoAesAHr7Z6Ssr6y9xIYUD1AN4XTShwAFBqNCuIbABoTFlJA1T+kQZGYYD3UkmMIrZyozkx5ADAZ639MNPn/++edDNeYBqAUTYYAMETgLfeuyGdFbgAovECFgCqA3avaoDgFQAKg0ixSTEtTo3fXtUJGY8oy4Os481i/SygbqB4bS4uss6R9QIpAKsLT3Vnj+tO4oaBFgSuMHJHn55h1gtYACgVPjPzYvvLT/gn40NlvEAMB+owgsie2jfII7AAOlgBShVoJLZqL6CMIFMiSwF4wBXwr3/xpLIWQF4g20kxJMgAmvWJy2d4btH8CwNmhEZxY0YMWQAoFVImoI7IhoJoAILAhVL1mqEZw6ldqg5lUiIbAAnh6pdO+bNTu8MrQrKhYDSK0V6XDQM2ANKB9HFXOtcV/h2WcrOhEK2her+XrQzZAPTCQNQDTm1gl+HYrliBctOhFAAKg+ULT9c/7L6cJxoTjR5YBUUEwNUBKQDizBDnBeqOD7Ue2A4ADY7kBS3nEmFbpVImRJwyWzXi6nZoFkrnOfWAlAdgw+QFuClaunjwpqgoipxS2SoYNPpZE3oABwIPWwAYeQFeHwpPoNF/4dEOqG66V1kusw0AeQEKzecljeGXI8TRjCUEMfZxyv7+lx5l+Y6TCaRDgIwkLRDnB2p3RgiVx12KR0RT4RmFCeV+HP0Fj3XEBoD4kgTNEvU6isJIcWl1rSC6PhqPB3mAbSFAhorb5duW6G+Xky6QN+D/1bs+RqOsvi6+f4DCt2bBrQ0USse2AxAFMVIoaBVMeI5mgbKzPnFGSW5Pz3AmACzb7gVbCiG9UaKNEy4EURuoTRGGCIeuo9F40IsX+LfaeDzXfD6p++MDDybFFICMHkQSSm4YaBkeBlV3f2fVby6crLF2jExnAXVnxR1kI1HUMpREEnWCDjyH8Y1H1vj+F6xI6PRgycQ/tmEZAGwsWghcD9C7zxkPncs+8aZw3d9yAEMNYdeRSYfq28bkc93fFgBqCFxhjHb0SfywHU76o+dZGgKiEWI4xAICFT8yo2+bBxAIEQLuLW4pbnUF+4C/M8J0i6+Pudt/rE3FeThL+cVmbfMA8SHiGyZP5XXWF80+N2A1iWmn5m37f51Q/1N9itKejOvbHgKR0iResyIsNlVk+M/+O0pZoebM/LQIxsQD9LQBz+dlXj604rnTs7ihgbVB3Zkx5PJKyTsCRpSafWMs5gCELIF/DvjCBGGMd12d5R3fOxIv5k7qvt78T2JK0OHw17cmXW07lzDWdz4hrCEy+V4vzIYEgNoj8Nsi8asThiZY9oXJkAPQCA/llNYHV3Z8VnNbAWCMvOW3DAOwHOkd1uCwB9xhA2Z5d/8H7+iCfQLjxHAAAAAASUVORK5CYII=";const Ut={name:"BasicSetting",components:{TranslatorList:At,BuildList:ft,DirectorySelect:W,DatabaseTypeSelect:X,CompilerSelect:B},props:{space:{required:!0},service:{required:!0},serviceType:{required:!0},serviceConfig:{}},data(){return{newCodespace:{changing:!1,value:""},originForm:null,form:{version:"",private:!1,receivable:!1,compiler:"",introduce:"",repository:"",supportedDatabases:[],tableFieldDefinitions:[],builds:[],unbuilds:[],prices:[{type:"free",value:0}],translator:{output:"",settings:[]},codespace:""}}},methods:{initData(){for(const e in this.form)this.form[e]=this.serviceConfig[e]||this.form[e];this.originForm=JSON.parse(JSON.stringify(this.form))},initialize(){this.form.codespace=this.newCodespace.value,te({space:this.space,name:this.service,...this.form}).then(()=>{this.newCodespace.changing=!1,this.$emit("initialized",this.form)}).catch(e=>{this.$tip.apiFailed(e)})},changePriceType(e){e==="free"&&(this.form.prices[0].value=0),this.saveConfig()},changeCodespace(){this.newCodespace.changing=!0,this.newCodespace.value=this.form.codespace},fetchConfig(e){M({codespace:e}).then(t=>{t!=null&&(this.form.version=t.version||this.form.version,this.form.introduce=t.introduce||this.form.introduce,this.form.compiler=t.compiler||this.form.compiler,this.form.prices=t.prices||this.form.prices,this.form.supportedDatabases=t.supportedDatabases||this.form.supportedDatabases,this.form.builds=t.builds||this.form.builds,this.form.unbuilds=t.unbuilds||this.form.unbuilds,this.form.translator=t.translator||this.form.translator)}).catch(t=>{this.$tip.apiFailed(t)})},saveConfig(){this.newCodespace.changing||G({space:this.space,service:this.service,...this.form,translator:{...this.form.translator,settings:this.form.translator.settings.filter(e=>e.type==="code"&&e.code.trim().length>0||e.type==="pattern"&&e.source.trim()!==""&&e.target.trim()!=="").map(e=>({name:e.name,path:e.path.trim().length===0?".*":e.path,type:e.type,source:e.type==="pattern"?e.source:"",target:e.type==="pattern"?e.target:"",code:e.type==="code"?e.code:""}))},builds:this.form.builds.map(e=>({name:e.name,type:e.type,content:e.contentType==="file"?e.__filepath:e.content,contentType:e.contentType})),unbuilds:this.form.unbuilds.map(e=>({name:e.name,type:e.type,content:e.contentType==="file"?e.__filepath:e.content,contentType:e.contentType}))}).then(()=>{this.originForm=JSON.parse(JSON.stringify(this.form))}).catch(e=>{this.$tip.apiFailed(e)})}},created(){this.initData()}},qt=e=>(L("data-v-82122fad"),e=e(),Q(),e),Bt={class:"basic-setting"},jt={class:"wrap"},Et=qt(()=>r("span",null,[r("img",{src:zt})],-1)),Mt={key:0,class:"codespace-wrap"},Wt={key:0,class:"opera-wrap"};function Ot(e,t,i,b,a,s){const c=o("el-input"),d=o("el-form-item"),f=o("CompilerSelect"),C=o("DatabaseTypeSelect"),I=o("el-radio-button"),h=o("el-radio-group"),w=o("el-input-number"),T=o("el-checkbox"),_=o("TranslatorList"),g=o("BuildList"),y=o("el-button"),S=o("DirectorySelect"),N=o("el-form");return u(),v("div",Bt,[r("div",jt,[l(N,{model:a.form},{default:n(()=>[l(d,{label:e.$t("service.settings.version"),prop:"version",required:""},{default:n(()=>[l(c,{modelValue:a.form.version,"onUpdate:modelValue":t[0]||(t[0]=m=>a.form.version=m),onInput:s.saveConfig},null,8,["modelValue","onInput"])]),_:1},8,["label"]),l(d,{label:e.$t("service.settings.compiler"),prop:"compiler",required:""},{default:n(()=>[l(f,{modelValue:a.form.compiler,"onUpdate:modelValue":t[1]||(t[1]=m=>a.form.compiler=m),onChange:s.saveConfig},null,8,["modelValue","onChange"])]),_:1},8,["label"]),l(d,{label:e.$t("service.settings.supportedDatabases"),prop:"supportedDatabases"},{default:n(()=>[l(C,{modelValue:a.form.supportedDatabases,"onUpdate:modelValue":t[2]||(t[2]=m=>a.form.supportedDatabases=m),onChange:s.saveConfig},null,8,["modelValue","onChange"])]),_:1},8,["label"]),l(d,{label:e.$t("service.settings.repository"),prop:"repository"},{default:n(()=>[l(c,{modelValue:a.form.repository,"onUpdate:modelValue":t[3]||(t[3]=m=>a.form.repository=m),onInput:s.saveConfig},null,8,["modelValue","onInput"])]),_:1},8,["label"]),l(d,{label:e.$t("service.settings.introduce"),prop:"introduce",required:""},{default:n(()=>[l(c,{type:"textarea",rows:5,modelValue:a.form.introduce,"onUpdate:modelValue":t[4]||(t[4]=m=>a.form.introduce=m),onInput:s.saveConfig},null,8,["modelValue","onInput"])]),_:1},8,["label"]),l(d,{label:e.$t("service.settings.charge"),prop:"prices[0].type",required:""},{default:n(()=>[l(h,{modelValue:a.form.prices[0].type,"onUpdate:modelValue":t[5]||(t[5]=m=>a.form.prices[0].type=m),onChange:s.changePriceType},{default:n(()=>[(u(!0),v(D,null,E(e.$const.getServiceLeaseTypes(e.$t),m=>(u(),V(I,{key:m.code,label:m.code},{default:n(()=>[k(p(m.label),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue","onChange"])]),_:1},8,["label"]),a.form.prices[0].type!=="free"?(u(),V(d,{key:0,label:"Price",prop:"prices[0].value",class:"item-price",required:""},{default:n(()=>[Et,l(w,{controls:!1,modelValue:a.form.prices[0].value,"onUpdate:modelValue":t[6]||(t[6]=m=>a.form.prices[0].value=m),onInput:s.saveConfig},null,8,["modelValue","onInput"])]),_:1})):R("",!0),l(d,{label:e.$t("service.settings.otherSettings"),class:"item-other-settings"},{default:n(()=>[r("div",null,[l(T,{modelValue:a.form.private,"onUpdate:modelValue":t[7]||(t[7]=m=>a.form.private=m),label:"Is a private service",onChange:s.saveConfig},null,8,["modelValue","onChange"])])]),_:1},8,["label"]),l(d,{label:e.$t("service.settings.translator.translator"),prop:"translator"},{default:n(()=>[l(_,{space:i.space,service:i.service,translator:a.form.translator,onSave:s.saveConfig},null,8,["space","service","translator","onSave"])]),_:1},8,["label"]),l(d,{label:e.$t("service.settings.installBuilds"),prop:"builds"},{default:n(()=>[l(g,{builds:a.form.builds,"service-config":i.serviceConfig,onSave:s.saveConfig},null,8,["builds","service-config","onSave"])]),_:1},8,["label"]),l(d,{label:e.$t("service.settings.uninstallBuilds"),prop:"unbuilds"},{default:n(()=>[l(g,{builds:a.form.unbuilds,"with-unbuild":!0,"service-config":i.serviceConfig,onSave:s.saveConfig},null,8,["builds","service-config","onSave"])]),_:1},8,["label"]),l(d,{label:e.$t("service.settings.codespace"),prop:"codespace"},{default:n(()=>[a.newCodespace.changing?(u(),V(S,{key:1,title:e.$t("service.settings.selectNewCodespace"),modelValue:a.newCodespace.value,"onUpdate:modelValue":t[8]||(t[8]=m=>a.newCodespace.value=m),onChange:s.fetchConfig},null,8,["title","modelValue","onChange"])):(u(),v("div",Mt,[r("p",null,p(a.form.codespace),1),l(y,{type:"primary",onClick:s.changeCodespace},{default:n(()=>[k(p(e.$t("service.settings.changeCodespace")),1)]),_:1},8,["onClick"])]))]),_:1},8,["label"])]),_:1},8,["model"]),a.newCodespace.changing?(u(),v("div",Wt,[l(y,{size:"large",onClick:t[9]||(t[9]=m=>a.newCodespace.changing=!1)},{default:n(()=>[k(p(e.$t("common.cancel")),1)]),_:1}),l(y,{size:"large",type:"primary",onClick:s.initialize},{default:n(()=>[k(p(e.$t("service.settings.reinitialize")),1)]),_:1},8,["onClick"])])):R("",!0)])])}const Pt=F(Ut,[["render",Ot],["__scopeId","data-v-82122fad"]]),Lt={name:"PublishWindow",data(){return{visible:!1,isWorking:!1,space:null,service:null,form:{version:"",publishDescription:""}}},methods:{open(e,t){this.space=e,this.service=t,this.visible=!0,this.fetchConfig()},getRules(){return{version:[{required:!0,message:this.$t("form.isRequired",{value:this.$t("service.versionNumber")})},{validator:ge,message:this.$t("form.isIncorrect",{field:this.$t("service.versionNumber")})}],publishDescription:[{required:!0,message:this.$t("form.isRequired",{value:this.$t("service.versionDescription")})}]}},fetchConfig(){M({space:this.space,service:this.service}).then(e=>{this.form.version=e.version}).catch(e=>{this.$tip.apiFailed(e)})},saveConfig(){this.$refs.form.validate().then(()=>{G({space:this.space,service:this.service,version:this.form.version}).catch(e=>{this.$tip.apiFailed(e)})}).catch(()=>{})},publish(){this.isWorking||(this.isWorking=!0,be({space:this.space,service:this.service,publishDescription:this.form.publishDescription}).then(()=>{this.visible=!1}).catch(e=>{this.$tip.apiFailed(e)}).finally(()=>{this.isWorking=!1}))}}},Qt={class:"dialog-footer"};function xt(e,t,i,b,a,s){const c=o("el-input"),d=o("el-form-item"),f=o("el-form"),C=o("el-button"),I=o("el-dialog");return u(),V(I,{modelValue:a.visible,"onUpdate:modelValue":t[3]||(t[3]=h=>a.visible=h),class:"publish-window",title:e.$t("service.settings.publishVersion"),width:"500px",draggable:"","close-on-press-escape":!1,"close-on-click-modal":!1},{footer:n(()=>[r("span",Qt,[l(C,{onClick:t[2]||(t[2]=h=>a.visible=!1)},{default:n(()=>[k(p(e.$t("common.cancel")),1)]),_:1}),l(C,{type:"primary",disabled:a.isWorking,onClick:s.publish},{default:n(()=>[k(p(e.$t("service.settings.publish")),1)]),_:1},8,["disabled","onClick"])])]),default:n(()=>[l(f,{ref:"form",model:a.form,rules:s.getRules()},{default:n(()=>[l(d,{label:e.$t("service.versionNumber"),prop:"version",required:""},{default:n(()=>[l(c,{modelValue:a.form.version,"onUpdate:modelValue":t[0]||(t[0]=h=>a.form.version=h),onInput:s.saveConfig},{prefix:n(()=>[k("v")]),_:1},8,["modelValue","onInput"])]),_:1},8,["label"]),l(d,{label:e.$t("service.versionDescription"),prop:"publishDescription",required:""},{default:n(()=>[l(c,{type:"textarea",rows:5,modelValue:a.form.publishDescription,"onUpdate:modelValue":t[1]||(t[1]=h=>a.form.publishDescription=h)},null,8,["modelValue"])]),_:1},8,["label"])]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])}const Gt=F(Lt,[["render",xt]]);const Jt={name:"OptionSettingWindow",components:{OptionValueInput:_e},data(){return{visible:!1,option:null}},methods:{open(e){this.option=e,this.visible=!0},add(){this.option.settings.push({label:"",name:"",inputType:"input",required:!0,defaultValue:""})},deleteSetting(e){this.option.settings.splice(e,1),this.emitChange()},emitChange(){this.$emit("change")}}},Yt={class:"toolbar"};function Ht(e,t,i,b,a,s){const c=o("el-button"),d=o("el-input"),f=o("el-table-column"),C=o("el-option"),I=o("el-select"),h=o("el-switch"),w=o("OptionValueInput"),T=o("el-table"),_=o("el-dialog");return u(),V(_,{modelValue:a.visible,"onUpdate:modelValue":t[0]||(t[0]=g=>a.visible=g),title:"Option Settings","append-to-body":"","custom-class":"option-setting-window"},{default:n(()=>[r("div",Yt,[l(c,{icon:"Plus",type:"primary",onClick:s.add},{default:n(()=>[k("Add")]),_:1},8,["onClick"])]),l(T,{data:a.option.settings},{default:n(()=>[l(f,{prop:"label",label:"Label"},{default:n(({row:g})=>[l(d,{modelValue:g.label,"onUpdate:modelValue":y=>g.label=y,onInput:s.emitChange},null,8,["modelValue","onUpdate:modelValue","onInput"])]),_:1}),l(f,{prop:"name",label:"Name"},{default:n(({row:g})=>[l(d,{modelValue:g.name,"onUpdate:modelValue":y=>g.name=y,onInput:s.emitChange},null,8,["modelValue","onUpdate:modelValue","onInput"])]),_:1}),l(f,{prop:"inputType",label:"Input Type"},{default:n(({row:g})=>[l(I,{modelValue:g.inputType,"onUpdate:modelValue":y=>g.inputType=y,onChange:s.emitChange},{default:n(()=>[l(C,{value:"input",label:"Input"}),l(C,{value:"number_input",label:"Number Input"}),l(C,{value:"textarea",label:"Textarea"})]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),l(f,{prop:"required",label:"Input Type"},{default:n(({row:g})=>[l(h,{modelValue:g.required,"onUpdate:modelValue":y=>g.required=y},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),l(f,{prop:"defaultValue",label:"Default Value"},{default:n(({row:g})=>[l(w,{"option-setting":g,modelValue:g.defaultValue,"onUpdate:modelValue":y=>g.defaultValue=y,onInput:s.emitChange},null,8,["option-setting","modelValue","onUpdate:modelValue","onInput"])]),_:1}),l(f,{width:"60px"},{default:n(({row:g,$index:y})=>[l(c,{icon:"Delete",onClick:S=>s.deleteSetting(y)},null,8,["onClick"])]),_:1})]),_:1},8,["data"])]),_:1},8,["modelValue"])}const Kt=F(Jt,[["render",Ht]]),Xt={name:"VariableSettingForm",components:{OptionSettingWindow:Kt,SortableButton:H,VariableInput:J,CompilerSelect:B,InputTypeSelect:O},props:{variable:{required:!0},rootVariable:{required:!0},variableGroup:{default:!1}},computed:{withGroup(){return this.variableGroup!=null}},watch:{"variable.defaultValue":function(){this.handleFieldVariableValues(),this.handleChange()},"variable.name":function(){this.handleFieldVariableValues(),this.handleChange()}},methods:{handleChange(){this.$emit("change")},handleDefaultValueChange(){this.handleFieldVariableValues(),this.$emit("change")},handleFieldVariableValues(){if(this.rootVariable!==this.variable&&(this.rootVariable.inputType==="query_model"||this.rootVariable.inputType==="table"))for(const e of this.rootVariable.children)for(const t of e.defaultValue){t[this.variable.name]=this.variable.defaultValue;for(const i in t){if(i==="origin")continue;e.children.find(a=>a.name===i)==null&&!t.origin.hasOwnProperty(i)&&delete t[i]}}},createOption(){this.variable.options.push({value:"",label:"",remark:"",settings:[]})},deleteOption(e){this.variable.options.splice(e,1)},handleInputTypeChange(){let e=this.variable.defaultValue;if(e!=null&&e.value!=null&&(e=e.value),e instanceof Array&&(e=e[0]),typeof e=="number"&&(e=e+""),this.variable.inputType==="number_input"){let t=Number(parseInt(e));isNaN(t)&&(t=0),this.variable.defaultValue=t}else if(this.variable.inputType==="select"){const t=this.variable.options.find(i=>i.value===e);this.variable.defaultValue={value:t==null?null:e,settings:t==null?[]:t.settings}}else this.variable.inputType==="checkbox"?this.variable.defaultValue=[]:this.variable.inputType==="radio"?this.variable.defaultValue="":this.variable.inputType==="datasource"||this.variable.inputType==="table"||this.variable.inputType==="query_model"?this.variable.defaultValue=null:this.variable.defaultValue=e;this.handleChange()},handleOptionSorted(e){this.variable.options=[],this.$nextTick(()=>{this.variable.options=e,this.handleChange()})}}},Zt={class:"opera"};function el(e,t,i,b,a,s){const c=o("el-input"),d=o("el-form-item"),f=o("InputTypeSelect"),C=o("el-button"),I=o("SortableButton"),h=o("el-table-column"),w=o("el-table"),T=o("OptionSettingWindow"),_=o("VariableInput"),g=o("el-switch"),y=o("CompilerSelect"),S=o("el-form"),N=x("sortable");return u(),V(S,{model:i.variable},{default:n(()=>[l(d,{label:e.$t("service.settings.variable.label"),required:""},{default:n(()=>[l(c,{modelValue:i.variable.label,"onUpdate:modelValue":t[0]||(t[0]=m=>i.variable.label=m),onInput:s.handleChange},null,8,["modelValue","onInput"])]),_:1},8,["label"]),l(d,{label:e.$t("service.settings.variable.name"),required:""},{default:n(()=>[l(c,{modelValue:i.variable.name,"onUpdate:modelValue":t[1]||(t[1]=m=>i.variable.name=m),onInput:s.handleChange},null,8,["modelValue","onInput"])]),_:1},8,["label"]),l(d,{label:e.$t("service.settings.variable.inputType"),required:""},{default:n(()=>[l(f,{modelValue:i.variable.inputType,"onUpdate:modelValue":t[2]||(t[2]=m=>i.variable.inputType=m),"with-group":s.withGroup,onChange:s.handleInputTypeChange},null,8,["modelValue","with-group","onChange"])]),_:1},8,["label"]),i.variable.inputType==="select"||i.variable.inputType==="checkbox"||i.variable.inputType==="radio"?(u(),V(d,{key:0,label:e.$t("service.settings.variable.options"),class:"item-options",required:""},{label:n(()=>[r("div",null,[r("label",null,p(e.$t("service.settings.variable.options")),1),r("div",Zt,[l(C,{type:"primary",onClick:s.createOption},{default:n(()=>[k(p(e.$t("common.add")),1)]),_:1},8,["onClick"])])])]),default:n(()=>[z((u(),V(w,{data:i.variable.options},{default:n(()=>[l(h,{width:"25px"},{default:n(()=>[l(I)]),_:1}),l(h,{label:"*"+e.$t("service.settings.variable.optionLabel"),"min-width":"200px"},{default:n(({row:m})=>[l(c,{modelValue:m.label,"onUpdate:modelValue":U=>m.label=U,type:"textarea",rows:1,onInput:s.handleChange},null,8,["modelValue","onUpdate:modelValue","onInput"])]),_:1},8,["label"]),l(h,{label:"*"+e.$t("service.settings.variable.optionValue"),"min-width":"120px"},{default:n(({row:m})=>[l(c,{modelValue:m.value,"onUpdate:modelValue":U=>m.value=U,onInput:s.handleChange},null,8,["modelValue","onUpdate:modelValue","onInput"])]),_:1},8,["label"]),l(h,{label:e.$t("common.remark"),"min-width":"150px"},{default:n(({row:m})=>[l(c,{modelValue:m.remark,"onUpdate:modelValue":U=>m.remark=U,type:"textarea",rows:1,onInput:s.handleChange},null,8,["modelValue","onUpdate:modelValue","onInput"])]),_:1},8,["label"]),i.variable.options.length>0?(u(),V(h,{key:0,"min-width":i.variable.inputType==="select"?"120px":"60px",fixed:"right"},{default:n(({row:m,$index:U})=>[i.variable.inputType==="select"?(u(),V(C,{key:0,icon:"Setting",class:"button-icon",onClick:ae=>e.$refs.optionSettingWindow.open(m)},null,8,["onClick"])):R("",!0),l(C,{icon:"Delete",class:"button-icon",onClick:ae=>s.deleteOption(U)},null,8,["onClick"])]),_:1},8,["min-width"])):R("",!0)]),_:1},8,["data"])),[[N,{data:i.variable.options,onChange:s.handleOptionSorted},"config"]]),l(T,{ref:"optionSettingWindow",onChange:s.handleChange},null,8,["onChange"])]),_:1},8,["label"])):R("",!0),l(d,{label:e.$t("service.settings.variable.defaultValue")},{default:n(()=>[l(_,{variable:i.variable,"value-key":"defaultValue",onChange:s.handleDefaultValueChange},null,8,["variable","onChange"])]),_:1},8,["label"]),l(d,{label:e.$t("service.settings.variable.required")},{default:n(()=>[l(g,{modelValue:i.variable.required,"onUpdate:modelValue":t[3]||(t[3]=m=>i.variable.required=m),onChange:s.handleChange},null,8,["modelValue","onChange"])]),_:1},8,["label"]),l(d,{label:e.$t("service.settings.variable.hidden")},{default:n(()=>[l(g,{modelValue:i.variable.hidden,"onUpdate:modelValue":t[4]||(t[4]=m=>i.variable.hidden=m),onChange:s.handleChange},null,8,["modelValue","onChange"])]),_:1},8,["label"]),i.variable.inputType!=="number_input"&&i.variable.inputType!=="table"&&i.variable.inputType!=="query_model"&&i.variable.inputType!=="datasource"&&i.rootVariable.inputType!=="query_model"&&i.rootVariable.inputType!=="table"?(u(),V(d,{key:1,label:e.$t("service.settings.variable.compiler")},{default:n(()=>[l(y,{modelValue:i.variable.compiler,"onUpdate:modelValue":t[5]||(t[5]=m=>i.variable.compiler=m),onChange:s.handleChange},null,8,["modelValue","onChange"])]),_:1},8,["label"])):R("",!0),l(d,{label:e.$t("common.remark")},{default:n(()=>[l(c,{modelValue:i.variable.remark,"onUpdate:modelValue":t[6]||(t[6]=m=>i.variable.remark=m),type:"textarea",rows:3,onInput:s.handleChange},null,8,["modelValue","onInput"])]),_:1},8,["label"])]),_:1},8,["model"])}const tl=F(Xt,[["render",el]]),ll={name:"VariableGroupSettingForm",components:{VariableInput:J,CompilerSelect:B,InputTypeSelect:O},props:{variable:{required:!0}},methods:{changeScope(){if(this.variable.type==="group")for(const e of this.variable.children)e.scope=this.variable.scope;this.handleChange()},handleChange(){this.$emit("change")}}};function al(e,t,i,b,a,s){const c=o("el-input"),d=o("el-form-item"),f=o("el-form");return u(),V(f,{model:i.variable},{default:n(()=>[l(d,{label:e.$t("service.settings.variable.groupLabel"),required:""},{default:n(()=>[l(c,{modelValue:i.variable.label,"onUpdate:modelValue":t[0]||(t[0]=C=>i.variable.label=C),onInput:s.handleChange},null,8,["modelValue","onInput"])]),_:1},8,["label"]),l(d,{label:e.$t("service.settings.variable.groupName"),required:""},{default:n(()=>[l(c,{modelValue:i.variable.name,"onUpdate:modelValue":t[1]||(t[1]=C=>i.variable.name=C),onInput:s.handleChange},null,8,["modelValue","onInput"])]),_:1},8,["label"])]),_:1},8,["model"])}const il=F(ll,[["render",al]]);const nl={name:"Variables",components:{VariableGroupSettingForm:il,VariableSettingForm:tl,VariableInput:J,I18nInput:ne,InputTypeSelect:O,CompilerSelect:B},props:{space:{required:!0},service:{required:!0}},data(){return{isWorking:{save:!1},timeout:{save:null},varIndex:1,groupIndex:1,currentVariable:null,currentGroup:null,currentRootVariable:null,variables:[],dragData:{target:null}}},methods:{selectVariable(e,t){this.currentVariable=null,this.$nextTick(()=>{this.currentVariable=e,this.currentGroup=null,this.currentRootVariable=null,t.level>2?(this.currentRootVariable=t.parent.parent.data,this.currentGroup=t.parent.data):t.level>1?(this.currentRootVariable=t.parent.data,t.parent.data.type==="group"&&(this.currentGroup=t.parent.data)):this.currentRootVariable=t.data})},createChild(e){if(e.type==="group"){this.createVariable(e);return}if(e.inputType==="query_model"){this.createGroup(e,"query_model_field");return}e.inputType==="table"&&this.createGroup(e,"table_field")},createVariable(e){const t=this.__generateVariableName(e==null?this.variables:e.children),i={id:Y(),type:"variable",name:t,label:t,inputType:"input",required:!1,hidden:!1,defaultValue:"",compiler:"static",remark:"",options:[]};e!=null?e.children.push(i):this.variables.push(i),this.saveVariables()},createGroup(e){const t=this.__generateGroupName(),i={id:Y(),type:"group",name:t,label:t,children:[]};e==null?this.variables.push(i):(e.children==null&&(e.children=[]),e.children.push(i)),this.currentVariable=i,this.saveVariables()},saveVariables(){this.timeout.save!=null&&clearTimeout(this.timeout.save),this.timeout.save=setTimeout(()=>{he({space:this.space,service:this.service,variables:this.getVariables()}).then(()=>{}).catch(e=>{this.$tip.apiFailed(e)}).finally(()=>{this.timeout.save=null})},1e3)},fetchVariables(){M({space:this.space,service:this.service}).then(e=>{this.variables=e.variables.map(t=>this.__getInitVariable(t))}).catch(e=>{this.$tip.apiFailed(e)})},getVariables(){return this.variables.filter(t=>t.name.trim().length>0&&t.label.trim().length>0).map(t=>this.__getSaveVariable(t))},deleteVariable(){const e=this.currentVariable.type==="variable"?"variable":"variable group";this.deleteConfirm(`Do you want to delete the ${e} named 「${this.currentVariable.name}」?`).then(()=>{if(this.currentRootVariable!==this.currentVariable&&(this.currentRootVariable.inputType==="query_model"||this.currentRootVariable.inputType==="table")){const i=this.currentGroup.children.findIndex(b=>b.id===this.currentVariable.id);if(i===-1)return;this.currentGroup.children.splice(i,1);for(const b of this.currentRootVariable.children)for(const a of b.defaultValue)for(const s in a){if(s==="origin")continue;b.children.find(d=>d.name===s)==null&&!a.origin.hasOwnProperty(s)&&delete a[s]}this.currentVariable=null,this.saveVariables();return}if(this.currentGroup!=null){const i=this.currentGroup.children.findIndex(b=>b.id===this.currentVariable.id);if(i===-1)return;this.currentGroup.children.splice(i,1),this.currentVariable=null,this.saveVariables();return}const t=this.variables.findIndex(i=>i.id===this.currentVariable.id);t!==-1&&(this.variables.splice(t,1),this.currentVariable=null,this.saveVariables())}).catch(()=>{})},handleDragStart(e){this.dragData.target=e.data},handleDrop(){this.saveVariables()},allowDrag(){return!0},allowDrop(e,t,i){return e.data.type==="variable"?!(t.data.type==="variable"&&i==="inner"):e.data.type==="group"?t.data.type!=="variable":!1},__getValidOptions(e){return e.filter(t=>t.value.trim().length>0&&t.label.trim().length>0)},__getInitVariable(e){const t=JSON.parse(JSON.stringify(e));return t.type==="group"?(t.children=t.children==null?[]:t.children.map(i=>(i.options=i.options==null?[]:i.options,this.__getInitVariable(i))),t):(t.options=t.options==null?[]:t.options,t.options.forEach(i=>{i.settings=i.settings==null?[]:i.settings}),t.inputType==="select"&&(JSON.stringify(t.defaultValue.settings)==="{}"||t.options.forEach(i=>{i.settings=i.settings.map(b=>({...b,value:t.defaultValue.settings[b.name]}))})),t)},__getSaveVariable(e){const t=JSON.parse(JSON.stringify(e));return t.type==="group"?(t.children=t.children.map(i=>this.__getSaveVariable(i)),t):t.inputType==="number_input"?(t.defaultValue=parseInt(t.defaultValue),t):t.inputType==="query_model"||t.inputType==="table"?(t.children!=null&&t.children.length>0&&(t.children=t.children.map(i=>(i.children=i.children.map(b=>this.__getSaveVariable(b)),i))),delete t.options,t):t.inputType==="select"?(t.options=this.__getValidOptions(t.options),t.options.forEach(i=>{i.settings=i.settings.filter(b=>b.name.trim()!==""&&b.label.trim()!=="")}),t.options.forEach(i=>{i.settings.forEach(b=>{delete b.value})}),t):t.inputType==="radio"||t.inputType==="checkbox"?(t.options=this.__getValidOptions(t.options),t.options.forEach(i=>{delete i.settings}),t):(delete t.options,t)},__generateVariableName(e){let t;for(;;)if(t=`var${this.varIndex}`,this.varIndex++,e.findIndex(i=>i.type==="variable"&&i.name===t)===-1)return t},__generateGroupName(){let e;for(;;)if(e=`group${this.groupIndex}`,this.groupIndex++,this.variables.findIndex(t=>t.type==="group"&&t.name===e)===-1)return e}},created(){this.fetchVariables()}},sl={class:"tree"},ol={class:"variables-wrap"},rl={class:"tools"},cl={class:"title"},ul={key:0,class:"opera"},dl={class:"variable-setting"},pl={class:"title"},ml={class:"content-wrap"},hl={key:1,class:"variable-holder"};function fl(e,t,i,b,a,s){const c=o("el-button"),d=o("el-tree"),f=o("VariableSettingForm"),C=o("VariableGroupSettingForm");return u(),v("div",sl,[r("div",ol,[r("div",rl,[l(c,{icon:"Plus",type:"primary",onClick:t[0]||(t[0]=I=>s.createVariable())},{default:n(()=>[k(p(e.$t("service.settings.variable.addVariable")),1)]),_:1}),l(c,{icon:"Plus",type:"primary",onClick:t[1]||(t[1]=I=>s.createGroup(null,"service"))},{default:n(()=>[k(p(e.$t("service.settings.variable.addGroup")),1)]),_:1})]),l(d,{ref:"tree",class:"variables","expand-on-click-node":!1,"default-expand-all":!0,"highlight-current":!0,data:a.variables,"node-key":"name",onNodeClick:s.selectVariable,draggable:"","allow-drop":s.allowDrop,"allow-drag":s.allowDrag,"empty-text":e.$t("service.settings.variable.noVariables"),onNodeDragStart:s.handleDragStart,onNodeDrop:s.handleDrop},{default:n(({node:I,data:h})=>[r("div",cl,[r("span",null,p(h.label),1),h.type==="group"||h.inputType==="query_model"||h.inputType==="table"?(u(),v("div",ul,[l(c,{class:"button-icon",icon:"Plus",size:"small",onClick:A(w=>s.createChild(h),["stop"])},null,8,["onClick"])])):R("",!0)])]),_:1},8,["data","onNodeClick","allow-drop","allow-drag","empty-text","onNodeDragStart","onNodeDrop"])]),r("div",dl,[r("div",pl,[r("h4",null,p(e.$t("service.settings.variable.variableSetting")),1),a.currentVariable!=null?(u(),V(c,{key:0,type:"danger",text:"",onClick:s.deleteVariable},{default:n(()=>[k("Delete")]),_:1},8,["onClick"])):R("",!0)]),r("div",ml,[a.currentVariable!=null?(u(),v(D,{key:0},[a.currentVariable.type==="variable"?(u(),V(f,{key:0,variable:a.currentVariable,"variable-group":a.currentGroup,"root-variable":a.currentRootVariable,onChange:s.saveVariables},null,8,["variable","variable-group","root-variable","onChange"])):R("",!0),a.currentVariable.type==="group"?(u(),V(C,{key:1,variable:a.currentVariable,onChange:s.saveVariables},null,8,["variable","onChange"])):R("",!0)],64)):(u(),v("div",hl,[r("h5",null,p(e.$t("service.settings.variable.variableHolderTitle")),1),r("p",null,p(e.$t("service.settings.variable.variableHolderTip")),1)]))])])])}const bl=F(nl,[["render",fl],["__scopeId","data-v-f74cae03"]]);const _l={name:"SpaceSettings",components:{MarkdownEditor:ee,HelpButton:se},props:{space:{required:!0}},data(){return{loading:!1,isWorking:!1,form:{id:null,name:"",withPrivate:!1,subServiceReceivable:!1,homepage:"",introduce:"",description:""},rules:{introduce:[{required:!0,message:"Please input space introduce"}],description:[{required:!0,message:"Please input space description"}]}}},methods:{fetchSpace(){this.loading||(this.loading=!0,ye(this.space).then(e=>{for(const t in this.form)this.form[t]=e[t]}).catch(e=>{this.$tip.apiFailed(e)}).finally(()=>{this.loading=!1}))},save(){this.$refs.form.validate().then(()=>{this.isWorking||(this.isWorking=!0,Ve(this.form).then(()=>{this.$tip.success(this.$t("common.saveSuccessfully"))}).catch(e=>{this.$tip.apiFailed(e)}).finally(()=>{this.isWorking=!1}))}).catch(()=>{})}},created(){this.fetchSpace()}},vl={class:"space-settings"},gl={class:"form-wrap"},yl={class:"opera"};function Vl(e,t,i,b,a,s){const c=o("el-form-item"),d=o("el-input"),f=o("el-checkbox"),C=o("el-form"),I=o("MarkdownEditor"),h=o("el-button"),w=x("loading");return u(),v("div",vl,[z((u(),v("div",gl,[l(C,{ref:"form",model:a.form,rules:a.rules},{default:n(()=>[l(c,{label:e.$t("space.spaceName"),prop:"name"},{default:n(()=>[r("h3",null,p(a.form.name),1)]),_:1},8,["label"]),l(c,{label:e.$t("space.homePage"),prop:"homepage"},{default:n(()=>[l(d,{modelValue:a.form.homepage,"onUpdate:modelValue":t[0]||(t[0]=T=>a.form.homepage=T)},null,8,["modelValue"])]),_:1},8,["label"]),l(c,{label:e.$t("common.introduce"),prop:"introduce",required:""},{default:n(()=>[l(d,{modelValue:a.form.introduce,"onUpdate:modelValue":t[1]||(t[1]=T=>a.form.introduce=T),type:"textarea",rows:3,maxlength:"200"},null,8,["modelValue"])]),_:1},8,["label"]),l(c,{label:e.$t("space.otherSettings"),class:"item-other-settings"},{default:n(()=>[r("div",null,[l(f,{modelValue:a.form.withPrivate,"onUpdate:modelValue":t[2]||(t[2]=T=>a.form.withPrivate=T),label:e.$t("space.isPrivateServiceTip")},null,8,["modelValue","label"])]),r("div",null,[l(f,{modelValue:a.form.subServiceReceivable,"onUpdate:modelValue":t[3]||(t[3]=T=>a.form.subServiceReceivable=T),label:e.$t("space.receiveSubServicesTip")},null,8,["modelValue","label"])])]),_:1},8,["label"])]),_:1},8,["model","rules"]),l(C,{ref:"descForm",class:"description-form",model:a.form},{default:n(()=>[l(c,{label:e.$t("space.spaceDescriptionLabel"),prop:"description",required:""},{default:n(()=>[l(I,{modelValue:a.form.description,"onUpdate:modelValue":t[4]||(t[4]=T=>a.form.description=T),placeholder:e.$t("space.spaceDescription")},null,8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1},8,["model"])])),[[w,a.loading]]),r("div",yl,[l(h,{type:"primary",size:"large",disabled:a.isWorking,onClick:s.save},{default:n(()=>[k(p(e.$t("common.save")),1)]),_:1},8,["disabled","onClick"])])])}const Cl=F(_l,[["render",Vl],["__scopeId","data-v-9a6ebe82"]]);const kl={name:"SystemVariableTable",data(){return{variableData:{date:[{name:"_yyyy",enRemark:"",zhRemark:"年（固定4位）",demo:"${_yyyy} => 1993"},{name:"_MM",enRemark:"",zhRemark:"月（固定2位）",demo:"${_MM} => 08"},{name:"_dd",enRemark:"",zhRemark:"日前（固定2位）",demo:"${_dd} => 13"},{name:"_hh",enRemark:"",zhRemark:"时（固定2位）",demo:"${_hh} => 00"},{name:"_mm",enRemark:"",zhRemark:"分（固定2位）",demo:"${_mm} => 00"},{name:"_ss",enRemark:"",zhRemark:"秒（固定2位）",demo:"${_ss} => 00"},{name:"_sss",enRemark:"",zhRemark:"毫秒（固定3位）",demo:"${_sss} => 000"}],mysqlTable:[{name:"name",enRemark:"",zhRemark:"原始表名",demo:"${myTable.name} => MY_TABLE"},{name:"camelCaseName",enRemark:"",zhRemark:"表名（驼峰命名法）",demo:"${myTable.camelCaseName} => myTables"},{name:"kebabCaseName",enRemark:"",zhRemark:"表名（中划线命名法）",demo:"${myTable.kebabCaseName} => my-table"},{name:"pascalCaseName",enRemark:"",zhRemark:"表名（帕斯卡命名法）",demo:"${myTable.pascalCaseName} => MyTable"},{name:"underScoreCaseName",enRemark:"",zhRemark:"表名（下划线命名法）",demo:"${myTable.underScoreCaseName} => my_table"},{name:"comment",enRemark:"",zhRemark:"表注释",demo:"${myTable.comment}"},{name:"fields",enRemark:"",zhRemark:"表字段数组",type:"Array",demo:`<#list myTable.fields as field>
\${field.name}
</#list>`},{name:"fields.name",enRemark:"",zhRemark:"字段原始名称",type:"String",demo:`<#list myTable.fields as field>
\${field.name}
</#list>`},{name:"fields.camelCaseName",enRemark:"",zhRemark:"字段名称（驼峰命名法）",type:"String",demo:`<#list myTable.fields as field>
\${field.camelCaseName}
</#list>`},{name:"fields.kebabCaseName",enRemark:"",zhRemark:"字段名称（中划线命名法）",type:"String",demo:`<#list myTable.fields as field>
\${field.kebabCaseName}
</#list>`},{name:"fields.pascalCaseName",enRemark:"",zhRemark:"字段名称（帕斯卡命名法）",type:"String",demo:`<#list myTable.fields as field>
\${field.pascalCaseName}
</#list>`},{name:"fields.underScoreCaseName",enRemark:"",zhRemark:"字段名称（下划线命名法）",type:"String",demo:`<#list myTable.fields as field>
\${field.underScoreCaseName}
</#list>`},{name:"fields.type",enRemark:"",zhRemark:"数据库字段类型",type:"String",demo:`<#list myTable.fields as field>
\${field.type}
</#list>`},{name:"fields.length",enRemark:"",zhRemark:"数据库字段类型长度",type:"Integer",demo:`<#list myTable.fields as field>
\${field.length}
</#list>`},{name:"fields.decimal",enRemark:"",zhRemark:"数据库字段类型精度",type:"Integer",demo:`<#list myTable.fields as field>
\${field.decimal}
</#list>`},{name:"fields.defaultValue",enRemark:"",zhRemark:"字段默认值",type:"Any",demo:`<#list myTable.fields as field>
\${field.defaultValue}
</#list>`},{name:"fields.required",enRemark:"",zhRemark:"是否必填",type:"Boolean",demo:`<#list myTable.fields as field>
\${field.required}
</#list>`},{name:"fields.isPrimaryKey",enRemark:"",zhRemark:"是否为主键",type:"Boolean",demo:`<#list myTable.fields as field>
\${field.isPrimaryKey}
</#list>`},{name:"fields.isAutoIncrement",enRemark:"",zhRemark:"是否为自增长",type:"Boolean",demo:`<#list myTable.fields as field>
\${field.isAutoIncrement}
</#list>`},{name:"fields.comment",enRemark:"",zhRemark:"字段注释",type:"Boolean",demo:`<#list myTable.fields as field>
\${field.comment}
</#list>`}],mysqlQueryModel:[{name:"name",enRemark:"",zhRemark:"模型原始名称",demo:"${myModel.name}"},{name:"camelCaseName",enRemark:"",zhRemark:"模型名称（驼峰命名法）",demo:"${myModel.camelCaseName}"},{name:"kebabCaseName",enRemark:"",zhRemark:"模型名称（中划线命名）",demo:"${myModel.kebabCaseName}"},{name:"pascalCaseName",enRemark:"",zhRemark:"模型名称（帕斯卡命名）",demo:"${myModel.pascalCaseName}"},{name:"underScoreCaseName",enRemark:"",zhRemark:"模型名称（下划线命名）",demo:"${myModel.underScoreCaseName}"},{name:"comment",enRemark:"",zhRemark:"模型注释",demo:"${myModel.comment}"},{name:"mainTable",enRemark:"",zhRemark:"主表，包含了MySQL表的所有信息",demo:"${myModel.mainTable.name} => 主表名称\n${myModel.mainTable.camelCaseName} => 主表名称（驼峰命名法）"},{name:"mainTable.alias",enRemark:"",zhRemark:"主表别名",demo:"${myModel.mainTable.alias}"},{name:"mainTable.isVirtual",enRemark:"",zhRemark:"是否为虚拟表",demo:"${myModel.mainTable.isVirtual}"},{name:"subTables",enRemark:"",zhRemark:"子表，包含了MySQL表的所有信息",type:"Array",demo:`<#list myModel.subTables as subTable>
\${subTable.name}
</#list>`},{name:"subTables.alias",enRemark:"",zhRemark:"子表别名",type:"Array",demo:`<#list myModel.subTables as subTable>
\${subTable.alias}
</#list>`},{name:"subTables.isVirtual",enRemark:"",zhRemark:"子表是否为虚拟表",type:"Array",demo:`<#list myModel.subTables as subTable>
\${subTable.isVirtual}
</#list>`},{name:"joins",enRemark:"",zhRemark:"关联信息",demo:`<#list myModel.joins as join>
\${join.joinType}
</#list>`},{name:"joins.table",enRemark:"",zhRemark:"左表",demo:`<#list myModel.joins as join>
\${join.table.alias}
</#list>`},{name:"joins.targetTable",enRemark:"",zhRemark:"右表",demo:`<#list myModel.joins as join>
\${join.targetTable.alias}
</#list>`},{name:"joins.joinType",enRemark:"",zhRemark:"JOIN类型",demo:`<#list myModel.joins as join>
\${join.joinType}
</#list>`},{name:"joins.ons",enRemark:"",zhRemark:"JOIN ON条件",demo:`<#list myModel.joins as join>
  <#list join.ons as on>
    \${on.field.alias} => 字段别名
  </#list>
</#list>`},{name:"joins.ons.field",enRemark:"",zhRemark:"左侧字段",demo:`<#list myModel.joins as join>
  <#list join.ons as on>
    \${on.field.name}
  </#list>
</#list>`},{name:"joins.ons.targetField",enRemark:"",zhRemark:"右侧字段",demo:`<#list myModel.joins as join>
  <#list join.ons as on>
    \${on.targetField.name}
  </#list>
</#list>`},{name:"joins.ons.relation",enRemark:"",zhRemark:"ON关系，AND或者OR",demo:`<#list myModel.joins as join>
  <#list join.ons as on>
    \${on.relation}
  </#list>
</#list>`},{name:"aggregates",enRemark:"",zhRemark:"聚合信息，内容待定",demo:""},{name:"sql",enRemark:"",zhRemark:"各个部分的SQL语句",demo:`<#list myModel.sql.fields as field>
\${field}
</#list>

<#list myModel.sql.joins as joinSql>
\${joinSql}
</#list>

\${myModel.sql.where} => where sql
\${myModel.sql.orderBy} => order by sql`}],select:[{name:"mySelect",enRemark:"",zhRemark:"选项值",type:"Any",demo:"${mySelect}"},{name:"mySelectSetting",enRemark:"",zhRemark:"select深度设置内容",type:"Object",demo:"${mySelectSetting.myField}"}]}}}},q=e=>(L("data-v-c27c6897"),e=e(),Q(),e),Sl={class:"variable-block"},Tl=q(()=>r("h3",null,"日期相关",-1)),Il={class:"variable-block"},wl=q(()=>r("h3",null,"MySQL表相关",-1)),Rl=q(()=>r("p",null,"定义变量且输入类型为Table，则可以通过变量名访问以下信息！",-1)),Fl={class:"variable-block"},Nl=q(()=>r("h3",null,"MySQL查询模型相关",-1)),$l=q(()=>r("p",null,"定义变量且输入类型为Query Model，则可以通过变量名访问以下信息！",-1)),Dl={class:"variable-block"},Al=q(()=>r("h3",null,"Select输入类型的深度设置",-1)),zl=q(()=>r("p",null,'定义变量且输入类型为Select，则可以通过变量名添加"Settings"后缀来获取深度设置对象！',-1));function Ul(e,t,i,b,a,s){const c=o("el-table-column"),d=o("el-table");return u(),v(D,null,[r("div",Sl,[Tl,l(d,{data:a.variableData.date},{default:n(()=>[l(c,{label:"变量名",width:"200px",prop:"name"}),l(c,{label:"变量备注",width:"300px",prop:"zhRemark"}),l(c,{label:"示例",prop:"demo"},{default:n(({row:f})=>[r("pre",null,p(f.demo),1)]),_:1})]),_:1},8,["data"])]),r("div",Il,[wl,Rl,l(d,{data:a.variableData.mysqlTable},{default:n(()=>[l(c,{label:"变量名",width:"235px",prop:"name"}),l(c,{label:"变量备注",width:"300px",prop:"zhRemark"}),l(c,{label:"示例",prop:"demo"},{default:n(({row:f})=>[r("pre",null,p(f.demo),1)]),_:1})]),_:1},8,["data"])]),r("div",Fl,[Nl,$l,l(d,{data:a.variableData.mysqlQueryModel},{default:n(()=>[l(c,{label:"变量名",width:"235px",prop:"name"}),l(c,{label:"变量备注",width:"300px",prop:"zhRemark"}),l(c,{label:"示例",prop:"demo"},{default:n(({row:f})=>[r("pre",null,p(f.demo),1)]),_:1})]),_:1},8,["data"])]),r("div",Dl,[Al,zl,l(d,{data:a.variableData.select},{default:n(()=>[l(c,{label:"变量名",width:"235px",prop:"name"}),l(c,{label:"变量备注",width:"300px",prop:"zhRemark"}),l(c,{label:"示例",prop:"demo"},{default:n(({row:f})=>[r("pre",null,p(f.demo),1)]),_:1})]),_:1},8,["data"])])],64)}const ql=F(kl,[["render",Ul],["__scopeId","data-v-c27c6897"]]);const Bl={components:{SystemVariableTable:ql,ServiceCodeErrorWindow:ve,SpaceSettings:Cl,MarkdownEditor:ee,Variables:bl,PublishWindow:Gt,BasicSetting:Pt,InitializeView:We,DirectorySelect:W,SettingFiles:ze},data(){return{isWorking:{compile:!1,cleanCompile:!1},route:{space:"",service:""},loading:!0,currentTab:"basic",service:null,serviceConfig:null}},computed:{...oe(["currentProject","currentProjectDetail","currentDatabase","installData"]),initialized(){return this.serviceConfig!=null&&this.serviceConfig.version!=null},compileTip(){return this.currentProjectDetail!=null?this.$t("service.settings.compileTipWithProject",{project:this.currentProjectDetail.name}):this.$t("service.settings.compileTip")},cleanCompileTip(){return this.currentProjectDetail!=null?this.$t("service.settings.cleanCompileTipWithProject",{project:this.currentProjectDetail.name}):this.$t("service.settings.cleanCompileTip")}},methods:{...re(["setInstallData"]),saveConfig(){G({...this.route,readme:this.service.description}).then(()=>{}).catch(e=>{this.$tip.apiFailed(e)})},fetchProfile(){this.loading=!0,fe({spaceName:this.route.space,serviceName:this.route.service}).then(e=>{this.service=e}).then(()=>M({space:this.route.space,service:this.route.service})).then(e=>{e!=null&&(this.serviceConfig=e,this.service.description=e.readme)}).catch(e=>{this.$tip.apiFailed(e)}).finally(()=>{this.loading=!1})},compile(){this.isWorking.compile||this.currentProject==null||this.currentProject===""||(this.isWorking.compile=!0,ce({...this.route,serviceType:this.service.type,projectId:this.currentProject,database:this.currentDatabase,variables:this.$refs.variables.getVariables()}).then(e=>{this.setInstallData(e),this.$tip.success("Compile successfully.")}).catch(e=>{if(e.code===6e3){this.$refs.serviceCodeErrorWindow.open(e.errorData);return}this.$tip.apiFailed(e)}).finally(()=>{this.isWorking.compile=!1}))},cleanCompile(){this.isWorking.cleanCompile||this.currentProject==null||this.currentProject===""||(this.isWorking.cleanCompile=!0,ue({...this.route,projectId:this.currentProject,database:this.currentDatabase,variables:this.$refs.variables.getVariables()}).then(e=>{this.$tip.success("Clean Compile successfully."),this.setInstallData(e)}).catch(e=>{if(e.code===6e3){this.$refs.serviceCodeErrorWindow.open(e.errorData);return}this.$tip.apiFailed(e)}).finally(()=>{this.isWorking.cleanCompile=!1}))}},created(){this.route.space=this.$route.query.space,this.route.service=this.$route.query.service,this.fetchProfile()}},jl={class:"wrap"},El={class:"header-wrap"},Ml={class:"header"},Wl={key:0,class:"opera"},Ol={key:0,class:"text-info-1 service-path"},Pl={class:"main"},Ll={class:"tabs"},Ql={class:"tab-content"};function xl(e,t,i,b,a,s){const c=o("el-button"),d=o("el-popover"),f=o("SpaceSettings"),C=o("BasicSetting"),I=o("MarkdownEditor"),h=o("Variables"),w=o("SettingFiles"),T=o("SystemVariableTable"),_=o("InitializeView"),g=o("PublishWindow"),y=o("ServiceCodeErrorWindow"),S=x("loading");return a.service!=null?z((u(),v("div",{key:0,class:$(["page",{"page-un-initialize":!s.initialized}])},[r("div",jl,[r("div",El,[r("div",Ml,[r("h2",null,p(a.service.space.name)+"·"+p(a.service.name),1),s.initialized?(u(),v("div",Wl,[l(d,{placement:"top-start",title:e.$t("service.settings.compileTipTitle"),width:200,trigger:"hover",content:s.compileTip},{reference:n(()=>[l(c,{type:"primary",class:$({"is-disabled":e.currentProject==null||a.isWorking.compile}),onClick:s.compile},{default:n(()=>[k(p(e.$t("service.settings.compile")),1)]),_:1},8,["class","onClick"])]),_:1},8,["title","content"]),l(d,{placement:"top-start",title:e.$t("service.settings.cleanCompileTipTitle"),width:200,trigger:"hover",content:s.cleanCompileTip},{reference:n(()=>[l(c,{type:"primary",class:$({"is-disabled":e.currentProject==null||a.isWorking.cleanCompile}),onClick:s.cleanCompile},{default:n(()=>[k(p(e.$t("service.settings.cleanCompile")),1)]),_:1},8,["class","onClick"])]),_:1},8,["title","content"]),l(c,{type:"important",onClick:t[0]||(t[0]=N=>e.$refs.publishWindow.open(a.route.space,a.route.service))},{default:n(()=>[k(p(e.$t("service.settings.publish")),1)]),_:1})])):R("",!0)]),s.initialized?(u(),v("p",Ol,p(e.$t("service.settings.at"))+" "+p(a.service.local.codespace),1)):R("",!0)]),r("div",Pl,[s.initialized?(u(),v(D,{key:0},[r("ul",Ll,[r("li",{class:$({selected:a.currentTab==="space"}),onClick:t[1]||(t[1]=N=>a.currentTab="space")},p(e.$t("service.settings.space")),3),r("li",{class:$({selected:a.currentTab==="basic"}),onClick:t[2]||(t[2]=N=>a.currentTab="basic")},p(e.$t("service.settings.service")),3),r("li",{class:$({selected:a.currentTab==="readme"}),onClick:t[3]||(t[3]=N=>a.currentTab="readme")},p(e.$t("service.settings.readme")),3),r("li",{class:$({selected:a.currentTab==="variables"}),onClick:t[4]||(t[4]=N=>a.currentTab="variables")},p(e.$t("service.settings.variables")),3),r("li",{class:$({selected:a.currentTab==="files"}),onClick:t[5]||(t[5]=N=>a.currentTab="files")},p(e.$t("service.settings.files")),3),r("li",{class:$({selected:a.currentTab==="system_variables"}),onClick:t[6]||(t[6]=N=>a.currentTab="system_variables")},p(e.$t("service.settings.systemVariables")),3)]),r("div",Ql,[z(l(f,{space:a.route.space},null,8,["space"]),[[j,a.currentTab==="space"]]),z(l(C,{space:a.route.space,service:a.route.service,"service-type":a.service.type,"service-config":a.serviceConfig},null,8,["space","service","service-type","service-config"]),[[j,a.currentTab==="basic"]]),a.service.description!=null?z((u(),V(I,{key:0,modelValue:a.service.description,"onUpdate:modelValue":[t[7]||(t[7]=N=>a.service.description=N),s.saveConfig],placeholder:e.$t("service.settings.serviceReadmeHolder")},null,8,["modelValue","placeholder","onUpdate:modelValue"])),[[j,a.currentTab==="readme"]]):R("",!0),z(l(h,{ref:"variables",space:a.route.space,service:a.route.service},null,8,["space","service"]),[[j,a.currentTab==="variables"]]),z(l(w,{space:a.route.space,service:a.route.service},null,8,["space","service"]),[[j,a.currentTab==="files"]]),a.currentTab==="system_variables"?(u(),V(T,{key:1})):R("",!0)])],64)):(u(),V(_,{key:1,"space-name":a.service.space.name,"service-name":a.service.name,onInitialized:s.fetchProfile},null,8,["space-name","service-name","onInitialized"]))])]),l(g,{ref:"publishWindow"},null,512),l(y,{ref:"serviceCodeErrorWindow"},null,512)],2)),[[S,a.loading]]):R("",!0)}const Zl=F(Bl,[["render",xl],["__scopeId","data-v-92b6fa5a"]]);export{Zl as default};
