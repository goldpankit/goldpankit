import{z as h,_ as b,L as k,s as x,v as I,x as O,r as m,o as P,c as w,a as s,b as t,w as l,k as v,t as f,e as a,p as V,l as y}from"./index-8656c7f4.js";import{a as C}from"./js.cookie-edb2da2a.js";function D(e){return h.post("/usr/regis/mobile",e,{baseURL:"/remote-api"})}function B(e){return h.post("/usr/regis/mobile/otp-code",e,{baseURL:"/remote-api"})}const E={components:{Logo:k},data(){return{isWorking:{regis:!1,sendOTP:!1},errorTip:"",form:{nickname:"",username:"",password:"",otpElement:"",otpCodeId:null,otpCode:""},sendOTPData:{time:60,buttonText:"发送验证码"}}},computed:{disabledSendOTPButton(){return this.isWorking.sendOTP||this.form.nickname.trim()===""||this.form.otpElement.trim()===""?!0:!/^1[3456789]\d{9}$/.test(this.form.otpElement)},disabledRegisButton(){return this.isWorking.regis||this.form.nickname.trim()===""||this.form.password.trim()===""||this.form.otpElement.trim()===""||!/^1[3456789]\d{9}$/.test(this.form.otpElement)?!0:this.form.otpCode.trim()===""}},methods:{...x(["setUserInfo"]),regis(){if(!this.disabledRegisButton&&this.check()){if(this.form.otpCodeId==null){this.errorTip="短信验证码不正确";return}this.isWorking.regis=!0,D(this.form).then(e=>(C.set("x-kit-token",e),I(e))).then(()=>O()).then(e=>{this.setUserInfo(e),this.$router.push({name:"Desktop"})}).catch(e=>{this.errorTip=e.message}).finally(()=>{this.isWorking.regis=!1})}},sendOTP(){this.disabledSendOTPButton||this.check()&&(this.isWorking.sendOTP=!0,B({mobile:this.form.otpElement}).then(e=>{this.form.otpCodeId=e,this.sendOTPData.buttonText=`${this.sendOTPData.time}s`;const o=setInterval(()=>{this.sendOTPData.time===0?(clearInterval(o),this.sendOTPData.buttonText="发送验证码",this.sendOTPData.time=60,this.isWorking.sendOTP=!1):(this.sendOTPData.time--,this.sendOTPData.buttonText=`${this.sendOTPData.time}s`)},1e3)}).catch(e=>{this.errorTip=e.message,this.isWorking.sendOTP=!1}))},check(){return this.form.username.trim()!==""&&/^\d+$/.test(this.form.username.trim())?(this.errorTip="用户名不能为纯数字",!1):this.form.username.trim()!==""&&this.form.username.trim().indexOf("@")!==-1?(this.errorTip="用户名不能包含@符号",!1):this.form.password.trim().length<6?(this.errorTip="密码长度至少为6位",!1):(this.errorTip="",!0)}}},c=e=>(V("data-v-8b3fd0eb"),e=e(),y(),e),S={class:"page-wrap"},U=c(()=>s("div",{class:"background-text"},[s("p",null,[a("世界因"),s("em",{style:{color:"#333"}},"技术"),a("变得更简洁，每个技术人都值得"),s("em",null,"更好"),a("！")]),s("p",null,[a("让我的作品替我"),s("em",null,"致敬"),a("每一个"),s("em",{style:{"font-size":"40px",color:"#000"}},"技术人"),a("！")])],-1)),W={class:"wrap"},L=c(()=>s("h2",null,"注册KIT账号，开启极速研发",-1)),R={class:"otp-input"},M={class:"text-danger",style:{height:"40px"}},N={class:"footer-wrap"},z={class:"create-account"};function K(e,o,j,q,r,n){const _=m("Logo"),u=m("el-input"),d=m("el-form-item"),p=m("el-button"),g=m("el-form"),T=m("router-link");return P(),w("div",S,[U,s("div",W,[t(_,{"with-version":!1,"with-animation":!0}),L,t(g,{ref:"form",model:r.form,onSubmit:o[5]||(o[5]=v(()=>{},["stop"]))},{default:l(()=>[t(d,{label:"希望网友如何称呼您？",prop:"nickname"},{default:l(()=>[t(u,{modelValue:r.form.nickname,"onUpdate:modelValue":o[0]||(o[0]=i=>r.form.nickname=i),type:"text",maxlength:"20",onInput:n.check},null,8,["modelValue","onInput"])]),_:1}),t(d,{label:"登录用户名",prop:"username"},{default:l(()=>[t(u,{modelValue:r.form.username,"onUpdate:modelValue":o[1]||(o[1]=i=>r.form.username=i),type:"text",placeholder:"非必填",maxlength:"50",onInput:n.check},null,8,["modelValue","onInput"])]),_:1}),t(d,{class:"password-item",label:"登录密码",prop:"password"},{default:l(()=>[t(u,{modelValue:r.form.password,"onUpdate:modelValue":o[2]||(o[2]=i=>r.form.password=i),"show-password":"",type:"password",maxlength:"20",onInput:n.check},null,8,["modelValue","onInput"])]),_:1}),t(d,{label:"手机号码（仅支持中国大陆）",prop:"otpElement"},{default:l(()=>[t(u,{modelValue:r.form.otpElement,"onUpdate:modelValue":o[3]||(o[3]=i=>r.form.otpElement=i),maxlength:"11",onInput:n.check},null,8,["modelValue","onInput"])]),_:1}),t(d,{label:"短信验证码",prop:"otpCode"},{default:l(()=>[s("div",R,[t(u,{modelValue:r.form.otpCode,"onUpdate:modelValue":o[4]||(o[4]=i=>r.form.otpCode=i),maxlength:"4",onInput:n.check},null,8,["modelValue","onInput"]),t(p,{type:"primary",disabled:n.disabledSendOTPButton,onClick:n.sendOTP},{default:l(()=>[a(f(r.sendOTPData.buttonText),1)]),_:1},8,["disabled","onClick"])])]),_:1})]),_:1},8,["model"]),s("p",M,f(r.errorTip),1),s("div",N,[s("div",null,[t(p,{type:"important",disabled:n.disabledRegisButton,onClick:n.regis},{default:l(()=>[a("注册KIT账号")]),_:1},8,["disabled","onClick"])])]),s("div",z,[t(T,{to:{name:"SignIn"}},{default:l(()=>[a("已有账号？点击登录")]),_:1})])])])}const G=b(E,[["render",K],["__scopeId","data-v-8b3fd0eb"]]);export{G as default};
