import{_ as I,r as c,o as a,c as d,a as i,F as P,f as N,b as o,w as u,p as E,l as A,x as q,E as G,M as K,m as O,n as J,J as R,z as H,A as S,t,e as p,g,j,G as D,I as b}from"./index-c1ed4b13.js";import{S as Q}from"./ServiceInstaller-7530a113.js";import{P as X}from"./Pagination-9905b134.js";import{B as Y}from"./BeanAmount-a786337c.js";import{P as Z}from"./PluginList-a97a795d.js";import{f as x}from"./ServiceCodeErrorWindow-acf9f7a3.js";import{f as $}from"./plugin-e2f80003.js";import{S as ee}from"./ServiceTitle-eb07b032.js";import"./FormItemTip-b3dd8647.js";import"./ServiceStatus-884858b6.js";import"./QueryModelView-e8a421ad.js";import"./InnerRouterViewWindow-390d2a9b.js";import"./form.check-189b470c.js";const se={name:"IssueListView",components:{Pagination:X},data(){return{pagination:{pageIndex:1,capacity:10,total:100}}}},k=e=>(E("data-v-f510f853"),e=e(),A(),e),ie={class:"issue-wrap"},ne=k(()=>i("div",{class:"toolbar"},[i("ul",null,[i("li",null,"All"),i("li",null,"Enabled"),i("li",null,"Completed"),i("li",null,"Refused")]),i("ul",{class:"issue-types"},[i("li",{class:"bug"},"BUG"),i("li",{class:"optimize"},"Optimize")])],-1)),te={class:"issues"},le=k(()=>i("h3",null,"登录失败时验证码没有刷新",-1)),re={class:"text-info-1"},oe=k(()=>i("span",null,"刘大逵",-1)),ce=k(()=>i("li",{class:"text-info-1"},[i("span",null,"Completed")],-1)),ae=k(()=>i("li",{class:"text-info-1"},[i("span",null,"3小时前")],-1));function ue(e,n,h,w,s,r){const f=c("UserFilled"),v=c("el-icon"),_=c("router-link"),m=c("Pagination");return a(),d("div",ie,[ne,i("ul",te,[(a(),d(P,null,N(10,y=>i("li",{key:y},[o(_,{to:"#",target:"_blank"},{default:u(()=>[le,i("ul",null,[i("li",re,[o(v,null,{default:u(()=>[o(f)]),_:1}),oe]),ce,ae])]),_:1})])),64))]),o(m,{pagination:s.pagination},null,8,["pagination"])])}const pe=I(se,[["render",ue],["__scopeId","data-v-f510f853"]]);const de={name:"SearchInput",props:{modelValue:{required:!0},placeholder:{}},methods:{search(){this.$emit("search")},handleInput(e){this.$emit("update:modelValue",e.target.value)}}},he={class:"search-input"},ve=["value","placeholder"];function _e(e,n,h,w,s,r){const f=c("Search"),v=c("el-icon");return a(),d("div",he,[i("input",{value:h.modelValue,placeholder:h.placeholder,onKeypress:n[0]||(n[0]=q((..._)=>r.search&&r.search(..._),["enter"])),onInput:n[1]||(n[1]=(..._)=>r.handleInput&&r.handleInput(..._))},null,40,ve),o(v,null,{default:u(()=>[o(f)]),_:1})])}const me=I(de,[["render",_e],["__scopeId","data-v-898d8650"]]);const ge={components:{SearchInput:me,ServiceTitle:ee,PluginList:Z,BeanAmount:Y,IssueListView:pe,Empty:G,MarkdownEditor:K,ServiceInstaller:Q},data(){return{loading:{page:!0,plugins:!0},isWorking:{install:!1,uninstall:!1},space:null,keyword:"",latestMainService:null,service:null,currentService:null,plugins:[],currentServiceDimension:"readme",project:null}},watch:{currentProject(){this.latestMainService=null,this.fetchProject(!0)}},computed:{...O(["currentProject","currentProjectDetail"]),installed(){return this.currentService==null?!1:this.installedPlugins[this.currentService.name]!=null},majorVersion(){return this.service==null?"...":`${this.service.version.substring(0,this.service.version.indexOf("."))}`},installedPlugins(){return this.project.plugins||this.project.services},installedService(){return this.project.service||this.project.main},upgradeDescription(){return this.latestMainService==null?"":this.$t("service.upgradeTip",{currentVersion:this.service.version,newVersion:this.latestMainService.version,publishDescription:this.latestMainService.publishDescription})}},methods:{...J(["setCurrentProject"]),install(){this.currentServiceDimension="install",this.$refs.installer.install()},uninstall(){this.currentServiceDimension="install",this.$refs.installer.uninstall()},withInstalled(e){return this.installedPlugins[e.name]!=null},fetchProject(e=!1){if(this.loading.page=!0,this.currentProject==null||this.currentProject===""){this.project=null,this.space=null,this.loading.page=!1;return}this.refreshProject(e)},fetchLatestVersion(){this.latestMainService==null&&x({space:this.space,service:this.service.name}).then(e=>{this.latestMainService=e}).catch(e=>{this.$tip.apiFailed(e)})},refreshProject(e=!1){this.loading.page=!0,R(this.currentProject).then(n=>{if(this.project=n,this.space=this.project.space,this.installedService==null){this.loading.page=!1;return}let h=null;for(const w in this.installedService){h=w;break}this.service={name:h,...this.installedService[h]},this.fetchLatestVersion(),e&&this.searchPlugins()}).catch(n=>{this.$tip.apiFailed(n)}).finally(()=>{this.loading.page=!1})},searchPlugins(){this.loading.plugins=!0,$({space:this.space,service:this.service.name,majorVersion:this.majorVersion,keyword:this.keyword}).then(e=>{this.plugins=e}).catch(e=>{console.log("searchPlugins",e),this.$tip.apiFailed(e)}).finally(()=>{this.loading.plugins=!1})},selectPlugin(e){this.plugins.length>0&&(this.currentService=e)},hasNewVersion(e){const n=this.installedPlugins[e.name];return n==null?!1:n.version!==e.lastVersion}},created(){const e=this.$route.query.project_id;e!=null&&e!==""&&(this.setCurrentProject(e),this.$router.replace({name:"Workbench"})),this.fetchProject(!0)}},fe={class:"page"},Se={key:0,class:"wrap"},ke={class:"header"},we={class:"title"},ye={class:"project-code-space"},je={class:"service-info"},be={class:"service-title-wrap"},Pe={class:"info"},Ie={class:"content-wrap"},Ve={class:"service-wrap"},Ce={class:"search-input-wrap"},De={class:"setting-wrap"},Le={class:"main"},Me={class:"service-dimensions"},We={class:"dimension-content"},Te={class:"issue-wrap"},Ue={class:"opera"},Fe={class:"opera-tip"},ze={key:1,class:"setting-holder"},Be={key:1,class:"incorrect-wrap"},Ne={class:"content"},Ee={key:2,class:"incorrect-wrap"},Ae={class:"content"};function qe(e,n,h,w,s,r){const f=c("Folder"),v=c("el-icon"),_=c("ServiceTitle"),m=c("el-button"),y=c("el-popover"),L=c("SearchInput"),M=c("Upload"),W=c("Check"),T=c("PluginList"),U=c("MarkdownEditor"),F=c("ServiceInstaller"),z=c("IssueListView"),B=c("InfoFilled"),V=c("router-link"),C=H("loading");return S((a(),d("div",fe,[!s.loading.page&&s.project!=null&&s.service!=null?(a(),d("div",Se,[i("div",null,[i("div",ke,[i("div",we,[i("h2",null,t(s.project.name),1),i("p",ye,[o(v,null,{default:u(()=>[o(f)]),_:1}),p(t(e.currentProjectDetail.codespace),1)]),i("div",je,[i("div",be,[o(_,{space:s.space,service:s.service.name,"service-label":s.service.label,"with-new-page":!0},null,8,["space","service","service-label"]),p(" · v"+t(s.service.version),1)]),s.latestMainService!=null&&s.latestMainService.version!==s.service.version?(a(),g(y,{key:0,title:e.$t("service.upgradeTitle"),width:255,trigger:"hover","popper-class":"upgrade-popover"},{default:u(()=>[i("pre",null,t(r.upgradeDescription),1)]),reference:u(()=>[o(m,{size:"small",type:"primary",icon:"Upload",onClick:n[0]||(n[0]=l=>e.$router.push({name:"ServiceDetail",params:{space:s.space,service:this.service.name}}))},{default:u(()=>[p(t(e.$t("service.upgrade")),1)]),_:1})]),_:1},8,["title"])):j("",!0)])]),i("div",Pe,[i("em",null,"v"+t(r.majorVersion),1),i("p",null,t(e.$t("common.currentVersion")),1)])]),i("div",Ie,[i("div",Ve,[i("div",Ce,[o(L,{placeholder:e.$t("common.search"),modelValue:s.keyword,"onUpdate:modelValue":n[1]||(n[1]=l=>s.keyword=l),onSearch:r.searchPlugins},null,8,["placeholder","modelValue","onSearch"])]),S((a(),g(T,{plugins:s.plugins,"custom-class":l=>({selected:s.currentService!=null&&s.currentService.name===l.name}),installed:l=>r.withInstalled(l),onClick:n[2]||(n[2]=l=>r.selectPlugin(l))},{title:u(({plugin:l})=>[p(t(l.label||l.name)+" ",1),r.hasNewVersion(l)?(a(),g(v,{key:0},{default:u(()=>[o(M)]),_:1})):r.withInstalled(l)?(a(),g(v,{key:1,class:"installed-icon"},{default:u(()=>[o(W)]),_:1})):j("",!0)]),_:1},8,["plugins","custom-class","installed"])),[[C,s.loading.plugins]])]),i("div",De,[s.currentService!=null?(a(),d(P,{key:0},[i("h3",null,t(s.currentService.label||s.currentService.name),1),i("div",Le,[i("ul",Me,[i("li",{class:D({selected:s.currentServiceDimension==="readme"}),onClick:n[3]||(n[3]=l=>s.currentServiceDimension="readme")},t(e.$t("common.readme")),3),i("li",{class:D({selected:s.currentServiceDimension==="install"}),onClick:n[4]||(n[4]=l=>s.currentServiceDimension="install")},t(e.$t("service.install2")),3)]),i("div",We,[S(i("div",null,[o(U,{modelValue:s.currentService.description,"onUpdate:modelValue":n[5]||(n[5]=l=>s.currentService.description=l),readonly:"","without-padding":!0},null,8,["modelValue"])],512),[[b,s.currentServiceDimension==="readme"]]),S(o(F,{ref:"installer",installing:s.isWorking.install,"onUpdate:installing":n[6]||(n[6]=l=>s.isWorking.install=l),uninstalling:s.isWorking.uninstall,"onUpdate:uninstalling":n[7]||(n[7]=l=>s.isWorking.uninstall=l),space:s.space,service:s.service.name,plugin:s.currentService.name,"service-price":s.currentService.price.price,"service-lease":s.currentService.latestLease,version:s.currentService.lastVersion,"with-project":!1,"project-config":s.project,onInstalled:n[8]||(n[8]=l=>r.refreshProject()),onUninstalled:n[9]||(n[9]=l=>r.refreshProject())},null,8,["installing","uninstalling","space","service","plugin","service-price","service-lease","version","project-config"]),[[b,s.currentServiceDimension==="install"]]),i("div",Te,[S(o(z,null,null,512),[[b,s.currentServiceDimension==="issues"]])])])]),i("div",Ue,[r.installed?(a(),d(P,{key:0},[r.hasNewVersion(s.currentService)?(a(),g(m,{key:0,type:"primary",size:"large",icon:"Upload",disabled:s.isWorking.install,onClick:r.install},{default:u(()=>[p(t(e.$t("service.upgrade")),1)]),_:1},8,["disabled","onClick"])):(a(),g(m,{key:1,type:"primary",size:"large",disabled:s.isWorking.install,onClick:r.install},{default:u(()=>[p(t(s.isWorking.install?e.$t("service.installing"):e.$t("service.reinstall")),1)]),_:1},8,["disabled","onClick"])),o(m,{size:"large",disabled:s.isWorking.uninstall,onClick:r.uninstall},{default:u(()=>[p(t(s.isWorking.uninstall?e.$t("service.uninstalling"):e.$t("service.uninstall")),1)]),_:1},8,["disabled","onClick"])],64)):(a(),g(m,{key:1,type:"primary",size:"large",disabled:s.isWorking.install,onClick:r.install},{default:u(()=>[p(t(s.isWorking.install?e.$t("service.installing"):e.$t("service.install")),1)]),_:1},8,["disabled","onClick"]))]),i("div",Fe,[o(v,null,{default:u(()=>[o(B)]),_:1}),i("p",null,t(e.$t("service.installTip")),1)])],64)):(a(),d("div",ze,[i("h4",null,t(e.$t("workbench.subServiceSettings")),1),i("p",null,t(e.$t("workbench.subServiceSettingsTip")),1)]))])])])])):s.project==null?(a(),d("div",Be,[i("div",Ne,[i("p",null,[p(t(e.$t("workbench.noProjectTip1")),1),o(V,{to:{name:"Index"}},{default:u(()=>[p(t(e.$t("common.homepage")),1)]),_:1}),p(t(e.$t("workbench.noProjectTip2")),1)])])])):s.service==null?(a(),d("div",Ee,[i("div",Ae,[i("p",null,[p(t(e.$t("workbench.noServiceInstalledTip1")),1),o(V,{to:{name:"PublicSpaces"}},{default:u(()=>[p(t(e.$t("common.publicSpace")),1)]),_:1}),p(t(e.$t("workbench.noServiceInstalledTip2")),1)])])])):j("",!0)])),[[C,s.loading.page]])}const ss=I(ge,[["render",qe],["__scopeId","data-v-228b2ce2"]]);export{ss as default};
