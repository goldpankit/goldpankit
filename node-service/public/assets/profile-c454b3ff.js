import{_ as U,r as a,o as p,g,w as n,a as i,m as I,q as k,$ as V,c as _,b as s,t as b,i as A,e as h}from"./index-dd2ed0b0.js";const w={name:"AvatarUploader",props:{modelValue:{required:!0}},methods:{handleAvatarSuccess(e){if(!e.success){this.$tip.apiFailed(e);return}this.$emit("update:modelValue",e.data.fileKey)},beforeAvatarUpload(e){return e.size/1024/1024>2?(this.$tip.error("Avatar picture size can not exceed 2MB!"),!1):!0}}},x=["src"];function N(e,t,u,v,o,l){const c=a("el-upload");return p(),g(c,{class:"avatar-uploader",action:"/remote-api/upload/image","show-file-list":!1,accept:".jpeg,.png,.jpg,.gif","on-success":l.handleAvatarSuccess,"before-upload":l.beforeAvatarUpload},{default:n(()=>[i("img",{src:e.getAvatarUri(u.modelValue),class:"avatar"},null,8,x)]),_:1},8,["on-success","before-upload"])}const z=U(w,[["render",N],["__scopeId","data-v-b6fadecc"]]);const B={components:{AvatarUploader:z},computed:{...I(["userInfo"])},data(){return{copyUserInfo:null,isWorking:!1,rules:{nickname:[{required:!0,message:"请输入昵称",trigger:"blur"}]}}},watch:{userInfo:{immediate:!0,handler:function(){this.copyUserInfo=JSON.parse(JSON.stringify(this.userInfo))}}},methods:{...k(["setUserInfo"]),save(){this.isWorking||this.$refs.form.validate(e=>{e&&(this.isWorking=!0,this.copyUserInfo.nickname=this.copyUserInfo.nickname.trim(),this.copyUserInfo.introduce=this.copyUserInfo.introduce==null?null:this.copyUserInfo.introduce.trim(),V({nickname:this.copyUserInfo.nickname,introduce:this.copyUserInfo.introduce}).then(()=>{this.setUserInfo(this.copyUserInfo),this.$router.push({name:"Desktop"})}).catch(t=>{this.$tip.apiFailed(t)}).finally(()=>{this.isWorking=!1}))})}}},C={class:"page"},S={key:0,class:"wrap"},$={class:"avatar-wrap"},W={class:"opera"};function q(e,t,u,v,o,l){const c=a("AvatarUploader"),d=a("el-input"),f=a("el-form-item"),y=a("el-form"),m=a("el-button");return p(),_("div",C,[o.copyUserInfo!=null?(p(),_("div",S,[i("div",$,[s(c,{modelValue:o.copyUserInfo.avatar,"onUpdate:modelValue":t[0]||(t[0]=r=>o.copyUserInfo.avatar=r)},null,8,["modelValue"]),i("h2",null,b(e.getUserDisplayName(o.copyUserInfo)),1)]),s(y,{ref:"form",model:o.copyUserInfo,rules:o.rules},{default:n(()=>[s(f,{label:"昵称",prop:"nickname",required:""},{default:n(()=>[s(d,{size:"large",modelValue:o.copyUserInfo.nickname,"onUpdate:modelValue":t[1]||(t[1]=r=>o.copyUserInfo.nickname=r),maxlength:"20"},null,8,["modelValue"])]),_:1}),s(f,{label:e.$t("common.introduce"),prop:"introduce"},{default:n(()=>[s(d,{size:"large",modelValue:o.copyUserInfo.introduce,"onUpdate:modelValue":t[2]||(t[2]=r=>o.copyUserInfo.introduce=r),type:"textarea",rows:5,maxlength:"200","show-word-limit":""},null,8,["modelValue"])]),_:1},8,["label"])]),_:1},8,["model","rules"]),i("div",W,[s(m,{size:"large",onClick:t[3]||(t[3]=r=>e.$router.push({name:"Desktop"})),icon:"Back"},{default:n(()=>[h("返回")]),_:1}),s(m,{type:"primary",size:"large",disabled:o.isWorking,onClick:l.save},{default:n(()=>[h("保存资料")]),_:1},8,["disabled","onClick"])])])):A("",!0)])}const j=U(B,[["render",q],["__scopeId","data-v-ce6e09a1"]]);export{j as default};
