import{_ as V,M as P,V as N,r,z as W,o as a,c as h,A as v,b as t,w as n,a as l,t as o,e as k,Q as q,m as M,n as U,Z as H,$ as R,j as b,F as A,H as u,I as g,g as w}from"./index-42b6b834.js";import{S as L,V as Q,P as Z,B as G,I as J,a as K}from"./SystemVariableTable-3ee64c92.js";import{a as O,b as X}from"./service.space-146f402b.js";import{S as Y}from"./ServiceCodeErrorWindow-333db70f.js";import{c as $,d as x,e as ee}from"./service-c94385d9.js";import{S as ie}from"./ServiceTitle-7a4b875c.js";import"./CompilerSelect-3dcc9bed.js";import"./plugin-a87a8e0c.js";import"./service.version-e08215bb.js";import"./form.check-189b470c.js";import"./QueryModelView-eff0868c.js";import"./InnerRouterViewWindow-129d0f04.js";const se={name:"SpaceSettings",components:{MarkdownEditor:P,HelpButton:N},props:{space:{required:!0}},data(){return{loading:!1,isWorking:!1,form:{id:null,name:"",withPrivate:!1,subServiceReceivable:!1,homepage:"",introduce:"",description:""},rules:{introduce:[{required:!0,message:"Please input space introduce"}],description:[{required:!0,message:"Please input space description"}]}}},methods:{fetchSpace(){this.loading||(this.loading=!0,O(this.space).then(i=>{for(const s in this.form)this.form[s]=i[s]}).catch(i=>{this.$tip.apiFailed(i)}).finally(()=>{this.loading=!1}))},save(){this.$refs.form.validate().then(()=>{this.isWorking||(this.isWorking=!0,X(this.form).then(()=>{this.$tip.success(this.$t("common.saveSuccessfully"))}).catch(i=>{this.$tip.apiFailed(i)}).finally(()=>{this.isWorking=!1}))}).catch(()=>{})}},created(){this.fetchSpace()}},te={class:"space-settings"},re={class:"form-wrap"},le={class:"opera"};function oe(i,s,j,D,e,c){const d=r("el-form-item"),f=r("el-input"),_=r("el-checkbox"),C=r("el-form"),y=r("MarkdownEditor"),T=r("el-button"),S=W("loading");return a(),h("div",te,[v((a(),h("div",re,[t(C,{ref:"form",model:e.form,rules:e.rules},{default:n(()=>[t(d,{label:i.$t("space.spaceName"),prop:"name"},{default:n(()=>[l("h3",null,o(e.form.name),1)]),_:1},8,["label"]),t(d,{label:i.$t("space.homePage"),prop:"homepage"},{default:n(()=>[t(f,{modelValue:e.form.homepage,"onUpdate:modelValue":s[0]||(s[0]=p=>e.form.homepage=p)},null,8,["modelValue"])]),_:1},8,["label"]),t(d,{label:i.$t("common.introduce"),prop:"introduce",required:""},{default:n(()=>[t(f,{modelValue:e.form.introduce,"onUpdate:modelValue":s[1]||(s[1]=p=>e.form.introduce=p),type:"textarea",rows:3,maxlength:"200"},null,8,["modelValue"])]),_:1},8,["label"]),t(d,{label:i.$t("space.otherSettings"),class:"item-other-settings"},{default:n(()=>[l("div",null,[t(_,{modelValue:e.form.withPrivate,"onUpdate:modelValue":s[2]||(s[2]=p=>e.form.withPrivate=p),label:i.$t("space.isPrivateServiceTip")},null,8,["modelValue","label"])])]),_:1},8,["label"])]),_:1},8,["model","rules"]),t(C,{ref:"descForm",class:"description-form",model:e.form},{default:n(()=>[t(d,{label:i.$t("space.spaceDescriptionLabel"),prop:"description",required:""},{default:n(()=>[t(y,{modelValue:e.form.description,"onUpdate:modelValue":s[3]||(s[3]=p=>e.form.description=p),placeholder:i.$t("space.spaceDescription")},null,8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1},8,["model"])])),[[S,e.loading]]),l("div",le,[t(T,{type:"primary",size:"large",disabled:e.isWorking,onClick:c.save},{default:n(()=>[k(o(i.$t("common.save")),1)]),_:1},8,["disabled","onClick"])])])}const ne=V(se,[["render",oe],["__scopeId","data-v-75dd8eac"]]);const ce={components:{ServiceTitle:ie,SystemVariableTable:L,ServiceCodeErrorWindow:Y,SpaceSettings:ne,MarkdownEditor:P,Variables:Q,PublishWindow:Z,BasicSetting:G,InitializeView:J,DirectorySelect:q,SettingFiles:K},data(){return{loading:!0,isWorking:{compile:!1,cleanCompile:!1},route:{space:"",service:""},currentTab:"basic",service:null,serviceConfig:null}},computed:{...M(["currentProject","currentProjectDetail","currentDatabase","installData"]),initialized(){return this.serviceConfig!=null&&this.serviceConfig.version!=null},compileTip(){return this.currentProjectDetail!=null?this.$t("service.settings.compileTipWithProject",{project:this.currentProjectDetail.name}):this.$t("service.settings.compileTip")},cleanCompileTip(){return this.currentProjectDetail!=null?this.$t("service.settings.cleanCompileTipWithProject",{project:this.currentProjectDetail.name}):this.$t("service.settings.cleanCompileTip")}},methods:{...U(["setInstallData"]),saveConfig(){$({...this.route,readme:this.service.description}).then(()=>{}).catch(i=>{this.$tip.apiFailed(i)})},fetchProfile(){this.loading=!0,x({spaceName:this.route.space,serviceName:this.route.service}).then(i=>{this.service=i}).then(()=>ee({space:this.route.space,service:this.route.service})).then(i=>{i!=null&&(this.serviceConfig=i,this.serviceConfig.label=this.serviceConfig.label||this.serviceConfig.name,this.service.label=this.serviceConfig.label,this.service.description=this.serviceConfig.readme)}).catch(i=>{this.$tip.apiFailed(i)}).finally(()=>{this.loading=!1})},compile(){this.isWorking.compile||this.currentProject==null||this.currentProject===""||(this.isWorking.compile=!0,H({...this.route,serviceType:this.service.type,projectId:this.currentProject,database:this.currentDatabase,variables:this.$refs.variables.getVariables()}).then(i=>{this.setInstallData(i),this.$tip.success("Compile successfully.")}).catch(i=>{if(i.code===6e3){this.$refs.serviceCodeErrorWindow.open(i.errorData);return}this.$tip.apiFailed(i)}).finally(()=>{this.isWorking.compile=!1}))},cleanCompile(){this.isWorking.cleanCompile||this.currentProject==null||this.currentProject===""||(this.isWorking.cleanCompile=!0,R({...this.route,projectId:this.currentProject,database:this.currentDatabase,variables:this.$refs.variables.getVariables()}).then(i=>{this.$tip.success("Clean Compile successfully."),this.setInstallData(i)}).catch(i=>{if(i.code===6e3){this.$refs.serviceCodeErrorWindow.open(i.errorData);return}this.$tip.apiFailed(i)}).finally(()=>{this.isWorking.cleanCompile=!1}))}},created(){this.route.space=this.$route.query.space,this.route.service=this.$route.query.service,this.fetchProfile()}},ae={key:0,class:"wrap"},pe={class:"header-wrap"},ue={class:"header"},me={key:0,class:"opera"},de={key:0,class:"text-info-1 service-path"},ve={class:"main"},he={class:"tabs"},fe={class:"tab-content"};function be(i,s,j,D,e,c){const d=r("ServiceTitle"),f=r("el-button"),_=r("el-popover"),C=r("SpaceSettings"),y=r("BasicSetting"),T=r("MarkdownEditor"),S=r("Variables"),p=r("SettingFiles"),z=r("SystemVariableTable"),I=r("InitializeView"),E=r("PublishWindow"),F=r("ServiceCodeErrorWindow"),B=W("loading");return v((a(),h("div",{class:u(["page",{"page-un-initialize":!c.initialized}])},[e.service!=null?(a(),h("div",ae,[l("div",pe,[l("div",ue,[t(d,{space:e.service.space.name,service:e.service.name,"service-label":e.service.label,"with-new-page":!0},null,8,["space","service","service-label"]),c.initialized?(a(),h("div",me,[t(_,{placement:"top-start",title:i.$t("service.settings.compileTipTitle"),width:200,trigger:"hover",content:c.compileTip},{reference:n(()=>[t(f,{type:"primary",class:u({"is-disabled":i.currentProject==null||e.isWorking.compile}),onClick:c.compile},{default:n(()=>[k(o(i.$t("service.settings.compile")),1)]),_:1},8,["class","onClick"])]),_:1},8,["title","content"]),t(_,{placement:"top-start",title:i.$t("service.settings.cleanCompileTipTitle"),width:200,trigger:"hover",content:c.cleanCompileTip},{reference:n(()=>[t(f,{type:"primary",class:u({"is-disabled":i.currentProject==null||e.isWorking.cleanCompile}),onClick:c.cleanCompile},{default:n(()=>[k(o(i.$t("service.settings.cleanCompile")),1)]),_:1},8,["class","onClick"])]),_:1},8,["title","content"]),t(f,{type:"important",onClick:s[0]||(s[0]=m=>i.$refs.publishWindow.open(e.route.space,e.route.service))},{default:n(()=>[k(o(i.$t("service.settings.publish")),1)]),_:1})])):b("",!0)]),c.initialized?(a(),h("p",de,o(i.$t("service.settings.at"))+" "+o(e.service.local.codespace),1)):b("",!0)]),l("div",ve,[c.initialized?(a(),h(A,{key:0},[l("ul",he,[l("li",{class:u({selected:e.currentTab==="space"}),onClick:s[1]||(s[1]=m=>e.currentTab="space")},o(i.$t("service.settings.space")),3),l("li",{class:u({selected:e.currentTab==="basic"}),onClick:s[2]||(s[2]=m=>e.currentTab="basic")},o(i.$t("service.settings.service")),3),l("li",{class:u({selected:e.currentTab==="readme"}),onClick:s[3]||(s[3]=m=>e.currentTab="readme")},o(i.$t("service.settings.readme")),3),l("li",{class:u({selected:e.currentTab==="variables"}),onClick:s[4]||(s[4]=m=>e.currentTab="variables")},o(i.$t("service.settings.variables")),3),l("li",{class:u({selected:e.currentTab==="files"}),onClick:s[5]||(s[5]=m=>e.currentTab="files")},o(i.$t("service.settings.files")),3),l("li",{class:u({selected:e.currentTab==="system_variables"}),onClick:s[6]||(s[6]=m=>e.currentTab="system_variables")},o(i.$t("service.settings.systemVariables")),3)]),l("div",fe,[v(t(C,{space:e.route.space},null,8,["space"]),[[g,e.currentTab==="space"]]),v(t(y,{space:e.route.space,service:e.route.service,"service-type":e.service.type,"service-config":e.serviceConfig},null,8,["space","service","service-type","service-config"]),[[g,e.currentTab==="basic"]]),e.service.description!=null?v((a(),w(T,{key:0,modelValue:e.service.description,"onUpdate:modelValue":[s[7]||(s[7]=m=>e.service.description=m),c.saveConfig],placeholder:i.$t("service.settings.serviceReadmeHolder")},null,8,["modelValue","placeholder","onUpdate:modelValue"])),[[g,e.currentTab==="readme"]]):b("",!0),v(t(S,{ref:"variables",space:e.route.space,service:e.route.service},null,8,["space","service"]),[[g,e.currentTab==="variables"]]),v(t(p,{space:e.route.space,service:e.route.service},null,8,["space","service"]),[[g,e.currentTab==="files"]]),e.currentTab==="system_variables"?(a(),w(z,{key:1})):b("",!0)])],64)):(a(),w(I,{key:1,"space-name":e.service.space.name,"service-name":e.service.name,"service-label":e.service.label,onInitialized:c.fetchProfile},null,8,["space-name","service-name","service-label","onInitialized"]))])])):b("",!0),t(E,{ref:"publishWindow"},null,512),t(F,{ref:"serviceCodeErrorWindow"},null,512)],2)),[[B,e.loading]])}const De=V(ce,[["render",be],["__scopeId","data-v-fb7bf319"]]);export{De as default};
