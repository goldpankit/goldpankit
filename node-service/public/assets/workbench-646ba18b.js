import{_ as L,C as N,M as U,m as z,n as B,J as E,r as c,z as T,A as S,o as l,c as p,a as n,t as r,e as o,F as g,j as f,g as m,w as a,b as u,H as k,I as _}from"./index-1c43f46f.js";import{S as F,I as q,a as A}from"./IssueListView-9d53d6fe.js";import{a as H}from"./service-439d7d20.js";import{E as J}from"./Empty-55e6f811.js";import{B as O}from"./BeanAmount-8639f1cf.js";import{f as G}from"./ServiceCodeErrorWindow-eb3d6671.js";import"./Pagination-bc89b1d5.js";const K={components:{CreateProjectWindow:N,SubServiceList:F,BeanAmount:O,IssueListView:q,Empty:J,MarkdownEditor:U,ServiceInstaller:A},data(){return{loading:!0,isWorking:{install:!1,uninstall:!1},space:null,latestMainService:null,mainService:null,currentService:null,subServices:[],currentServiceDimension:"readme",project:null}},watch:{currentProject(){this.fetchProject(!0)}},computed:{...z(["currentProject"]),installed(){return this.currentService==null?!1:this.project.services[this.currentService.name]!=null},majorVersion(){return this.mainService==null?"...":`${this.mainService.version.substring(0,this.mainService.version.indexOf("."))}`}},methods:{...B(["setCurrentProject"]),withInstalled(e){return this.project.services[e.name]!=null},fetchProject(e=!1){if(this.loading=!0,this.currentProject==null||this.currentProject===""){this.project=null,this.space=null,this.loading=!1;return}this.refreshProject(e)},fetchMainService(){this.latestMainService==null&&G({space:this.space,service:this.mainService.name}).then(e=>{this.latestMainService=e}).catch(e=>{this.$tip.apiFailed(e)})},refreshProject(e=!1){E(this.currentProject).then(s=>{if(this.project=s,this.space=this.project.space,this.project.main==null){this.loading=!1;return}let h=null;for(const j in this.project.main){h=j;break}this.mainService={name:h,...this.project.main[h]},this.fetchMainService(),e&&this.searchSubServices()}).catch(s=>{this.$tip.apiFailed(s)}).finally(()=>{this.loading=!1})},searchSubServices(){H({space:this.space,service:this.mainService.name,majorVersion:this.majorVersion}).then(e=>{this.subServices=e,this.subServices.length>0&&this.selectService(this.subServices[0])}).catch(e=>{this.$tip.apiFailed(e)})},selectService(e){this.subServices.length>0&&(this.currentService=e)},hasNewVersion(e){const s=this.project.services[e.name];return s==null?!1:s.version!==e.lastVersion}},created(){const e=this.$route.query.project_id;e!=null&&e!==""&&(this.setCurrentProject(e),this.$router.replace({name:"Workbench"})),this.fetchProject(!0)}},Q={class:"page"},R={key:0,class:"wrap"},X={class:"header"},Y={class:"title"},Z={class:"service-info"},$={class:"info"},x={class:"content-wrap"},ee={class:"service-wrap"},ie={class:"search-box"},se={class:"setting-wrap"},ne={class:"main"},re={class:"service-dimensions"},te={class:"dimension-content"},le={class:"issue-wrap"},oe={class:"opera"},ce={key:1,class:"setting-holder"},ae={key:1,class:"incorrect-wrap"},ue={class:"content"},ve={key:2,class:"incorrect-wrap"},pe={class:"content"};function me(e,s,h,j,i,v){const d=c("el-button"),y=c("el-input"),V=c("Upload"),b=c("el-icon"),C=c("Check"),I=c("SubServiceList"),P=c("MarkdownEditor"),M=c("ServiceInstaller"),W=c("IssueListView"),w=c("router-link"),D=T("loading");return S((l(),p("div",Q,[!i.loading&&i.project!=null&&i.mainService!=null?(l(),p("div",R,[n("div",null,[n("div",X,[n("div",Y,[n("h2",null,r(i.project.name),1),n("div",Z,[n("p",null,[o(r(i.space)+" · "+r(i.mainService.name)+" · v"+r(i.mainService.version)+" ",1),i.latestMainService!=null?(l(),p(g,{key:0},[o(" · "+r(e.$t("service.latestVersion"))+": v"+r(i.latestMainService.version),1)],64)):f("",!0)]),i.latestMainService!=null&&i.latestMainService.version!==i.mainService.version?(l(),m(d,{key:0,type:"primary",icon:"Upload",onClick:s[0]||(s[0]=t=>e.$router.push({name:"SpaceDetail",params:{name:i.space},query:{service:this.mainService.name}}))},{default:a(()=>[o(r(e.$t("service.upgrade")),1)]),_:1})):f("",!0)])]),n("div",$,[n("em",null,"v"+r(v.majorVersion),1),n("p",null,r(e.$t("common.currentVersion")),1)])]),n("div",x,[n("div",ee,[n("div",ie,[u(y,{size:"large",placeholder:e.$t("common.search")},null,8,["placeholder"])]),u(I,{services:i.subServices,"custom-class":t=>({selected:i.currentService!=null&&i.currentService.name===t.name}),installed:t=>v.withInstalled(t),onClick:s[1]||(s[1]=t=>v.selectService(t))},{title:a(({service:t})=>[o(r(t.name)+" ",1),v.hasNewVersion(t)?(l(),m(b,{key:0},{default:a(()=>[u(V)]),_:1})):v.withInstalled(t)?(l(),m(b,{key:1,class:"installed-icon"},{default:a(()=>[u(C)]),_:1})):f("",!0)]),_:1},8,["services","custom-class","installed"])]),n("div",se,[i.currentService!=null?(l(),p(g,{key:0},[n("h3",null,r(i.currentService.name),1),n("div",ne,[n("ul",re,[n("li",{class:k({selected:i.currentServiceDimension==="readme"}),onClick:s[2]||(s[2]=t=>i.currentServiceDimension="readme")},r(e.$t("common.readme")),3),n("li",{class:k({selected:i.currentServiceDimension==="install"}),onClick:s[3]||(s[3]=t=>i.currentServiceDimension="install")},r(e.$t("service.install2")),3),n("li",{class:k(["disabled",{selected:i.currentServiceDimension==="issues"}])},r(e.$t("common.issues")),3)]),n("div",te,[S(n("div",null,[u(P,{modelValue:i.currentService.description,"onUpdate:modelValue":s[4]||(s[4]=t=>i.currentService.description=t),readonly:"","without-padding":!0},null,8,["modelValue"])],512),[[_,i.currentServiceDimension==="readme"]]),S(u(M,{ref:"installer",installing:i.isWorking.install,"onUpdate:installing":s[5]||(s[5]=t=>i.isWorking.install=t),uninstalling:i.isWorking.uninstall,"onUpdate:uninstalling":s[6]||(s[6]=t=>i.isWorking.uninstall=t),space:i.space,service:i.currentService.name,"service-type":i.currentService.type,"service-price":i.currentService.price.price,"service-lease":i.currentService.latestLease,version:i.currentService.lastVersion,"with-project":!1,"project-config":i.project,onInstalled:s[7]||(s[7]=t=>v.refreshProject()),onUninstalled:s[8]||(s[8]=t=>v.refreshProject())},null,8,["installing","uninstalling","space","service","service-type","service-price","service-lease","version","project-config"]),[[_,i.currentServiceDimension==="install"]]),n("div",le,[S(u(W,null,null,512),[[_,i.currentServiceDimension==="issues"]])])])]),n("div",oe,[v.installed?(l(),p(g,{key:0},[v.hasNewVersion(i.currentService)?(l(),m(d,{key:0,type:"primary",size:"large",icon:"Upload",disabled:i.isWorking.install,onClick:s[9]||(s[9]=t=>e.$refs.installer.install())},{default:a(()=>[o(r(e.$t("service.upgrade")),1)]),_:1},8,["disabled"])):(l(),m(d,{key:1,type:"primary",size:"large",disabled:i.isWorking.install,onClick:s[10]||(s[10]=t=>e.$refs.installer.install())},{default:a(()=>[o(r(i.isWorking.install?e.$t("service.installing"):e.$t("service.reinstall")),1)]),_:1},8,["disabled"])),u(d,{size:"large",disabled:i.isWorking.uninstall,onClick:s[11]||(s[11]=t=>e.$refs.installer.uninstall())},{default:a(()=>[o(r(i.isWorking.uninstall?e.$t("service.uninstalling"):e.$t("service.uninstall")),1)]),_:1},8,["disabled"])],64)):(l(),m(d,{key:1,type:"primary",size:"large",disabled:i.isWorking.install,onClick:s[12]||(s[12]=t=>e.$refs.installer.install())},{default:a(()=>[o(r(i.isWorking.install?e.$t("service.installing"):e.$t("service.install")),1)]),_:1},8,["disabled"]))])],64)):(l(),p("div",ce,[n("h4",null,r(e.$t("workbench.subServiceSettings")),1),n("p",null,r(e.$t("workbench.subServiceSettingsTip")),1)]))])])])])):i.project==null?(l(),p("div",ae,[n("div",ue,[n("p",null,[o(r(e.$t("workbench.noProjectTip1")),1),u(w,{to:{name:"Index"}},{default:a(()=>[o(r(e.$t("common.homepage")),1)]),_:1}),o(r(e.$t("workbench.noProjectTip2")),1)])])])):i.mainService==null?(l(),p("div",ve,[n("div",pe,[n("p",null,[o(r(e.$t("workbench.noServiceInstalledTip1")),1),u(w,{to:{name:"PublicSpaces"}},{default:a(()=>[o(r(e.$t("common.publicSpace")),1)]),_:1}),o(r(e.$t("workbench.noServiceInstalledTip2")),1)])])])):f("",!0)])),[[D,i.loading]])}const je=L(K,[["render",me],["__scopeId","data-v-fe724321"]]);export{je as default};
