import{P as A,S as F}from"./PluginList-722691e8.js";import{_ as k,r as l,o as n,c as o,F as j,g as D,b as a,a as i,t,M as q,m as E,z as x,A as h,j as p,I as m,J as f,h as y,w as b,e as g,p as z,l as U}from"./index-6053e319.js";import{B as w}from"./BeanAmount-0125dd8f.js";import{f as O,a as J}from"./service-08534623.js";import{a as R}from"./service.space-25db4f68.js";import{S as T}from"./ServiceTitle-6abe1307.js";import{S as G}from"./ServiceStatus-dc47764a.js";import"./service.version-c7c15ef3.js";const H={name:"VerticalServiceList",components:{ServiceTitle:T,BeanAmount:w},props:{space:{require:!0},services:{type:Array,required:!0}}},K={class:"service-list"},Q={class:"price-wrap"},W={class:"text-info-1 text-mini"};function X(s,r,v,N,e,S){const _=l("ServiceTitle"),d=l("BeanAmount");return n(),o("ul",K,[(n(!0),o(j,null,D(v.services,u=>(n(),o("li",{key:u.name},[a(_,{space:v.space,service:u.name,"with-paths":!1},null,8,["space","service"]),i("p",null,t(u.introduce),1),i("div",Q,[i("p",W,t(s.getDateOffsetText(u.lastPublish)),1),a(d,{price:u.price.price,type:u.price.leaseType},null,8,["price","type"])])]))),128))])}const Y=k(H,[["render",X],["__scopeId","data-v-15862673"]]);const Z={components:{ServiceStatus:G,ServiceTitle:T,VerticalServiceList:Y,BeanAmount:w,MarkdownEditor:q,PluginList:A,ServiceStructureView:F},data(){return{loading:!0,route:{space:null,service:null},currentTab:"readme",currentMajorVersion:"",currentVersion:null,majorVersions:[],space:null,service:null,majorVersionDetail:null,relationServices:[]}},computed:{...E(["userInfo"])},methods:{initData(){this.loading=!0,this.space=null,this.service=null,this.currentVersion=null,this.fetchSpace(),this.fetchServices(),this.fetchDetail()},changeMajorVersion(s){this.currentMajorVersion!==s&&(this.currentMajorVersion=s,this.fetchDetail(s))},fetchSpace(){R(this.route.space).then(s=>{this.space=s}).catch(s=>{this.$tip.apiFailed(s)})},fetchServices(){O({space:this.route.space,withSpaceInfo:!1,withPublisher:!1}).then(s=>{this.relationServices=s.filter(r=>this.route.service!==r.name)}).catch(s=>{this.$tip.apiFailed(s)})},fetchDetail(s){J({...this.route,majorVersion:s}).then(r=>{if(r==null){this.alert("该服务还未发布或已被删除").then(()=>{this.$router.push({name:"PublicServices"})});return}this.service=r,this.majorVersions=r.majorVersions,this.currentMajorVersion=s||this.majorVersions[0],this.majorVersionDetail=r.defaultMajorVersion,this.currentVersion=this.majorVersionDetail.version,this.majorVersionDetail.description==null&&this.majorVersionDetail.description.trim()===""&&(this.majorVersionDetail.description="No Descriptions")}).catch(r=>{if(r.code===5110||r.code===4002){this.alert(r.message).then(()=>{this.$router.push({name:"PublicServices"})});return}this.$tip.apiFailed(r)}).finally(()=>{this.loading=!1})}},beforeRouteUpdate(s,r,v){this.route.space=s.params.spaceName,this.route.service=s.params.serviceName,this.initData(),v()},created(){this.route.space=this.$route.params.spaceName,this.route.service=this.$route.params.serviceName,this.initData()}},$=s=>(z("data-v-a4ab00a9"),s=s(),U(),s),ee={class:"page"},se={key:0,class:"wrap"},ie={class:"header"},re={class:"tech-stack-wrap"},te={key:0,class:"major-versions"},ne=["onClick"],oe={class:"content-wrap"},ce={class:"dimension-wrap"},le={class:"dimensions"},ae={key:0,class:"detail"},ue={class:"info"},pe={class:"user-profile"},ve={class:"user-info"},he={class:"introduce"},me={class:"install"},_e=$(()=>i("i",{class:"iconfont icon-code"},null,-1)),de={class:"info-list"},fe=["href"],Se={key:1},Ve={key:0},ye={key:1},be={key:0,class:"relation-services-wrap"};function ge(s,r,v,N,e,S){const _=l("ServiceTitle"),d=l("ServiceStatus"),u=l("BeanAmount"),P=l("MarkdownEditor"),M=l("PluginList"),C=l("ServiceStructureView"),B=l("Avatar"),V=l("el-button"),I=l("VerticalServiceList"),L=x("loading");return h((n(),o("div",ee,[e.space!=null&&e.service!=null?(n(),o("div",se,[i("div",ie,[a(_,{space:e.space.name,service:e.service.name,"service-label":e.service.label},null,8,["space","service","service-label"]),i("div",re,[a(d,{"with-private":e.service.withPrivate},null,8,["with-private"]),i("p",null,t(e.majorVersionDetail.subServices.length)+" "+t(s.$t("service.plugins")),1),a(u,{price:e.service.price.price,type:e.service.price.leaseType},null,8,["price","type"])]),e.majorVersions.length>1?(n(),o("ul",te,[(n(!0),o(j,null,D(e.majorVersions,c=>(n(),o("li",{key:c,class:m({selected:c===e.currentMajorVersion}),onClick:ke=>S.changeMajorVersion(c)},"v"+t(c),11,ne))),128))])):p("",!0)]),i("div",oe,[i("div",ce,[i("ul",le,[i("li",{class:m({selected:e.currentTab==="readme"}),onClick:r[0]||(r[0]=c=>e.currentTab="readme")},"说明",2),i("li",{class:m({selected:e.currentTab==="extends"}),onClick:r[1]||(r[1]=c=>e.currentTab="extends")},"插件",2),i("li",{class:m({selected:e.currentTab==="structure"}),onClick:r[2]||(r[2]=c=>e.currentTab="structure")},"代码结构",2)]),e.majorVersionDetail!=null?(n(),o("div",ae,[h(a(P,{modelValue:e.majorVersionDetail.description,"onUpdate:modelValue":r[3]||(r[3]=c=>e.majorVersionDetail.description=c),readonly:!0,"without-padding":!0},null,8,["modelValue"]),[[f,e.currentTab==="readme"]]),h(a(M,{plugins:e.majorVersionDetail.subServices},null,8,["plugins"]),[[f,e.currentTab==="extends"]]),e.currentVersion!=null?h((n(),y(C,{key:0,space:e.route.space,service:e.route.service,version:e.currentVersion},null,8,["space","service","version"])),[[f,e.currentTab==="structure"]]):p("",!0)])):p("",!0)]),i("div",ue,[i("div",pe,[i("div",ve,[a(B,{"file-key":e.service.user.avatar,size:"30px",margin:"0 10px 0 0"},null,8,["file-key"]),i("h4",null,t(s.getUserDisplayName(e.service.user)),1)]),i("p",he,t(e.service.user.introduce===""||e.service.user.introduce==null?"这个发布者很神秘～":e.service.user.introduce),1)]),i("div",me,[a(V,{type:"important",onClick:r[4]||(r[4]=c=>s.$router.push({name:"ServiceInstaller",params:{spaceName:e.space.name,serviceName:e.service.name},query:{major:e.currentMajorVersion}}))},{default:b(()=>[_e,g(t(s.$t("service.install")),1)]),_:1}),s.userInfo!=null&&s.userInfo.isDeveloper?(n(),y(V,{key:0,onClick:r[5]||(r[5]=c=>s.$router.push({name:"CreatePlugin",query:{space:e.space.name,service:e.service.name}}))},{default:b(()=>[g("创建插件")]),_:1})):p("",!0)]),i("ul",de,[i("li",null,[i("label",null,t(s.$t("service.subServices")),1),i("p",null,t(e.majorVersionDetail.subServices.length),1)]),i("li",null,[i("label",null,t(s.$t("service.repository")),1),e.service.repository!=null&&e.service.repository!==""?(n(),o("a",{key:0,href:e.service.repository,target:"_blank"},t(e.service.repository),9,fe)):(n(),o("p",Se,t(s.$t("common.none")),1))]),i("li",null,[i("label",null,t(s.$t("service.lastPublish")),1),e.service.lastPublish!=null?(n(),o("p",Ve,t(s.getDateOffsetText(e.service.lastPublish)),1)):(n(),o("p",ye,"None"))])]),e.relationServices.length>0?(n(),o("div",be,[i("h4",null,t(s.$t("service.relationList")),1),a(I,{services:e.relationServices},null,8,["services"])])):p("",!0)])])])):p("",!0)])),[[L,e.loading]])}const Be=k(Z,[["render",ge],["__scopeId","data-v-a4ab00a9"]]);export{Be as default};
