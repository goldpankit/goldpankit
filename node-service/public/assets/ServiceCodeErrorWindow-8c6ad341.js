import{_ as I,o as n,c as d,F as S,f as C,H as T,t as y,r as s,g as _,w as v,a as p,j as F,b as g,e as M,m as w,D as O,a5 as E,z as H,A,a6 as U,p as j,l as L}from"./index-48ed7bfc.js";import{Q as G}from"./QueryModelView-8e3b2aa5.js";const J={name:"InstallCheckbox",props:{modelValue:{type:Array},type:{default:"checkbox"},options:{}},data(){return{}},computed:{optionValues(){return this.options.map(t=>t.value)}},watch:{modelValue:{immediate:!0,handler(){this.filterValues(this.modelValue)}},optionValues(){this.filterValues(this.modelValue)}},methods:{handleSelect(t){let e=this.modelValue.findIndex(r=>r===t.value),l=[];e===-1?l=this.modelValue.concat([t.value]):l=this.modelValue.filter((r,i)=>i!==e),this.filterValues(l)},filterValues(t){const e=[];for(const l of t)this.options.find(i=>i.value===l)!=null&&e.push(l);e!==this.modelValue&&(e!=null&&this.modelValue!=null&&e.join(",")===this.modelValue.join(",")||(this.$emit("update:modelValue",e),this.$emit("change",e)))}}},R={key:0,class:"installer-checkbox"},P=["onClick"],z={key:1};function B(t,e,l,r,i,o){return l.options.length>0?(n(),d("ul",R,[(n(!0),d(S,null,C(l.options,u=>(n(),d("li",{key:u.value,class:T({selected:l.modelValue==null?!1:l.modelValue.findIndex(h=>h===u.value)!==-1}),onClick:h=>o.handleSelect(u)},y(u.label),11,P))),128))])):(n(),d("p",z,"Please add options first."))}const K=I(J,[["render",B],["__scopeId","data-v-24b20c0d"]]);const X={name:"InstallInput",props:{type:{default:"text"},rows:{default:3}}};function Y(t,e,l,r,i,o){const u=s("el-input");return n(),_(u,{type:l.type,rows:l.rows,class:"install-input"},null,8,["type","rows"])}const q=I(X,[["render",Y],["__scopeId","data-v-35abcc78"]]);const Z={name:"InstallRadio",props:{modelValue:{},options:{}},data(){return{optionSettingData:{visible:!1}}},methods:{handleSelect(t){this.$emit("update:modelValue",t),this.$emit("change",t)}}},ee={key:0,class:"installer-radio"},le=["onClick"],te={key:1};function ne(t,e,l,r,i,o){return l.options.length>0?(n(),d("ul",ee,[(n(!0),d(S,null,C(l.options,u=>(n(),d("li",{key:u.value,class:T({selected:l.modelValue===u.value}),onClick:h=>o.handleSelect(u.value)},y(u.label),11,le))),128))])):(n(),d("p",te,"Please add options first."))}const D=I(Z,[["render",ne],["__scopeId","data-v-801a3273"]]);const ae={name:"MySqlFieldSelect",props:{modelValue:{},table:{required:!0},multiple:{default:!0}},methods:{handleInput(t){this.$emit("update:modelValue",t.map(e=>this.table.fields.find(l=>l.name===e)).filter(e=>e!=null))}}},oe={class:"option-content"},ie={class:"text-info-1"};function se(t,e,l,r,i,o){const u=s("el-option"),h=s("el-select");return n(),_(h,{class:"mysql-field-select","popper-class":"mysql-field-select__popper",multiple:l.multiple,"model-value":l.modelValue==null?[]:l.modelValue.map(b=>b.name),"onUpdate:modelValue":o.handleInput},{default:v(()=>[(n(!0),d(S,null,C(l.table.fields,b=>(n(),_(u,{value:b.name,label:b.name},{default:v(()=>[p("p",oe,[p("span",null,y(b.name),1),p("span",ie,y(b.comment),1)])]),_:2},1032,["value","label"]))),256))]),_:1},8,["multiple","model-value","onUpdate:modelValue"])}const ue=I(ae,[["render",se],["__scopeId","data-v-af47228f"]]);const de={name:"OptionValueInput",props:{modelValue:{},optionSetting:{required:!0}},methods:{emitChange(t){this.$emit("update:model-value",t),this.$emit("input",t)}}},re={class:"option-value-input"};function ce(t,e,l,r,i,o){const u=s("el-input"),h=s("el-input-number");return n(),d("div",re,[l.optionSetting.inputType==="input"?(n(),_(u,{key:0,"model-value":l.modelValue,"onUpdate:modelValue":o.emitChange},null,8,["model-value","onUpdate:modelValue"])):l.optionSetting.inputType==="number_input"?(n(),_(h,{key:1,"model-value":l.modelValue,controls:!1,"onUpdate:modelValue":o.emitChange},null,8,["model-value","onUpdate:modelValue"])):l.optionSetting.inputType==="textarea"?(n(),_(u,{key:2,type:"textarea",rows:1,"model-value":l.modelValue,"onUpdate:modelValue":o.emitChange},null,8,["model-value","onUpdate:modelValue"])):F("",!0)])}const me=I(de,[["render",ce],["__scopeId","data-v-c1e053d5"]]);const _e={name:"InstallSelect",components:{OptionValueInput:me},props:{modelValue:{},options:{},type:{default:"radio"}},data(){return{optionSettingData:{visible:!1}}},computed:{validOptions(){return this.options.filter(t=>t.value.trim()!==""&&t.label.trim()!=="")},currentOption(){return this.validOptions.find(t=>t.value===this.modelValue.value)},optionValues(){return this.validOptions.map(t=>t.value)},currenOptionSettings(){return this.currentOption==null?[]:this.currentOption.settings.map(t=>t.defaultValue)}},watch:{optionValues(){this.handleSelect(this.modelValue.value)},currenOptionSettings(){this.fillSettingValue()},modelValue:{immediate:!0,handler(){this.fillSettingValueFromModelValue()}}},methods:{handleSelect(t){const e=this.validOptions.find(r=>r.value===t);let l={value:null,settings:{}};if(e!=null){const r={};for(const i of e.settings)r[i.name]=i.defaultValue;l={value:t,settings:r}}this.$emit("update:modelValue",l),this.$emit("change",l),this.fillSettingValue()},fillSettingValue(){this.$nextTick(()=>{if(this.currentOption!=null)for(const t of this.currentOption.settings)t.value=t.defaultValue})},fillSettingValueFromModelValue(){for(const t in this.modelValue.settings){const e=this.options.find(r=>r.value===this.modelValue.value);if(e==null)continue;const l=e.settings.find(r=>r.name===t);l!=null&&(l.value=this.modelValue.settings[t])}}}},he={key:0,class:"install-radio-select"},pe={key:1};function ve(t,e,l,r,i,o){const u=s("el-option"),h=s("el-select"),b=s("el-button"),f=s("OptionValueInput"),m=s("el-form-item"),a=s("el-form"),V=s("el-dialog");return l.options.length>0?(n(),d("div",he,[g(h,{"model-value":l.modelValue.value,clearable:"",onChange:o.handleSelect},{default:v(()=>[(n(!0),d(S,null,C(o.validOptions,k=>(n(),_(u,{key:k.value,value:k.value,label:k.label},null,8,["value","label"]))),128))]),_:1},8,["model-value","onChange"]),o.currentOption!=null&&o.currentOption.settings.length>0?(n(),_(b,{key:0,type:"primary",icon:"Setting",class:"button-icon",onClick:e[0]||(e[0]=k=>i.optionSettingData.visible=!0)})):F("",!0),o.currentOption!=null?(n(),_(V,{key:1,modelValue:i.optionSettingData.visible,"onUpdate:modelValue":e[2]||(e[2]=k=>i.optionSettingData.visible=k),title:`${o.currentOption.label}${t.$t("service.settingsForSelectType")}`,"append-to-body":!0},{default:v(()=>[g(a,null,{default:v(()=>[(n(!0),d(S,null,C(o.currentOption.settings,k=>(n(),_(m,{key:k.name,label:k.label,required:k.required},{default:v(()=>[g(f,{modelValue:k.value,"onUpdate:modelValue":c=>k.value=c,"option-setting":k,onInput:e[1]||(e[1]=c=>t.$emit("change"))},null,8,["modelValue","onUpdate:modelValue","option-setting"])]),_:2},1032,["label","required"]))),128))]),_:1})]),_:1},8,["modelValue","title"])):F("",!0)])):(n(),d("p",pe,"Please add options first."))}const Q=I(_e,[["render",ve],["__scopeId","data-v-31aafd6c"]]);const be={name:"InstallNumberInput",props:{type:{default:"text"}}};function fe(t,e,l,r,i,o){const u=s("el-input-number");return n(),_(u,{class:"install-number-input",controls:!1})}const $=I(be,[["render",fe],["__scopeId","data-v-6340b22c"]]);const ye={name:"TableFieldVariableInput",components:{InstallNumberInput:$,InstallSelect:Q,InstallCheckbox:K,InstallRadio:D,InstallInput:q},props:{modelValue:{},variable:{required:!0}}};function ge(t,e,l,r,i,o){const u=s("InstallInput"),h=s("InstallNumberInput"),b=s("InstallSelect"),f=s("InstallCheckbox"),m=s("InstallRadio");return l.variable.inputType==="input"?(n(),_(u,{key:0,"model-value":l.modelValue,"onUpdate:modelValue":e[0]||(e[0]=a=>t.$emit("update:modelValue",a)),onInput:e[1]||(e[1]=a=>t.$emit("change",a))},null,8,["model-value"])):l.variable.inputType==="number_input"?(n(),_(h,{key:1,"model-value":l.modelValue,"onUpdate:modelValue":e[2]||(e[2]=a=>t.$emit("update:modelValue",a)),onInput:e[3]||(e[3]=a=>t.$emit("change",a))},null,8,["model-value"])):l.variable.inputType==="textarea"?(n(),_(u,{key:2,type:"textarea",rows:1,"model-value":l.modelValue,"onUpdate:modelValue":e[4]||(e[4]=a=>t.$emit("update:modelValue",a)),onInput:e[5]||(e[5]=a=>t.$emit("change",a))},null,8,["model-value"])):l.variable.inputType==="select"?(n(),_(b,{key:3,options:l.variable.options,"model-value":l.modelValue,"onUpdate:modelValue":e[6]||(e[6]=a=>t.$emit("update:modelValue",a)),onChange:e[7]||(e[7]=a=>t.$emit("change",a))},null,8,["options","model-value"])):l.variable.inputType==="checkbox"?(n(),_(f,{key:4,options:l.variable.options,"model-value":l.modelValue,"onUpdate:modelValue":e[8]||(e[8]=a=>t.$emit("update:modelValue",a)),onChange:e[9]||(e[9]=a=>t.$emit("change",a))},null,8,["options","model-value"])):l.variable.inputType==="radio"?(n(),_(m,{key:5,options:l.variable.options,"model-value":l.modelValue,"onUpdate:modelValue":e[10]||(e[10]=a=>t.$emit("update:modelValue",a)),onChange:e[11]||(e[11]=a=>t.$emit("change",a))},null,8,["options","model-value"])):F("",!0)}const N=I(ye,[["render",ge],["__scopeId","data-v-7763fb5d"]]);function x(t){return t==null||t===""||t.trim&&t.trim()===""||JSON.stringify(t)==="[]"||JSON.stringify(t)==="{}"}function W(t){return t==="input"||t==="textarea"||t==="radio"?"":t==="select"?{value:null,settings:[]}:t==="checkbox"?[]:t==="table"||t==="database"||t==="query_model"?null:""}const Ve={name:"FieldSetting",components:{TableFieldVariableInput:N,MySqlFieldSelect:ue},props:{valueKey:{default:"value"},table:{required:!0},group:{required:!0}},methods:{handleSelect(t){for(const e of t){e.origin==null&&(e.origin=JSON.parse(JSON.stringify(e)));for(const l of this.group.children)e[l.name]=x(e[l.name])?l.defaultValue:e[l.name],x(e[l.name])&&(e[l.name]=W(l.inputType))}this.group[this.valueKey]=t,this.emitChange()},emitChange(){this.$emit("change")},getColumnMinWidth(t){return t.inputType==="select"?"150px":"120px"}}},Se={key:0,class:"required"};function Ie(t,e,l,r,i,o){const u=s("MySqlFieldSelect"),h=s("el-table-column"),b=s("TableFieldVariableInput"),f=s("el-table");return n(),d(S,null,[p("h5",null,y(l.group.label),1),g(u,{"onUpdate:modelValue":o.handleSelect,"model-value":l.group[l.valueKey],table:l.table,placeholder:"Select fields"},null,8,["onUpdate:modelValue","model-value","table"]),g(f,{size:"small",data:l.group[l.valueKey]},{default:v(()=>[g(h,{label:"字段名",width:"100px",prop:"name",fixed:""}),(n(!0),d(S,null,C(l.group.children,m=>(n(),_(h,{key:m.name,label:m.label,"min-width":o.getColumnMinWidth(m)},{header:v(()=>[m.required?(n(),d("em",Se,"*")):F("",!0),M(y(m.label),1)]),default:v(({row:a})=>[g(b,{variable:m,modelValue:a[m.name],"onUpdate:modelValue":V=>a[m.name]=V,onChange:o.emitChange},null,8,["variable","modelValue","onUpdate:modelValue","onChange"])]),_:2},1032,["label","min-width"]))),128))]),_:1},8,["data"])],64)}const ke=I(Ve,[["render",Ie],["__scopeId","data-v-897a442e"]]);const Ce={name:"TableSelect",components:{FieldSetting:ke},props:{modelValue:{},valueKey:{default:"value"},variable:{required:!0}},data(){return{selected:null,databases:[],tables:[]}},computed:{...w(["currentProject","currentDatabase"]),fieldVariableGroup(){return this.variable.children||[]}},watch:{currentDatabase(){this.fetchTables()}},methods:{handleChange(t){this.selected=this.tables.find(e=>e.name===t),this.fieldVariableGroup.forEach(e=>{e[this.valueKey]=[]}),this.$emit("update:modelValue",t),this.$emit("change",t)},emitChange(){this.$emit("change")},fetchDatabases(){O().then(t=>{this.databases=t,this.fetchTables()}).catch(t=>{this.$tip.apiFailed(t)})},fetchTables(){const t=this.databases.find(e=>e.id===this.currentDatabase);if(t==null){this.tables=[];return}E({host:t.host,port:t.port,user:t.username,password:t.password,database:t.schema}).then(e=>{this.tables=e,this.modelValue!=null&&(this.selected=this.tables.find(l=>l.name===this.modelValue),this.selected==null&&this.handleChange(null))}).catch(e=>{this.$tip.apiFailed(e)})}},created(){this.fetchDatabases()}},Fe={class:"option-content"},Te={class:"text-info-1"},xe={key:0,class:"field-settings"};function we(t,e,l,r,i,o){const u=s("el-option"),h=s("el-select"),b=s("FieldSetting");return n(),d(S,null,[g(h,{class:"table-select","popper-class":"table-select__popper","model-value":l.modelValue,clearable:"",onChange:o.handleChange},{default:v(()=>[(n(!0),d(S,null,C(i.tables,f=>(n(),_(u,{key:f.name,value:f.name,label:f.name},{default:v(()=>[p("p",Fe,[p("span",null,y(f.name),1),p("span",Te,y(f.comment),1)])]),_:2},1032,["value","label"]))),128))]),_:1},8,["model-value","onChange"]),i.selected!=null&&o.fieldVariableGroup.length>0?(n(),d("ul",xe,[(n(!0),d(S,null,C(o.fieldVariableGroup,f=>(n(),d("li",{key:f.label},[g(b,{"value-key":l.valueKey,table:i.selected,group:f,onChange:o.emitChange},null,8,["value-key","table","group","onChange"])]))),128))])):F("",!0)],64)}const Me=I(Ce,[["render",we],["__scopeId","data-v-624bbd32"]]);const Oe={name:"QueryModelFieldSelect",props:{modelValue:{},model:{required:!0},multiple:{default:!0}},data(){return{tables:[],selectedFields:[],currentHoverTable:null,currentHoverField:null,leaveFieldTimeout:null}},watch:{model:{immediate:!0,handler(){this.__handleTables()}},modelValue:{immediate:!0,handler(){this.selectedFields=this.__getSelectedFieldsObjects(this.modelValue)}}},methods:{handleFieldSorted(){this.$emit("update:modelValue",this.selectedFields.map(t=>`${t.table.id}.${t.name}`)),this.$emit("fields:change",this.selectedFields)},handleCheckAllChange(t,e){let l=[];e&&(l=t.fields.map(i=>`${t.id}.${i.name}`));let r=this.modelValue;r=r.filter(i=>!i.startsWith(`${t.id}.`)),r=r.concat(l),this.handleInput(t,r)},handleInput(t,e){const l=e.filter(i=>i.startsWith(`${t.id}.`));t.checkedAll=l.length===t.fields.length;let r=this.__getSelectedFieldsObjects(e);this.selectedFields.splice(0,this.selectedFields.length),this.selectedFields.push.apply(this.selectedFields,r),this.$emit("update:modelValue",e),this.$emit("fields:change",this.selectedFields)},handleFieldEnter(t){this.leaveFieldTimeout!=null&&clearTimeout(this.leaveFieldTimeout),this.currentHoverField=t},handleFieldLeave(){this.leaveFieldTimeout=setTimeout(()=>{this.currentHoverField=null},500)},handleTableEnter(t){this.currentHoverTable=t},handleTableLeave(){this.currentHoverTable=null},close(){this.handleTableLeave(),this.handleFieldLeave()},__handleTables(){this.tables=[];for(const t of this.model.tables){const e=t.fields.filter(l=>l.visible);e.length>0&&this.tables.push({id:t.id,type:t.type,name:t.name,alias:t.alias,fields:e,checkedAll:!1})}},__getSelectedFieldsObjects(t){return t.map(e=>{const l=e.split(".")[0],r=e.split(".")[1],i=this.model.tables.find(h=>h.id===l),o=JSON.parse(JSON.stringify(i)),u=i.fields.find(h=>h.name===r);return delete o.fields,u.table=o,u}).filter(e=>e!=null)}}},Ue={class:"model-field-select"},Ke={class:"selected-preview"},qe=["onMouseenter"],De={key:0},Qe={class:"field-select__tables"},$e=["onMouseenter"],Ne={class:"table__header"},We={class:"table__fields-wrap"},Ee={class:"table-fields"},He={key:0,class:"text-info-1"};function Ae(t,e,l,r,i,o){const u=s("el-checkbox"),h=s("el-checkbox-group"),b=s("el-scrollbar"),f=s("el-popover"),m=H("sortable");return n(),d("div",Ue,[g(f,{trigger:"click","popper-class":"model-field-select-popper","hide-after":0,persistent:!1,onHide:o.close},{reference:v(()=>[A((n(),d("ul",Ke,[(n(!0),d(S,null,C(i.selectedFields,a=>(n(),d("li",{key:a.name,class:T({"field-light":i.currentHoverTable!=null&&a.table.id===i.currentHoverTable.id}),onMouseenter:V=>o.handleFieldEnter(a),onMouseleave:e[0]||(e[0]=(...V)=>o.handleFieldLeave&&o.handleFieldLeave(...V))},[p("p",null,y(a.table.alias)+"."+y(a.name),1),a.comment!=null&&a.comment!==""?(n(),d("p",De,y(a.comment),1)):F("",!0)],42,qe))),128))])),[[m,{data:i.selectedFields,onChange:o.handleFieldSorted},"config"]])]),default:v(()=>[p("div",Qe,[(n(!0),d(S,null,C(i.tables,a=>(n(),d("div",{key:a.alias,class:T(["field-select__table",{"table-main":a.type==="MAIN","table-light":i.currentHoverField!=null&&a.id===i.currentHoverField.table.id}]),onMouseenter:V=>o.handleTableEnter(a),onMouseleave:e[1]||(e[1]=(...V)=>o.handleTableLeave&&o.handleTableLeave(...V))},[p("div",Ne,[g(u,{modelValue:a.checkedAll,"onUpdate:modelValue":V=>a.checkedAll=V,onChange:V=>o.handleCheckAllChange(a,V)},{default:v(()=>[p("h4",null,y(a.name)+" AS "+y(a.alias),1)]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])]),p("div",We,[g(b,null,{default:v(()=>[p("div",Ee,[g(h,{"model-value":l.modelValue,onChange:V=>o.handleInput(a,V)},{default:v(()=>[(n(!0),d(S,null,C(a.fields,V=>(n(),_(u,{label:`${a.id}.${V.name}`,key:V.name},{default:v(()=>[p("p",null,y(V.name),1),V.comment!==""?(n(),d("p",He,y(V.comment),1)):F("",!0)]),_:2},1032,["label"]))),128))]),_:2},1032,["model-value","onChange"])])]),_:2},1024)])],42,$e))),128))])]),_:1},8,["onHide"])])}const je=I(Oe,[["render",Ae],["__scopeId","data-v-5568b9c1"]]);const Le={name:"QueryModelFieldSetting",components:{QueryModelFieldSelect:je,TableFieldVariableInput:N},props:{valueKey:{default:"value"},model:{required:!0},group:{required:!0}},data(){return{selectedFields:[]}},watch:{model(){this.initSelectedFields()}},methods:{initSelectedFields(){this.selectedFields=[];const t=this.group[this.valueKey];t!=null&&t.length>0&&(this.selectedFields=t.map(e=>`${e.table.id}.${e.name}`))},handleSelect(t){for(const e of t){e.origin==null&&(e.origin=JSON.parse(JSON.stringify(e)));for(const l of this.group.children)e[l.name]=x(e[l.name])?l.defaultValue:e[l.name],x(e[l.name])&&(e[l.name]=W(l.inputType))}this.group[this.valueKey]=t,this.emitChange()},emitChange(){this.$emit("change")},getColumnMinWidth(t){return t.inputType==="select"?"150px":"120px"}},created(){this.initSelectedFields()}},Ge={key:0,class:"required"};function Je(t,e,l,r,i,o){const u=s("QueryModelFieldSelect"),h=s("el-table-column"),b=s("TableFieldVariableInput"),f=s("el-table");return n(),d(S,null,[p("h5",null,y(l.group.label),1),g(u,{modelValue:i.selectedFields,"onUpdate:modelValue":e[0]||(e[0]=m=>i.selectedFields=m),model:l.model,placeholder:"Select fields","onFields:change":o.handleSelect},null,8,["modelValue","model","onFields:change"]),l.group.children.length>0?(n(),_(f,{key:0,size:"small",data:l.group[l.valueKey]},{default:v(()=>[g(h,{label:"字段名",width:"150px",prop:"name",fixed:""},{default:v(({row:m})=>[p("p",null,y(m.table.alias)+"."+y(m.name),1),p("p",null,y(m.comment),1)]),_:1}),(n(!0),d(S,null,C(l.group.children,m=>(n(),_(h,{key:m.name,label:m.label,"min-width":o.getColumnMinWidth(m)},{header:v(()=>[m.required?(n(),d("em",Ge,"*")):F("",!0),M(y(m.label),1)]),default:v(({row:a})=>[g(b,{variable:m,modelValue:a[m.name],"onUpdate:modelValue":V=>a[m.name]=V,onChange:o.emitChange},null,8,["variable","modelValue","onUpdate:modelValue","onChange"])]),_:2},1032,["label","min-width"]))),128))]),_:1},8,["data"])):F("",!0)],64)}const Re=I(Le,[["render",Je],["__scopeId","data-v-4e174456"]]);const Pe={name:"QueryModelWindow",components:{DataSourceSelect:U,QueryModelView:G},data(){return{visible:!1}},computed:{...w(["currentDatabase"])},methods:{open(){this.visible=!0},close(){this.visible=!1,this.$emit("close")}}},ze=p("h2",null,"查询模型设计",-1),Be={class:"header__opera"};function Xe(t,e,l,r,i,o){const u=s("DataSourceSelect"),h=s("Close"),b=s("el-icon"),f=s("QueryModelView"),m=s("el-dialog");return n(),_(m,{"custom-class":"query-model-window",modelValue:i.visible,"onUpdate:modelValue":e[0]||(e[0]=a=>i.visible=a),fullscreen:"","append-to-body":"","show-close":!1},{header:v(()=>[ze,p("div",Be,[g(u,{"model-value":t.currentDatabase},null,8,["model-value"]),g(b,{onClick:o.close},{default:v(()=>[g(h)]),_:1},8,["onClick"])])]),default:v(()=>[g(f)]),_:1},8,["modelValue"])}const Ye=I(Pe,[["render",Xe]]),Ze="/images/database/icon-design.svg";const el={name:"QueryModelSelect",components:{QueryModelWindow:Ye,QueryModelFieldSetting:Re},props:{modelValue:{},valueKey:{default:"value"},variable:{required:!0}},data(){return{databases:[],models:[],selected:null}},computed:{...w(["currentProject","currentDatabase"]),fieldVariableGroup(){return this.variable.children||[]}},watch:{currentDatabase(){this.fetchModels()}},methods:{handleChange(t){this.selected=this.models.find(e=>e.id===t),this.fieldVariableGroup.forEach(e=>{e[this.valueKey]=[]}),this.$emit("update:modelValue",t),this.emitChange()},emitChange(){this.$emit("change")},fetchDatabases(){O().then(t=>{this.databases=t,this.fetchModels()}).catch(t=>{this.$tip.apiFailed(t)})},fetchModels(){const t=this.databases.find(e=>e.id===this.currentDatabase);if(t==null){this.models=[];return}this.models=t.models,this.modelValue!=null&&(this.selected=this.models.find(e=>e.id===this.modelValue),this.selected==null&&this.handleChange(null))}},created(){this.fetchDatabases()}},ll=t=>(j("data-v-0179f899"),t=t(),L(),t),tl={class:"query-model-select"},nl={class:"option-content"},al={class:"text-info-1"},ol=ll(()=>p("img",{src:Ze},null,-1)),il={key:0,class:"field-settings"};function sl(t,e,l,r,i,o){const u=s("el-option"),h=s("el-select"),b=s("el-button"),f=s("QueryModelWindow"),m=s("QueryModelFieldSetting");return n(),d(S,null,[p("div",tl,[g(h,{class:"model-select","popper-class":"model-select__popper","model-value":l.modelValue,clearable:"",onChange:o.handleChange},{default:v(()=>[(n(!0),d(S,null,C(i.models,a=>(n(),_(u,{key:a.id,value:a.id,label:a.name},{default:v(()=>[p("p",nl,[p("span",null,y(a.name),1),p("span",al,y(a.comment),1)])]),_:2},1032,["value","label"]))),128))]),_:1},8,["model-value","onChange"]),g(b,{class:"button-icon",type:"primary",onClick:e[0]||(e[0]=a=>t.$refs.queryModelWindow.open())},{default:v(()=>[ol]),_:1}),g(f,{ref:"queryModelWindow",onClose:o.fetchDatabases},null,8,["onClose"])]),i.selected!=null&&o.fieldVariableGroup.length>0?(n(),d("ul",il,[(n(!0),d(S,null,C(o.fieldVariableGroup,a=>(n(),d("li",{key:a.label},[g(m,{"value-key":l.valueKey,model:i.selected,group:a,onChange:o.emitChange},null,8,["value-key","model","group","onChange"])]))),128))])):F("",!0)],64)}const ul=I(el,[["render",sl],["__scopeId","data-v-0179f899"]]);const dl={name:"VariableInput",components:{InstallNumberInput:$,InstallSelect:Q,DataSourceSelect:U,QueryModelSelect:ul,TableSelect:Me,InstallCheckbox:K,InstallRadio:D,InstallInput:q},props:{variable:{required:!0},valueKey:{default:"value"}},computed:{inputType(){return this.variable.inputType}}},rl={class:"variable-input"};function cl(t,e,l,r,i,o){const u=s("InstallInput"),h=s("InstallNumberInput"),b=s("InstallSelect"),f=s("InstallCheckbox"),m=s("InstallRadio"),a=s("DataSourceSelect"),V=s("TableSelect"),k=s("QueryModelSelect");return n(),d("div",rl,[l.variable.inputType==="input"?(n(),_(u,{key:0,modelValue:l.variable[l.valueKey],"onUpdate:modelValue":e[0]||(e[0]=c=>l.variable[l.valueKey]=c),onInput:e[1]||(e[1]=c=>t.$emit("change",c))},null,8,["modelValue"])):F("",!0),l.variable.inputType==="number_input"?(n(),_(h,{key:1,modelValue:l.variable[l.valueKey],"onUpdate:modelValue":e[2]||(e[2]=c=>l.variable[l.valueKey]=c),onInput:e[3]||(e[3]=c=>t.$emit("change",c))},null,8,["modelValue"])):l.variable.inputType==="textarea"?(n(),_(u,{key:2,type:"textarea",modelValue:l.variable[l.valueKey],"onUpdate:modelValue":e[4]||(e[4]=c=>l.variable[l.valueKey]=c),onInput:e[5]||(e[5]=c=>t.$emit("change",c))},null,8,["modelValue"])):l.variable.inputType==="select"?(n(),_(b,{key:3,modelValue:l.variable[l.valueKey],"onUpdate:modelValue":e[6]||(e[6]=c=>l.variable[l.valueKey]=c),options:l.variable.options,onChange:e[7]||(e[7]=c=>t.$emit("change",c))},null,8,["modelValue","options"])):l.variable.inputType==="checkbox"?(n(),_(f,{key:4,modelValue:l.variable[l.valueKey],"onUpdate:modelValue":e[8]||(e[8]=c=>l.variable[l.valueKey]=c),options:l.variable.options,onChange:e[9]||(e[9]=c=>t.$emit("change",c))},null,8,["modelValue","options"])):l.variable.inputType==="radio"?(n(),_(m,{key:5,modelValue:l.variable[l.valueKey],"onUpdate:modelValue":e[10]||(e[10]=c=>l.variable[l.valueKey]=c),options:l.variable.options,onChange:e[11]||(e[11]=c=>t.$emit("change",c))},null,8,["modelValue","options"])):l.variable.inputType==="datasource"?(n(),_(a,{key:6,modelValue:l.variable[l.valueKey],"onUpdate:modelValue":e[12]||(e[12]=c=>l.variable[l.valueKey]=c),"with-prefix":!1,"with-block":!0,onChange:e[13]||(e[13]=c=>t.$emit("change",c))},null,8,["modelValue"])):l.variable.inputType==="table"?(n(),_(V,{key:7,variable:l.variable,"value-key":l.valueKey,modelValue:l.variable[l.valueKey],"onUpdate:modelValue":e[14]||(e[14]=c=>l.variable[l.valueKey]=c),onChange:e[15]||(e[15]=c=>t.$emit("change",c))},null,8,["variable","value-key","modelValue"])):l.variable.inputType==="query_model"?(n(),_(k,{key:8,variable:l.variable,"value-key":l.valueKey,modelValue:l.variable[l.valueKey],"onUpdate:modelValue":e[16]||(e[16]=c=>l.variable[l.valueKey]=c),onChange:e[17]||(e[17]=c=>t.$emit("change",c))},null,8,["variable","value-key","modelValue"])):F("",!0)])}const gl=I(dl,[["render",cl],["__scopeId","data-v-dbb70002"]]);const ml={name:"ServiceCodeErrorWindow",data(){return{visible:!1,error:null}},methods:{open(t){this.error=t,this.visible=!0}}},_l={class:"window-header-wrap"},hl={class:"title"},pl={class:"tip"},vl={class:"window-content-wrap"};function bl(t,e,l,r,i,o){const u=s("CircleCloseFilled"),h=s("el-icon"),b=s("el-dialog");return n(),_(b,{modelValue:i.visible,"onUpdate:modelValue":e[0]||(e[0]=f=>i.visible=f),width:"1000px","custom-class":"service-code-error-window","show-close":!1},{header:v(()=>[p("div",_l,[p("div",hl,[g(h,null,{default:v(()=>[g(u)]),_:1}),p("h5",null,y(t.$t("service.serviceCodeErrorTitle")),1)]),p("p",pl,y(t.$t("service.serviceCodeErrorTip")),1)])]),default:v(()=>[p("div",vl,[p("p",null,"at "+y(i.error.position),1),p("pre",null,y(i.error.message),1)])]),_:1},8,["modelValue"])}const Vl=I(ml,[["render",bl]]);export{ke as F,D as I,ue as M,me as O,Vl as S,gl as V,q as a,K as b,W as g,x as i};
