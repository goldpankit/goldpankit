import{_ as C,o as n,c as r,F as S,f as F,H as T,t as b,r as s,g as h,w as v,a as _,j as I,b as y,e as x,m as M,D as K,a5 as G,z as q,A as D,p as O,l as U,a0 as J,a6 as Q}from"./index-bbbc4d77.js";import{Q as B}from"./QueryModelView-32ee0b4f.js";const R={name:"InstallCheckbox",props:{modelValue:{type:Array},type:{default:"checkbox"},options:{}},data(){return{}},computed:{optionValues(){return this.options.map(e=>e.value)}},watch:{modelValue:{immediate:!0,handler(){this.filterValues(this.modelValue)}},optionValues(){this.filterValues(this.modelValue)}},methods:{handleSelect(e){let l=this.modelValue.findIndex(m=>m===e.value),t=[];l===-1?t=this.modelValue.concat([e.value]):t=this.modelValue.filter((m,i)=>i!==l),this.filterValues(t)},filterValues(e){const l=[];for(const t of e)this.options.find(i=>i.value===t)!=null&&l.push(t);l!==this.modelValue&&(l!=null&&this.modelValue!=null&&l.join(",")===this.modelValue.join(",")||(this.$emit("update:modelValue",l),this.$emit("change",l)))}}},P={key:0,class:"installer-checkbox"},z=["onClick"],X={key:1};function Y(e,l,t,m,i,o){return t.options.length>0?(n(),r("ul",P,[(n(!0),r(S,null,F(t.options,d=>(n(),r("li",{key:d.value,class:T({selected:t.modelValue==null?!1:t.modelValue.findIndex(p=>p===d.value)!==-1}),onClick:p=>o.handleSelect(d)},b(d.label),11,z))),128))])):(n(),r("p",X,"Please add options first."))}const N=C(R,[["render",Y],["__scopeId","data-v-24b20c0d"]]);const Z={name:"InstallInput",props:{type:{default:"text"},rows:{default:3}}};function ee(e,l,t,m,i,o){const d=s("el-input");return n(),h(d,{type:t.type,rows:t.rows,class:"install-input"},null,8,["type","rows"])}const $=C(Z,[["render",ee],["__scopeId","data-v-35abcc78"]]);const le={name:"InstallRadio",props:{modelValue:{},options:{}},data(){return{optionSettingData:{visible:!1}}},methods:{handleSelect(e){this.$emit("update:modelValue",e),this.$emit("change",e)}}},te={key:0,class:"installer-radio"},ne=["onClick"],ae={key:1};function oe(e,l,t,m,i,o){return t.options.length>0?(n(),r("ul",te,[(n(!0),r(S,null,F(t.options,d=>(n(),r("li",{key:d.value,class:T({selected:t.modelValue===d.value}),onClick:p=>o.handleSelect(d.value)},b(d.label),11,ne))),128))])):(n(),r("p",ae,"Please add options first."))}const W=C(le,[["render",oe],["__scopeId","data-v-801a3273"]]);const ie={name:"MySqlFieldSelect",props:{modelValue:{},table:{required:!0},multiple:{default:!0}},methods:{handleInput(e){this.$emit("update:modelValue",e.map(l=>this.table.fields.find(t=>t.name===l)).filter(l=>l!=null))}}},se={class:"option-content"},ue={class:"text-info-1"};function de(e,l,t,m,i,o){const d=s("el-option"),p=s("el-select");return n(),h(p,{class:"mysql-field-select","popper-class":"mysql-field-select__popper",multiple:t.multiple,"model-value":t.modelValue==null?[]:t.modelValue.map(f=>f.name),"onUpdate:modelValue":o.handleInput},{default:v(()=>[(n(!0),r(S,null,F(t.table.fields,f=>(n(),h(d,{value:f.name,label:f.name},{default:v(()=>[_("p",se,[_("span",null,b(f.name),1),_("span",ue,b(f.comment),1)])]),_:2},1032,["value","label"]))),256))]),_:1},8,["multiple","model-value","onUpdate:modelValue"])}const re=C(ie,[["render",de],["__scopeId","data-v-af47228f"]]);const ce={name:"OptionValueInput",props:{modelValue:{},optionSetting:{required:!0}},methods:{emitChange(e){this.$emit("update:model-value",e),this.$emit("input",e)}}},me={class:"option-value-input"};function _e(e,l,t,m,i,o){const d=s("el-input"),p=s("el-input-number");return n(),r("div",me,[t.optionSetting.inputType==="input"?(n(),h(d,{key:0,"model-value":t.modelValue,"onUpdate:modelValue":o.emitChange},null,8,["model-value","onUpdate:modelValue"])):t.optionSetting.inputType==="number_input"?(n(),h(p,{key:1,"model-value":t.modelValue,controls:!1,"onUpdate:modelValue":o.emitChange},null,8,["model-value","onUpdate:modelValue"])):t.optionSetting.inputType==="textarea"?(n(),h(d,{key:2,type:"textarea",rows:1,"model-value":t.modelValue,"onUpdate:modelValue":o.emitChange},null,8,["model-value","onUpdate:modelValue"])):I("",!0)])}const he=C(ce,[["render",_e],["__scopeId","data-v-c1e053d5"]]);const pe={name:"InstallSelect",components:{OptionValueInput:he},props:{modelValue:{},options:{},type:{default:"radio"}},data(){return{optionSettingData:{visible:!1}}},computed:{validOptions(){return this.options.filter(e=>e.value.trim()!==""&&e.label.trim()!=="")},currentOption(){return this.validOptions.find(e=>e.value===this.modelValue.value)},optionValues(){return this.validOptions.map(e=>e.value)},currenOptionSettings(){return this.currentOption==null?[]:this.currentOption.settings.map(e=>e.defaultValue)}},watch:{optionValues(){this.handleSelect(this.modelValue.value)},currenOptionSettings(){this.fillSettingValue()},modelValue:{immediate:!0,handler(){this.fillSettingValueFromModelValue()}}},methods:{handleSelect(e){const l=this.validOptions.find(m=>m.value===e);let t={value:null,settings:{}};if(l!=null){const m={};for(const i of l.settings)m[i.name]=i.defaultValue;t={value:e,settings:m}}this.$emit("update:modelValue",t),this.$emit("change",t),this.fillSettingValue()},fillSettingValue(){this.$nextTick(()=>{if(this.currentOption!=null)for(const e of this.currentOption.settings)e.value=e.defaultValue})},fillSettingValueFromModelValue(){for(const e in this.modelValue.settings){const l=this.options.find(m=>m.value===this.modelValue.value);if(l==null)continue;const t=l.settings.find(m=>m.name===e);t!=null&&(t.value=this.modelValue.settings[e])}}}},ve={key:0,class:"install-radio-select"},be={key:1};function fe(e,l,t,m,i,o){const d=s("el-option"),p=s("el-select"),f=s("el-button"),g=s("OptionValueInput"),V=s("el-form-item"),a=s("el-form"),u=s("el-dialog");return t.options.length>0?(n(),r("div",ve,[y(p,{"model-value":t.modelValue.value,clearable:"",onChange:o.handleSelect},{default:v(()=>[(n(!0),r(S,null,F(o.validOptions,k=>(n(),h(d,{key:k.value,value:k.value,label:k.label},null,8,["value","label"]))),128))]),_:1},8,["model-value","onChange"]),o.currentOption!=null&&o.currentOption.settings.length>0?(n(),h(f,{key:0,type:"primary",icon:"Setting",class:"button-icon",onClick:l[0]||(l[0]=k=>i.optionSettingData.visible=!0)})):I("",!0),o.currentOption!=null?(n(),h(u,{key:1,modelValue:i.optionSettingData.visible,"onUpdate:modelValue":l[2]||(l[2]=k=>i.optionSettingData.visible=k),title:`${o.currentOption.label}${e.$t("service.settingsForSelectType")}`,"append-to-body":!0},{default:v(()=>[y(a,null,{default:v(()=>[(n(!0),r(S,null,F(o.currentOption.settings,k=>(n(),h(V,{key:k.name,label:k.label,required:k.required},{default:v(()=>[y(g,{modelValue:t.modelValue.settings[k.name],"onUpdate:modelValue":c=>t.modelValue.settings[k.name]=c,"option-setting":k,onInput:l[1]||(l[1]=c=>e.$emit("change"))},null,8,["modelValue","onUpdate:modelValue","option-setting"])]),_:2},1032,["label","required"]))),128))]),_:1})]),_:1},8,["modelValue","title"])):I("",!0)])):(n(),r("p",be,"Please add options first."))}const E=C(pe,[["render",fe],["__scopeId","data-v-f7bbb9b8"]]);const ye={name:"InstallNumberInput",props:{type:{default:"text"}}};function ge(e,l,t,m,i,o){const d=s("el-input-number");return n(),h(d,{class:"install-number-input",controls:!1})}const A=C(ye,[["render",ge],["__scopeId","data-v-6340b22c"]]);const Ve={name:"TableFieldVariableInput",components:{InstallNumberInput:A,InstallSelect:E,InstallCheckbox:N,InstallRadio:W,InstallInput:$},props:{modelValue:{},variable:{required:!0}}};function Se(e,l,t,m,i,o){const d=s("InstallInput"),p=s("InstallNumberInput"),f=s("InstallSelect"),g=s("InstallCheckbox"),V=s("InstallRadio");return t.variable.inputType==="input"?(n(),h(d,{key:0,"model-value":t.modelValue,"onUpdate:modelValue":l[0]||(l[0]=a=>e.$emit("update:modelValue",a)),onInput:l[1]||(l[1]=a=>e.$emit("change",a))},null,8,["model-value"])):t.variable.inputType==="number_input"?(n(),h(p,{key:1,"model-value":t.modelValue,"onUpdate:modelValue":l[2]||(l[2]=a=>e.$emit("update:modelValue",a)),onInput:l[3]||(l[3]=a=>e.$emit("change",a))},null,8,["model-value"])):t.variable.inputType==="textarea"?(n(),h(d,{key:2,type:"textarea",rows:1,"model-value":t.modelValue,"onUpdate:modelValue":l[4]||(l[4]=a=>e.$emit("update:modelValue",a)),onInput:l[5]||(l[5]=a=>e.$emit("change",a))},null,8,["model-value"])):t.variable.inputType==="select"?(n(),h(f,{key:3,options:t.variable.options,"model-value":t.modelValue,"onUpdate:modelValue":l[6]||(l[6]=a=>e.$emit("update:modelValue",a)),onChange:l[7]||(l[7]=a=>e.$emit("change",a))},null,8,["options","model-value"])):t.variable.inputType==="checkbox"?(n(),h(g,{key:4,options:t.variable.options,"model-value":t.modelValue,"onUpdate:modelValue":l[8]||(l[8]=a=>e.$emit("update:modelValue",a)),onChange:l[9]||(l[9]=a=>e.$emit("change",a))},null,8,["options","model-value"])):t.variable.inputType==="radio"?(n(),h(V,{key:5,options:t.variable.options,"model-value":t.modelValue,"onUpdate:modelValue":l[10]||(l[10]=a=>e.$emit("update:modelValue",a)),onChange:l[11]||(l[11]=a=>e.$emit("change",a))},null,8,["options","model-value"])):I("",!0)}const H=C(Ve,[["render",Se],["__scopeId","data-v-7763fb5d"]]);function w(e){return e==null||e===""||e.trim&&e.trim()===""||JSON.stringify(e)==="[]"||JSON.stringify(e)==="{}"}function j(e){return e==="input"||e==="textarea"||e==="radio"?"":e==="select"?{value:null,settings:[]}:e==="checkbox"?[]:e==="table"||e==="database"||e==="query_model"?null:""}const ke={name:"FieldSetting",components:{TableFieldVariableInput:H,MySqlFieldSelect:re},props:{valueKey:{default:"value"},table:{required:!0},group:{required:!0}},methods:{handleSelect(e){for(const l of e){l.origin==null&&(l.origin=JSON.parse(JSON.stringify(l)));for(const t of this.group.children)l[t.name]=w(l[t.name])?t.defaultValue:l[t.name],w(l[t.name])&&(l[t.name]=j(t.inputType))}this.group[this.valueKey]=e,this.emitChange()},emitChange(){this.$emit("change")},getColumnMinWidth(e){return e.inputType==="select"?"150px":"120px"}}},Ie={key:0,class:"required"};function Ce(e,l,t,m,i,o){const d=s("MySqlFieldSelect"),p=s("el-table-column"),f=s("TableFieldVariableInput"),g=s("el-table");return n(),r(S,null,[_("h5",null,b(t.group.label),1),y(d,{"onUpdate:modelValue":o.handleSelect,"model-value":t.group[t.valueKey],table:t.table,placeholder:"Select fields"},null,8,["onUpdate:modelValue","model-value","table"]),y(g,{size:"small",data:t.group[t.valueKey]},{default:v(()=>[y(p,{label:"字段名",width:"100px",prop:"name",fixed:""}),(n(!0),r(S,null,F(t.group.children,V=>(n(),h(p,{key:V.name,label:V.label,"min-width":o.getColumnMinWidth(V)},{header:v(()=>[V.required?(n(),r("em",Ie,"*")):I("",!0),x(b(V.label),1)]),default:v(({row:a})=>[y(f,{variable:V,modelValue:a[V.name],"onUpdate:modelValue":u=>a[V.name]=u,onChange:o.emitChange},null,8,["variable","modelValue","onUpdate:modelValue","onChange"])]),_:2},1032,["label","min-width"]))),128))]),_:1},8,["data"])],64)}const Fe=C(ke,[["render",Ce],["__scopeId","data-v-897a442e"]]);const xe={name:"TableSelect",components:{FieldSetting:Fe},props:{modelValue:{},valueKey:{default:"value"},variable:{required:!0}},data(){return{selected:null,databases:[],tables:[]}},computed:{...M(["currentProject","currentDatabase"]),fieldVariableGroup(){return this.variable.children||[]}},watch:{currentDatabase(){this.fetchTables()}},methods:{handleChange(e){this.selected=this.tables.find(l=>l.name===e),this.fieldVariableGroup.forEach(l=>{l[this.valueKey]=[]}),this.$emit("update:modelValue",e),this.$emit("change",e)},emitChange(){this.$emit("change")},fetchDatabases(){K().then(e=>{this.databases=e,this.fetchTables()}).catch(e=>{this.$tip.apiFailed(e)})},fetchTables(){const e=this.databases.find(l=>l.id===this.currentDatabase);if(e==null){this.tables=[];return}G({host:e.host,port:e.port,user:e.username,password:e.password,database:e.schema}).then(l=>{this.tables=l,this.modelValue!=null&&(this.selected=this.tables.find(t=>t.name===this.modelValue),this.selected==null&&this.handleChange(null))}).catch(l=>{this.$tip.apiFailed(l)})}},created(){this.fetchDatabases()}},Te={class:"option-content"},we={class:"text-info-1"},Me={key:0,class:"field-settings"};function Oe(e,l,t,m,i,o){const d=s("el-option"),p=s("el-select"),f=s("FieldSetting");return n(),r(S,null,[y(p,{class:"table-select","popper-class":"table-select__popper","model-value":t.modelValue,clearable:"",onChange:o.handleChange},{default:v(()=>[(n(!0),r(S,null,F(i.tables,g=>(n(),h(d,{key:g.name,value:g.name,label:g.name},{default:v(()=>[_("p",Te,[_("span",null,b(g.name),1),_("span",we,b(g.comment),1)])]),_:2},1032,["value","label"]))),128))]),_:1},8,["model-value","onChange"]),i.selected!=null&&o.fieldVariableGroup.length>0?(n(),r("ul",Me,[(n(!0),r(S,null,F(o.fieldVariableGroup,g=>(n(),r("li",{key:g.label},[y(f,{"value-key":t.valueKey,table:i.selected,group:g,onChange:o.emitChange},null,8,["value-key","table","group","onChange"])]))),128))])):I("",!0)],64)}const Ue=C(xe,[["render",Oe],["__scopeId","data-v-624bbd32"]]);const Ke={name:"QueryModelFieldSelect",props:{modelValue:{},model:{required:!0},multiple:{default:!0}},data(){return{focused:!1,tables:[],selectedFields:[],currentHoverTable:null,currentHoverField:null,leaveFieldTimeout:null}},watch:{model:{immediate:!0,handler(){this.__handleTables()}},modelValue:{immediate:!0,handler(){this.selectedFields.splice(0,this.selectedFields.length),this.selectedFields.push.apply(this.selectedFields,this.__getSelectedFieldsObjects(this.modelValue))}}},methods:{focus(){this.focused=!0},handleFieldSorted(){this.$emit("update:modelValue",this.selectedFields.map(e=>`${e.table.id}.${e.name}`)),this.$emit("fields:change",this.selectedFields)},handleCheckAllChange(e,l){let t=[];l&&(t=e.fields.map(i=>`${e.id}.${i.name}`));let m=this.modelValue;m=m.filter(i=>!i.startsWith(`${e.id}.`)),m=m.concat(t),this.handleInput(e,m)},handleInput(e,l){const t=l.filter(i=>i.startsWith(`${e.id}.`));e.checkedAll=t.length===e.fields.length;let m=this.__getSelectedFieldsObjects(l);this.selectedFields.splice(0,this.selectedFields.length),this.selectedFields.push.apply(this.selectedFields,m),this.$emit("update:modelValue",l),this.$emit("fields:change",this.selectedFields)},handleFieldEnter(e){this.leaveFieldTimeout!=null&&clearTimeout(this.leaveFieldTimeout),this.currentHoverField=e},handleFieldLeave(){this.leaveFieldTimeout=setTimeout(()=>{this.currentHoverField=null},500)},handleTableEnter(e){this.currentHoverTable=e},handleTableLeave(){this.currentHoverTable=null},close(){this.focused=!1,this.handleTableLeave(),this.handleFieldLeave()},__handleTables(){this.tables=[];for(const e of this.model.tables){const l=e.fields.filter(t=>t.visible);l.length>0&&this.tables.push({id:e.id,type:e.type,name:e.name,alias:e.alias,fields:l,checkedAll:!1})}},__getSelectedFieldsObjects(e){return e.map(l=>{const t=l.split(".")[0],m=l.split(".")[1],i=this.model.tables.find(p=>p.id===t),o=JSON.parse(JSON.stringify(i)),d=i.fields.find(p=>p.name===m);return delete o.fields,d.table=o,d}).filter(l=>l!=null)}}},L=e=>(O("data-v-ae3f3a56"),e=e(),U(),e),qe={class:"model-field-select"},De={key:0,class:"placeholder"},Qe=["onMouseenter"],Ne=L(()=>_("em",null,"AS",-1)),$e={key:0},We={class:"field-select__tables"},Ee=["onMouseenter"],Ae={class:"table__header"},He={class:"table__fields-wrap"},je={class:"table-fields"},Le=L(()=>_("em",null,"AS",-1)),Ge={key:0,class:"text-info-1"};function Je(e,l,t,m,i,o){const d=s("el-checkbox"),p=s("el-checkbox-group"),f=s("el-scrollbar"),g=s("el-popover"),V=q("sortable");return n(),r("div",qe,[y(g,{trigger:"click","popper-class":"model-field-select-popper","hide-after":0,persistent:!1,onHide:o.close},{reference:v(()=>[D((n(),r("ul",{class:T(["selected-preview",{"is-focus":i.focused}]),onClick:l[1]||(l[1]=(...a)=>o.focus&&o.focus(...a))},[i.selectedFields.length===0?(n(),r("li",De,"请选择")):(n(!0),r(S,{key:1},F(i.selectedFields,a=>(n(),r("li",{key:a.name,class:T({"field-light":i.currentHoverTable!=null&&a.table.id===i.currentHoverTable.id}),onMouseenter:u=>o.handleFieldEnter(a),onMouseleave:l[0]||(l[0]=(...u)=>o.handleFieldLeave&&o.handleFieldLeave(...u))},[_("p",null,[x(b(a.table.alias)+"."+b(a.name)+" ",1),a.alias!==a.name?(n(),r(S,{key:0},[Ne,x(),_("b",null,b(a.alias),1)],64)):I("",!0)]),a.comment!=null&&a.comment!==""?(n(),r("p",$e,b(a.comment),1)):I("",!0)],42,Qe))),128))],2)),[[V,{data:i.selectedFields,onChange:o.handleFieldSorted},"config"]])]),default:v(()=>[_("div",We,[(n(!0),r(S,null,F(i.tables,a=>(n(),r("div",{key:a.alias,class:T(["field-select__table",{"table-main":a.type==="MAIN","table-light":i.currentHoverField!=null&&a.id===i.currentHoverField.table.id}]),onMouseenter:u=>o.handleTableEnter(a),onMouseleave:l[2]||(l[2]=(...u)=>o.handleTableLeave&&o.handleTableLeave(...u))},[_("div",Ae,[y(d,{modelValue:a.checkedAll,"onUpdate:modelValue":u=>a.checkedAll=u,onChange:u=>o.handleCheckAllChange(a,u)},{default:v(()=>[_("h4",null,b(a.name)+" AS "+b(a.alias),1)]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])]),_("div",He,[y(f,null,{default:v(()=>[_("div",je,[y(p,{"model-value":t.modelValue,onChange:u=>o.handleInput(a,u)},{default:v(()=>[(n(!0),r(S,null,F(a.fields,u=>(n(),h(d,{label:`${a.id}.${u.name}`,key:u.name},{default:v(()=>[_("p",null,[x(b(u.name)+" ",1),u.alias!==u.name?(n(),r(S,{key:0},[Le,x(),_("b",null,b(u.alias),1)],64)):I("",!0)]),u.comment!==""?(n(),r("p",Ge,b(u.comment),1)):I("",!0)]),_:2},1032,["label"]))),128))]),_:2},1032,["model-value","onChange"])])]),_:2},1024)])],42,Ee))),128))])]),_:1},8,["onHide"])])}const Be=C(Ke,[["render",Je],["__scopeId","data-v-ae3f3a56"]]);const Re={name:"QueryModelFieldSetting",components:{SortableButton:J,QueryModelFieldSelect:Be,TableFieldVariableInput:H},props:{valueKey:{default:"value"},model:{required:!0},group:{required:!0}},data(){return{selectedFields:[]}},watch:{model(){this.initSelectedFields()}},methods:{handleSort(){this.initSelectedFields(),this.emitChange()},initSelectedFields(){this.selectedFields=[];const e=this.group[this.valueKey];e!=null&&e.length>0&&(this.selectedFields=e.map(l=>`${l.table.id}.${l.name}`))},handleSelect(e){for(const l of e){l.origin==null&&(l.origin=JSON.parse(JSON.stringify(l)));for(const t of this.group.children)l[t.name]=w(l[t.name])?t.defaultValue:l[t.name],w(l[t.name])&&(l[t.name]=j(t.inputType))}this.group[this.valueKey]=e,this.emitChange()},emitChange(){this.$emit("change")},getColumnMinWidth(e){return e.inputType==="select"?"150px":"120px"}},created(){this.initSelectedFields()}},Pe=e=>(O("data-v-ea5bd0d9"),e=e(),U(),e),ze=Pe(()=>_("em",null,"AS",-1)),Xe={key:0,class:"required"};function Ye(e,l,t,m,i,o){const d=s("QueryModelFieldSelect"),p=s("SortableButton"),f=s("el-table-column"),g=s("TableFieldVariableInput"),V=s("el-table"),a=q("sortable");return n(),r(S,null,[_("h5",null,b(t.group.label),1),y(d,{modelValue:i.selectedFields,"onUpdate:modelValue":l[0]||(l[0]=u=>i.selectedFields=u),model:t.model,placeholder:"Select fields","onFields:change":o.handleSelect},null,8,["modelValue","model","onFields:change"]),t.group.children.length>0?D((n(),h(V,{key:0,size:"small",data:t.group[t.valueKey],"row-key":u=>`${u.table.id}.${u.name}@${u.alias}`},{default:v(()=>[y(f,{width:"25px",fixed:""},{default:v(()=>[y(p)]),_:1}),y(f,{label:"字段名",width:"150px",prop:"name",fixed:""},{default:v(({row:u})=>[_("p",null,[x(b(u.table.alias)+"."+b(u.name)+" ",1),u.alias!==u.name?(n(),r(S,{key:0},[ze,x(),_("b",null,b(u.alias),1)],64)):I("",!0)]),_("p",null,b(u.comment),1)]),_:1}),(n(!0),r(S,null,F(t.group.children,u=>(n(),h(f,{key:u.name,label:u.label,"min-width":o.getColumnMinWidth(u)},{header:v(()=>[u.required?(n(),r("em",Xe,"*")):I("",!0),x(b(u.label),1)]),default:v(({row:k})=>[y(g,{variable:u,modelValue:k[u.name],"onUpdate:modelValue":c=>k[u.name]=c,onChange:o.emitChange},null,8,["variable","modelValue","onUpdate:modelValue","onChange"])]),_:2},1032,["label","min-width"]))),128))]),_:1},8,["data","row-key"])),[[a,{data:t.group[t.valueKey],onChange:o.handleSort},"config"]]):I("",!0)],64)}const Ze=C(Re,[["render",Ye],["__scopeId","data-v-ea5bd0d9"]]);const el={name:"QueryModelWindow",components:{DataSourceSelect:Q,QueryModelView:B},data(){return{visible:!1}},computed:{...M(["currentDatabase"])},methods:{open(){this.visible=!0},close(){this.visible=!1,this.$emit("close")}}},ll=_("h2",null,"查询模型设计",-1),tl={class:"header__opera"};function nl(e,l,t,m,i,o){const d=s("DataSourceSelect"),p=s("Close"),f=s("el-icon"),g=s("QueryModelView"),V=s("el-dialog");return n(),h(V,{"custom-class":"query-model-window",modelValue:i.visible,"onUpdate:modelValue":l[0]||(l[0]=a=>i.visible=a),fullscreen:"","append-to-body":"","show-close":!1},{header:v(()=>[ll,_("div",tl,[y(d,{"model-value":e.currentDatabase},null,8,["model-value"]),y(f,{onClick:o.close},{default:v(()=>[y(p)]),_:1},8,["onClick"])])]),default:v(()=>[y(g)]),_:1},8,["modelValue"])}const al=C(el,[["render",nl]]),ol="/images/database/icon-design.svg";const il={name:"QueryModelSelect",components:{QueryModelWindow:al,QueryModelFieldSetting:Ze},props:{modelValue:{},valueKey:{default:"value"},variable:{required:!0}},data(){return{databases:[],models:[],selected:null}},computed:{...M(["currentProject","currentDatabase"]),fieldVariableGroup(){return this.variable.children||[]}},watch:{currentDatabase(){this.fetchModels()}},methods:{handleChange(e){this.selected=this.models.find(l=>l.id===e),this.fieldVariableGroup.forEach(l=>{l[this.valueKey]=[]}),this.$emit("update:modelValue",e),this.emitChange()},emitChange(){this.$emit("change")},fetchDatabases(){K().then(e=>{this.databases=e,this.fetchModels()}).catch(e=>{this.$tip.apiFailed(e)})},fetchModels(){const e=this.databases.find(l=>l.id===this.currentDatabase);if(e==null){this.models=[];return}this.models=e.models,this.modelValue!=null&&(this.selected=this.models.find(l=>l.id===this.modelValue),this.selected==null&&this.handleChange(null))}},created(){this.fetchDatabases()}},sl=e=>(O("data-v-0179f899"),e=e(),U(),e),ul={class:"query-model-select"},dl={class:"option-content"},rl={class:"text-info-1"},cl=sl(()=>_("img",{src:ol},null,-1)),ml={key:0,class:"field-settings"};function _l(e,l,t,m,i,o){const d=s("el-option"),p=s("el-select"),f=s("el-button"),g=s("QueryModelWindow"),V=s("QueryModelFieldSetting");return n(),r(S,null,[_("div",ul,[y(p,{class:"model-select","popper-class":"model-select__popper","model-value":t.modelValue,clearable:"",onChange:o.handleChange},{default:v(()=>[(n(!0),r(S,null,F(i.models,a=>(n(),h(d,{key:a.id,value:a.id,label:a.name},{default:v(()=>[_("p",dl,[_("span",null,b(a.name),1),_("span",rl,b(a.comment),1)])]),_:2},1032,["value","label"]))),128))]),_:1},8,["model-value","onChange"]),y(f,{class:"button-icon",type:"primary",onClick:l[0]||(l[0]=a=>e.$refs.queryModelWindow.open())},{default:v(()=>[cl]),_:1}),y(g,{ref:"queryModelWindow",onClose:o.fetchDatabases},null,8,["onClose"])]),i.selected!=null&&o.fieldVariableGroup.length>0?(n(),r("ul",ml,[(n(!0),r(S,null,F(o.fieldVariableGroup,a=>(n(),r("li",{key:a.label},[y(V,{"value-key":t.valueKey,model:i.selected,group:a,onChange:o.emitChange},null,8,["value-key","model","group","onChange"])]))),128))])):I("",!0)],64)}const hl=C(il,[["render",_l],["__scopeId","data-v-0179f899"]]);const pl={name:"VariableInput",components:{InstallNumberInput:A,InstallSelect:E,DataSourceSelect:Q,QueryModelSelect:hl,TableSelect:Ue,InstallCheckbox:N,InstallRadio:W,InstallInput:$},props:{variable:{required:!0},valueKey:{default:"value"}},computed:{inputType(){return this.variable.inputType}}},vl={class:"variable-input"};function bl(e,l,t,m,i,o){const d=s("InstallInput"),p=s("InstallNumberInput"),f=s("InstallSelect"),g=s("InstallCheckbox"),V=s("InstallRadio"),a=s("DataSourceSelect"),u=s("TableSelect"),k=s("QueryModelSelect");return n(),r("div",vl,[t.variable.inputType==="input"?(n(),h(d,{key:0,modelValue:t.variable[t.valueKey],"onUpdate:modelValue":l[0]||(l[0]=c=>t.variable[t.valueKey]=c),onInput:l[1]||(l[1]=c=>e.$emit("change",c))},null,8,["modelValue"])):I("",!0),t.variable.inputType==="number_input"?(n(),h(p,{key:1,modelValue:t.variable[t.valueKey],"onUpdate:modelValue":l[2]||(l[2]=c=>t.variable[t.valueKey]=c),onInput:l[3]||(l[3]=c=>e.$emit("change",c))},null,8,["modelValue"])):t.variable.inputType==="textarea"?(n(),h(d,{key:2,type:"textarea",modelValue:t.variable[t.valueKey],"onUpdate:modelValue":l[4]||(l[4]=c=>t.variable[t.valueKey]=c),onInput:l[5]||(l[5]=c=>e.$emit("change",c))},null,8,["modelValue"])):t.variable.inputType==="select"?(n(),h(f,{key:3,modelValue:t.variable[t.valueKey],"onUpdate:modelValue":l[6]||(l[6]=c=>t.variable[t.valueKey]=c),options:t.variable.options,onChange:l[7]||(l[7]=c=>e.$emit("change",c))},null,8,["modelValue","options"])):t.variable.inputType==="checkbox"?(n(),h(g,{key:4,modelValue:t.variable[t.valueKey],"onUpdate:modelValue":l[8]||(l[8]=c=>t.variable[t.valueKey]=c),options:t.variable.options,onChange:l[9]||(l[9]=c=>e.$emit("change",c))},null,8,["modelValue","options"])):t.variable.inputType==="radio"?(n(),h(V,{key:5,modelValue:t.variable[t.valueKey],"onUpdate:modelValue":l[10]||(l[10]=c=>t.variable[t.valueKey]=c),options:t.variable.options,onChange:l[11]||(l[11]=c=>e.$emit("change",c))},null,8,["modelValue","options"])):t.variable.inputType==="datasource"?(n(),h(a,{key:6,modelValue:t.variable[t.valueKey],"onUpdate:modelValue":l[12]||(l[12]=c=>t.variable[t.valueKey]=c),"with-prefix":!1,"with-block":!0,onChange:l[13]||(l[13]=c=>e.$emit("change",c))},null,8,["modelValue"])):t.variable.inputType==="table"?(n(),h(u,{key:7,variable:t.variable,"value-key":t.valueKey,modelValue:t.variable[t.valueKey],"onUpdate:modelValue":l[14]||(l[14]=c=>t.variable[t.valueKey]=c),onChange:l[15]||(l[15]=c=>e.$emit("change",c))},null,8,["variable","value-key","modelValue"])):t.variable.inputType==="query_model"?(n(),h(k,{key:8,variable:t.variable,"value-key":t.valueKey,modelValue:t.variable[t.valueKey],"onUpdate:modelValue":l[16]||(l[16]=c=>t.variable[t.valueKey]=c),onChange:l[17]||(l[17]=c=>e.$emit("change",c))},null,8,["variable","value-key","modelValue"])):I("",!0)])}const Fl=C(pl,[["render",bl],["__scopeId","data-v-dbb70002"]]);const fl={name:"ServiceCodeErrorWindow",data(){return{visible:!1,error:null}},methods:{open(e){this.error=e,this.visible=!0}}},yl={class:"window-header-wrap"},gl={class:"title"},Vl={class:"tip"},Sl={class:"window-content-wrap"};function kl(e,l,t,m,i,o){const d=s("CircleCloseFilled"),p=s("el-icon"),f=s("el-dialog");return n(),h(f,{modelValue:i.visible,"onUpdate:modelValue":l[0]||(l[0]=g=>i.visible=g),width:"1000px","custom-class":"service-code-error-window","show-close":!1},{header:v(()=>[_("div",yl,[_("div",gl,[y(p,null,{default:v(()=>[y(d)]),_:1}),_("h5",null,b(e.$t("service.serviceCodeErrorTitle")),1)]),_("p",Vl,b(e.$t("service.serviceCodeErrorTip")),1)])]),default:v(()=>[_("div",Sl,[_("p",null,"at "+b(i.error.position),1),_("pre",null,b(i.error.message),1)])]),_:1},8,["modelValue"])}const xl=C(fl,[["render",kl]]);export{Fe as F,W as I,re as M,he as O,xl as S,Fl as V,$ as a,N as b,j as g,w as i};
