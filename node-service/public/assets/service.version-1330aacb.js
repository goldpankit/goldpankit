import{_ as V,r as u,o as a,c as d,F as b,x as h,I as K,t as y,f as C,d as k,w as f,u as i,b as p,m as F,C as D,S as w,W as R,n as I}from"./index-509f7063.js";const P={name:"InstallCheckbox",props:{modelValue:{type:Array},type:{default:"checkbox"},options:{}},data(){return{selected:null}},methods:{handleSelect(l){let t=this.modelValue.findIndex(e=>e===l.value);t===-1?this.$emit("update:modelValue",this.modelValue.concat([l.value])):this.$emit("update:modelValue",this.modelValue.filter((e,v)=>v!==t))}}},Q={key:0,class:"installer-checkbox"},j=["onClick"],G={key:1};function N(l,t,e,v,c,r){const o=u("el-option"),m=u("el-select");return e.options.length>0?(a(),d(b,{key:0},[e.type==="checkbox"?(a(),d("ul",Q,[(a(!0),d(b,null,h(e.options,n=>(a(),d("li",{key:n.value,class:K({selected:e.modelValue==null?!1:e.modelValue.findIndex(s=>s===n.value)!==-1}),onClick:s=>r.handleSelect(n)},y(n.label),11,j))),128))])):C("",!0),k(m,{"model-value":e.modelValue,"onUpdate:modelValue":t[0]||(t[0]=n=>l.$emit("update:modelValue",n)),multiple:""},{default:f(()=>[(a(!0),d(b,null,h(e.options,n=>(a(),i(o,{key:n.value,value:n.value,label:n.label},null,8,["value","label"]))),128))]),_:1},8,["model-value"])],64)):(a(),d("p",G,"Please add options first."))}const T=V(P,[["render",N],["__scopeId","data-v-7f4de5a4"]]);const B={name:"InstallInput",props:{type:{default:"text"}}};function E(l,t,e,v,c,r){const o=u("el-input");return a(),i(o,{type:e.type,class:"install-input"},null,8,["type"])}const q=V(B,[["render",E],["__scopeId","data-v-fad1f630"]]);const O={name:"InstallRadio",props:{modelValue:{},options:{},type:{default:"radio"}},methods:{handleSelect(l){this.$emit("update:modelValue",l),this.$emit("change",l)}},created(){console.log("radio value",this.modelValue)}},z={key:0,class:"installer-checkbox"},J=["onClick"],A={key:1};function L(l,t,e,v,c,r){const o=u("el-option"),m=u("el-select");return e.options.length>0?(a(),d(b,{key:0},[e.type==="radio"?(a(),d("ul",z,[(a(!0),d(b,null,h(e.options,n=>(a(),d("li",{key:n.value,class:K({selected:e.modelValue===n.value}),onClick:s=>r.handleSelect(n.value)},y(n.label),11,J))),128))])):(a(),i(m,{key:1,"model-value":e.modelValue,onChange:r.handleSelect},{default:f(()=>[(a(!0),d(b,null,h(e.options,n=>(a(),i(o,{key:n.value,value:n.value,label:n.label},null,8,["value","label"]))),128))]),_:1},8,["model-value","onChange"]))],64)):(a(),d("p",A,"Please add options first."))}const M=V(O,[["render",L],["__scopeId","data-v-e1926bd3"]]);const W={name:"MySqlFieldSelect",props:{modelValue:{},table:{required:!0},multiple:{default:!0}},methods:{handleInput(l){this.$emit("update:modelValue",l.map(t=>this.table.fields.find(e=>e.name===t)).filter(t=>t!=null))}}},H={class:"option-content"},X={class:"text-info-1"};function Y(l,t,e,v,c,r){const o=u("el-option"),m=u("el-select");return a(),i(m,{class:"mysql-field-select","popper-class":"mysql-field-select__popper",multiple:e.multiple,"model-value":e.modelValue==null?[]:e.modelValue.map(n=>n.name),"onUpdate:modelValue":r.handleInput},{default:f(()=>[(a(!0),d(b,null,h(e.table.fields,n=>(a(),i(o,{value:n.name,label:n.name},{default:f(()=>[p("p",H,[p("span",null,y(n.name),1),p("span",X,y(n.comment),1)])]),_:2},1032,["value","label"]))),256))]),_:1},8,["multiple","model-value","onUpdate:modelValue"])}const Z=V(W,[["render",Y],["__scopeId","data-v-af47228f"]]),$={name:"TableFieldVariableInput",components:{InstallCheckbox:T,InstallRadio:M,InstallInput:q},props:{modelValue:{},variable:{required:!0}}};function ee(l,t,e,v,c,r){const o=u("InstallInput"),m=u("InstallCheckbox"),n=u("InstallRadio");return e.variable.inputType==="input"?(a(),i(o,{key:0,"model-value":e.modelValue,onChange:t[0]||(t[0]=s=>l.$emit("update:modelValue",s))},null,8,["model-value"])):e.variable.inputType==="textarea"?(a(),i(o,{key:1,type:"textarea","model-value":e.modelValue,onChange:t[1]||(t[1]=s=>l.$emit("update:modelValue",s))},null,8,["model-value"])):e.variable.inputType==="checkbox"?(a(),i(m,{key:2,type:"select",options:e.variable.options,"model-value":e.modelValue,onChange:t[2]||(t[2]=s=>l.$emit("update:modelValue",s))},null,8,["options","model-value"])):e.variable.inputType==="radio"?(a(),i(n,{key:3,type:"select",options:e.variable.options,"model-value":e.modelValue,onChange:t[3]||(t[3]=s=>l.$emit("update:modelValue",s))},null,8,["options","model-value"])):C("",!0)}const le=V($,[["render",ee]]);function S(l){return l==null||l===""||JSON.stringify(l)==="[]"||JSON.stringify(l)==="{}"}function U(l){return l==="input"||l==="textarea"||l==="radio"?"":l==="checkbox"?[]:l==="table"||l==="database"||l==="query_model"?null:""}const te={name:"FieldSetting",components:{TableFieldVariableInput:le,MySqlFieldSelect:Z},props:{valueKey:{default:"value"},table:{required:!0},group:{required:!0}},methods:{handleSelect(l){for(const t of l)for(const e of this.group.children)t[e.name]=S(t[e.name])?e.defaultValue:t[e.name],S(t[e.name])&&(t[e.name]=U(e.inputType));this.group[this.valueKey]=l}},created(){console.log("group",this.group)}};function ae(l,t,e,v,c,r){const o=u("MySqlFieldSelect"),m=u("el-table-column"),n=u("TableFieldVariableInput"),s=u("el-table");return a(),d(b,null,[p("h5",null,y(e.group.label),1),k(o,{"onUpdate:modelValue":r.handleSelect,"model-value":e.group[e.valueKey],table:e.table,placeholder:"Select fields"},null,8,["onUpdate:modelValue","model-value","table"]),k(s,{size:"small",data:e.group[e.valueKey]},{default:f(()=>[k(m,{label:"字段名",width:"100px",prop:"name",fixed:""}),(a(!0),d(b,null,h(e.group.children,g=>(a(),i(m,{key:g.name,label:g.label},{default:f(({row:x})=>[k(n,{variable:g,modelValue:x[g.name],"onUpdate:modelValue":_=>x[g.name]=_},null,8,["variable","modelValue","onUpdate:modelValue"])]),_:2},1032,["label"]))),128))]),_:1},8,["data"])],64)}const ne=V(te,[["render",ae],["__scopeId","data-v-c519e87d"]]);const oe={name:"TableSelect",components:{FieldSetting:ne},props:{modelValue:{},valueKey:{default:"value"},variables:{required:!0}},data(){return{selected:null,databases:[],tables:[]}},computed:{...F(["currentProject","currentDatabase"]),fieldVariableGroup(){return this.variables.filter(l=>l.type==="group"&&l.scope==="table_field")}},watch:{currentDatabase(){this.fetchTables()}},methods:{handleChange(l){this.selected=this.tables.find(t=>t.name===l),this.fieldVariableGroup.forEach(t=>{t[this.valueKey]=[]}),this.$emit("update:modelValue",l),this.$emit("change",l)},fetchDatabases(){D().then(l=>{this.databases=l,this.fetchTables()}).catch(l=>{this.$tip.apiFailed(l)})},fetchTables(){const l=this.databases.find(t=>t.id===this.currentDatabase);l!=null&&w({host:l.host,port:l.port,user:l.username,password:l.password,database:l.schema}).then(t=>{if(this.tables=t,this.modelValue!=null&&(this.selected=this.tables.find(e=>e.name===this.modelValue)),this.selected!=null)for(const e of this.fieldVariableGroup){const v=e[this.valueKey];for(const c of v){const r=this.selected.fields.find(o=>o.name===c.name);if(r!=null){Object.assign(r,c);for(const o of e.children)S(c[o.name])&&(c[o.name]=o.defaultValue),S(c[o.name])&&(c[o.name]=U(o.inputType));console.log("cacheField",c)}}}}).catch(t=>{this.$tip.apiFailed(t)})}},created(){this.fetchDatabases()}},ue={class:"option-content"},se={class:"text-info-1"},ie={key:0,class:"field-settings"};function de(l,t,e,v,c,r){const o=u("el-option"),m=u("el-select"),n=u("FieldSetting");return a(),d(b,null,[k(m,{class:"table-select","popper-class":"table-select__popper","model-value":e.modelValue,onChange:r.handleChange},{default:f(()=>[(a(!0),d(b,null,h(c.tables,s=>(a(),i(o,{key:s.name,value:s.name,label:s.name},{default:f(()=>[p("p",ue,[p("span",null,y(s.name),1),p("span",se,y(s.comment),1)])]),_:2},1032,["value","label"]))),128))]),_:1},8,["model-value","onChange"]),c.selected!=null&&r.fieldVariableGroup.length>0?(a(),d("ul",ie,[(a(!0),d(b,null,h(r.fieldVariableGroup,s=>(a(),d("li",{key:s.label},[k(n,{"value-key":e.valueKey,table:c.selected,group:s},null,8,["value-key","table","group"])]))),128))])):C("",!0)],64)}const ce=V(oe,[["render",de],["__scopeId","data-v-5993ce60"]]);const re={name:"QueryModelSelect",props:{},data(){return{models:[],selected:null}},computed:{...F(["currentProject","currentDatabase"]),unique(){return[this.currentProject,this.currentDatabase]}},watch:{unique(){this.fetchModels()}},methods:{fetchModels(){const l=this.currentProject.databases.find(t=>t.name===this.currentDatabase);if(l==null){this.models=[];return}this.models=l.models}},created(){this.fetchModels()}},_e={class:"option-content"},me={class:"text-info-1"};function be(l,t,e,v,c,r){const o=u("el-option"),m=u("el-select");return a(),i(m,{class:"model-select","popper-class":"model-select__popper"},{default:f(()=>[(a(!0),d(b,null,h(c.models,n=>(a(),i(o,{key:n.name,value:n.name,label:n.name},{default:f(()=>[p("p",_e,[p("span",null,y(n.name),1),p("span",me,y(n.comment),1)])]),_:2},1032,["value","label"]))),128))]),_:1})}const ve=V(re,[["render",be],["__scopeId","data-v-f7939967"]]),pe={name:"VariableInput",components:{DatabaseSelect:R,QueryModelSelect:ve,TableSelect:ce,InstallCheckbox:T,InstallRadio:M,InstallInput:q},props:{variable:{required:!0},variables:{},valueKey:{default:"value"}},computed:{inputType(){return this.variable.inputType}}};function fe(l,t,e,v,c,r){const o=u("InstallInput"),m=u("InstallCheckbox"),n=u("InstallRadio"),s=u("DatabaseSelect"),g=u("TableSelect"),x=u("QueryModelSelect");return e.variable.inputType==="input"?(a(),i(o,{key:0,modelValue:e.variable[e.valueKey],"onUpdate:modelValue":t[0]||(t[0]=_=>e.variable[e.valueKey]=_),onInput:t[1]||(t[1]=_=>l.$emit("change",_))},null,8,["modelValue"])):e.variable.inputType==="textarea"?(a(),i(o,{key:1,type:"textarea",modelValue:e.variable[e.valueKey],"onUpdate:modelValue":t[2]||(t[2]=_=>e.variable[e.valueKey]=_),onInput:t[3]||(t[3]=_=>l.$emit("change",_))},null,8,["modelValue"])):e.variable.inputType==="checkbox"?(a(),i(m,{key:2,modelValue:e.variable[e.valueKey],"onUpdate:modelValue":t[4]||(t[4]=_=>e.variable[e.valueKey]=_),options:e.variable.options},null,8,["modelValue","options"])):e.variable.inputType==="radio"?(a(),i(n,{key:3,modelValue:e.variable[e.valueKey],"onUpdate:modelValue":t[5]||(t[5]=_=>e.variable[e.valueKey]=_),options:e.variable.options},null,8,["modelValue","options"])):e.variable.inputType==="database"?(a(),i(s,{key:4,modelValue:e.variable[e.valueKey],"onUpdate:modelValue":t[6]||(t[6]=_=>e.variable[e.valueKey]=_),"with-prefix":!1,"with-block":!0},null,8,["modelValue"])):e.variable.inputType==="table"?(a(),i(g,{key:5,variables:e.variables,"value-key":e.valueKey,modelValue:e.variable[e.valueKey],"onUpdate:modelValue":t[7]||(t[7]=_=>e.variable[e.valueKey]=_)},null,8,["variables","value-key","modelValue"])):e.variable.inputType==="query_model"?(a(),i(x,{key:6,variables:e.variables,"value-key":e.valueKey,modelValue:e.variable[e.valueKey],"onUpdate:modelValue":t[8]||(t[8]=_=>e.variable[e.valueKey]=_)},null,8,["variables","value-key","modelValue"])):C("",!0)}const ye=V(pe,[["render",fe]]);function Ve(l){return I.post("/service/install",l)}function ge(l){return I.post("/service/uninstall",l)}function ke(l){return I.post("/service/compile",l)}function Ie(l){return I.post("/service/compile/clean",l)}function xe(l){return I.post("/service/version/publish",l)}function Se(l){return I.post("/service/version",l)}export{ne as F,M as I,Z as M,ye as V,q as a,T as b,ke as c,Ie as d,Se as f,Ve as i,xe as p,ge as u};
