import{B as W}from"./BeanAmount-baa90a62.js";import{E as q}from"./Empty-54189d5d.js";import{_ as C,r as d,o as n,c as o,F as y,f as w,H as E,i as L,a as i,K as B,t as c,j as g,g as v,e as V,L as F,P as D,N as A,m as M,n as R,h as G,O as N,Q as O,b as h,w as f,p as U,l as z}from"./index-615d6ceb.js";import{S as x,F as H,M as J,V as K,I as Q,a as X,b as Y,c as Z,i as I,g as ee}from"./ServiceCodeErrorWindow-cbabb515.js";import{P as te}from"./Pagination-915a643a.js";const se={name:"SubServiceList",components:{Empty:q,BeanAmount:W},props:{services:{type:Array,required:!0},customClass:{type:Function,default(){return()=>{}}},installed:{type:Function,default(){return()=>{}}}}},ie={key:0,class:"sub-service-list"},ne=["onClick"],le={class:"latest-version"},re={key:0},ae={class:"user-profile"},oe=["src"],ce={class:"price-wrap"},ue={class:"text-info-1 text-mini"},de={key:0};function pe(e,s,t,l,r,u){const _=d("BeanAmount"),m=d("Empty");return t.services.length>0?(n(),o("ul",ie,[(n(!0),o(y,null,w(t.services,a=>(n(),o("li",{key:a.id,class:E({...t.customClass(a),"service-installed":t.installed(a)===!0}),onClick:L(k=>e.$emit("click",a),["stop"])},[i("h5",null,[B(e.$slots,"title",{service:a},()=>[V(c(a.name),1)],!0)]),i("p",le,[i("span",null,c(e.$t("service.latestVersion"))+": v"+c(a.lastVersion),1),t.installed(a)===!0?(n(),o("span",re,c(e.$t("service.installed")),1)):g("",!0)]),i("p",null,c(a.introduce),1),i("div",ae,[i("img",{src:e.getAccessUri(a.user.avatar,"/images/avatar/default.png")},null,8,oe),i("span",null,c(a.user.username),1)]),i("div",ce,[i("p",ue,c(e.$t("service.lastPublish"))+": "+c(e.getDateOffsetText(a.lastPublishTime)),1),a.latestLease!=null?(n(),o("em",de,c(e.getRemainingDay(a.latestLease.leaseEndTime))+" "+c(e.$t("common.days")),1)):(n(),v(_,{key:1,price:a.price.price,type:a.price.leaseType},null,8,["price","type"]))])],10,ne))),128))])):(n(),v(m,{key:1,description:e.$t("service.noSubServices")},null,8,["description"]))}const Ne=C(se,[["render",pe],["__scopeId","data-v-7a480bed"]]);const he={name:"ServiceInstaller",components:{ServiceCodeErrorWindow:x,MergeWindow:F,ProjectSelect:D,DirectorySelect:A,FieldSetting:H,MySqlFieldSelect:J,VariableInput:K,InstallRadio:Q,InstallInput:X,InstallCheckbox:Y},props:{installing:{},uninstalling:{},space:{required:!0},service:{required:!0},serviceType:{required:!0},servicePrice:{required:!0},serviceLease:{required:!1},version:{required:!0},withProject:{default:!0},projectConfig:{},withBreadcrumbs:{default:!1},withInstallButton:{default:!1}},data(){return{isWorking:{install:!1,uninstall:!1},variables:[]}},computed:{...M(["currentProject","currentDatabase"]),serviceVariables(){return this.variables},unique(){return[this.space,this.service,this.version]}},watch:{unique(){this.fetchVersion()},"isWorking.install":function(){this.$emit("update:installing",this.isWorking.install)},"isWorking.uninstall":function(){this.$emit("update:uninstalling",this.isWorking.uninstall)}},methods:{...R(["setCurrentProject","setInstallData"]),...G(["refreshBalance"]),fetchVersion(){Z({space:this.space,service:this.service,version:this.version}).then(e=>{this.variables=JSON.parse(e.variables).map(s=>this.__initVariableValue(s))}).catch(e=>{this.$tip.apiFailed(e)})},install(){if(this.serviceLease!=null){this.__install();return}if(this.servicePrice<50){this.__install();return}this.installConfirm(this.servicePrice).then(()=>{this.__install()}).catch(()=>{})},__install(){if(this.isWorking.install)return;if(this.isWorking.install=!0,this.currentProject==null||this.currentProject===""){this.$tip.warning(this.$t("service.selectProject")),this.isWorking.install=!1;return}const e=this.__getInstallVariables(this.variables);if(!this.__checkVariables(e)){this.isWorking.install=!1;return}N({projectId:this.currentProject,database:this.currentDatabase,space:this.space,service:this.service,serviceType:this.serviceType,version:this.version,variables:e}).then(s=>{this.$tip.success(this.$t("service.installSuccessfully")),this.setInstallData(s),this.refreshBalance(),this.$emit("installed")}).catch(s=>{if(s.code===6e3){this.$refs.serviceCodeErrorWindow.open(s.errorData);return}this.$tip.apiFailed(s)}).finally(()=>{this.isWorking.install=!1})},uninstall(){if(this.serviceLease!=null){this.__uninstall();return}if(this.servicePrice<50){this.__uninstall();return}this.uninstallConfirm().then(()=>{this.__uninstall()}).catch(()=>{})},__uninstall(){this.isWorking.uninstall||(this.isWorking.uninstall=!0,O({projectId:this.currentProject,database:this.currentDatabase,space:this.space,service:this.service,serviceType:this.serviceType,version:this.version,variables:this.__getInstallVariables(this.variables)}).then(e=>{this.$tip.success(this.$t("service.uninstallSuccessfully")),this.setInstallData(e),this.$emit("uninstalled")}).catch(e=>{if(e.code===6e3){this.$refs.serviceCodeErrorWindow.open(e.errorData);return}this.$tip.apiFailed(e)}).finally(()=>{this.isWorking.uninstall=!1}))},__checkVariables(e,s){for(const t of e){if(t.inputType==="query_model"||t.inputType==="table"){for(const l of t.children){const r=l.value;for(const u of l.children){if(!u.required)continue;const _=r.find(m=>I(m[u.name]));if(_!=null)return this.$tip.warning(this.$t("service.fieldMissingValueTip",{fieldGroupLabel:l.label,emptyFieldName:_.name,fieldVariableLabel:u.label})),!1}}continue}if(t.inputType==="select"){const l=t.value;if(t.required&&l.value==null)return this.__tipEmptyVariable(t,s),!1;if(l.value!=null){const r=t.options.find(u=>u.value===l.value);if(r.settings.length>0){for(const u of r.settings)if(I(l.settings[u.name]))return this.$tip.warning(this.$t("service.variableMissingSettingTip",{variable:t.label,settingLabel:u.label})),!1}}continue}if(t.type==="group"){if(!this.__checkVariables(t.children,t.label))return!1;continue}if(I(t.value))return this.__tipEmptyVariable(t,s),!1}return!0},__tipEmptyVariable(e,s){s!=null?this.$tip.warning(this.$t("service.missingGroupVariableValueTip",{variable:e.label,groupName:s})):this.$tip.warning(this.$t("service.missingVariableValueTip",{variable:e.label}))},__getInstallVariables(e){return e.map(s=>{if(s.inputType==="select"){const t=s.options.find(r=>r.value===s.value.value);if(t==null)return s;const l={};for(const r of t.settings)l[r.name]=r.value;s.value.settings=l}return s.type==="group"&&(s.children=this.__getInstallVariables(s.children)),s})},__initVariableValue(e,s){if(s==null&&this.projectConfig!=null){const t=this.projectConfig.services[this.service];if(t!=null){const l=t.variables.findLast(r=>r.name===e.name);l!=null&&(s=l.value)}if(s==null){let l=null;for(const u in this.projectConfig.main){l=u;break}const r=this.projectConfig.main[l].variables[e.name];s=r,r!=null&&r.constructor!==e.defaultValue.constructor&&(s=null)}}if(s!=null){if(e.inputType==="table"||e.inputType==="query_model"){for(const t in s.settings){const l=e.children.find(r=>r.name===t);l!=null&&(l.value=s.settings[t])}return e.value=s.value,e}return e.type==="group"?(e.children.forEach(t=>this.__initVariableValue(t,s[t.name])),e):(e.value=s,e)}if(s=e.defaultValue,s=s??ee(e.inputType),e.inputType==="table"||e.inputType==="query_model"){for(const t of e.children)t.value=t.defaultValue;return e.value=s,e}return e.type==="group"?(e.children.forEach(t=>{t.value=t.defaultValue}),e):(e.value=s,e)}},created(){this.fetchVersion()}},_e={class:"service-installer"},fe={key:0,class:"nav"},me={class:"title"},ge={class:"content-wrap"},ye={class:"install-tip"},ve={class:"form-wrap"},be={key:1,class:"label-wrap"},ke={key:1,class:"group-vars"},$e={class:"text-info-1 text-mini"},Ve={key:0},we={key:1,class:"parameters-holder"},Se={key:2,class:"install"};function Ie(e,s,t,l,r,u){const _=d("el-button"),m=d("ProjectSelect"),a=d("el-form-item"),k=d("ArrowRight"),S=d("el-icon"),P=d("VariableInput"),j=d("el-form"),T=d("ServiceCodeErrorWindow");return n(),o("div",_e,[t.withBreadcrumbs?(n(),o("div",fe,[i("div",me,[h(_,{class:"button-icon",icon:"ArrowLeftBold",onClick:s[0]||(s[0]=p=>e.$emit("back"))}),i("h4",null,c(t.service)+c(t.version==null?"":" · "+t.version.toUpperCase())+" · "+c(e.$t("service.install2")),1)])])):g("",!0),i("div",ge,[t.withProject||u.serviceVariables.length>0?(n(),o(y,{key:0},[i("p",ye,c(e.$t("service.withParametersTip")),1),i("div",ve,[h(j,null,{default:f(()=>[t.withProject?(n(),v(a,{key:0,label:e.$t("project.project"),required:""},{default:f(()=>[h(m,{"model-value":e.currentProject,"with-block":!0,"with-prefix":!1,onChange:e.setCurrentProject},null,8,["model-value","onChange"])]),_:1},8,["label"])):g("",!0),(n(!0),o(y,null,w(u.serviceVariables,p=>(n(),o(y,null,[p.hidden?g("",!0):(n(),v(a,{key:p.name,label:p.label,required:p.required},{label:f(()=>[p.type==="variable"?(n(),o(y,{key:0},[V(c(p.label),1)],64)):(n(),o("div",be,[i("span",null,c(p.label),1),h(S,null,{default:f(()=>[h(k)]),_:1})]))]),default:f(()=>[p.type==="variable"?(n(),v(P,{key:0,variable:p},null,8,["variable"])):p.type==="group"?(n(),o("ul",ke,[(n(!0),o(y,null,w(p.children,$=>(n(),o("li",{key:`${p.name}_${$.name}`},[i("label",$e,[$.required?(n(),o("em",Ve,"*")):g("",!0),V(c($.label),1)]),h(P,{variable:$},null,8,["variable"])]))),128))])):g("",!0)]),_:2},1032,["label","required"]))],64))),256))]),_:1})])],64)):(n(),o("div",we,[i("p",null,c(e.$t("service.withoutParametersTip")),1)])),t.withInstallButton?(n(),o("div",Se,[h(_,{type:"important",onClick:u.install,disabled:r.isWorking.install},{default:f(()=>[V(c(r.isWorking.install?e.$t("service.installing"):e.$t("service.install")),1)]),_:1},8,["onClick","disabled"])])):g("",!0)]),h(T,{ref:"serviceCodeErrorWindow"},null,512)])}const Oe=C(he,[["render",Ie],["__scopeId","data-v-03fcbe9b"]]);const Ce={name:"IssueListView",components:{Pagination:te},data(){return{pagination:{pageIndex:1,capacity:10,total:100}}}},b=e=>(U("data-v-f510f853"),e=e(),z(),e),Pe={class:"issue-wrap"},je=b(()=>i("div",{class:"toolbar"},[i("ul",null,[i("li",null,"All"),i("li",null,"Enabled"),i("li",null,"Completed"),i("li",null,"Refused")]),i("ul",{class:"issue-types"},[i("li",{class:"bug"},"BUG"),i("li",{class:"optimize"},"Optimize")])],-1)),Te={class:"issues"},We=b(()=>i("h3",null,"登录失败时验证码没有刷新",-1)),qe={class:"text-info-1"},Ee=b(()=>i("span",null,"刘大逵",-1)),Le=b(()=>i("li",{class:"text-info-1"},[i("span",null,"Completed")],-1)),Be=b(()=>i("li",{class:"text-info-1"},[i("span",null,"3小时前")],-1));function Fe(e,s,t,l,r,u){const _=d("UserFilled"),m=d("el-icon"),a=d("router-link"),k=d("Pagination");return n(),o("div",Pe,[je,i("ul",Te,[(n(),o(y,null,w(10,S=>i("li",{key:S},[h(a,{to:"#",target:"_blank"},{default:f(()=>[We,i("ul",null,[i("li",qe,[h(m,null,{default:f(()=>[h(_)]),_:1}),Ee]),Le,Be])]),_:1})])),64))]),h(k,{pagination:r.pagination},null,8,["pagination"])])}const Ue=C(Ce,[["render",Fe],["__scopeId","data-v-f510f853"]]);export{Ue as I,Ne as S,Oe as a};
