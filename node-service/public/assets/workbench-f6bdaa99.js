import{_ as D,C as L,M as N,m as U,n as z,J as B,r as c,z as E,A as S,o,c as v,a as n,t as r,e as l,F as g,j as f,g as d,w as a,b as u,H as k,I as b}from"./index-8bf0d0b9.js";import{S as T,I as F,a as q}from"./IssueListView-6afb0bb1.js";import{a as A}from"./service-e436d86b.js";import{E as H}from"./Empty-423b8e89.js";import{B as J}from"./BeanAmount-f8329e95.js";import{f as O}from"./service.version-a4bef89f.js";import"./Pagination-b166e712.js";const G={components:{CreateProjectWindow:L,SubServiceList:T,BeanAmount:J,IssueListView:F,Empty:H,MarkdownEditor:N,ServiceInstaller:q},data(){return{loading:!0,isWorking:{install:!1,uninstall:!1},space:null,latestMainService:null,mainService:null,currentService:null,subServices:[],currentServiceDimension:"readme",project:null}},watch:{currentProject(){this.fetchProject(!0)}},computed:{...U(["currentProject"]),installed(){return this.currentService==null?!1:this.project.services[this.currentService.name]!=null},majorVersion(){return this.mainService==null?"...":`${this.mainService.version.substring(0,this.mainService.version.indexOf("."))}`}},methods:{...z(["setCurrentProject"]),fetchProject(i=!1){if(this.loading=!0,this.currentProject==null||this.currentProject===""){this.project=null,this.space=null,this.loading=!1;return}this.refreshProject(i)},fetchMainService(){this.latestMainService==null&&O({space:this.space,service:this.mainService.name}).then(i=>{console.log("data",i),this.latestMainService=i}).catch(i=>{this.$tip.apiFailed(i)})},refreshProject(i=!1){B(this.currentProject).then(s=>{if(this.project=s,this.space=this.project.space,this.project.main==null){this.loading=!1;return}let h=null;for(const _ in this.project.main){h=_;break}this.mainService={name:h,...this.project.main[h]},this.fetchMainService(),i&&this.searchSubServices()}).catch(s=>{this.$tip.apiFailed(s)}).finally(()=>{this.loading=!1})},searchSubServices(){A({space:this.space,service:this.mainService.name,majorVersion:this.majorVersion}).then(i=>{this.subServices=i,this.subServices.length>0&&this.selectService(this.subServices[0])}).catch(i=>{this.$tip.apiFailed(i)})},selectService(i){this.subServices.length>0&&(this.currentService=i)},hasNewVersion(i){const s=this.project.services[i.name];return s==null?!1:s.version!==i.lastVersion}},created(){const i=this.$route.query.project_id;i!=null&&i!==""&&(this.setCurrentProject(i),this.$router.replace({name:"Workbench"})),this.fetchProject(!0)}},K={class:"page"},Q={key:0,class:"wrap"},R={class:"header"},X={class:"title"},Y={class:"service-info"},Z={class:"info"},$={class:"content-wrap"},x={class:"service-wrap"},ee={class:"search-box"},ie={class:"setting-wrap"},se={class:"main"},ne={class:"service-dimensions"},re={class:"dimension-content"},te={class:"issue-wrap"},le={class:"opera"},oe={key:1,class:"setting-holder"},ce={key:1,class:"incorrect-wrap"},ae={class:"content"},ue={key:2,class:"incorrect-wrap"},ve={class:"content"};function pe(i,s,h,_,e,p){const m=c("el-button"),y=c("el-input"),w=c("Upload"),V=c("el-icon"),P=c("SubServiceList"),C=c("MarkdownEditor"),I=c("ServiceInstaller"),M=c("IssueListView"),j=c("router-link"),W=E("loading");return S((o(),v("div",K,[!e.loading&&e.project!=null&&e.mainService!=null?(o(),v("div",Q,[n("div",null,[n("div",R,[n("div",X,[n("h2",null,r(e.project.name),1),n("div",Y,[n("p",null,[l(r(e.space)+" · "+r(e.mainService.name)+" · v"+r(e.mainService.version)+" ",1),e.latestMainService!=null?(o(),v(g,{key:0},[l(" · "+r(i.$t("service.latestVersion"))+": v"+r(e.latestMainService.version),1)],64)):f("",!0)]),e.latestMainService!=null&&e.latestMainService.version!==e.mainService.version?(o(),d(m,{key:0,type:"primary",icon:"Upload",onClick:s[0]||(s[0]=t=>i.$router.push({name:"SpaceDetail",params:{name:e.space},query:{service:this.mainService.name}}))},{default:a(()=>[l(r(i.$t("service.upgrade")),1)]),_:1})):f("",!0)])]),n("div",Z,[n("em",null,"v"+r(p.majorVersion),1),n("p",null,r(i.$t("common.currentVersion")),1)])]),n("div",$,[n("div",x,[n("div",ee,[u(y,{size:"large",placeholder:i.$t("common.search")},null,8,["placeholder"])]),u(P,{services:e.subServices,"custom-class":t=>({selected:e.currentService!=null&&e.currentService.name===t.name}),onClick:s[1]||(s[1]=t=>p.selectService(t))},{title:a(({service:t})=>[l(r(t.name)+" ",1),p.hasNewVersion(t)?(o(),d(V,{key:0},{default:a(()=>[u(w)]),_:1})):f("",!0)]),_:1},8,["services","custom-class"])]),n("div",ie,[e.currentService!=null?(o(),v(g,{key:0},[n("h3",null,r(e.currentService.name),1),n("div",se,[n("ul",ne,[n("li",{class:k({selected:e.currentServiceDimension==="readme"}),onClick:s[2]||(s[2]=t=>e.currentServiceDimension="readme")},r(i.$t("common.readme")),3),n("li",{class:k({selected:e.currentServiceDimension==="install"}),onClick:s[3]||(s[3]=t=>e.currentServiceDimension="install")},r(i.$t("service.install2")),3),n("li",{class:k(["disabled",{selected:e.currentServiceDimension==="issues"}])},r(i.$t("common.issues")),3)]),n("div",re,[S(n("div",null,[u(C,{modelValue:e.currentService.description,"onUpdate:modelValue":s[4]||(s[4]=t=>e.currentService.description=t),readonly:"","without-padding":!0},null,8,["modelValue"])],512),[[b,e.currentServiceDimension==="readme"]]),S(u(I,{ref:"installer",installing:e.isWorking.install,"onUpdate:installing":s[5]||(s[5]=t=>e.isWorking.install=t),uninstalling:e.isWorking.uninstall,"onUpdate:uninstalling":s[6]||(s[6]=t=>e.isWorking.uninstall=t),space:e.space,service:e.currentService.name,"service-type":e.currentService.type,"service-price":e.currentService.price.price,"service-lease":e.currentService.latestLease,version:e.currentService.lastVersion,"with-project":!1,"project-config":e.project,onInstalled:s[7]||(s[7]=t=>p.refreshProject()),onUninstalled:s[8]||(s[8]=t=>p.refreshProject())},null,8,["installing","uninstalling","space","service","service-type","service-price","service-lease","version","project-config"]),[[b,e.currentServiceDimension==="install"]]),n("div",te,[S(u(M,null,null,512),[[b,e.currentServiceDimension==="issues"]])])])]),n("div",le,[p.installed?(o(),v(g,{key:0},[p.hasNewVersion(e.currentService)?(o(),d(m,{key:0,type:"primary",size:"large",icon:"Upload",disabled:e.isWorking.install,onClick:s[9]||(s[9]=t=>i.$refs.installer.install())},{default:a(()=>[l(r(i.$t("service.upgrade")),1)]),_:1},8,["disabled"])):(o(),d(m,{key:1,type:"primary",size:"large",disabled:e.isWorking.install,onClick:s[10]||(s[10]=t=>i.$refs.installer.install())},{default:a(()=>[l(r(e.isWorking.install?i.$t("service.installing"):i.$t("service.reinstall")),1)]),_:1},8,["disabled"])),u(m,{size:"large",disabled:e.isWorking.uninstall,onClick:s[11]||(s[11]=t=>i.$refs.installer.uninstall())},{default:a(()=>[l(r(e.isWorking.uninstall?i.$t("service.uninstalling"):i.$t("service.uninstall")),1)]),_:1},8,["disabled"])],64)):(o(),d(m,{key:1,type:"primary",size:"large",disabled:e.isWorking.install,onClick:s[12]||(s[12]=t=>i.$refs.installer.install())},{default:a(()=>[l(r(e.isWorking.install?i.$t("service.installing"):i.$t("service.install")),1)]),_:1},8,["disabled"]))])],64)):(o(),v("div",oe,[n("h4",null,r(i.$t("workbench.subServiceSettings")),1),n("p",null,r(i.$t("workbench.subServiceSettingsTip")),1)]))])])])])):e.project==null?(o(),v("div",ce,[n("div",ae,[n("p",null,[l(r(i.$t("workbench.noProjectTip1")),1),u(j,{to:{name:"Index"}},{default:a(()=>[l(r(i.$t("common.homepage")),1)]),_:1}),l(r(i.$t("workbench.noProjectTip2")),1)])])])):e.mainService==null?(o(),v("div",ue,[n("div",ve,[n("p",null,[l(r(i.$t("workbench.noServiceInstalledTip1")),1),u(j,{to:{name:"PublicSpaces"}},{default:a(()=>[l(r(i.$t("common.publicSpace")),1)]),_:1}),l(r(i.$t("workbench.noServiceInstalledTip2")),1)])])])):f("",!0)])),[[W,e.loading]])}const be=D(G,[["render",pe],["__scopeId","data-v-5ba99ac2"]]);export{be as default};
