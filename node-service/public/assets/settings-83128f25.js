import{_ as D,M as z,Q as I,m as E,n as F,Z as B,$ as N,r as t,z as M,A as u,o as p,c as v,a as r,b as l,w as g,j as m,t as o,F as q,H as c,I as h,g as d,e as f}from"./index-42b6b834.js";import{S as H,V as O,P as U,B as A,I as Q,a as R}from"./SystemVariableTable-3ee64c92.js";import{S as Z}from"./ServiceCodeErrorWindow-333db70f.js";import{s as G,a as J,b as K}from"./plugin-a87a8e0c.js";import{S as L}from"./ServiceTitle-7a4b875c.js";import"./CompilerSelect-3dcc9bed.js";import"./service-c94385d9.js";import"./service.version-e08215bb.js";import"./form.check-189b470c.js";import"./QueryModelView-eff0868c.js";import"./InnerRouterViewWindow-129d0f04.js";const X={components:{ServiceTitle:L,SystemVariableTable:H,ServiceCodeErrorWindow:Z,MarkdownEditor:z,Variables:O,PublishWindow:U,BasicSetting:A,InitializeView:Q,DirectorySelect:I,SettingFiles:R},data(){return{isWorking:{compile:!1,cleanCompile:!1},route:{space:null,service:null,plugin:null},loading:!0,currentTab:"basic",plugin:null,pluginConfig:null}},computed:{...E(["currentProject","currentProjectDetail","currentDatabase","installData"]),initialized(){return this.pluginConfig!=null&&this.pluginConfig.version!=null},compileTip(){return this.currentProjectDetail!=null?this.$t("service.settings.compileTipWithProject",{project:this.currentProjectDetail.name}):this.$t("service.settings.compileTip")},cleanCompileTip(){return this.currentProjectDetail!=null?this.$t("service.settings.cleanCompileTipWithProject",{project:this.currentProjectDetail.name}):this.$t("service.settings.cleanCompileTip")}},methods:{...F(["setInstallData"]),saveConfig(){G({...this.route,readme:this.plugin.description}).catch(i=>{this.$tip.apiFailed(i)})},fetchProfile(){this.loading=!0,J({spaceName:this.route.space,serviceName:this.route.service,pluginName:this.route.plugin}).then(i=>{this.plugin=i}).then(()=>K({space:this.route.space,service:this.route.service,plugin:this.route.plugin})).then(i=>{i!=null&&(this.pluginConfig=i,this.pluginConfig.label=this.pluginConfig.label||this.pluginConfig.name,this.plugin.label=this.pluginConfig.label,this.plugin.description=i.readme)}).catch(i=>{this.$tip.apiFailed(i)}).finally(()=>{this.loading=!1})},compile(){this.isWorking.compile||this.currentProject==null||this.currentProject===""||(this.isWorking.compile=!0,B({...this.route,serviceType:"COMMON",projectId:this.currentProject,database:this.currentDatabase,variables:this.$refs.variables.getVariables()}).then(i=>{this.setInstallData(i),this.$tip.success("Compile successfully.")}).catch(i=>{if(i.code===6e3){this.$refs.serviceCodeErrorWindow.open(i.errorData);return}this.$tip.apiFailed(i)}).finally(()=>{this.isWorking.compile=!1}))},cleanCompile(){this.isWorking.cleanCompile||this.currentProject==null||this.currentProject===""||(this.isWorking.cleanCompile=!0,N({...this.route,projectId:this.currentProject,database:this.currentDatabase,variables:this.$refs.variables.getVariables()}).then(i=>{this.$tip.success("Clean Compile successfully."),this.setInstallData(i)}).catch(i=>{if(i.code===6e3){this.$refs.serviceCodeErrorWindow.open(i.errorData);return}this.$tip.apiFailed(i)}).finally(()=>{this.isWorking.cleanCompile=!1}))}},created(){this.route.space=this.$route.query.space,this.route.service=this.$route.query.service,this.route.plugin=this.$route.query.plugin,this.fetchProfile()}},Y={class:"wrap"},x={class:"header-wrap"},$={class:"header"},ee={key:0,class:"opera"},ie={key:0,class:"text-info-1 service-path"},se={class:"main"},te={class:"tabs"},re={class:"tab-content"};function le(i,s,ne,oe,e,n){const _=t("ServiceTitle"),b=t("el-button"),C=t("el-popover"),T=t("BasicSetting"),k=t("MarkdownEditor"),y=t("Variables"),w=t("SettingFiles"),P=t("SystemVariableTable"),S=t("InitializeView"),W=t("PublishWindow"),j=t("ServiceCodeErrorWindow"),V=M("loading");return e.plugin!=null?u((p(),v("div",{key:0,class:c(["page",{"page-un-initialize":!n.initialized}])},[r("div",Y,[r("div",x,[r("div",$,[l(_,{space:e.plugin.space.name,service:e.plugin.service.name,"service-label":e.plugin.service.label,plugin:e.plugin.name,"plugin-label":e.plugin.label,"with-new-page":!0},null,8,["space","service","service-label","plugin","plugin-label"]),n.initialized?(p(),v("div",ee,[l(C,{placement:"top-start",title:i.$t("service.settings.compileTipTitle"),width:200,trigger:"hover",content:n.compileTip},{reference:g(()=>[l(b,{type:"primary",class:c({"is-disabled":i.currentProject==null||e.isWorking.compile}),onClick:n.compile},{default:g(()=>[f(o(i.$t("service.settings.compile")),1)]),_:1},8,["class","onClick"])]),_:1},8,["title","content"]),l(C,{placement:"top-start",title:i.$t("service.settings.cleanCompileTipTitle"),width:200,trigger:"hover",content:n.cleanCompileTip},{reference:g(()=>[l(b,{type:"primary",class:c({"is-disabled":i.currentProject==null||e.isWorking.cleanCompile}),onClick:n.cleanCompile},{default:g(()=>[f(o(i.$t("service.settings.cleanCompile")),1)]),_:1},8,["class","onClick"])]),_:1},8,["title","content"]),l(b,{type:"important",onClick:s[0]||(s[0]=a=>i.$refs.publishWindow.open(e.route.space,e.route.service,e.route.plugin))},{default:g(()=>[f(o(i.$t("service.settings.publish")),1)]),_:1})])):m("",!0)]),n.initialized?(p(),v("p",ie,o(i.$t("service.settings.at"))+" "+o(e.plugin.local.codespace),1)):m("",!0)]),r("div",se,[n.initialized?(p(),v(q,{key:0},[r("ul",te,[r("li",{class:c({selected:e.currentTab==="basic"}),onClick:s[1]||(s[1]=a=>e.currentTab="basic")},o(i.$t("plugin.settings2")),3),r("li",{class:c({selected:e.currentTab==="readme"}),onClick:s[2]||(s[2]=a=>e.currentTab="readme")},o(i.$t("plugin.readme")),3),r("li",{class:c({selected:e.currentTab==="variables"}),onClick:s[3]||(s[3]=a=>e.currentTab="variables")},o(i.$t("service.settings.variables")),3),r("li",{class:c({selected:e.currentTab==="files"}),onClick:s[4]||(s[4]=a=>e.currentTab="files")},o(i.$t("service.settings.files")),3),r("li",{class:c({selected:e.currentTab==="system_variables"}),onClick:s[5]||(s[5]=a=>e.currentTab="system_variables")},o(i.$t("service.settings.systemVariables")),3)]),r("div",re,[u(l(T,{space:e.route.space,service:e.route.service,plugin:e.route.plugin,"service-config":e.pluginConfig},null,8,["space","service","plugin","service-config"]),[[h,e.currentTab==="basic"]]),e.plugin.description!=null?u((p(),d(k,{key:0,modelValue:e.plugin.description,"onUpdate:modelValue":[s[6]||(s[6]=a=>e.plugin.description=a),n.saveConfig],placeholder:i.$t("service.settings.serviceReadmeHolder")},null,8,["modelValue","placeholder","onUpdate:modelValue"])),[[h,e.currentTab==="readme"]]):m("",!0),u(l(y,{ref:"variables",space:e.route.space,service:e.route.service,plugin:e.route.plugin},null,8,["space","service","plugin"]),[[h,e.currentTab==="variables"]]),u(l(w,{space:e.route.space,service:e.route.service,plugin:e.route.plugin},null,8,["space","service","plugin"]),[[h,e.currentTab==="files"]]),e.currentTab==="system_variables"?(p(),d(P,{key:1})):m("",!0)])],64)):(p(),d(S,{key:1,"space-name":e.plugin.space.name,"service-name":e.plugin.service.name,"plugin-name":e.plugin.name,"plugin-label":e.plugin.label,onInitialized:n.fetchProfile},null,8,["space-name","service-name","plugin-name","plugin-label","onInitialized"]))])]),l(W,{ref:"publishWindow"},null,512),l(j,{ref:"serviceCodeErrorWindow"},null,512)],2)),[[V,e.loading]]):m("",!0)}const Ce=D(X,[["render",le],["__scopeId","data-v-1b119c91"]]);export{Ce as default};
