import{_ as I,r as c,o as a,c as d,a as i,F as V,f as M,b as o,w as u,p as A,l as q,x as K,E as O,M as G,m as H,n as J,J as R,z as Q,A as k,t as l,e as p,g,j as P,H as j,I as b}from"./index-bbbc4d77.js";import{S as X}from"./ServiceInstaller-7aeafa5e.js";import{P as Y}from"./Pagination-c5bcec6c.js";import{B as Z}from"./BeanAmount-cb3f194c.js";import{S as x,P as $}from"./PluginList-36f0ed79.js";import{f as ee}from"./service.version-c6e68f54.js";import{f as se}from"./plugin-0859030c.js";import{S as ie}from"./ServiceTitle-3e005be1.js";import"./ServiceCodeErrorWindow-cd8c130e.js";import"./QueryModelView-32ee0b4f.js";import"./InnerRouterViewWindow-58d3c233.js";import"./form.check-189b470c.js";import"./FormItemTip-d6bea30d.js";import"./ServiceStatus-12489d88.js";const ne={name:"IssueListView",components:{Pagination:Y},data(){return{pagination:{pageIndex:1,capacity:10,total:100}}}},w=s=>(A("data-v-f510f853"),s=s(),q(),s),le={class:"issue-wrap"},te=w(()=>i("div",{class:"toolbar"},[i("ul",null,[i("li",null,"All"),i("li",null,"Enabled"),i("li",null,"Completed"),i("li",null,"Refused")]),i("ul",{class:"issue-types"},[i("li",{class:"bug"},"BUG"),i("li",{class:"optimize"},"Optimize")])],-1)),re={class:"issues"},oe=w(()=>i("h3",null,"登录失败时验证码没有刷新",-1)),ce={class:"text-info-1"},ae=w(()=>i("span",null,"刘大逵",-1)),ue=w(()=>i("li",{class:"text-info-1"},[i("span",null,"Completed")],-1)),pe=w(()=>i("li",{class:"text-info-1"},[i("span",null,"3小时前")],-1));function de(s,n,h,S,e,r){const f=c("UserFilled"),m=c("el-icon"),v=c("router-link"),_=c("Pagination");return a(),d("div",le,[te,i("ul",re,[(a(),d(V,null,M(10,y=>i("li",{key:y},[o(v,{to:"#",target:"_blank"},{default:u(()=>[oe,i("ul",null,[i("li",ce,[o(m,null,{default:u(()=>[o(f)]),_:1}),ae]),ue,pe])]),_:1})])),64))]),o(_,{pagination:e.pagination},null,8,["pagination"])])}const he=I(ne,[["render",de],["__scopeId","data-v-f510f853"]]);const me={name:"SearchInput",props:{modelValue:{required:!0},placeholder:{}},methods:{search(){this.$emit("search")},handleInput(s){this.$emit("update:modelValue",s.target.value)}}},ve={class:"search-input"},_e=["value","placeholder"];function ge(s,n,h,S,e,r){const f=c("Search"),m=c("el-icon");return a(),d("div",ve,[i("input",{value:h.modelValue,placeholder:h.placeholder,onKeypress:n[0]||(n[0]=K((...v)=>r.search&&r.search(...v),["enter"])),onInput:n[1]||(n[1]=(...v)=>r.handleInput&&r.handleInput(...v))},null,40,_e),o(m,null,{default:u(()=>[o(f)]),_:1})])}const fe=I(me,[["render",ge],["__scopeId","data-v-898d8650"]]);const ke={components:{ServiceStructureView:x,SearchInput:fe,ServiceTitle:ie,PluginList:$,BeanAmount:Z,IssueListView:he,Empty:O,MarkdownEditor:G,ServiceInstaller:X},data(){return{loading:{page:!0,plugins:!0},isWorking:{install:!1,uninstall:!1},space:null,keyword:"",latestService:null,service:null,selectedPlugin:null,plugins:[],selectedPluginDimension:"readme",project:null}},computed:{...H(["currentProject","currentProjectDetail"]),installed(){return this.selectedPlugin==null?!1:this.installedPlugins[this.selectedPlugin.name]!=null},majorVersion(){return this.service==null?"...":`${this.service.version.substring(0,this.service.version.indexOf("."))}`},installedPlugins(){return this.project.plugins||this.project.services},installedService(){return this.project.service||this.project.main},upgradeDescription(){return this.latestService==null?"":this.$t("service.upgradeTip",{currentVersion:this.service.version,newVersion:this.latestService.version,publishDescription:this.latestService.publishDescription})}},watch:{currentProject(){this.latestService=null,this.selectedPlugin=null,this.fetchProject()}},methods:{...J(["setCurrentProject"]),upgrade(){window.open(`/space/${this.space}/${this.service.name}/install?major=${this.majorVersion}`)},install(){this.selectedPluginDimension="install",this.$refs.installer.install()},uninstall(){this.selectedPluginDimension="install",this.$refs.installer.uninstall()},withInstalled(s){return this.installedPlugins[s.name]!=null},fetchProject(){if(this.loading.page=!0,this.currentProject==null||this.currentProject===""){this.project=null,this.space=null,this.loading.page=!1;return}this.refreshProject(!0)},fetchLatestVersion(){this.latestService==null&&ee({space:this.space,service:this.service.name,majorVersion:this.majorVersion}).then(s=>{this.latestService=s}).catch(s=>{if(s.code===4002){this.alert("当前项目使用的服务可能已被更名或删除，您可以前往服务详情了解更多内容。",null,{showCancelButton:!0,confirmButtonText:"查看服务详情"}).then(()=>{window.open(`/space/${this.space}/${this.service.name}`)});return}this.$tip.apiFailed(s)})},refreshProject(s=!1){this.loading.page=!0,R(this.currentProject).then(n=>{if(this.project=n,this.space=this.project.space,this.space==null){this.service=null,this.loading.page=!1;return}if(this.installedService==null){this.loading.page=!1;return}let h=null;for(const S in this.installedService){h=S;break}this.service={name:h,...this.installedService[h]},this.fetchLatestVersion(),s&&this.searchPlugins()}).catch(n=>{this.$tip.apiFailed(n)}).finally(()=>{this.loading.page=!1})},searchPlugins(){this.loading.plugins=!0,se({space:this.space,service:this.service.name,majorVersion:this.majorVersion,keyword:this.keyword}).then(s=>{this.plugins=s}).catch(s=>{s.code!==4001&&this.$tip.apiFailed(s)}).finally(()=>{this.loading.plugins=!1})},selectPlugin(s){this.plugins.length>0&&(this.selectedPlugin=s)},hasNewVersion(s){const n=this.installedPlugins[s.name];return n==null?!1:n.version!==s.lastVersion}},created(){const s=this.$route.query.project_id;s!=null&&s!==""&&(this.setCurrentProject(s),this.$router.replace({name:"Workbench"})),this.fetchProject()}},Pe={class:"page"},we={key:0,class:"wrap"},Se={class:"header"},ye={class:"title"},je={class:"project-code-space"},be={class:"service-info"},Ve={class:"service-title-wrap"},Ie={class:"info"},Ce={class:"content-wrap"},De={class:"service-wrap"},Te={class:"search-input-wrap"},We={class:"setting-wrap"},Le={class:"main"},Ue={class:"service-dimensions"},Fe={class:"dimension-content"},Be={key:0,class:"opera"},ze={key:1,class:"opera-tip"},Ne={key:1,class:"setting-holder"},Ee={key:1,class:"incorrect-wrap"},Me={class:"content"},Ae={key:2,class:"incorrect-wrap"},qe={class:"content"};function Ke(s,n,h,S,e,r){const f=c("Folder"),m=c("el-icon"),v=c("ServiceTitle"),_=c("el-button"),y=c("el-popover"),T=c("SearchInput"),W=c("Upload"),L=c("Check"),U=c("PluginList"),F=c("MarkdownEditor"),B=c("ServiceInstaller"),z=c("ServiceStructureView"),N=c("el-scrollbar"),E=c("InfoFilled"),C=c("router-link"),D=Q("loading");return k((a(),d("div",Pe,[!e.loading.page&&e.project!=null&&e.service!=null?(a(),d("div",we,[i("div",null,[i("div",Se,[i("div",ye,[i("h2",null,l(e.project.name),1),i("p",je,[o(m,null,{default:u(()=>[o(f)]),_:1}),p(l(s.currentProjectDetail.codespace),1)]),i("div",be,[i("div",Ve,[o(v,{space:e.space,service:e.service.name,"service-label":e.service.label,"with-new-page":!0},null,8,["space","service","service-label"]),p(" · v"+l(e.service.version),1)]),e.latestService!=null&&e.latestService.version!==e.service.version?(a(),g(y,{key:0,title:s.$t("service.upgradeTitle"),width:255,trigger:"hover","popper-class":"upgrade-popover"},{default:u(()=>[i("pre",null,l(r.upgradeDescription),1)]),reference:u(()=>[o(_,{size:"small",type:"primary",icon:"Upload",onClick:r.upgrade},{default:u(()=>[p(l(s.$t("service.upgrade")),1)]),_:1},8,["onClick"])]),_:1},8,["title"])):P("",!0)])]),i("div",Ie,[i("em",null,"v"+l(r.majorVersion),1),i("p",null,l(s.$t("common.currentVersion")),1)])]),i("div",Ce,[i("div",De,[i("div",Te,[o(T,{placeholder:s.$t("common.search"),modelValue:e.keyword,"onUpdate:modelValue":n[0]||(n[0]=t=>e.keyword=t),onSearch:r.searchPlugins},null,8,["placeholder","modelValue","onSearch"])]),k((a(),g(U,{plugins:e.plugins,"custom-class":t=>({selected:e.selectedPlugin!=null&&e.selectedPlugin.name===t.name}),installed:t=>r.withInstalled(t),onClick:n[1]||(n[1]=t=>r.selectPlugin(t))},{title:u(({plugin:t})=>[p(l(t.label||t.name)+" ",1),r.hasNewVersion(t)?(a(),g(m,{key:0},{default:u(()=>[o(W)]),_:1})):r.withInstalled(t)?(a(),g(m,{key:1,class:"installed-icon"},{default:u(()=>[o(L)]),_:1})):P("",!0)]),_:1},8,["plugins","custom-class","installed"])),[[D,e.loading.plugins]])]),i("div",We,[e.selectedPlugin!=null?(a(),d(V,{key:0},[i("h3",null,l(e.selectedPlugin.label||e.selectedPlugin.name),1),i("div",Le,[o(N,null,{default:u(()=>[i("ul",Ue,[i("li",{class:j({selected:e.selectedPluginDimension==="readme"}),onClick:n[2]||(n[2]=t=>e.selectedPluginDimension="readme")},l(s.$t("common.readme")),3),i("li",{class:j({selected:e.selectedPluginDimension==="install"}),onClick:n[3]||(n[3]=t=>e.selectedPluginDimension="install")},l(s.$t("plugin.install")),3),i("li",{class:j({selected:e.selectedPluginDimension==="structure"}),onClick:n[4]||(n[4]=t=>e.selectedPluginDimension="structure")},l(s.$t("service.structure")),3)]),i("div",Fe,[k(i("div",null,[o(F,{modelValue:e.selectedPlugin.description,"onUpdate:modelValue":n[5]||(n[5]=t=>e.selectedPlugin.description=t),readonly:"","without-padding":!0},null,8,["modelValue"])],512),[[b,e.selectedPluginDimension==="readme"]]),k(o(B,{ref:"installer",installing:e.isWorking.install,"onUpdate:installing":n[6]||(n[6]=t=>e.isWorking.install=t),uninstalling:e.isWorking.uninstall,"onUpdate:uninstalling":n[7]||(n[7]=t=>e.isWorking.uninstall=t),space:e.space,service:e.service.name,plugin:e.selectedPlugin.name,"service-price":e.selectedPlugin.price.price,"service-lease":e.selectedPlugin.latestLease,version:e.selectedPlugin.lastVersion,"with-project":!1,"project-config":e.project,onInstalled:n[8]||(n[8]=t=>r.refreshProject()),onUninstalled:n[9]||(n[9]=t=>r.refreshProject())},null,8,["installing","uninstalling","space","service","plugin","service-price","service-lease","version","project-config"]),[[b,e.selectedPluginDimension==="install"]]),k(o(z,{space:e.space,service:e.service.name,plugin:e.selectedPlugin.name,version:e.selectedPlugin.lastVersion},null,8,["space","service","plugin","version"]),[[b,e.selectedPluginDimension==="structure"]])])]),_:1})]),e.selectedPluginDimension==="install"?(a(),d("div",Be,[r.installed?(a(),d(V,{key:0},[r.hasNewVersion(e.selectedPlugin)?(a(),g(_,{key:0,type:"primary",size:"large",icon:"Upload",disabled:e.isWorking.install,onClick:r.install},{default:u(()=>[p(l(s.$t("service.upgrade")),1)]),_:1},8,["disabled","onClick"])):(a(),g(_,{key:1,type:"primary",size:"large",disabled:e.isWorking.install,onClick:r.install},{default:u(()=>[p(l(e.isWorking.install?s.$t("service.installing"):s.$t("service.reinstall")),1)]),_:1},8,["disabled","onClick"])),o(_,{size:"large",disabled:e.isWorking.uninstall,onClick:r.uninstall},{default:u(()=>[p(l(e.isWorking.uninstall?s.$t("service.uninstalling"):s.$t("service.uninstall")),1)]),_:1},8,["disabled","onClick"])],64)):(a(),g(_,{key:1,type:"primary",size:"large",disabled:e.isWorking.install,onClick:r.install},{default:u(()=>[p(l(e.isWorking.install?s.$t("service.installing"):s.$t("service.install")),1)]),_:1},8,["disabled","onClick"]))])):P("",!0),e.selectedPluginDimension==="install"?(a(),d("div",ze,[o(m,null,{default:u(()=>[o(E)]),_:1}),i("p",null,l(s.$t("service.installTip")),1)])):P("",!0)],64)):(a(),d("div",Ne,[i("h4",null,l(s.$t("workbench.subServiceSettings")),1),i("p",null,l(s.$t("workbench.subServiceSettingsTip")),1)]))])])])])):e.project==null?(a(),d("div",Ee,[i("div",Me,[i("p",null,[p(l(s.$t("workbench.noProjectTip1")),1),o(C,{to:{name:"Index"}},{default:u(()=>[p(l(s.$t("common.homepage")),1)]),_:1}),p(l(s.$t("workbench.noProjectTip2")),1)])])])):e.service==null?(a(),d("div",Ae,[i("div",qe,[i("p",null,[p(l(s.$t("workbench.noServiceInstalledTip1")),1),o(C,{to:{name:"PublicServices"}},{default:u(()=>[p(l(s.$t("service.publicServices")),1)]),_:1}),p(l(s.$t("workbench.noServiceInstalledTip2")),1)])])])):P("",!0)])),[[D,e.loading.page]])}const ns=I(ke,[["render",Ke],["__scopeId","data-v-5f151660"]]);export{ns as default};
