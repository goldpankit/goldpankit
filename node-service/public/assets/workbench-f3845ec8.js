import{_ as V,E as C,m as D,i as P,K as W,r as u,o as r,c as o,b as i,t as l,d as a,F as _,x as E,u as m,I as h,v as f,J as k,w as S,f as y,g as p,p as U,h as T}from"./index-509f7063.js";import{I as A,S as x}from"./IssueListView-8e261f47.js";import{a as z}from"./service-129a27a2.js";import{M as B}from"./MarkdownEditor-d552790b.js";import"./service.version-1330aacb.js";import"./Pagination-ba4bc926.js";const M={components:{IssueListView:A,Empty:C,MarkdownEditor:B,ServiceInstaller:x},data(){return{isWorking:{install:!1,uninstall:!1},space:null,mainService:null,currentService:null,version:"v1",subServices:[],currentServiceDimension:"readme",project:null}},watch:{currentProject(){this.fetchProject(!0)}},computed:{...D(["currentProject"]),installed(){return this.currentService==null?!1:this.project.services[this.currentService.name]!=null}},methods:{...P(["setCurrentProject"]),fetchProject(n=!1){W(this.currentProject).then(s=>{this.project=s,this.space=this.project.space;let v=null;for(const b in this.project.main){v=b;break}this.mainService={name:v,...this.project.main[v]},n&&this.searchSubServices()}).catch(s=>{this.$tip.apiFailed(s)})},searchSubServices(){z({space:this.space,service:this.mainService.name,majorVersion:this.mainService.version.split(".")[0]}).then(n=>{this.subServices=n,this.subServices.length>0&&this.selectService(this.subServices[0])}).catch(n=>{this.$tip.apiFailed(n)})},selectService(n){this.currentService=n},hasNewVersion(n){const s=this.project.services[n.name];return s==null?!1:s.version!==n.lastVersion}},created(){const n=this.$route.query.project_id;n!=null&&n!==""&&(this.setCurrentProject(n),this.$router.replace({name:"Workbench"})),this.fetchProject(!0)}},g=n=>(U("data-v-01110bc7"),n=n(),T(),n),F={class:"page"},G={key:0,class:"wrap"},R={class:"header"},q={class:"title"},J={class:"service-info"},K={class:"info"},Y=g(()=>i("p",null,"current version",-1)),H={class:"content-wrap"},O={class:"service-wrap"},Q={class:"search-box"},X={key:0,class:"service-list"},Z=["onClick"],$={key:0},ee={class:"text-info-1 text-mini"},se={class:"setting-wrap"},ie={class:"main"},ne={class:"service-dimensions"},te={class:"dimension-content"},re={class:"issue-wrap"},le={class:"opera"},oe={key:1,class:"setting-holder"},ce=g(()=>i("h4",null,"Sub Service Settings",-1)),ue=g(()=>i("p",null,"You can open Settings by clicking on sub services on the left.",-1)),ae=[ce,ue];function pe(n,s,v,b,e,c){const I=u("el-input"),j=u("Empty"),w=u("MarkdownEditor"),N=u("ServiceInstaller"),L=u("IssueListView"),d=u("el-button");return r(),o("div",F,[e.space!=null?(r(),o("div",G,[i("div",null,[i("div",R,[i("div",q,[i("h2",null,l(e.project.name),1),i("p",J,l(e.space)+" · "+l(e.mainService.name)+" · v"+l(e.mainService.version),1)]),i("div",K,[i("em",null,l(e.version),1),Y])]),i("div",H,[i("div",O,[i("div",Q,[a(I,{size:"large",placeholder:"Search"})]),e.subServices.length>0?(r(),o("ul",X,[(r(!0),o(_,null,E(e.subServices,t=>(r(),o("li",{key:t.id,class:h({selected:e.currentService!=null&&e.currentService.name===t.name}),onClick:ve=>c.selectService(t)},[i("h5",null,[p(l(t.name)+" ",1),c.hasNewVersion(t)?(r(),o("em",$,"Upgradable")):y("",!0)]),i("p",null,l(t.lastVersion),1),i("p",null,l(t.introduce),1),i("p",ee,"Last publish: "+l(t.lastPublishTime),1)],10,Z))),128))])):(r(),m(j,{key:1,description:"No Sub Services"}))]),i("div",se,[e.currentService!=null?(r(),o(_,{key:0},[i("h3",null,l(e.currentService.name),1),i("div",ie,[i("ul",ne,[i("li",{class:h({selected:e.currentServiceDimension==="readme"}),onClick:s[0]||(s[0]=t=>e.currentServiceDimension="readme")},"Readme",2),i("li",{class:h({selected:e.currentServiceDimension==="install"}),onClick:s[1]||(s[1]=t=>e.currentServiceDimension="install")},"Install",2),i("li",{class:h({selected:e.currentServiceDimension==="issues"}),onClick:s[2]||(s[2]=t=>e.currentServiceDimension="issues")},"Issues",2)]),i("div",te,[f(i("div",null,[a(w,{modelValue:e.currentService.description,"onUpdate:modelValue":s[3]||(s[3]=t=>e.currentService.description=t),readonly:"","without-padding":!0},null,8,["modelValue"])],512),[[k,e.currentServiceDimension==="readme"]]),f(a(N,{ref:"installer",installing:e.isWorking.install,"onUpdate:installing":s[4]||(s[4]=t=>e.isWorking.install=t),uninstalling:e.isWorking.uninstall,"onUpdate:uninstalling":s[5]||(s[5]=t=>e.isWorking.uninstall=t),space:e.space,service:e.currentService.name,version:e.currentService.lastVersion,"with-project":!1,"project-config":e.project,onInstalled:s[6]||(s[6]=t=>c.fetchProject()),onUninstalled:s[7]||(s[7]=t=>c.fetchProject())},null,8,["installing","uninstalling","space","service","version","project-config"]),[[k,e.currentServiceDimension==="install"]]),i("div",re,[f(a(L,null,null,512),[[k,e.currentServiceDimension==="issues"]])])])]),i("div",le,[c.installed?(r(),o(_,{key:0},[c.hasNewVersion(e.currentService)?(r(),m(d,{key:0,type:"primary",size:"large",icon:"Upload",onClick:s[8]||(s[8]=t=>n.$refs.installer.install())},{default:S(()=>[p("UPGRADE")]),_:1})):(r(),m(d,{key:1,type:"primary",size:"large",disabled:e.isWorking.install,onClick:s[9]||(s[9]=t=>n.$refs.installer.install())},{default:S(()=>[p(l(e.isWorking.install?"INSTALLING...":"REINSTALL"),1)]),_:1},8,["disabled"])),a(d,{size:"large",disabled:e.isWorking.uninstall,onClick:s[10]||(s[10]=t=>n.$refs.installer.uninstall())},{default:S(()=>[p(l(e.isWorking.uninstall?"UNINSTALLING...":"UNINSTALL"),1)]),_:1},8,["disabled"])],64)):(r(),m(d,{key:1,type:"primary",size:"large",disabled:e.isWorking.install,onClick:s[11]||(s[11]=t=>n.$refs.installer.install())},{default:S(()=>[p(l(e.isWorking.install?"INSTALLING...":"INSTALL"),1)]),_:1},8,["disabled"]))])],64)):(r(),o("div",oe,ae))])])])])):y("",!0)])}const ke=V(M,[["render",pe],["__scopeId","data-v-01110bc7"]]);export{ke as default};
