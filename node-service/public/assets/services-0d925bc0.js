import{P as y}from"./Pagination-8e94a10c.js";import{_ as C,E as P,m as $,r as p,z as k,o as n,c as o,a as t,t as a,A as b,F as E,f as z,g as D,b as d,w as g,e as m,j as F}from"./index-8ca28570.js";import{d as w,f as B}from"./user.service-94880b1e.js";import{b as L}from"./service-79a9e8d7.js";const N={components:{Empty:P,Pagination:y},data(){return{loading:!1,pagination:{page:1,capacity:10,total:100},services:[]}},computed:{...$(["userInfo"])},methods:{openSettings(e){this.$router.push({name:"ServiceSettings",query:{space:e.space.name,service:e.name}})},deleteService(e){this.deleteConfirm(this.$t("service.confirmDeleteTip")).then(()=>{w({space:e.space.name,service:e.name}).then(()=>{this.services.length===1&&(this.pagination.page-=1),this.fetchPage(),this.$tip.success(this.$t("common.deleteSuccessfully"))}).catch(i=>{this.$tip.apiFailed(i)})}).catch(()=>{})},handleCurrentChange(e){this.pagination.page=e,this.fetchPage()},handleSizeChange(e){this.pagination.capacity=e,this.fetchPage()},fetchPage(){this.loading||(this.loading=!0,this.pagination.page<1&&(this.pagination.page=1),B({...this.pagination,model:{}}).then(e=>{this.services=e.records,this.pagination.total=e.total,this.fetchLocalServices()}).catch(e=>{this.$tip.apiFailed(e)}).finally(()=>{this.loading=!1}))},fetchLocalServices(){L().then(e=>{this.services.forEach(i=>{i.codespace=null;const c=e.find(h=>h.space===i.space.name&&h.name===i.name);c!=null&&(i.repository=c.repository,i.codespace=c.codespace)})}).catch(e=>{this.$tip.apiFailed(e)})}},created(){this.fetchPage()}},V={class:"page"},A={class:"wrap"},I={class:"header"},T={key:0,class:"service-list"},j={class:"introduce"},q={class:"footer-info"},O={class:"user-profile"},U=["src"],G={class:"text-info-1 text-mini"},H={key:0,class:"opera"};function J(e,i,c,h,l,r){const u=p("el-button"),f=p("Empty"),_=p("Pagination"),v=k("loading");return n(),o("div",V,[t("div",A,[t("div",I,[t("h2",null,a(e.$t("user.leasedAndPrivateServices")),1)]),l.services.length>0?b((n(),o("ul",T,[(n(!0),o(E,null,z(l.services,s=>(n(),o("li",{key:s.id},[t("h3",null,"@"+a(s.space.name)+"/"+a(s.name),1),t("p",j,a(s.introduce),1),t("p",null,a(e.$t("service.codespace"))+": "+a(s.codespace),1),t("p",null,a(e.$t("service.repository"))+": "+a(s.repository),1),t("div",q,[t("div",O,[t("img",{src:e.getAccessUri(s.user.avatar,"/images/avatar/default.png")},null,8,U),t("span",null,a(s.user.username),1)]),t("p",G,a(e.$t("service.lastPublish"))+": "+a(s.lastPublish==null?e.$t("service.unPublish"):e.getDateOffsetText(s.lastPublish)),1)]),e.userInfo.id===s.user.id?(n(),o("ul",H,[t("li",null,[d(u,{onClick:S=>r.openSettings(s)},{default:g(()=>[m(a(e.$t("service.serviceSettings")),1)]),_:2},1032,["onClick"])]),t("li",null,[d(u,{text:"",type:"danger",onClick:S=>r.deleteService(s)},{default:g(()=>[m(a(e.$t("common.delete")),1)]),_:2},1032,["onClick"])])])):F("",!0)]))),128))])),[[v,l.loading]]):(n(),D(f,{key:1,description:e.$t("service.noServices")},null,8,["description"])),d(_,{pagination:l.pagination,onCurrentChange:r.handleCurrentChange,onSizeChange:r.handleSizeChange},null,8,["pagination","onCurrentChange","onSizeChange"])])])}const W=C(N,[["render",J],["__scopeId","data-v-a73e05f0"]]);export{W as default};
