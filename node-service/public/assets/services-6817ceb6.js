import{P as S}from"./Pagination-0efb9bf5.js";import{E as y}from"./Empty-d235fe22.js";import{d as C,f as P}from"./user.service-b359c84b.js";import{b as $}from"./service-15774d4a.js";import{_ as k,m as b,r as h,o as i,c as o,a as t,t as a,F as E,f as F,g as z,b as d,w as g,e as m,j as B}from"./index-cbab2a5a.js";const L={components:{Empty:y,Pagination:S},data(){return{loading:!1,pagination:{page:1,capacity:10,total:100},services:[]}},computed:{...b(["userInfo"])},methods:{openSettings(e){this.$router.push({name:"ServiceSettings",query:{space:e.space.name,service:e.name}})},deleteService(e){this.deleteConfirm(this.$t("service.confirmDeleteTip")).then(()=>{C({space:e.space.name,service:e.name}).then(()=>{this.services.length===1&&(this.pagination.page-=1,this.fetchPage()),this.$tip.success(this.$t("common.deleteSuccessfully"))}).catch(n=>{this.$tip.apiFailed(n)})}).catch(()=>{})},handleCurrentChange(e){console.log("page",e),this.pagination.page=e,this.fetchPage()},handleSizeChange(e){this.pagination.capacity=e,this.fetchPage()},fetchPage(){this.loading||(this.loading=!0,this.pagination.page<1&&(this.pagination.page=1),P({...this.pagination,model:{}}).then(e=>{this.services=e.records,this.pagination.total=e.total,this.fetchLocalServices()}).catch(e=>{this.$tip.apiFailed(e)}).finally(()=>{this.loading=!1}))},fetchLocalServices(){$().then(e=>{this.services.forEach(n=>{n.codespace=null;const c=e.find(p=>p.space===n.space.name&&p.name===n.name);c!=null&&(n.repository=c.repository,n.codespace=c.codespace)})}).catch(e=>{this.$tip.apiFailed(e)})}},created(){this.fetchPage()}},N={class:"page"},V={class:"wrap"},w={class:"header"},D={key:0,class:"service-list"},I={class:"introduce"},T={class:"footer-info"},A={class:"user-profile"},j=["src"],q={class:"text-info-1 text-mini"},O={key:0,class:"opera"};function U(e,n,c,p,l,r){const u=h("el-button"),f=h("Empty"),_=h("Pagination");return i(),o("div",N,[t("div",V,[t("div",w,[t("h2",null,a(e.$t("user.leasedAndPrivateServices")),1)]),!l.loading&&l.services.length>0?(i(),o("ul",D,[(i(!0),o(E,null,F(l.services,s=>(i(),o("li",{key:s.id},[t("h3",null,"@"+a(s.space.name)+"/"+a(s.name),1),t("p",I,a(s.introduce),1),t("p",null,a(e.$t("service.codespace"))+": "+a(s.codespace),1),t("p",null,a(e.$t("service.repository"))+": "+a(s.repository),1),t("div",T,[t("div",A,[t("img",{src:e.getAccessUri(s.user.avatar,"/images/avatar/default.png")},null,8,j),t("span",null,a(s.user.username),1)]),t("p",q,a(e.$t("service.lastPublish"))+": "+a(s.lastPublish==null?e.$t("service.unPublish"):e.getDateOffsetText(s.lastPublish)),1)]),e.userInfo.id===s.user.id?(i(),o("ul",O,[t("li",null,[d(u,{text:"",onClick:v=>r.openSettings(s)},{default:g(()=>[m(a(e.$t("service.serviceSettings")),1)]),_:2},1032,["onClick"])]),t("li",null,[d(u,{text:"",type:"danger",onClick:v=>r.deleteService(s)},{default:g(()=>[m(a(e.$t("common.delete")),1)]),_:2},1032,["onClick"])])])):B("",!0)]))),128))])):(i(),z(f,{key:1,description:e.$t("service.noServices")},null,8,["description"])),d(_,{pagination:l.pagination,onCurrentChange:r.handleCurrentChange,onSizeChange:r.handleSizeChange},null,8,["pagination","onCurrentChange","onSizeChange"])])])}const M=k(L,[["render",U],["__scopeId","data-v-19132a64"]]);export{M as default};
