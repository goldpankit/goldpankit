import{_ as w,r as o,o as n,c as d,F as I,f as L,a as i,t as p,g as _,E as q,w as k,b as h,k as f,m as N,G as b,z as M,H as T,p as j,h as P,e as C,A as R}from"./index-8997febf.js";import{E}from"./Empty-89b3c193.js";import{f as z,s as A}from"./service-099db8a1.js";import{M as F}from"./MarkdownEditor-8b30137d.js";import{S as W,I as H,a as O}from"./IssueListView-2549f977.js";import{f as U}from"./service.space-96995e9f.js";import{S as Y}from"./ServiceList-7d9f8021.js";import"./BeanAmount-278922ff.js";import"./service.version-d5d1ea47.js";import"./Pagination-ed9a0c44.js";const G={name:"ServiceListView",components:{Empty:E},props:{services:{required:!0},emptyDescription:{default:"No Services"}}},J={key:0,class:"service-list"},K={class:"service-info"},Q={class:"text-mini text-info-1"};function X(t,s,r,c,e,v){const l=o("Empty");return r.services.length>0?(n(),d("ul",J,[(n(!0),d(I,null,L(r.services,m=>(n(),d("li",{key:m.name},[i("div",K,[i("h3",null,p(m.name),1),i("p",null,p(m.introduce),1),i("p",Q,"Last publish: "+p(m.lastPublishTime),1)])]))),128))])):(n(),_(l,{key:1,description:r.emptyDescription},null,8,["description"]))}const x=w(G,[["render",X],["__scopeId","data-v-fdbc436c"]]);const Z={name:"ServiceStructureView",props:{nodes:{required:!0}},data(){return{}},computed:{data(){const t=this.nodes.filter(r=>r.type==="DIRECTORY").sort((r,c)=>c.path.split("/").length-r.path.split("/").length),s=this.nodes.filter(r=>r.type==="FILE");for(const r of t){let c=null;for(let e=s.length-1;e>=0;e--){if(!s[e].path.startsWith(r.path))continue;r.children==null&&(r.children=[]);let v=new Date(s[e].publishTime).getTime();(c==null||v>c)&&(r.description=s[e].description,c=v),r.publishTime=s[e].publishTime,s[e].path=s[e].path.split("/").pop(),r.children.push(s[e]),s.splice(e,1)}}t.reverse();for(let r=t.length-1;r>=0;r--){const c=t[r];let e=!1;for(let v=r-1;v>=0;v--){const l=t[v];if(!c.path.startsWith(l.path))continue;l.children==null&&(l.children=[]);let m=new Date(c.publishTime).getTime(),y=new Date(l.publishTime).getTime();m>y&&(l.description=c.description,l.publishTime=c.publishTime),c.path=c.path.split("/").pop(),l.children.push(c),e=!0;break}e&&t.splice(r,1)}return t.push.apply(t,s),q(t),t}}},$={class:"node-label"},ee={class:"filename"},se={class:"text-info-1 text-mini description"},ie={class:"text-info-1 text-mini publish-time"};function te(t,s,r,c,e,v){const l=o("Document"),m=o("el-icon"),y=o("Folder"),V=o("el-tree");return n(),_(V,{class:"service-structure-tree",data:v.data},{default:k(({node:u,data:S})=>[i("span",$,[S.type==="FILE"?(n(),_(m,{key:0},{default:k(()=>[h(l)]),_:1})):S.type==="DIRECTORY"?(n(),_(m,{key:1},{default:k(()=>[h(y)]),_:1})):f("",!0),i("span",ee,p(S.path),1),i("span",se,p(S.description),1),i("span",ie,p(S.publishTime),1)])]),_:1},8,["data"])}const re=w(Z,[["render",te],["__scopeId","data-v-b81f2d48"]]);const ne={name:"MainServiceDetail",components:{SubServiceList:W,MarkdownEditor:F,ServiceStructureView:re,ServiceListView:x},props:{space:{required:!0},service:{required:!0}},data(){return{currentMajorVersion:"",currentVersion:"",currentDim:"readme",majorVersions:[],majorVersionDetail:null}},computed:{...N(["currentProject"])},methods:{fetchDetail(){z({space:this.space,service:this.service}).then(t=>{this.majorVersions=t.majorVersions,this.currentMajorVersion=this.majorVersions[0],this.majorVersionDetail=t.defaultMajorVersion,this.currentVersion=this.majorVersionDetail.version}).catch(t=>{this.$tip.apiFailed(t)})}},created(){this.fetchDetail()}},ce=t=>(j("data-v-94c5f212"),t=t(),P(),t),oe={key:0,class:"service-detail"},le={class:"nav"},ue={class:"title"},ae=["onClick"],pe={class:"install"},me=ce(()=>i("h5",null,"INSTALL",-1)),de={class:"content-wrap"},ve={class:"service-dimensions"};function _e(t,s,r,c,e,v){const l=o("el-button"),m=o("MarkdownEditor"),y=o("SubServiceList"),V=o("ServiceStructureView");return e.majorVersionDetail!=null?(n(),d("div",oe,[i("div",le,[i("div",ue,[h(l,{class:"button-icon",icon:"ArrowLeftBold",onClick:s[0]||(s[0]=u=>t.$emit("back"))}),i("h4",null,p(r.service),1)]),i("ul",null,[(n(!0),d(I,null,L(e.majorVersions,u=>(n(),d("li",{key:u,class:b({selected:u===e.currentMajorVersion}),onClick:S=>e.currentMajorVersion=u},"v"+p(u),11,ae))),128))])]),i("div",pe,[h(l,{type:"important",onClick:s[1]||(s[1]=u=>t.$emit("install",e.currentVersion))},{default:k(()=>[me]),_:1})]),i("div",de,[i("ul",ve,[i("li",{class:b({selected:e.currentDim==="readme"}),onClick:s[2]||(s[2]=u=>e.currentDim="readme")},"Readme",2),i("li",{class:b({selected:e.currentDim==="subServices"}),onClick:s[3]||(s[3]=u=>e.currentDim="subServices")},"Sub Services",2),i("li",{class:b({selected:e.currentDim==="structure"}),onClick:s[4]||(s[4]=u=>e.currentDim="structure")},"Structure",2)]),M(h(m,{modelValue:e.majorVersionDetail.description,"onUpdate:modelValue":s[5]||(s[5]=u=>e.majorVersionDetail.description=u),readonly:!0},null,8,["modelValue"]),[[T,e.currentDim==="readme"]]),M(h(y,{services:e.majorVersionDetail.subServices},null,8,["services"]),[[T,e.currentDim==="subServices"]]),M(h(V,{nodes:e.majorVersionDetail.structure},null,8,["nodes"]),[[T,e.currentDim==="structure"]])])])):f("",!0)}const he=w(ne,[["render",_e],["__scopeId","data-v-94c5f212"]]);const Se={components:{ServiceList:Y,IssueListView:H,ServiceListView:x,Empty:E,MarkdownEditor:F,ServiceInstaller:O,MainServiceDetail:he},data(){return{spaceName:null,currentTab:"readme",currentMainService:null,currentMainServiceVersion:null,space:null,mainServices:[]}},computed:{...N(["userInfo"])},methods:{fetchSpace(){U(this.spaceName).then(t=>{this.space=t,this.space.description==null&&(this.space.description=""),this.fetchServiceList()}).catch(t=>{this.$tip.apiFailed(t)})},fetchServiceList(){A({space:this.spaceName,serviceType:"MAIN"}).then(t=>{this.mainServices=t;const s=this.$route.query.service;s!=null&&s!==""&&(this.currentMainService=this.mainServices.find(r=>r.name===s),this.currentMainService!=null&&(this.currentTab="services"))}).catch(t=>{this.$tip.apiFailed(t)})},handleServiceInstall(t){this.currentMainServiceVersion=t}},created(){this.spaceName=this.$route.params.name,this.fetchSpace()}},D=t=>(j("data-v-c4f458d7"),t=t(),P(),t),fe={key:0,class:"page"},be={class:"wrap"},ye={class:"tech-stack-wrap"},ke={class:"tech-stack"},Ve={class:"content-wrap"},we={class:"dimension-wrap"},De={class:"dimensions"},Me={class:"detail"},Te={key:0,class:"readme"},Ie={class:"info"},ge=D(()=>i("div",{class:"user-profile"},[i("div",{class:"user-info"},[i("img",{src:R}),i("h4",null,"Caesar Liu")]),i("p",{class:"description"},"Kit联合创始人，从业10年，精通Java、Vue等技术栈。")],-1)),Ce={class:"install"},Le=D(()=>i("label",null,"Home Page",-1)),Ne={key:0,href:"#"},je={key:1},Pe=D(()=>i("label",null,"Services",-1)),Ee=D(()=>i("label",null,"Last Publish",-1)),Fe={key:0},xe={key:1};function Be(t,s,r,c,e,v){const l=o("MarkdownEditor"),m=o("ServiceList"),y=o("Empty"),V=o("MainServiceDetail"),u=o("ServiceInstaller"),S=o("ServiceListView"),B=o("IssueListView"),g=o("el-button");return e.space!=null?(n(),d("div",fe,[i("div",be,[i("h2",null,p(e.space.name),1),i("div",ye,[i("em",null,p(e.space.withPrivate?"Private":"Public"),1),i("p",ke,p(e.space.serviceCount)+" services",1)]),i("div",Ve,[i("div",we,[i("ul",De,[i("li",{class:b({selected:e.currentTab==="readme"}),onClick:s[0]||(s[0]=a=>e.currentTab="readme")},"Readme",2),i("li",{class:b({selected:e.currentTab==="services"}),onClick:s[1]||(s[1]=a=>e.currentTab="services")},"Services",2),i("li",{class:b({selected:e.currentTab==="prices"}),onClick:s[2]||(s[2]=a=>e.currentTab="prices")},"Prices",2),i("li",{class:b({selected:e.currentTab==="issues"}),onClick:s[3]||(s[3]=a=>e.currentTab="issues")},"Issues",2)]),i("div",Me,[e.currentTab==="readme"?(n(),d("div",Te,[h(l,{readonly:"","without-padding":!0,modelValue:e.space.description,"onUpdate:modelValue":s[4]||(s[4]=a=>e.space.description=a)},null,8,["modelValue"])])):e.currentTab==="services"?(n(),d(I,{key:1},[e.currentMainService==null&&e.mainServices.length>0?(n(),_(m,{key:0,services:e.mainServices,onClick:s[5]||(s[5]=a=>e.currentMainService=a)},null,8,["services"])):e.currentMainService==null&&e.mainServices.length===0?(n(),_(y,{key:1,description:"No Services"})):f("",!0),e.currentMainService!=null&&e.currentMainServiceVersion==null?(n(),_(V,{key:2,space:e.space.name,service:e.currentMainService.name,onInstall:v.handleServiceInstall,onBack:s[6]||(s[6]=a=>e.currentMainService=null)},null,8,["space","service","onInstall"])):f("",!0),e.currentMainServiceVersion!=null?(n(),_(u,{key:3,space:e.space.name,service:e.currentMainService.name,"service-type":e.currentMainService.type,version:e.currentMainServiceVersion,"with-breadcrumbs":!0,"with-install-button":!0,onBack:s[7]||(s[7]=a=>e.currentMainServiceVersion=null),onInstalled:s[8]||(s[8]=a=>t.$router.push({name:"Workbench"})),onError:s[9]||(s[9]=a=>t.$tip.apiFailed(a))},null,8,["space","service","service-type","version"])):f("",!0)],64)):e.currentTab==="prices"?(n(),_(S,{key:2,services:[],"empty-description":"No Price Services"})):e.currentTab==="issues"?(n(),_(B,{key:3})):f("",!0)])]),i("div",Ie,[ge,i("div",Ce,[e.space.subServiceReceivable||t.userInfo!=null&&t.userInfo.id===e.space.userId?(n(),_(g,{key:0,type:"primary",size:"large",onClick:s[10]||(s[10]=a=>t.$router.push({name:"CreateService",query:{space:e.spaceName}}))},{default:k(()=>[C("Create New Service")]),_:1})):f("",!0),h(g,{type:"primary",size:"large",onClick:s[11]||(s[11]=a=>t.$router.push({name:"CreateService",query:{space:e.spaceName}}))},{default:k(()=>[C("Create New Issue")]),_:1})]),i("ul",null,[i("li",null,[Le,e.space.homePage!=null&&e.space.homePage!==""?(n(),d("a",Ne,p(e.space.homePage),1)):(n(),d("p",je,"None"))]),i("li",null,[Pe,i("p",null,p(e.space.serviceCount),1)]),i("li",null,[Ee,e.space.lastPublish!=null?(n(),d("p",Fe,p(e.space.lastPublish),1)):(n(),d("p",xe,"None"))])])])])])])):f("",!0)}const Je=w(Se,[["render",Be],["__scopeId","data-v-c4f458d7"]]);export{Je as default};
