import{_ as N,C as z,m as B,n as L,J as U,r as c,z as E,A as h,o as l,c as v,a as n,t as r,b as a,w as u,F as b,H as f,I as g,g as S,e as o,j}from"./index-02df0a5a.js";import{S as T,I as M,a as F}from"./IssueListView-ef116ff1.js";import{a as A}from"./service-4357765e.js";import{M as q}from"./MarkdownEditor-cfc109f5.js";import{E as H}from"./Empty-ee40c95e.js";import{B as J}from"./BeanAmount-e191582f.js";import"./service.version-8ce5a7af.js";import"./Pagination-3254d031.js";const G={components:{CreateProjectWindow:z,SubServiceList:T,BeanAmount:J,IssueListView:M,Empty:H,MarkdownEditor:q,ServiceInstaller:F},data(){return{loading:!0,isWorking:{install:!1,uninstall:!1},space:null,mainService:null,currentService:null,version:"v1",subServices:[],currentServiceDimension:"readme",project:null}},watch:{currentProject(){this.fetchProject(!0)}},computed:{...B(["currentProject"]),installed(){return this.currentService==null?!1:this.project.services[this.currentService.name]!=null}},methods:{...L(["setCurrentProject"]),fetchProject(s=!1){if(this.loading=!0,this.currentProject==null||this.currentProject===""){this.project=null,this.space=null,this.loading=!1;return}this.refreshProject(s)},refreshProject(s=!1){U(this.currentProject).then(i=>{if(this.project=i,this.space=this.project.space,this.project.main==null){this.loading=!1;return}let m=null;for(const k in this.project.main){m=k;break}this.mainService={name:m,...this.project.main[m]},s&&this.searchSubServices()}).catch(i=>{this.$tip.apiFailed(i)}).finally(()=>{this.loading=!1})},searchSubServices(){A({space:this.space,service:this.mainService.name,majorVersion:this.mainService.version.split(".")[0]}).then(s=>{this.subServices=s,this.subServices.length>0&&this.selectService(this.subServices[0])}).catch(s=>{this.$tip.apiFailed(s)})},selectService(s){this.subServices.length>0&&(this.currentService=s)},hasNewVersion(s){const i=this.project.services[s.name];return i==null?!1:i.version!==s.lastVersion}},created(){const s=this.$route.query.project_id;s!=null&&s!==""&&(this.setCurrentProject(s),this.$router.replace({name:"Workbench"})),this.fetchProject(!0)}},K={class:"page"},O={key:0,class:"wrap"},Q={class:"header"},R={class:"title"},X={class:"service-info"},Y={class:"info"},Z={class:"content-wrap"},$={class:"service-wrap"},x={class:"search-box"},ee={class:"setting-wrap"},se={class:"main"},ie={class:"service-dimensions"},ne={class:"dimension-content"},re={class:"issue-wrap"},te={class:"opera"},le={key:1,class:"setting-holder"},oe={key:1,class:"incorrect-wrap"},ce={class:"content"},ae={key:2,class:"incorrect-wrap"},ue={class:"content"};function ve(s,i,m,k,e,p){const w=c("el-input"),y=c("Upload"),P=c("el-icon"),V=c("SubServiceList"),C=c("MarkdownEditor"),I=c("ServiceInstaller"),W=c("IssueListView"),d=c("el-button"),_=c("router-link"),D=E("loading");return h((l(),v("div",K,[!e.loading&&e.project!=null&&e.mainService!=null?(l(),v("div",O,[n("div",null,[n("div",Q,[n("div",R,[n("h2",null,r(e.project.name),1),n("p",X,r(e.space)+" · "+r(e.mainService.name)+" · v"+r(e.mainService.version),1)]),n("div",Y,[n("em",null,r(e.version),1),n("p",null,r(s.$t("common.currentVersion")),1)])]),n("div",Z,[n("div",$,[n("div",x,[a(w,{size:"large",placeholder:s.$t("common.search")},null,8,["placeholder"])]),a(V,{services:e.subServices,"custom-class":t=>({selected:e.currentService!=null&&e.currentService.name===t.name}),onClick:i[0]||(i[0]=t=>p.selectService(t))},{title:u(({service:t})=>[o(r(t.name)+" ",1),p.hasNewVersion(t)?(l(),S(P,{key:0},{default:u(()=>[a(y)]),_:1})):j("",!0)]),_:1},8,["services","custom-class"])]),n("div",ee,[e.currentService!=null?(l(),v(b,{key:0},[n("h3",null,r(e.currentService.name),1),n("div",se,[n("ul",ie,[n("li",{class:f({selected:e.currentServiceDimension==="readme"}),onClick:i[1]||(i[1]=t=>e.currentServiceDimension="readme")},r(s.$t("common.readme")),3),n("li",{class:f({selected:e.currentServiceDimension==="install"}),onClick:i[2]||(i[2]=t=>e.currentServiceDimension="install")},r(s.$t("service.install2")),3),n("li",{class:f(["disabled",{selected:e.currentServiceDimension==="issues"}])},r(s.$t("common.issues")),3)]),n("div",ne,[h(n("div",null,[a(C,{modelValue:e.currentService.description,"onUpdate:modelValue":i[3]||(i[3]=t=>e.currentService.description=t),readonly:"","without-padding":!0},null,8,["modelValue"])],512),[[g,e.currentServiceDimension==="readme"]]),h(a(I,{ref:"installer",installing:e.isWorking.install,"onUpdate:installing":i[4]||(i[4]=t=>e.isWorking.install=t),uninstalling:e.isWorking.uninstall,"onUpdate:uninstalling":i[5]||(i[5]=t=>e.isWorking.uninstall=t),space:e.space,service:e.currentService.name,"service-type":e.currentService.type,"service-price":e.currentService.price.price,"service-lease":e.currentService.latestLease,version:e.currentService.lastVersion,"with-project":!1,"project-config":e.project,onInstalled:i[6]||(i[6]=t=>p.refreshProject()),onUninstalled:i[7]||(i[7]=t=>p.refreshProject())},null,8,["installing","uninstalling","space","service","service-type","service-price","service-lease","version","project-config"]),[[g,e.currentServiceDimension==="install"]]),n("div",re,[h(a(W,null,null,512),[[g,e.currentServiceDimension==="issues"]])])])]),n("div",te,[p.installed?(l(),v(b,{key:0},[p.hasNewVersion(e.currentService)?(l(),S(d,{key:0,type:"primary",size:"large",icon:"Upload",disabled:e.isWorking.install,onClick:i[8]||(i[8]=t=>s.$refs.installer.install())},{default:u(()=>[o(r(s.$t("service.upgrade")),1)]),_:1},8,["disabled"])):(l(),S(d,{key:1,type:"primary",size:"large",disabled:e.isWorking.install,onClick:i[9]||(i[9]=t=>s.$refs.installer.install())},{default:u(()=>[o(r(e.isWorking.install?s.$t("service.installing"):s.$t("service.reinstall")),1)]),_:1},8,["disabled"])),a(d,{size:"large",disabled:e.isWorking.uninstall,onClick:i[10]||(i[10]=t=>s.$refs.installer.uninstall())},{default:u(()=>[o(r(e.isWorking.uninstall?s.$t("service.uninstalling"):s.$t("service.uninstall")),1)]),_:1},8,["disabled"])],64)):(l(),S(d,{key:1,type:"primary",size:"large",disabled:e.isWorking.install,onClick:i[11]||(i[11]=t=>s.$refs.installer.install())},{default:u(()=>[o(r(e.isWorking.install?s.$t("service.installing"):s.$t("service.install")),1)]),_:1},8,["disabled"]))])],64)):(l(),v("div",le,[n("h4",null,r(s.$t("workbench.subServiceSettings")),1),n("p",null,r(s.$t("workbench.subServiceSettingsTip")),1)]))])])])])):e.project==null?(l(),v("div",oe,[n("div",ce,[n("p",null,[o(r(s.$t("workbench.noProjectTip1")),1),a(_,{to:{name:"Index"}},{default:u(()=>[o(r(s.$t("common.homepage")),1)]),_:1}),o(r(s.$t("workbench.noProjectTip2")),1)])])])):e.mainService==null?(l(),v("div",ae,[n("div",ue,[n("p",null,[o(r(s.$t("workbench.noServiceInstalledTip1")),1),a(_,{to:{name:"PublicSpaces"}},{default:u(()=>[o(r(s.$t("common.publicSpace")),1)]),_:1}),o(r(s.$t("workbench.noServiceInstalledTip2")),1)])])])):j("",!0)])),[[D,e.loading]])}const _e=N(G,[["render",ve],["__scopeId","data-v-58b3c259"]]);export{_e as default};
