import{_ as D,E as N,r as p,o as r,c as a,F as w,x as I,b as s,t as c,u as h,H as F,w as V,d as v,f as y,m as B,I as S,v as M,J as C,p as j,h as P,g as L,y as q}from"./index-509f7063.js";import{f as R,s as z}from"./service-129a27a2.js";import{M as E}from"./MarkdownEditor-d552790b.js";import{I as A,S as W}from"./IssueListView-8e261f47.js";import{f as H}from"./service.space-af0f690f.js";import"./service.version-1330aacb.js";import"./Pagination-ba4bc926.js";const J={name:"ServiceListView",components:{Empty:N},props:{services:{required:!0},emptyDescription:{default:"No Services"}}},O={key:0,class:"service-list"},U={class:"service-info"},Y={class:"text-mini text-info-1"};function K(i,t,n,l,e,_){const u=p("Empty");return n.services.length>0?(r(),a("ul",O,[(r(!0),a(w,null,I(n.services,d=>(r(),a("li",{key:d.name},[s("div",U,[s("h3",null,c(d.name),1),s("p",null,c(d.introduce),1),s("p",Y,"Last publish: "+c(d.lastPublishTime),1)])]))),128))])):(r(),h(u,{key:1,description:n.emptyDescription},null,8,["description"]))}const x=D(J,[["render",K],["__scopeId","data-v-fdbc436c"]]);const G={name:"ServiceStructureView",props:{nodes:{required:!0}},data(){return{}},computed:{data(){const i=this.nodes.filter(n=>n.type==="DIRECTORY").sort((n,l)=>l.path.split("/").length-n.path.split("/").length),t=this.nodes.filter(n=>n.type==="FILE");for(const n of i){let l=null;for(let e=t.length-1;e>=0;e--){if(!t[e].path.startsWith(n.path))continue;n.children==null&&(n.children=[]);let _=new Date(t[e].publishTime).getTime();(l==null||_>l)&&(n.description=t[e].description,l=_),n.publishTime=t[e].publishTime,t[e].path=t[e].path.split("/").pop(),n.children.push(t[e]),t.splice(e,1)}}i.reverse();for(let n=i.length-1;n>=0;n--){const l=i[n];let e=!1;for(let _=n-1;_>=0;_--){const u=i[_];if(!l.path.startsWith(u.path))continue;u.children==null&&(u.children=[]);let d=new Date(l.publishTime).getTime(),b=new Date(u.publishTime).getTime();d>b&&(u.description=l.description,u.publishTime=l.publishTime),l.path=l.path.split("/").pop(),u.children.push(l),e=!0;break}e&&i.splice(n,1)}return i.push.apply(i,t),F(i),i}}},Q={class:"node-label"},X={class:"filename"},Z={class:"text-info-1 text-mini description"},$={class:"text-info-1 text-mini publish-time"};function ee(i,t,n,l,e,_){const u=p("Document"),d=p("el-icon"),b=p("Folder"),k=p("el-tree");return r(),h(k,{class:"service-structure-tree",data:_.data},{default:V(({node:m,data:f})=>[s("span",Q,[f.type==="FILE"?(r(),h(d,{key:0},{default:V(()=>[v(u)]),_:1})):f.type==="DIRECTORY"?(r(),h(d,{key:1},{default:V(()=>[v(b)]),_:1})):y("",!0),s("span",X,c(f.path),1),s("span",Z,c(f.description),1),s("span",$,c(f.publishTime),1)])]),_:1},8,["data"])}const se=D(G,[["render",ee],["__scopeId","data-v-b81f2d48"]]);const te={name:"MainServiceDetail",components:{MarkdownEditor:E,ServiceStructureView:se,ServiceListView:x},props:{space:{required:!0},service:{required:!0}},data(){return{currentMajorVersion:"",currentVersion:"",currentDim:"readme",majorVersions:[],majorVersionDetail:null}},computed:{...B(["currentProject"])},methods:{fetchDetail(){R({space:this.space,service:this.service}).then(i=>{this.majorVersions=i.majorVersions,this.currentMajorVersion=this.majorVersions[0],this.majorVersionDetail=i.defaultMajorVersion,this.currentVersion=this.majorVersionDetail.version}).catch(i=>{this.$tip.apiFailed(i)})}},created(){this.fetchDetail()}},ie=i=>(j("data-v-7ea5acf0"),i=i(),P(),i),ne={key:0,class:"service-detail"},re={class:"nav"},oe={class:"title"},ce=["onClick"],le={class:"install"},ue=ie(()=>s("h5",null,"INSTALL",-1)),ae={class:"content-wrap"},pe={class:"service-dimensions"};function me(i,t,n,l,e,_){const u=p("el-button"),d=p("MarkdownEditor"),b=p("ServiceListView"),k=p("ServiceStructureView");return e.majorVersionDetail!=null?(r(),a("div",ne,[s("div",re,[s("div",oe,[v(u,{class:"button-icon",icon:"ArrowLeftBold",onClick:t[0]||(t[0]=m=>i.$emit("back"))}),s("h4",null,c(n.service),1)]),s("ul",null,[(r(!0),a(w,null,I(e.majorVersions,m=>(r(),a("li",{key:m,class:S({selected:m===e.currentMajorVersion}),onClick:f=>e.currentMajorVersion=m},"v"+c(m),11,ce))),128))])]),s("div",le,[v(u,{type:"important",onClick:t[1]||(t[1]=m=>i.$emit("install",e.currentVersion))},{default:V(()=>[ue]),_:1})]),s("div",ae,[s("ul",pe,[s("li",{class:S({selected:e.currentDim==="readme"}),onClick:t[2]||(t[2]=m=>e.currentDim="readme")},"Readme",2),s("li",{class:S({selected:e.currentDim==="subServices"}),onClick:t[3]||(t[3]=m=>e.currentDim="subServices")},"Sub Services",2),s("li",{class:S({selected:e.currentDim==="structure"}),onClick:t[4]||(t[4]=m=>e.currentDim="structure")},"Structure",2)]),M(v(d,{modelValue:e.majorVersionDetail.description,"onUpdate:modelValue":t[5]||(t[5]=m=>e.majorVersionDetail.description=m),readonly:!0},null,8,["modelValue"]),[[C,e.currentDim==="readme"]]),M(v(b,{services:e.majorVersionDetail.subServices},null,8,["services"]),[[C,e.currentDim==="subServices"]]),M(v(k,{nodes:e.majorVersionDetail.structure},null,8,["nodes"]),[[C,e.currentDim==="structure"]])])])):y("",!0)}const de=D(te,[["render",me],["__scopeId","data-v-7ea5acf0"]]);const _e={components:{IssueListView:A,ServiceListView:x,Empty:N,MarkdownEditor:E,ServiceInstaller:W,MainServiceDetail:de},data(){return{spaceName:null,currentTab:"readme",currentMainService:null,currentMainServiceVersion:null,space:null,mainServices:[]}},methods:{fetchSpace(){H(this.spaceName).then(i=>{this.space=i,this.space.description==null&&(this.space.description=""),this.fetchServiceList()}).catch(i=>{this.$tip.apiFailed(i)})},fetchServiceList(){z({space:this.spaceName,serviceTypes:["MAIN"]}).then(i=>{this.mainServices=i;const t=this.$route.query.service;t!=null&&t!==""&&(this.currentMainService=this.mainServices.find(n=>n.name===t),this.currentMainService!=null&&(this.currentTab="services"))}).catch(i=>{this.$tip.apiFailed(i)})},handleServiceInstall(i){this.currentMainServiceVersion=i}},created(){this.spaceName=this.$route.params.name,this.fetchSpace()}},T=i=>(j("data-v-9466ed4d"),i=i(),P(),i),ve={key:0,class:"page"},he={class:"wrap"},fe={class:"tech-stack-wrap"},Se={class:"tech-stack"},be={class:"content-wrap"},ye={class:"dimension-wrap"},Ve={class:"dimensions"},ke={class:"detail"},we={key:0,class:"readme"},De={key:0,class:"service-list"},Te=["onClick"],Me={class:"infos"},Ce={class:"infos text-info-1"},Ie={class:"info"},ge=T(()=>s("div",{class:"user-profile"},[s("div",{class:"user-info"},[s("img",{src:q}),s("h4",null,"Caesar Liu")]),s("p",{class:"description"},"Kit联合创始人，从业10年，精通Java、Vue等技术栈。")],-1)),Le={class:"install"},Ne=T(()=>s("label",null,"Home Page",-1)),je={key:0,href:"#"},Pe={key:1},Ee=T(()=>s("label",null,"Services",-1)),xe=T(()=>s("label",null,"Last Publish",-1)),Fe={key:0},Be={key:1};function qe(i,t,n,l,e,_){const u=p("MarkdownEditor"),d=p("Empty"),b=p("MainServiceDetail"),k=p("ServiceInstaller"),m=p("ServiceListView"),f=p("IssueListView"),g=p("el-button");return e.space!=null?(r(),a("div",ve,[s("div",he,[s("h2",null,c(e.space.name),1),s("div",fe,[s("em",null,c(e.space.withPrivate?"Private":"Public"),1),s("p",Se,c(e.space.serviceCount)+" services",1)]),s("div",be,[s("div",ye,[s("ul",Ve,[s("li",{class:S({selected:e.currentTab==="readme"}),onClick:t[0]||(t[0]=o=>e.currentTab="readme")},"Readme",2),s("li",{class:S({selected:e.currentTab==="services"}),onClick:t[1]||(t[1]=o=>e.currentTab="services")},"Services",2),s("li",{class:S({selected:e.currentTab==="prices"}),onClick:t[2]||(t[2]=o=>e.currentTab="prices")},"Prices",2),s("li",{class:S({selected:e.currentTab==="issues"}),onClick:t[3]||(t[3]=o=>e.currentTab="issues")},"Issues",2)]),s("div",ke,[e.currentTab==="readme"?(r(),a("div",we,[v(u,{readonly:"","without-padding":!0,modelValue:e.space.description,"onUpdate:modelValue":t[4]||(t[4]=o=>e.space.description=o)},null,8,["modelValue"])])):e.currentTab==="services"?(r(),a(w,{key:1},[e.currentMainService==null&&e.mainServices.length>0?(r(),a("ul",De,[(r(!0),a(w,null,I(e.mainServices,o=>(r(),a("li",{onClick:Re=>e.currentMainService=o},[s("h4",null,c(o.name),1),s("p",null,c(o.introduce),1),s("section",Me,[s("p",null,c(o.versionCount)+" versions",1),s("p",null,"Latest version: "+c(o.lastVersion),1)]),s("section",Ce,[s("p",null,"Last publish: "+c(o.lastPublish),1)])],8,Te))),256))])):e.currentMainService==null&&e.mainServices.length===0?(r(),h(d,{key:1,description:"No Services"})):y("",!0),e.currentMainService!=null&&e.currentMainServiceVersion==null?(r(),h(b,{key:2,space:e.space.name,service:e.currentMainService.name,onInstall:_.handleServiceInstall,onBack:t[5]||(t[5]=o=>e.currentMainService=null)},null,8,["space","service","onInstall"])):y("",!0),e.currentMainServiceVersion!=null?(r(),h(k,{key:3,space:e.space.name,service:e.currentMainService.name,version:e.currentMainServiceVersion,"with-breadcrumbs":!0,"with-install-button":!0,onBack:t[6]||(t[6]=o=>e.currentMainServiceVersion=null),onInstalled:t[7]||(t[7]=o=>i.$router.push({name:"Workbench"})),onError:t[8]||(t[8]=o=>i.$tip.apiFailed(o))},null,8,["space","service","version"])):y("",!0)],64)):e.currentTab==="prices"?(r(),h(m,{key:2,services:[],"empty-description":"No Price Services"})):e.currentTab==="issues"?(r(),h(f,{key:3})):y("",!0)])]),s("div",Ie,[ge,s("div",Le,[v(g,{type:"primary",size:"large",onClick:t[9]||(t[9]=o=>i.$router.push({name:"CreateService",query:{space:e.spaceName}}))},{default:V(()=>[L("Create New Service")]),_:1}),v(g,{type:"primary",size:"large",onClick:t[10]||(t[10]=o=>i.$router.push({name:"CreateService",query:{space:e.spaceName}}))},{default:V(()=>[L("Create New Issue")]),_:1})]),s("ul",null,[s("li",null,[Ne,e.space.homePage!=null&&e.space.homePage!==""?(r(),a("a",je,c(e.space.homePage),1)):(r(),a("p",Pe,"None"))]),s("li",null,[Ee,s("p",null,c(e.space.serviceCount),1)]),s("li",null,[xe,e.space.lastPublish!=null?(r(),a("p",Fe,c(e.space.lastPublish),1)):(r(),a("p",Be,"None"))])])])])])])):y("",!0)}const Ye=D(_e,[["render",qe],["__scopeId","data-v-9466ed4d"]]);export{Ye as default};
