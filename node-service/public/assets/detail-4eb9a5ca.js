import{_ as D,H as B,r as l,o as c,g as V,w as S,a as i,b as u,j as f,t as n,c as h,F as P,f as N,M as F,z as x,A as b,G as y,I as T,e as k,p as A,l as E}from"./index-c1ed4b13.js";import{P as q}from"./PluginList-a97a795d.js";import{B as C}from"./BeanAmount-a786337c.js";import{f as O,a as R}from"./service-ff4ad1ca.js";import{a as z}from"./service.space-3fc278a0.js";import{S as I}from"./ServiceTitle-eb07b032.js";import{S as U}from"./ServiceStatus-884858b6.js";const W={name:"ServiceStructureView",props:{nodes:{required:!0}},data(){return{}},computed:{data(){const s=this.nodes.filter(r=>r.type==="DIRECTORY").sort((r,o)=>o.path.split("/").length-r.path.split("/").length),t=this.nodes.filter(r=>r.type==="FILE");for(const r of s){let o=null;for(let e=t.length-1;e>=0;e--){if(!t[e].path.startsWith(r.path))continue;r.children==null&&(r.children=[]);let m=new Date(t[e].publishTime).getTime();(o==null||m>o)&&(r.description=t[e].description,o=m),r.publishTime=t[e].publishTime,t[e].path=t[e].path.split("/").pop(),r.children.push(t[e]),t.splice(e,1)}}s.reverse();for(let r=s.length-1;r>=0;r--){const o=s[r];let e=!1;for(let m=r-1;m>=0;m--){const a=s[m];if(!o.path.startsWith(a.path))continue;a.children==null&&(a.children=[]);let d=new Date(o.publishTime).getTime(),p=new Date(a.publishTime).getTime();d>p&&(a.description=o.description,a.publishTime=o.publishTime),o.path=o.path.split("/").pop(),a.children.push(o),e=!0;break}e&&s.splice(r,1)}return s.push.apply(s,t),B(s),s}}},Y={class:"node-label"},G={class:"filename"},H={class:"text-info-1 text-mini description"},$={class:"text-info-1 text-mini publish-time"};function J(s,t,r,o,e,m){const a=l("Document"),d=l("el-icon"),p=l("Folder"),g=l("el-tree");return c(),V(g,{class:"service-structure-tree",data:m.data},{default:S(({node:j,data:v})=>[i("span",Y,[v.type==="FILE"?(c(),V(d,{key:0},{default:S(()=>[u(a)]),_:1})):v.type==="DIRECTORY"?(c(),V(d,{key:1},{default:S(()=>[u(p)]),_:1})):f("",!0),i("span",G,n(v.path),1),i("span",H,n(v.description),1),i("span",$,n(s.getDateOffsetText(v.publishTime)),1)])]),_:1},8,["data"])}const K=D(W,[["render",J],["__scopeId","data-v-20da06ab"]]);const Q={name:"VerticalServiceList",components:{ServiceTitle:I,BeanAmount:C},props:{space:{require:!0},services:{type:Array,required:!0}}},X={class:"service-list"},Z={class:"price-wrap"},ee={class:"text-info-1 text-mini"};function se(s,t,r,o,e,m){const a=l("ServiceTitle"),d=l("BeanAmount");return c(),h("ul",X,[(c(!0),h(P,null,N(r.services,p=>(c(),h("li",{key:p.name},[u(a,{space:r.space,service:p.name,"with-paths":!1},null,8,["space","service"]),i("p",null,n(p.introduce),1),i("div",Z,[i("p",ee,n(s.getDateOffsetText(p.lastPublish)),1),u(d,{price:p.price.price,type:p.price.leaseType},null,8,["price","type"])])]))),128))])}const te=D(Q,[["render",se],["__scopeId","data-v-15862673"]]);const ie={components:{ServiceStatus:U,ServiceTitle:I,VerticalServiceList:te,BeanAmount:C,MarkdownEditor:F,PluginList:q,ServiceStructureView:K},data(){return{loading:!0,route:{space:null,service:null},currentTab:"readme",currentMajorVersion:"",currentVersion:"",majorVersions:[],space:null,service:null,majorVersionDetail:null,relationServices:[]}},methods:{initData(){this.loading=!0,this.fetchSpace(),this.fetchServices(),this.fetchDetail()},changeMajorVersion(s){this.currentMajorVersion!==s&&(this.currentMajorVersion=s,this.fetchDetail(s))},fetchSpace(){z(this.route.space).then(s=>{this.space=s,console.log("this.space",this.space)}).catch(s=>{this.$tip.apiFailed(s)})},fetchServices(){O({space:this.route.space,withSpaceInfo:!1,withPublisher:!1}).then(s=>{this.relationServices=s.filter(t=>this.route.service!==t.name)}).catch(s=>{this.$tip.apiFailed(s)})},fetchDetail(s){R({...this.route,majorVersion:s}).then(t=>{if(t==null){this.alert("该服务还未发布或已被删除").then(()=>{this.$router.push({name:"PublicServices"})});return}this.service=t,this.majorVersions=t.majorVersions,this.currentMajorVersion=s||this.majorVersions[0],this.majorVersionDetail=t.defaultMajorVersion,this.currentVersion=this.majorVersionDetail.version,this.majorVersionDetail.description==null&&this.majorVersionDetail.description.trim()===""&&(this.majorVersionDetail.description="No Descriptions")}).catch(t=>{if(t.code===5110){this.alert(t.message).then(()=>{this.$router.push({name:"PublicServices"})});return}this.$tip.apiFailed(t)}).finally(()=>{this.loading=!1})}},beforeRouteUpdate(s,t,r){this.route.space=s.params.spaceName,this.route.service=s.params.serviceName,this.initData(),r()},created(){this.route.space=this.$route.params.spaceName,this.route.service=this.$route.params.serviceName,this.initData()}},re=s=>(A("data-v-8787b063"),s=s(),E(),s),ne={class:"page"},oe={key:0,class:"wrap"},ce={class:"header"},le={class:"tech-stack-wrap"},ae={key:0,class:"major-versions"},ue=["onClick"],pe={class:"content-wrap"},he={class:"dimension-wrap"},me={class:"dimensions"},_e={key:0,class:"detail"},de={class:"info"},ve={class:"user-profile"},fe={class:"user-info"},Se=["src"],be={class:"introduce"},ge={class:"install"},Ve=re(()=>i("i",{class:"iconfont icon-code"},null,-1)),ye={class:"info-list"},Te={key:0},De={key:1},je={key:0,class:"relation-services-wrap"};function we(s,t,r,o,e,m){const a=l("ServiceTitle"),d=l("ServiceStatus"),p=l("BeanAmount"),g=l("MarkdownEditor"),j=l("PluginList"),v=l("ServiceStructureView"),w=l("el-button"),L=l("VerticalServiceList"),M=x("loading");return b((c(),h("div",ne,[e.space!=null&&e.service!=null?(c(),h("div",oe,[i("div",ce,[u(a,{space:e.space.name,service:e.service.name,"service-label":e.service.label},null,8,["space","service","service-label"]),i("div",le,[u(d,{"with-private":e.service.withPrivate},null,8,["with-private"]),i("p",null,n(e.majorVersionDetail.subServices.length)+" "+n(s.$t("service.plugins")),1),u(p,{price:e.service.price.price,type:e.service.price.leaseType},null,8,["price","type"])]),e.majorVersions.length>1?(c(),h("ul",ae,[(c(!0),h(P,null,N(e.majorVersions,_=>(c(),h("li",{key:_,class:y({selected:_===e.currentMajorVersion}),onClick:ke=>m.changeMajorVersion(_)},"v"+n(_),11,ue))),128))])):f("",!0)]),i("div",pe,[i("div",he,[i("ul",me,[i("li",{class:y({selected:e.currentTab==="readme"}),onClick:t[0]||(t[0]=_=>e.currentTab="readme")},n(s.$t("common.readme")),3),i("li",{class:y({selected:e.currentTab==="extends"}),onClick:t[1]||(t[1]=_=>e.currentTab="extends")},n(s.$t("service.subServices")),3)]),e.majorVersionDetail!=null?(c(),h("div",_e,[b(u(g,{modelValue:e.majorVersionDetail.description,"onUpdate:modelValue":t[2]||(t[2]=_=>e.majorVersionDetail.description=_),readonly:!0,"without-padding":!0},null,8,["modelValue"]),[[T,e.currentTab==="readme"]]),b(u(j,{plugins:e.majorVersionDetail.subServices},null,8,["plugins"]),[[T,e.currentTab==="extends"]]),b(u(v,{nodes:e.majorVersionDetail.structure},null,8,["nodes"]),[[T,e.currentTab==="structure"]])])):f("",!0)]),i("div",de,[i("div",ve,[i("div",fe,[i("img",{src:s.getAccessUri(e.service.user.avatar,"/images/avatar/default.png")},null,8,Se),i("h4",null,n(e.service.user.username),1)]),i("p",be,n(e.service.user.introduce===""||e.service.user.introduce==null?"No introduce":e.service.user.introduce),1)]),i("div",ge,[u(w,{type:"important",size:"large",onClick:t[3]||(t[3]=_=>s.$router.push({name:"ServiceInstaller",params:{spaceName:e.space.name,serviceName:e.service.name},query:{major:e.currentMajorVersion}}))},{default:S(()=>[Ve,k(n(s.$t("service.install")),1)]),_:1}),u(w,{size:"large",onClick:t[4]||(t[4]=_=>s.$router.push({name:"CreatePlugin",query:{space:e.space.name,service:e.service.name}}))},{default:S(()=>[k(n(s.$t("plugin.create2")),1)]),_:1})]),i("ul",ye,[i("li",null,[i("label",null,n(s.$t("service.subServices")),1),i("p",null,n(e.majorVersionDetail.subServices.length),1)]),i("li",null,[i("label",null,n(s.$t("service.lastPublish")),1),e.service.lastPublish!=null?(c(),h("p",Te,n(s.getDateOffsetText(e.service.lastPublish)),1)):(c(),h("p",De,"None"))])]),e.relationServices.length>0?(c(),h("div",je,[i("h4",null,n(s.$t("service.relationList")),1),u(L,{services:e.relationServices},null,8,["services"])])):f("",!0)])])])):f("",!0)])),[[M,e.loading]])}const Fe=D(ie,[["render",we],["__scopeId","data-v-8787b063"]]);export{Fe as default};
