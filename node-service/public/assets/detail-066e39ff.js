import{P as L,S as A}from"./PluginList-3c13b307.js";import{_ as k,r as l,o as n,c as o,F as D,f as j,b as a,a as i,t,M as F,m as q,z,A as h,i as p,H as m,I as f,g as y,w as b,e as g,p as E,k as U}from"./index-ea6b6181.js";import{B as w}from"./BeanAmount-e1365bbf.js";import{f as O,a as H}from"./service-13aca3c0.js";import{a as R}from"./service.space-0bf0a46b.js";import{S as T}from"./ServiceTitle-1a8672e5.js";import{S as G}from"./ServiceStatus-9277696c.js";import"./service.version-aeeb6e53.js";const J={name:"VerticalServiceList",components:{ServiceTitle:T,BeanAmount:w},props:{space:{require:!0},services:{type:Array,required:!0}}},K={class:"service-list"},Q={class:"price-wrap"},W={class:"text-info-1 text-mini"};function X(s,r,v,N,e,S){const _=l("ServiceTitle"),d=l("BeanAmount");return n(),o("ul",K,[(n(!0),o(D,null,j(v.services,u=>(n(),o("li",{key:u.name},[a(_,{space:v.space,service:u.name,"with-paths":!1},null,8,["space","service"]),i("p",null,t(u.introduce),1),i("div",Q,[i("p",W,t(s.getDateOffsetText(u.lastPublish)),1),a(d,{price:u.price.price,type:u.price.leaseType},null,8,["price","type"])])]))),128))])}const Y=k(J,[["render",X],["__scopeId","data-v-15862673"]]);const Z={components:{ServiceStatus:G,ServiceTitle:T,VerticalServiceList:Y,BeanAmount:w,MarkdownEditor:F,PluginList:L,ServiceStructureView:A},data(){return{loading:!0,route:{space:null,service:null},currentTab:"readme",currentMajorVersion:"",currentVersion:null,majorVersions:[],space:null,service:null,majorVersionDetail:null,relationServices:[]}},computed:{...q(["userInfo"])},methods:{initData(){this.loading=!0,this.space=null,this.service=null,this.currentVersion=null,this.fetchSpace(),this.fetchServices(),this.fetchDetail()},changeMajorVersion(s){this.currentMajorVersion!==s&&(this.currentMajorVersion=s,this.fetchDetail(s))},fetchSpace(){R(this.route.space).then(s=>{this.space=s}).catch(s=>{this.$tip.apiFailed(s)})},fetchServices(){O({space:this.route.space,withSpaceInfo:!1,withPublisher:!1}).then(s=>{this.relationServices=s.filter(r=>this.route.service!==r.name)}).catch(s=>{this.$tip.apiFailed(s)})},fetchDetail(s){H({...this.route,majorVersion:s}).then(r=>{if(r==null){this.alert("该服务还未发布或已被删除").then(()=>{this.$router.push({name:"PublicServices"})});return}this.service=r,this.majorVersions=r.majorVersions,this.currentMajorVersion=s||this.majorVersions[0],this.majorVersionDetail=r.defaultMajorVersion,this.currentVersion=this.majorVersionDetail.version,this.majorVersionDetail.description==null&&this.majorVersionDetail.description.trim()===""&&(this.majorVersionDetail.description="No Descriptions")}).catch(r=>{if(r.code===5110||r.code===4002){this.alert(r.message).then(()=>{this.$router.push({name:"PublicServices"})});return}this.$tip.apiFailed(r)}).finally(()=>{this.loading=!1})}},beforeRouteUpdate(s,r,v){this.route.space=s.params.spaceName,this.route.service=s.params.serviceName,this.initData(),v()},created(){this.route.space=this.$route.params.spaceName,this.route.service=this.$route.params.serviceName,this.initData()}},x=s=>(E("data-v-b2126741"),s=s(),U(),s),$={class:"page"},ee={key:0,class:"wrap"},se={class:"header"},ie={class:"tech-stack-wrap"},re={key:0,class:"major-versions"},te=["onClick"],ne={class:"content-wrap"},oe={class:"dimension-wrap"},ce={class:"dimensions"},le={key:0,class:"detail"},ae={class:"info"},ue={class:"user-profile"},pe={class:"user-info"},ve=["src"],he={class:"introduce"},me={class:"install"},_e=x(()=>i("i",{class:"iconfont icon-code"},null,-1)),de={class:"info-list"},fe=["href"],Se={key:1},Ve={key:0},ye={key:1},be={key:0,class:"relation-services-wrap"};function ge(s,r,v,N,e,S){const _=l("ServiceTitle"),d=l("ServiceStatus"),u=l("BeanAmount"),P=l("MarkdownEditor"),M=l("PluginList"),C=l("ServiceStructureView"),V=l("el-button"),B=l("VerticalServiceList"),I=z("loading");return h((n(),o("div",$,[e.space!=null&&e.service!=null?(n(),o("div",ee,[i("div",se,[a(_,{space:e.space.name,service:e.service.name,"service-label":e.service.label},null,8,["space","service","service-label"]),i("div",ie,[a(d,{"with-private":e.service.withPrivate},null,8,["with-private"]),i("p",null,t(e.majorVersionDetail.subServices.length)+" "+t(s.$t("service.plugins")),1),a(u,{price:e.service.price.price,type:e.service.price.leaseType},null,8,["price","type"])]),e.majorVersions.length>1?(n(),o("ul",re,[(n(!0),o(D,null,j(e.majorVersions,c=>(n(),o("li",{key:c,class:m({selected:c===e.currentMajorVersion}),onClick:ke=>S.changeMajorVersion(c)},"v"+t(c),11,te))),128))])):p("",!0)]),i("div",ne,[i("div",oe,[i("ul",ce,[i("li",{class:m({selected:e.currentTab==="readme"}),onClick:r[0]||(r[0]=c=>e.currentTab="readme")},t(s.$t("common.readme")),3),i("li",{class:m({selected:e.currentTab==="extends"}),onClick:r[1]||(r[1]=c=>e.currentTab="extends")},t(s.$t("service.subServices")),3),i("li",{class:m({selected:e.currentTab==="structure"}),onClick:r[2]||(r[2]=c=>e.currentTab="structure")},t(s.$t("service.structure")),3)]),e.majorVersionDetail!=null?(n(),o("div",le,[h(a(P,{modelValue:e.majorVersionDetail.description,"onUpdate:modelValue":r[3]||(r[3]=c=>e.majorVersionDetail.description=c),readonly:!0,"without-padding":!0},null,8,["modelValue"]),[[f,e.currentTab==="readme"]]),h(a(M,{plugins:e.majorVersionDetail.subServices},null,8,["plugins"]),[[f,e.currentTab==="extends"]]),e.currentVersion!=null?h((n(),y(C,{key:0,space:e.route.space,service:e.route.service,version:e.currentVersion},null,8,["space","service","version"])),[[f,e.currentTab==="structure"]]):p("",!0)])):p("",!0)]),i("div",ae,[i("div",ue,[i("div",pe,[i("img",{src:s.getAvatarUri(e.service.user.avatar)},null,8,ve),i("h4",null,t(s.getUserDisplayName(e.service.user)),1)]),i("p",he,t(e.service.user.introduce===""||e.service.user.introduce==null?"No introduce":e.service.user.introduce),1)]),i("div",me,[a(V,{type:"important",size:"large",onClick:r[4]||(r[4]=c=>s.$router.push({name:"ServiceInstaller",params:{spaceName:e.space.name,serviceName:e.service.name},query:{major:e.currentMajorVersion}}))},{default:b(()=>[_e,g(t(s.$t("service.install")),1)]),_:1}),s.userInfo!=null&&s.userInfo.isDeveloper?(n(),y(V,{key:0,size:"large",onClick:r[5]||(r[5]=c=>s.$router.push({name:"CreatePlugin",query:{space:e.space.name,service:e.service.name}}))},{default:b(()=>[g(t(s.$t("plugin.create2")),1)]),_:1})):p("",!0)]),i("ul",de,[i("li",null,[i("label",null,t(s.$t("service.subServices")),1),i("p",null,t(e.majorVersionDetail.subServices.length),1)]),i("li",null,[i("label",null,t(s.$t("service.repository")),1),e.service.repository!=null&&e.service.repository!==""?(n(),o("a",{key:0,href:e.service.repository,target:"_blank"},t(e.service.repository),9,fe)):(n(),o("p",Se,t(s.$t("common.none")),1))]),i("li",null,[i("label",null,t(s.$t("service.lastPublish")),1),e.service.lastPublish!=null?(n(),o("p",Ve,t(s.getDateOffsetText(e.service.lastPublish)),1)):(n(),o("p",ye,"None"))])]),e.relationServices.length>0?(n(),o("div",be,[i("h4",null,t(s.$t("service.relationList")),1),a(B,{services:e.relationServices},null,8,["services"])])):p("",!0)])])])):p("",!0)])),[[I,e.loading]])}const Be=k(Z,[["render",ge],["__scopeId","data-v-b2126741"]]);export{Be as default};
