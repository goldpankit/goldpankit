import{_ as D,r as l,o as c,c as v,F as T,f as C,a as r,t,g as h,G as F,w as V,b as _,j as y,m as L,H as S,A as w,I as M,e as I}from"./index-39109f26.js";import{E as j}from"./Empty-863b76aa.js";import{f as B,s as q}from"./service-3a807430.js";import{M as N}from"./MarkdownEditor-4d84be01.js";import{S as R,I as A,a as $}from"./IssueListView-e45c7f50.js";import{f as z}from"./service.space-9a41d824.js";import{S as O}from"./ServiceList-1bf99ca1.js";import"./BeanAmount-edbcbac0.js";import"./service.version-4325a046.js";import"./Pagination-1f5deb3c.js";const U={name:"ServiceListView",components:{Empty:j},props:{services:{required:!0},emptyDescription:{default:"No Services"}}},W={key:0,class:"service-list"},Y={class:"service-info"},G={class:"text-mini text-info-1"};function H(s,i,n,o,e,d){const u=l("Empty");return n.services.length>0?(c(),v("ul",W,[(c(!0),v(T,null,C(n.services,p=>(c(),v("li",{key:p.name},[r("div",Y,[r("h3",null,t(p.name),1),r("p",null,t(p.introduce),1),r("p",G,"Last publish: "+t(p.lastPublishTime),1)])]))),128))])):(c(),h(u,{key:1,description:n.emptyDescription},null,8,["description"]))}const E=D(U,[["render",H],["__scopeId","data-v-fdbc436c"]]);const J={name:"ServiceStructureView",props:{nodes:{required:!0}},data(){return{}},computed:{data(){const s=this.nodes.filter(n=>n.type==="DIRECTORY").sort((n,o)=>o.path.split("/").length-n.path.split("/").length),i=this.nodes.filter(n=>n.type==="FILE");for(const n of s){let o=null;for(let e=i.length-1;e>=0;e--){if(!i[e].path.startsWith(n.path))continue;n.children==null&&(n.children=[]);let d=new Date(i[e].publishTime).getTime();(o==null||d>o)&&(n.description=i[e].description,o=d),n.publishTime=i[e].publishTime,i[e].path=i[e].path.split("/").pop(),n.children.push(i[e]),i.splice(e,1)}}s.reverse();for(let n=s.length-1;n>=0;n--){const o=s[n];let e=!1;for(let d=n-1;d>=0;d--){const u=s[d];if(!o.path.startsWith(u.path))continue;u.children==null&&(u.children=[]);let p=new Date(o.publishTime).getTime(),b=new Date(u.publishTime).getTime();p>b&&(u.description=o.description,u.publishTime=o.publishTime),o.path=o.path.split("/").pop(),u.children.push(o),e=!0;break}e&&s.splice(n,1)}return s.push.apply(s,i),F(s),s}}},K={class:"node-label"},Q={class:"filename"},X={class:"text-info-1 text-mini description"},Z={class:"text-info-1 text-mini publish-time"};function x(s,i,n,o,e,d){const u=l("Document"),p=l("el-icon"),b=l("Folder"),k=l("el-tree");return c(),h(k,{class:"service-structure-tree",data:d.data},{default:V(({node:a,data:f})=>[r("span",K,[f.type==="FILE"?(c(),h(p,{key:0},{default:V(()=>[_(u)]),_:1})):f.type==="DIRECTORY"?(c(),h(p,{key:1},{default:V(()=>[_(b)]),_:1})):y("",!0),r("span",Q,t(f.path),1),r("span",X,t(f.description),1),r("span",Z,t(s.getDateOffsetText(f.publishTime,s.$t)),1)])]),_:1},8,["data"])}const ee=D(J,[["render",x],["__scopeId","data-v-fab5c620"]]);const se={name:"MainServiceDetail",components:{SubServiceList:R,MarkdownEditor:N,ServiceStructureView:ee,ServiceListView:E},props:{space:{required:!0},service:{required:!0}},data(){return{currentMajorVersion:"",currentVersion:"",currentDim:"readme",majorVersions:[],majorVersionDetail:null}},computed:{...L(["currentProject"])},methods:{fetchDetail(){B({space:this.space,service:this.service}).then(s=>{this.majorVersions=s.majorVersions,this.currentMajorVersion=this.majorVersions[0],this.majorVersionDetail=s.defaultMajorVersion,this.currentVersion=this.majorVersionDetail.version}).catch(s=>{this.$tip.apiFailed(s)})}},created(){this.fetchDetail()}},ie={key:0,class:"service-detail"},re={class:"nav"},te={class:"title"},ne=["onClick"],ce={class:"install"},oe={class:"content-wrap"},le={class:"service-dimensions"};function ue(s,i,n,o,e,d){const u=l("el-button"),p=l("MarkdownEditor"),b=l("SubServiceList"),k=l("ServiceStructureView");return e.majorVersionDetail!=null?(c(),v("div",ie,[r("div",re,[r("div",te,[_(u,{class:"button-icon",icon:"ArrowLeftBold",onClick:i[0]||(i[0]=a=>s.$emit("back"))}),r("h4",null,t(n.service),1)]),r("ul",null,[(c(!0),v(T,null,C(e.majorVersions,a=>(c(),v("li",{key:a,class:S({selected:a===e.currentMajorVersion}),onClick:f=>e.currentMajorVersion=a},"v"+t(a),11,ne))),128))])]),r("div",ce,[_(u,{type:"important",onClick:i[1]||(i[1]=a=>s.$emit("install",e.currentVersion))},{default:V(()=>[r("h5",null,t(s.$t("service.install")),1)]),_:1})]),r("div",oe,[r("ul",le,[r("li",{class:S({selected:e.currentDim==="readme"}),onClick:i[2]||(i[2]=a=>e.currentDim="readme")},t(s.$t("common.readme")),3),r("li",{class:S({selected:e.currentDim==="subServices"}),onClick:i[3]||(i[3]=a=>e.currentDim="subServices")},t(s.$t("service.subServices")),3),r("li",{class:S({selected:e.currentDim==="structure"}),onClick:i[4]||(i[4]=a=>e.currentDim="structure")},t(s.$t("service.structure")),3)]),w(_(p,{modelValue:e.majorVersionDetail.description,"onUpdate:modelValue":i[5]||(i[5]=a=>e.majorVersionDetail.description=a),readonly:!0},null,8,["modelValue"]),[[M,e.currentDim==="readme"]]),w(_(b,{services:e.majorVersionDetail.subServices},null,8,["services"]),[[M,e.currentDim==="subServices"]]),w(_(k,{nodes:e.majorVersionDetail.structure},null,8,["nodes"]),[[M,e.currentDim==="structure"]])])])):y("",!0)}const ae=D(se,[["render",ue],["__scopeId","data-v-4bc20247"]]);const pe={components:{ServiceList:O,IssueListView:A,ServiceListView:E,Empty:j,MarkdownEditor:N,ServiceInstaller:$,MainServiceDetail:ae},data(){return{spaceName:null,currentTab:"readme",currentMainService:null,currentMainServiceVersion:null,space:null,mainServices:[]}},computed:{...L(["userInfo"])},methods:{fetchSpace(){z(this.spaceName).then(s=>{this.space=s,this.space.description==null&&(this.space.description=""),this.fetchServiceList()}).catch(s=>{this.$tip.apiFailed(s)})},fetchServiceList(){q({space:this.spaceName,serviceType:"MAIN"}).then(s=>{this.mainServices=s;const i=this.$route.query.service;i!=null&&i!==""&&(this.currentMainService=this.mainServices.find(n=>n.name===i),this.currentMainService!=null&&(this.currentTab="services"))}).catch(s=>{this.$tip.apiFailed(s)})},handleServiceInstall(s){this.currentMainServiceVersion=s}},created(){this.spaceName=this.$route.params.name,this.fetchSpace()}},me={key:0,class:"page"},ve={class:"wrap"},de={class:"tech-stack-wrap"},he={class:"tech-stack"},_e={class:"content-wrap"},fe={class:"dimension-wrap"},Se={class:"dimensions"},be={class:"detail"},ye={key:0,class:"readme"},Ve={class:"info"},ke={class:"user-profile"},De={class:"user-info"},we=["src"],Me={class:"introduce"},Te={class:"install"},ge={key:0,href:"#"},Ie={key:1},Ce={key:0},Le={key:1};function je(s,i,n,o,e,d){const u=l("MarkdownEditor"),p=l("ServiceList"),b=l("Empty"),k=l("MainServiceDetail"),a=l("ServiceInstaller"),f=l("ServiceListView"),P=l("IssueListView"),g=l("el-button");return e.space!=null?(c(),v("div",me,[r("div",ve,[r("h2",null,t(e.space.name),1),r("div",de,[r("em",null,t(e.space.withPrivate?s.$t("common.private"):s.$t("common.public")),1),r("p",he,t(e.space.serviceCount)+" "+t(s.$t("service.services")),1)]),r("div",_e,[r("div",fe,[r("ul",Se,[r("li",{class:S({selected:e.currentTab==="readme"}),onClick:i[0]||(i[0]=m=>e.currentTab="readme")},t(s.$t("common.readme")),3),r("li",{class:S({selected:e.currentTab==="services"}),onClick:i[1]||(i[1]=m=>e.currentTab="services")},t(s.$t("service.services2")),3),r("li",{class:S({selected:e.currentTab==="prices"}),onClick:i[2]||(i[2]=m=>e.currentTab="prices")},t(s.$t("common.prices")),3),r("li",{class:S({selected:e.currentTab==="issues"}),onClick:i[3]||(i[3]=m=>e.currentTab="issues")},t(s.$t("common.issues")),3)]),r("div",be,[e.currentTab==="readme"?(c(),v("div",ye,[_(u,{readonly:"","without-padding":!0,modelValue:e.space.description,"onUpdate:modelValue":i[4]||(i[4]=m=>e.space.description=m)},null,8,["modelValue"])])):e.currentTab==="services"?(c(),v(T,{key:1},[e.currentMainService==null&&e.mainServices.length>0?(c(),h(p,{key:0,services:e.mainServices,onClick:i[5]||(i[5]=m=>e.currentMainService=m)},null,8,["services"])):e.currentMainService==null&&e.mainServices.length===0?(c(),h(b,{key:1,description:s.$t("service.noServices")},null,8,["description"])):y("",!0),e.currentMainService!=null&&e.currentMainServiceVersion==null?(c(),h(k,{key:2,space:e.space.name,service:e.currentMainService.name,onInstall:d.handleServiceInstall,onBack:i[6]||(i[6]=m=>e.currentMainService=null)},null,8,["space","service","onInstall"])):e.currentMainServiceVersion!=null?(c(),h(a,{key:3,space:e.space.name,service:e.currentMainService.name,"service-type":e.currentMainService.type,"service-price":e.currentMainService.price,"service-lease":e.currentMainService.latestLease,version:e.currentMainServiceVersion,"with-breadcrumbs":!0,"with-install-button":!0,onBack:i[7]||(i[7]=m=>e.currentMainServiceVersion=null),onInstalled:i[8]||(i[8]=m=>s.$router.push({name:"Workbench"})),onError:i[9]||(i[9]=m=>s.$tip.apiFailed(m))},null,8,["space","service","service-type","service-price","service-lease","version"])):y("",!0)],64)):e.currentTab==="prices"?(c(),h(f,{key:2,services:[],"empty-description":"No Price Services"})):e.currentTab==="issues"?(c(),h(P,{key:3})):y("",!0)])]),r("div",Ve,[r("div",ke,[r("div",De,[r("img",{src:s.getAccessUri(e.space.user.avatar,"/images/avatar/default.png")},null,8,we),r("h4",null,t(e.space.user.username),1)]),r("p",Me,t(e.space.user.introduce===""||e.space.user.introduce==null?"No introduce":e.space.user.introduce),1)]),r("div",Te,[e.space.subServiceReceivable||s.userInfo!=null&&s.userInfo.id===e.space.userId?(c(),h(g,{key:0,type:"primary",size:"large",onClick:i[10]||(i[10]=m=>s.$router.push({name:"CreateService",query:{space:e.spaceName}}))},{default:V(()=>[I(t(s.$t("service.createNewService")),1)]),_:1})):y("",!0),_(g,{type:"primary",size:"large"},{default:V(()=>[I(t(s.$t("issue.createNewIssue")),1)]),_:1})]),r("ul",null,[r("li",null,[r("label",null,t(s.$t("space.homePage")),1),e.space.homePage!=null&&e.space.homePage!==""?(c(),v("a",ge,t(e.space.homePage),1)):(c(),v("p",Ie,t(s.$t("common.none")),1))]),r("li",null,[r("label",null,t(s.$t("service.services2")),1),r("p",null,t(e.space.serviceCount),1)]),r("li",null,[r("label",null,t(s.$t("service.lastPublish")),1),e.space.lastPublish!=null?(c(),v("p",Ce,t(e.space.lastPublish),1)):(c(),v("p",Le,"None"))])])])])])])):y("",!0)}const Oe=D(pe,[["render",je],["__scopeId","data-v-1a6ce5ba"]]);export{Oe as default};
