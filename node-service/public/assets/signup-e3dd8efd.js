import{y as _,_ as O,r as p,o as l,c as d,a,t as n,b as o,w as r,i as y,F as c,e as m,j as b}from"./index-39109f26.js";import{c as v}from"./form.check-e9db3bf5.js";function V(e){return _.post("/usr/regis/email",e,{baseURL:"/remote-api"})}function w(e){return _.post("/usr/regis/email/otp-code",e,{baseURL:"/remote-api"})}const E={data(){return{form:{username:"",password:"",otpElement:"",otpCodeId:null,otpCode:""},rules:{username:[{required:!0,message:"Please input Username"}],password:[{required:!0,message:"Please input password"}],otpElement:[{required:!0,message:"Please input email"},{validator:(e,s,g)=>v(e,s,g,"Please enter the correct email address")}],otpCode:[{required:!0,message:"Please input OTP code"},{required:!0,message:"Please input OTP code"}]},sendOtpCodeData:{isWorking:!1,timeout:0,sended:!1},regisData:{isWorking:!1}}},methods:{regis(){this.$refs.form.validate().then(()=>{this.regisData.isWorking||(this.regisData.isWorking=!0,V(this.form).then(()=>{this.$message.success("Register successful."),this.$router.push({name:"SignIn"})}).catch(e=>{this.$tip.apiFailed(e)}).finally(()=>{this.regisData.isWorking=!1}))}).catch(()=>{})},sendOtpCode(){this.$refs.form.validateField("otpElement").then(()=>{this.sendOtpCodeData.isWorking||(this.sendOtpCodeData.isWorking=!0,w({email:this.form.otpElement,username:this.form.username}).then(e=>{this.form.otpCodeId=e,this.sendOtpCodeData.timeout=60,this.sendOtpCodeData.sended=!0;const s=setInterval(()=>{this.sendOtpCodeData.timeout--,this.sendOtpCodeData.timeout===0&&clearInterval(s)},1e3)}).catch(e=>{this.$tip.apiFailed(e)}).finally(()=>{this.sendOtpCodeData.isWorking=!1}))}).catch(()=>{})}}},W={class:"signup"},q={class:"wrap"},I={key:0},P={class:"login-box"},U={class:"have-an-account"};function z(e,s,g,B,t,C){const u=p("el-input"),f=p("el-form-item"),h=p("el-button"),k=p("el-form"),D=p("router-link");return l(),d("div",W,[a("div",q,[a("h2",null,n(e.$t("common.signUp")),1),o(k,{ref:"form",model:t.form,rules:t.rules,onSubmit:s[4]||(s[4]=y(()=>{},["stop"]))},{default:r(()=>[o(f,{label:e.$t("user.username"),prop:"username",required:""},{default:r(()=>[o(u,{modelValue:t.form.username,"onUpdate:modelValue":s[0]||(s[0]=i=>t.form.username=i),type:"text",size:"large"},null,8,["modelValue"])]),_:1},8,["label"]),o(f,{label:e.$t("user.password"),prop:"password",required:""},{default:r(()=>[o(u,{modelValue:t.form.password,"onUpdate:modelValue":s[1]||(s[1]=i=>t.form.password=i),type:"password",size:"large"},null,8,["modelValue"])]),_:1},8,["label"]),o(f,{label:e.$t("user.email"),prop:"otpElement",required:""},{default:r(()=>[o(u,{modelValue:t.form.otpElement,"onUpdate:modelValue":s[2]||(s[2]=i=>t.form.otpElement=i),type:"text",size:"large"},null,8,["modelValue"])]),_:1},8,["label"]),o(f,{label:e.$t("user.otpCode"),prop:"otpCode",required:"",class:"otp-code"},{default:r(()=>[a("div",null,[o(u,{type:"text",modelValue:t.form.otpCode,"onUpdate:modelValue":s[3]||(s[3]=i=>t.form.otpCode=i),size:"large"},null,8,["modelValue"]),o(h,{size:"large",type:"primary",disabled:t.sendOtpCodeData.isWorking||t.sendOtpCodeData.timeout!==0,onClick:C.sendOtpCode},{default:r(()=>[t.sendOtpCodeData.isWorking?(l(),d(c,{key:0},[m(n(e.$t("common.otp.sending")),1)],64)):t.sendOtpCodeData.timeout===0&&!t.sendOtpCodeData.sended?(l(),d(c,{key:1},[m(n(e.$t("common.otp.send")),1)],64)):t.sendOtpCodeData.timeout===0&&t.sendOtpCodeData.sended?(l(),d(c,{key:2},[m(n(e.$t("common.otp.resend")),1)],64)):(l(),d(c,{key:3},[m(n(t.sendOtpCodeData.timeout)+"s",1)],64))]),_:1},8,["disabled","onClick"])]),t.sendOtpCodeData.sended?(l(),d("p",I,n(e.$t("common.otp.sendTip",{email:t.form.otpElement})),1)):b("",!0)]),_:1},8,["label"])]),_:1},8,["model","rules"]),a("div",P,[a("div",null,[o(h,{type:"important",onClick:C.regis,disabled:t.regisData.isWorking},{default:r(()=>[m(n(e.$t("user.createAccount")),1)]),_:1},8,["onClick","disabled"])])])]),a("div",U,[a("p",null,n(e.$t("user.haveAnAccount")),1),o(D,{to:{name:"SignIn"}},{default:r(()=>[m(n(e.$t("common.signIn")),1)]),_:1})])])}const R=O(E,[["render",z],["__scopeId","data-v-df48cf4f"]]);export{R as default};
