import{C as P}from"./CompilerSelect-4ac34fba.js";import{_ as T,r,o as d,j as I,w as i,b as l,c as h,a,e as C,g as V,p as F,d as z,I as E,F as B,f as A,n as S,t as x,m as L,y as J,i as U,v as O}from"./index-2937f55a.js";import{f as H,a as M,b as Y,d as G,i as K,g as Q,p as W}from"./service-022673d3.js";import{D as X}from"./DirectorySelect-4f4f7343.js";import{V as Z,c as $}from"./VariableInput-95b4e3fe.js";const ee={name:"InputTypeSelect"};function le(e,n,v,k,t,o){const c=r("el-option"),m=r("el-select");return d(),I(m,{class:"input-type-select"},{default:i(()=>[l(c,{value:"input",label:"Input"}),l(c,{value:"textarea",label:"Textarea"}),l(c,{value:"checkbox",label:"Checkbox"}),l(c,{value:"radio",label:"Radio"})]),_:1})}const R=T(ee,[["render",le],["__scopeId","data-v-613a034a"]]);const te={name:"SettingFiles",components:{CompilerSelect:P,InputTypeSelect:R},props:{serviceId:{required:!0}},data(){return{currentNode:null,files:[]}},methods:{fetchFiles(){H(this.serviceId).then(e=>{this.files=e}).catch(e=>{console.log("e",e)})},saveFileSetting(){this.saveTimeout!=null&&clearTimeout(this.saveTimeout),this.saveTimeout=setTimeout(()=>{M({serviceId:this.serviceId,...this.currentNode,variables:this.currentNode.variables.filter(e=>e.name.trim().length>0)}).then(()=>{console.log("保存成功")}).catch(e=>{console.log("e",e)})},300)},createVariable(){this.currentNode.variables.push({name:"",value:"",compiler:"static",remark:""})},deleteVariable(e){this.currentNode.variables.splice(e,1)},handleNodeClick(e){console.log("node",e),this.currentNode=e}},created(){this.fetchFiles()}},j=e=>(F("data-v-d479bf1e"),e=e(),z(),e),ne={class:"tree"},ae={class:"files-wrap"},ie={class:"file-setting"},oe=j(()=>a("h4",null,"File Setting",-1)),se={class:"content-wrap"},re=j(()=>a("label",null,"Variables",-1)),ce={class:"opera"};function ue(e,n,v,k,t,o){const c=r("el-input"),m=r("el-tree"),_=r("CompilerSelect"),y=r("el-form-item"),f=r("el-button"),p=r("el-table-column"),w=r("el-table"),N=r("el-form");return d(),h("div",ne,[a("div",ae,[l(c,{placeholder:"Filter keyword"}),l(m,{data:t.files,onNodeClick:o.handleNodeClick},null,8,["data","onNodeClick"])]),a("div",ie,[oe,a("div",se,[t.currentNode!=null?(d(),I(N,{key:0},{default:i(()=>[l(y,{label:"Compiler"},{default:i(()=>[l(_,{modelValue:t.currentNode.compiler,"onUpdate:modelValue":n[0]||(n[0]=u=>t.currentNode.compiler=u),"with-follow-service":!0,onChange:o.saveFileSetting},null,8,["modelValue","onChange"])]),_:1}),l(y,{label:"Enable Express"},{default:i(()=>[l(c,{modelValue:t.currentNode.enableExpress,"onUpdate:modelValue":n[1]||(n[1]=u=>t.currentNode.enableExpress=u),type:"textarea",rows:8,onInput:o.saveFileSetting},null,8,["modelValue","onInput"])]),_:1}),l(y,{label:"Variables",class:"item-variables"},{label:i(()=>[a("div",null,[re,a("div",ce,[l(f,{icon:"Top",class:"button-icon"}),l(f,{icon:"Bottom",class:"button-icon"}),l(f,{onClick:o.createVariable},{default:i(()=>[C("Add")]),_:1},8,["onClick"])])])]),default:i(()=>[l(w,{data:t.currentNode.variables},{default:i(()=>[l(p,{label:"*Name","min-width":"120px"},{default:i(({row:u})=>[l(c,{modelValue:u.name,"onUpdate:modelValue":b=>u.name=b,onInput:o.saveFileSetting},null,8,["modelValue","onUpdate:modelValue","onInput"])]),_:1}),l(p,{label:"*Value","min-width":"200px"},{default:i(({row:u})=>[l(c,{modelValue:u.value,"onUpdate:modelValue":b=>u.value=b,type:"textarea",rows:1,onChange:o.saveFileSetting},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),l(p,{label:"*Compiler","min-width":"120px"},{default:i(({row:u})=>[l(_,{modelValue:u.compiler,"onUpdate:modelValue":b=>u.compiler=b,onChange:o.saveFileSetting},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),l(p,{label:"Remark","min-width":"140px"},{default:i(({row:u})=>[l(c,{modelValue:u.remark,"onUpdate:modelValue":b=>u.remark=b,type:"textarea",rows:1,onInput:o.saveFileSetting},null,8,["modelValue","onUpdate:modelValue","onInput"])]),_:1}),t.currentNode.variables.length>0?(d(),I(p,{key:0,"min-width":"60px",fixed:"right"},{default:i(({row:u,index:b})=>[l(f,{icon:"Delete",class:"button-icon",onClick:D=>o.deleteVariable(b)},null,8,["onClick"])]),_:1})):V("",!0)]),_:1},8,["data"])]),_:1})]),_:1})):V("",!0)])])])}const de=T(te,[["render",ue],["__scopeId","data-v-d479bf1e"]]);const pe={name:"SettingVariables",components:{VariableInput:Z,I18nInput:E,InputTypeSelect:R,CompilerSelect:P},props:{serviceId:{required:!0}},data(){return{varIndex:1,currentVariable:null,variables:[]}},methods:{selectVariable(e){this.currentVariable=e},createVariable(){const e=this.__generateVariableName(),n={name:e,message:e,inputType:"input",required:!1,defaultValue:"",compiler:"static",remark:"",options:[]};this.variables.push(n),this.currentVariable=n,this.saveVariables()},createOption(){this.currentVariable.options.push({value:"",label:"",remark:""})},deleteOption(e){this.currentVariable.options.splice(e,1)},saveVariables(){const e=this.variables.filter(n=>n.name.trim().length>0&&n.message.trim().length>0);Y({serviceId:this.serviceId,variables:e.map(n=>{const v=JSON.parse(JSON.stringify(n));return v.inputType==="input"?delete v.options:v.options=v.options.filter(k=>k.value.trim().length>0&&k.label.trim().length>0),v})}).then(n=>{console.log("data",n)}).catch(n=>{console.log("e",n)})},fetchVariables(){G(this.serviceId).then(e=>{this.variables=e.variables.map(n=>({...n,options:n.options==null?[]:n.options})),console.log("初始化变量",this.variables)}).catch(e=>{console.log("e",e)})},__generateVariableName(){let e;for(;;)if(e=`var${this.varIndex}`,this.varIndex++,this.variables.findIndex(n=>n.name===e)===-1)return e},__getInputTypeLabel(e){return{input:"Input",radio:"Radio",checkbox:"Checkbox",textarea:"Textarea"}[e]}},created(){this.fetchVariables()}},q=e=>(F("data-v-c32396cf"),e=e(),z(),e),_e={class:"tree"},me={class:"variables-wrap"},be={class:"tools"},ve={class:"variables"},he=["onClick"],Ve={class:"title"},fe=q(()=>a("div",{class:"content"},"Hello",-1)),ge={class:"variable-setting"},ye=q(()=>a("h4",null,"Variable Setting",-1)),Ie={class:"content-wrap"},ke=q(()=>a("label",null,"Options",-1)),Ce={class:"opera"};function Se(e,n,v,k,t,o){const c=r("el-button"),m=r("el-input"),_=r("el-form-item"),y=r("I18nInput"),f=r("InputTypeSelect"),p=r("el-table-column"),w=r("el-table"),N=r("VariableInput"),u=r("el-switch"),b=r("CompilerSelect"),D=r("el-form");return d(),h("div",_e,[a("div",me,[a("div",be,[l(c,{icon:"Plus",type:"primary",onClick:o.createVariable},{default:i(()=>[C("Add")]),_:1},8,["onClick"])]),a("ul",ve,[(d(!0),h(B,null,A(t.variables,s=>(d(),h("li",{key:s.name,class:S({selected:t.currentVariable!=null&&t.currentVariable.name===s.name}),onClick:g=>o.selectVariable(s)},[a("div",Ve,[a("span",null,x(s.message),1),a("em",{class:S(`type-${s.inputType}`)},x(o.__getInputTypeLabel(s.inputType)),3)]),fe],10,he))),128))])]),a("div",ge,[ye,a("div",Ie,[t.currentVariable!=null?(d(),I(D,{key:0},{default:i(()=>[l(_,{label:"Name",required:""},{default:i(()=>[l(m,{modelValue:t.currentVariable.name,"onUpdate:modelValue":n[0]||(n[0]=s=>t.currentVariable.name=s),onInput:o.saveVariables},null,8,["modelValue","onInput"])]),_:1}),l(_,{label:"Message",required:""},{default:i(()=>[l(y,{modelValue:t.currentVariable.message,"onUpdate:modelValue":n[1]||(n[1]=s=>t.currentVariable.message=s),onInput:o.saveVariables},null,8,["modelValue","onInput"])]),_:1}),l(_,{label:"Input Type",required:""},{default:i(()=>[l(f,{modelValue:t.currentVariable.inputType,"onUpdate:modelValue":n[2]||(n[2]=s=>t.currentVariable.inputType=s),onChange:o.saveVariables},null,8,["modelValue","onChange"])]),_:1}),t.currentVariable.inputType==="checkbox"||t.currentVariable.inputType==="radio"?(d(),I(_,{key:0,label:"Options",class:"item-options",required:""},{label:i(()=>[a("div",null,[ke,a("div",Ce,[l(c,{icon:"Top",class:"button-icon"}),l(c,{icon:"Bottom",class:"button-icon"}),l(c,{onClick:o.createOption},{default:i(()=>[C("Add")]),_:1},8,["onClick"])])])]),default:i(()=>[l(w,{data:t.currentVariable.options},{default:i(()=>[l(p,{label:"*Value","min-width":"120px"},{default:i(({row:s})=>[l(m,{modelValue:s.value,"onUpdate:modelValue":g=>s.value=g,onInput:o.saveVariables},null,8,["modelValue","onUpdate:modelValue","onInput"])]),_:1}),l(p,{label:"*Label","min-width":"200px"},{default:i(({row:s})=>[l(m,{modelValue:s.label,"onUpdate:modelValue":g=>s.label=g,type:"textarea",rows:1,onInput:o.saveVariables},null,8,["modelValue","onUpdate:modelValue","onInput"])]),_:1}),l(p,{label:"Remark","min-width":"150px"},{default:i(({row:s})=>[l(m,{modelValue:s.remark,"onUpdate:modelValue":g=>s.remark=g,type:"textarea",rows:1,onInput:o.saveVariables},null,8,["modelValue","onUpdate:modelValue","onInput"])]),_:1}),t.currentVariable.options.length>0?(d(),I(p,{key:0,"min-width":"60px",fixed:"right"},{default:i(({row:s,index:g})=>[l(c,{icon:"Delete",class:"button-icon",onClick:Je=>o.deleteOption(g)},null,8,["onClick"])]),_:1})):V("",!0)]),_:1},8,["data"])]),_:1})):V("",!0),l(_,{label:"Default Value"},{default:i(()=>[l(N,{variable:t.currentVariable,"value-key":"defaultValue",onChange:o.saveVariables},null,8,["variable","onChange"])]),_:1}),l(_,{label:"Required"},{default:i(()=>[l(u,{modelValue:t.currentVariable.required,"onUpdate:modelValue":n[3]||(n[3]=s=>t.currentVariable.required=s),onChange:o.saveVariables},null,8,["modelValue","onChange"])]),_:1}),l(_,{label:"Compiler"},{default:i(()=>[l(b,{modelValue:t.currentVariable.compiler,"onUpdate:modelValue":n[4]||(n[4]=s=>t.currentVariable.compiler=s),onChange:o.saveVariables},null,8,["modelValue","onChange"])]),_:1}),l(_,{label:"Remark"},{default:i(()=>[l(m,{modelValue:t.currentVariable.remark,"onUpdate:modelValue":n[5]||(n[5]=s=>t.currentVariable.remark=s),type:"textarea",rows:3,onInput:o.saveVariables},null,8,["modelValue","onInput"])]),_:1})]),_:1})):V("",!0)])])])}const xe=T(pe,[["render",Se],["__scopeId","data-v-c32396cf"]]);const Te={components:{SettingVariables:xe,DirectorySelect:X,SettingFiles:de},data(){return{loading:!0,currentTab:"variables",serviceId:null,service:null,directorySelect:{value:""}}},computed:{...L(["currentProject"])},methods:{initialize(){K({id:this.$route.query.service_id,name:this.service.name,type:this.service.type,codespace:this.directorySelect.value}).then(()=>{this.service.initialized=!0}).catch(e=>{console.log("e",e)})},getProfile(){this.loading=!0,Q(this.serviceId).then(e=>{this.service=e}).catch(e=>{console.log("e",e)}).finally(()=>{this.loading=!1})},compile(){$({serviceId:this.service.id,projectId:this.currentProject.id}).then(()=>{console.log("编译成功")}).catch(e=>{console.log("e",e)})},push(){W(this.serviceId).then(e=>{console.log("推送成功",e)}).catch(e=>{console.log("e",e)})}},created(){this.serviceId=this.$route.query.service_id,this.getProfile()}},we=e=>(F("data-v-7f18daf3"),e=e(),z(),e),Ne={key:0,class:"page"},Ue={class:"wrap"},Fe={class:"header-wrap"},ze={class:"header"},qe={key:0,class:"opera"},De={key:0,class:"text-info-1 service-path"},Oe={class:"main"},Pe={class:"tabs"},Be={class:"tab-content"},Re={key:1,class:"initialize-wrap"},je=we(()=>a("div",{class:"tip"},[a("h3",null,"Initialize Service"),a("p",null,"You must first specify or create a local directory and initialize the service. Then you can code the service in the specified local directory.")],-1)),Ee={class:"directory-select-wrap"},Ae={class:"opera-bottom"};function Le(e,n,v,k,t,o){const c=r("el-button"),m=r("SettingFiles"),_=r("SettingVariables"),y=r("DirectorySelect"),f=J("loading");return t.service!=null?U((d(),h("div",Ne,[a("div",Ue,[a("div",Fe,[a("div",ze,[a("h2",null,x(t.service.space.name)+"·"+x(t.service.name),1),t.service.initialized?(d(),h("div",qe,[l(c,{type:"primary",disabled:e.currentProject==null,onClick:o.compile},{default:i(()=>[C("Compile")]),_:1},8,["disabled","onClick"]),l(c,{type:"primary",onClick:o.push},{default:i(()=>[C("Publish")]),_:1},8,["onClick"])])):V("",!0)]),t.service.initialized&&t.service.local!=null?(d(),h("p",De,"At "+x(t.service.local.codespace),1)):V("",!0)]),a("div",Oe,[t.service.initialized?(d(),h(B,{key:0},[a("ul",Pe,[a("li",{class:S({selected:t.currentTab==="basic"}),onClick:n[0]||(n[0]=p=>t.currentTab="basic")},"Basic",2),a("li",{class:S({selected:t.currentTab==="variables"}),onClick:n[1]||(n[1]=p=>t.currentTab="variables")},"Variables",2),a("li",{class:S({selected:t.currentTab==="files"}),onClick:n[2]||(n[2]=p=>t.currentTab="files")},"Files",2)]),a("div",Be,[U(l(m,{"service-id":t.serviceId},null,8,["service-id"]),[[O,t.currentTab==="files"]]),U(l(_,{ref:"variables","service-id":t.serviceId},null,8,["service-id"]),[[O,t.currentTab==="variables"]])])],64)):(d(),h("div",Re,[je,a("div",Ee,[t.loading?V("",!0):(d(),I(y,{key:0,modelValue:t.directorySelect.value,"onUpdate:modelValue":n[3]||(n[3]=p=>t.directorySelect.value=p),title:"Select Service Directory"},null,8,["modelValue"]))]),a("div",Ae,[l(c,{type:"primary",size:"large",onClick:o.initialize},{default:i(()=>[C("Initialize Service")]),_:1},8,["onClick"])])]))])])])),[[f,t.loading]]):V("",!0)}const Qe=T(Te,[["render",Le],["__scopeId","data-v-7f18daf3"]]);export{Qe as default};
